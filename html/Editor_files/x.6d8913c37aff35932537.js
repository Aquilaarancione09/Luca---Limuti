(()=>{"use strict";var e,t,s,i,n,a,r,o,h={8132:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.r(t),s.d(t,{Displacement:()=>a.KL,Gif:()=>a.nt,GifBuffer:()=>a.ZM,Layer:()=>a.mh,Mp4:()=>a.HE,PXD:()=>a.BS,Stroke:()=>a.mP,ZipReader:()=>a.Mr,ZipWriter:()=>a._Q,__wbg_buffer_397eaa4d72ee94dd:()=>a.jp,__wbg_height_28c0c13811abedde:()=>a.mE,__wbg_new_de1f835fd3453d3d:()=>a.MS,__wbg_newwithbyteoffsetandlength_8252bb2eb6e239b2:()=>a.dZ,__wbg_width_5491bf1bf3b1e78a:()=>a.gI,__wbg_x_84616b3462f445c9:()=>a.bi,__wbg_y_3b1c131c2eb62473:()=>a.lK,__wbindgen_memory:()=>a.oH,__wbindgen_object_drop_ref:()=>a.ug,__wbindgen_rethrow:()=>a.nD,__wbindgen_string_new:()=>a.h4,__wbindgen_throw:()=>a.Or,distanceTransform:()=>a.TK,distanceTransformInv:()=>a.Mt});var n=s(2982),a=s(2646),r=e([n,a]);[n,a]=r.then?(await r)():r,i()}catch(o){i(o)}}))},2646:(e,t,s)=>{s.a(e,(async(i,n)=>{try{s.d(t,{BS:()=>z,HE:()=>D,KL:()=>I,MS:()=>Y,Mr:()=>B,Mt:()=>A,Or:()=>K,TK:()=>M,ZM:()=>R,_Q:()=>O,bi:()=>H,dZ:()=>W,gI:()=>V,h4:()=>U,jp:()=>G,lK:()=>q,mE:()=>j,mP:()=>N,mh:()=>F,nD:()=>Q,nt:()=>_,oH:()=>$,ug:()=>X});var a=s(6817),r=s(2982);e=s.hmd(e);var o=i([r]);r=(o.then?(await o)():o)[0];let h=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});h.decode();let c=null;function l(){return null!==c&&c.buffer===r.memory.buffer||(c=new Uint8Array(r.memory.buffer)),c}function d(e,t){return h.decode(l().subarray(e,e+t))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let p=u.length;function g(e){p===u.length&&u.push(u.length+1);const t=p;return p=u[t],u[t]=e,t}function m(e){return u[e]}function v(e){e<36||(u[e]=p,p=e)}function f(e){const t=m(e);return v(e),t}let y=0;let w=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const b="function"==typeof w.encodeInto?function(e,t){return w.encodeInto(e,t)}:function(e,t){const s=w.encode(e);return t.set(s),{read:e.length,written:s.length}};function x(e,t,s){if(void 0===s){const s=w.encode(e),i=t(s.length);return l().subarray(i,i+s.length).set(s),y=s.length,i}let i=e.length,n=t(i);const a=l();let r=0;for(;r<i;r++){const t=e.charCodeAt(r);if(t>127)break;a[n+r]=t}if(r!==i){0!==r&&(e=e.slice(r)),n=s(n,i,i=r+3*e.length);const t=l().subarray(n+r,n+i);r+=b(e,t).written}return y=r,n}function Z(e,t){const s=t(1*e.length);return l().set(e,s/1),y=e.length,s}let k=null;function E(){return null!==k&&k.buffer===r.memory.buffer||(k=new Int32Array(r.memory.buffer)),k}function P(e,t){return l().subarray(e/1,e/1+t)}let S=null;function C(e,t){return(null!==S&&S.buffer===r.memory.buffer||(S=new Uint8ClampedArray(r.memory.buffer)),S).subarray(e/1,e/1+t)}let T=null;function L(e,t){return(null!==T&&T.buffer===r.memory.buffer||(T=new Float32Array(r.memory.buffer)),T).subarray(e/4,e/4+t)}function M(e,t,s){try{const c=r.__wbindgen_add_to_stack_pointer(-16);var i=Z(s,r.__wbindgen_malloc),n=y;r.distanceTransform(c,e,t,i,n);var a=E()[c/4+0],o=E()[c/4+1],h=L(a,o).slice();return r.__wbindgen_free(a,4*o),h}finally{r.__wbindgen_add_to_stack_pointer(16)}}function A(e,t,s){try{const c=r.__wbindgen_add_to_stack_pointer(-16);var i=Z(s,r.__wbindgen_malloc),n=y;r.distanceTransformInv(c,e,t,i,n);var a=E()[c/4+0],o=E()[c/4+1],h=L(a,o).slice();return r.__wbindgen_free(a,4*o),h}finally{r.__wbindgen_add_to_stack_pointer(16)}}class I{static __wrap(e){const t=Object.create(I.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_displacement_free(e)}constructor(e,t,s,i,n,a){var o=Z(e,r.__wbindgen_malloc),h=y,c=r.displacement_new(o,h,t,s,i,n,a);return I.__wrap(c)}beginStroke(){var e=r.displacement_beginStroke(this.ptr);return N.__wrap(e)}setStampSize(e){r.displacement_setStampSize(this.ptr,e)}setDensity(e){r.displacement_setDensity(this.ptr,e)}setStrength(e){r.displacement_setStrength(this.ptr,e)}retarget(e,t,s){var i=Z(e,r.__wbindgen_malloc),n=y;r.displacement_retarget(this.ptr,i,n,t,s)}setMode(e){var t=x(e,r.__wbindgen_malloc,r.__wbindgen_realloc),s=y;r.displacement_setMode(this.ptr,t,s)}applyFast(e){return f(r.displacement_applyFast(this.ptr,g(e)))}applyQuality(e){return f(r.displacement_applyQuality(this.ptr,g(e)))}}class _{static __wrap(e){const t=Object.create(_.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_gif_free(e)}constructor(e,t,s){var i=r.gif_new(e,t,s);return _.__wrap(i)}addFrame(e,t,s){var i=Z(e,r.__wbindgen_malloc),n=y;r.gif_addFrame(this.ptr,i,n,t,s)}takeResult(){try{const i=this.__destroy_into_raw(),n=r.__wbindgen_add_to_stack_pointer(-16);r.gif_takeResult(n,i);var e=E()[n/4+0],t=E()[n/4+1],s=C(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class R{__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_gifbuffer_free(e)}}class F{static __wrap(e){const t=Object.create(F.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_layer_free(e)}get kind(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_kind(s,this.ptr);var e=E()[s/4+0],t=E()[s/4+1];return d(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get x(){return r.layer_x(this.ptr)}get y(){return r.layer_y(this.ptr)}get name(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_name(s,this.ptr);var e=E()[s/4+0],t=E()[s/4+1];return d(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get width(){return r.layer_width(this.ptr)}get height(){return r.layer_height(this.ptr)}get alpha(){return r.layer_alpha(this.ptr)}get blendMode(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_blendMode(s,this.ptr);var e=E()[s/4+0],t=E()[s/4+1];return d(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get visible(){return 0!==r.layer_visible(this.ptr)}get locked(){return 0!==r.layer_locked(this.ptr)}get rotation(){return r.layer_rotation(this.ptr)}takeCanvas(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeCanvas(i,this.ptr);var e=E()[i/4+0],t=E()[i/4+1],s=C(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeMask(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeMask(i,this.ptr);var e=E()[i/4+0],t=E()[i/4+1],s=C(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}get meta(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_meta(s,this.ptr);var e=E()[s/4+0],t=E()[s/4+1];return d(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}}class D{static __wrap(e){const t=Object.create(D.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_mp4_free(e)}constructor(e){var t=r.mp4_new(e);return D.__wrap(t)}addVideoTrack(e,t,s){var i=Z(s,r.__wbindgen_malloc),n=y;return r.mp4_addVideoTrack(this.ptr,e,t,i,n)>>>0}addFrame(e,t,s,i,n,a){var o=Z(a,r.__wbindgen_malloc),h=y;r.mp4_addFrame(this.ptr,e,t,s,i,n,o,h)}fetchFile(){try{const i=this.__destroy_into_raw(),n=r.__wbindgen_add_to_stack_pointer(-16);r.mp4_fetchFile(n,i);var e=E()[n/4+0],t=E()[n/4+1],s=P(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class z{static __wrap(e){const t=Object.create(z.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_pxd_free(e)}get width(){return r.__wbg_get_pxd_width(this.ptr)}set width(e){r.__wbg_set_pxd_width(this.ptr,e)}get height(){return r.__wbg_get_pxd_height(this.ptr)}set height(e){r.__wbg_set_pxd_height(this.ptr,e)}get layers(){return r.__wbg_get_pxd_layers(this.ptr)}set layers(e){r.__wbg_set_pxd_layers(this.ptr,e)}static decode(e){var t=Z(e,r.__wbindgen_malloc),s=y,i=r.pxd_decode(t,s);return z.__wrap(i)}takeNextLayer(){var e=r.pxd_takeNextLayer(this.ptr);return F.__wrap(e)}}class N{static __wrap(e){const t=Object.create(N.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_stroke_free(e)}push(e,t,s){return f(r.stroke_push(this.ptr,e,t,s))}}class B{static __wrap(e){const t=Object.create(B.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_zipreader_free(e)}constructor(e){var t=Z(e,r.__wbindgen_malloc),s=y,i=r.zipreader_new(t,s);return B.__wrap(i)}readFile(e){try{const o=r.__wbindgen_add_to_stack_pointer(-16);var t=x(e,r.__wbindgen_malloc,r.__wbindgen_realloc),s=y;r.zipreader_readFile(o,this.ptr,t,s);var i=E()[o/4+0],n=E()[o/4+1],a=P(i,n).slice();return r.__wbindgen_free(i,1*n),a}finally{r.__wbindgen_add_to_stack_pointer(16)}}readString(e){try{const a=r.__wbindgen_add_to_stack_pointer(-16);var t=x(e,r.__wbindgen_malloc,r.__wbindgen_realloc),s=y;r.zipreader_readString(a,this.ptr,t,s);var i=E()[a/4+0],n=E()[a/4+1];return d(i,n)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(i,n)}}}class O{static __wrap(e){const t=Object.create(O.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_zipwriter_free(e)}constructor(){var e=r.zipwriter_new();return O.__wrap(e)}writeFile(e,t,s){var i=x(e,r.__wbindgen_malloc,r.__wbindgen_realloc),n=y,a=Z(t,r.__wbindgen_malloc),o=y;r.zipwriter_writeFile(this.ptr,i,n,a,o,s)}writeString(e,t,s){var i=x(e,r.__wbindgen_malloc,r.__wbindgen_realloc),n=y,a=x(t,r.__wbindgen_malloc,r.__wbindgen_realloc),o=y;r.zipwriter_writeString(this.ptr,i,n,a,o,s)}finish(){try{const i=this.__destroy_into_raw(),n=r.__wbindgen_add_to_stack_pointer(-16);r.zipwriter_finish(n,i);var e=E()[n/4+0],t=E()[n/4+1],s=P(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}function U(e,t){return g(d(e,t))}function H(e){return m(e).x}function q(e){return m(e).y}function V(e){return m(e).width}function j(e){return m(e).height}function $(){return g(r.memory)}function G(e){return g(m(e).buffer)}function W(e,t,s){return g(new Uint8ClampedArray(m(e),t>>>0,s>>>0))}function X(e){f(e)}function Y(e,t,s,i){return g(new a.Z(e,t,s,i))}function K(e,t){throw new Error(d(e,t))}function Q(e){throw f(e)}n()}catch(h){n(h)}}))},1030:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(4820);const n=(e,t)=>{if("undefined"==typeof ga||"function"!=typeof ga.getAll||void 0===ga.getAll()[0])return;const s=ga.getAll()[0].get("name");ga(`${s}.send`,{hitType:"event",eventCategory:(i.ZP.user&&"guest"!==i.ZP.user.name?i.ZP.user.subscription?"Premium":"User":"Guest")+":"+i.ZP.product,eventAction:e,eventLabel:t})}},2396:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3990),n=s(7318);class a{constructor(e=!1,t,s,i,n){this.block=e,this.enter=t,this.scene=s,this.exit=i,this.stagger=n}}a.fromInjection=(e,t)=>{let s=t?a.clone(t):new a;if(s.block=!1,!e)return s;if(e.enter&&(s.enter&&(e.enter.delay=s.enter.delay,e.enter.speed=s.enter.speed),s.enter=e.enter,s.enter.duration=s.enter.duration?s.enter.duration:a.getMotionsDuration(s.enter.motions)),e.scene&&(s.scene&&(e.scene.delay=s.scene.delay,e.scene.speed=s.scene.speed,e.scene.repeat=s.scene.repeat,e.scene.gap=s.scene.gap),s.scene=e.scene,s.scene.motions)){let e=a.getMotionsDuration(s.scene.motions);s.scene.duration=e+s.scene.repeat*(e+s.scene.gap)}return e.exit&&(s.exit&&(e.exit.delay=s.exit.delay,e.exit.speed=s.exit.speed),s.exit=e.exit,s.exit.duration=a.getMotionsDuration(s.exit.motions)),e.stagger&&(s.stagger=e.stagger),s},a.getSegment=(e,t)=>{if(t)switch(e){case"enter":return t.enter;case"scene":return t.scene;case"exit":return t.exit}},a.setSegmentSpeed=(e,t)=>{if(!e)return;e.speed=t;let s=a.getMotionsDuration(e.motions,e.speed);e.duration=s+e.repeat*(s+e.gap)},a.setSegmentRepeat=(e,t)=>{if(!e)return;let s=a.getMotionsDuration(e.motions,e.speed);e.repeat=t,e.duration=s+t*(s+e.gap)},a.setSegmentGap=(e,t)=>{if(!e)return;let s=a.getMotionsDuration(e.motions,e.speed);e.gap=t,e.duration=s+e.repeat*(s+e.gap)},a.getAnimationSegment=(e,t)=>{if(!t)return;const s=new a(t.block);return"enter"===e&&(s.enter=new i.Z(t.enter.name,[...t.enter.motions],t.enter.option,t.enter.duration,t.enter.delay,t.enter.speed,t.enter.repeat,t.enter.gap)),"scene"===e&&(s.scene=new i.Z(t.scene.name,[...t.scene.motions],t.scene.option,t.scene.duration,t.scene.delay,t.scene.speed,t.scene.repeat,t.scene.gap)),"exit"===e&&(s.exit=new i.Z(t.exit.name,[...t.exit.motions],t.exit.option,t.exit.duration,t.exit.delay,t.exit.speed,t.exit.repeat,t.exit.gap)),s},a.getMotionsDuration=(e,t=1)=>{if(!e||0===e.length)return 0;let s=0;for(const i of e)s=Math.max(s,Math.round((i.delay+i.duration)*t));return s},a.clone=e=>{if(!e)return;const t=new a(e.block);return e.enter&&(t.enter=new i.Z(e.enter.name,[...e.enter.motions],e.enter.option,e.enter.duration,e.enter.delay,e.enter.speed,e.enter.repeat,e.enter.gap)),e.scene&&(t.scene=new i.Z(e.scene.name,[...e.scene.motions],e.scene.option,e.scene.duration,e.scene.delay,e.scene.speed,e.scene.repeat,e.scene.gap)),e.exit&&(t.exit=new i.Z(e.exit.name,[...e.exit.motions],e.exit.option,e.exit.duration,e.exit.delay,e.exit.speed,e.exit.repeat,e.exit.gap)),e.stagger&&(t.stagger=new n.Z(e.stagger.duration,e.stagger.metod)),t}},7339:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(9872),n=s(3673),a=s(4256),r=s(9422),o=s(7318),h=s(2396);class c{constructor(e,t){this.scantime=0,this.scantype="none",this.getDuration=()=>{let e=0;return this.transitions.forEach((t=>{e=Math.max(e,t.getDuration())})),e},this.prepare=e=>{for(const t of this.transitions)t.motion.fill&&(t.begin(this.getProperty(t.motion.method,e)),this.setProperty(t.motion.method,t.motion.manner,e,t.step(0)))},this.step=(e,t)=>{for(const s of this.transitions)s.shouldRun(e)&&(s.playing||s.begin(this.getProperty(s.motion.method,t)),this.setProperty(s.motion.method,s.motion.manner,t,s.step(e)))},this.setProperty=(e,t,s,i)=>{switch(e){case"opacity":this.layer.transform.opacity=i;break;case"rotate":this.layer.transform.rotation=360*i,this.layer.transform.rAnchor=this.anchorToPoint(t);break;case"scale":this.layer.transform.scale.x=i,this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-width":this.layer.transform.scale.x=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-height":this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"self-x":this.layer.transform.offset.x=i*this.layer.getRect().width;break;case"self-y":this.layer.transform.offset.y=i*this.layer.getRect().height;break;case"offset-x":this.layer.transform.offset.x=i*s.width;break;case"offset-y":this.layer.transform.offset.y=i*s.height;break;case"viewport-x":this.layer.transform.offset.x=i*s.width-this.layer.getRect().center().x;break;case"viewport-y":this.layer.transform.offset.y=i*s.height-this.layer.getRect().center().y;break;case"viewport-box-x":const n=this.transformedRectWidth();this.layer.transform.offset.x=this.layer.getRect().center().x-(.5*n+i*(s.width-n));break;case"viewport-box-y":const a=this.transformedRectHeight();this.layer.transform.offset.y=this.layer.getRect().center().y-(.5*a+i*(s.height-a));break;default:this.setShader(e,i,t)}},this.transformedRectWidth=()=>this.layer.getRect().width*this.layer.transform.scale.x,this.transformedRectHeight=()=>this.layer.getRect().height*this.layer.transform.scale.y,this.anchorToPoint=e=>{switch(e){case"topleft":return new n.Z(0,0);case"top":return new n.Z(.5,0);case"topright":return new n.Z(1,0);case"left":return new n.Z(0,.5);case"center":return new n.Z(.5,.5);case"right":return new n.Z(1,.5);case"bottomleft":return new n.Z(0,1);case"bottom":return new n.Z(.5,1);case"bottomright":return new n.Z(1,1)}return new n.Z(.5,.5)},this.setShader=(e,t,s)=>{switch(this.shaders||(this.shaders=new a.Z),e){case"wipe":this.shaders.addShader("wipe",{direction:s,amount:t});break;case"slot":this.shaders.addShader("slot",{direction:s,amount:t});break;case"blinds":this.shaders.addShader("blinds",{direction:s,amount:t});break;case"melt":this.shaders.addShader("melt",{direction:s,amount:t});break;case"warp":this.shaders.addShader("warp",{direction:s,amount:t});break;case"curtain":this.shaders.addShader("curtain",{direction:s,amount:t});break;case"split":this.shaders.addShader("split",{direction:s,sections:2,amount:t});break;case"line":this.shaders.addShader("split",{direction:s,sections:8,amount:t});break;default:this.shaders.addShader(e,t)}this.layer.transient=this.shaders.apply(this.layer.baked?this.layer.baked:this.layer.canvas)},this.getProperty=(e,t)=>{switch(e){case"opacity":return this.layer.transform.opacity;case"rotate":return this.layer.transform.rotation/360;case"scale":case"scale-width":return this.layer.transform.scale.x;case"scale-height":return this.layer.transform.scale.y;case"self-x":return this.layer.transform.offset.x/this.layer.getRect().width;case"self-y":return this.layer.transform.offset.y/this.layer.getRect().height;case"offset-x":return this.layer.transform.offset.x/t.width;case"offset-y":return this.layer.transform.offset.y/t.height;case"viewport-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/t.width;case"viewport-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/t.height;case"viewport-box-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/(t.width-this.transformedRectWidth());case"viewport-box-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/(t.height-this.transformedRectHeight())}return 0},this.finish=()=>{this.layer.transient=void 0,this.layer.transform=void 0},this.layer=e,this.transitions=t,this.layer.transform={sAnchor:new n.Z(.5,.5),rAnchor:new n.Z(.5,.5),scale:new n.Z(1,1),offset:new n.Z(0,0),rotation:0,opacity:1}}}c.bakeAnimators=e=>{const t=new Array;for(const s of e.layers)if(!s.animation&&e.animation){const i=c.createPageTransitions(s,e,e.animation);i.length>0&&t.push(new c(s,i))}else if(s.animation&&!s.animation.block){const e=c.createLayerTransitions(s.animation);t.push(new c(s,e))}return t},c.createPageTransitions=(e,t,s)=>{const n=t.layerNr(e.id),a=t.layers.length,h=new i.Z(t.width,t.height),l=c.filterMotions(s.enter,e,n,a,h),d=c.filterMotions(s.scene,e,n,a,h),u=c.filterMotions(s.exit,e,n,a,h);if(!l&&!d&&!u&&0===l.length&&0===d.length&&0===u.length)return;const p=0===n&&e.settings.locked?0:o.Z.getOffset(e,t,s.stagger),g=s.enter?s.enter.duration+s.enter.delay:0,m=s.scene?s.scene.duration+s.scene.delay:0,v=new Array;if(l)for(const i of l)v.push(new r.Z(i,s.enter.speed,s.enter.delay+p));if(d)for(const i of d)v.push(new r.Z(i,s.scene.speed,s.scene.delay+p+g));if(u)for(const i of u)v.push(new r.Z(i,s.exit.speed,s.enter.delay+p+g+m));return v},c.createLayerTransitions=(e,t=!1)=>{const s=!!e.enter,i=!!e.scene,n=new Array;let a=s?e.enter.duration:0,o=i?e.scene.duration:0;if(!t&&s&&(a+=e.enter.delay),(t&&s&&i||!t&&i)&&(o+=e.scene.delay),e.enter){const s=t?0:e.enter.delay;for(const t of e.enter.motions)n.push(new r.Z(t,e.enter.speed,s))}if(e.scene){const i=t&&!s?0:e.scene.delay;for(const t of e.scene.motions)n.push(new r.Z(t,e.scene.speed,i+a));if(e.scene.repeat>0){let t=h.Z.getMotionsDuration(e.scene.motions,e.scene.speed),s=t+e.scene.gap;for(let o=0;o<e.scene.repeat;o++){for(const t of e.scene.motions)n.push(new r.Z(t,e.scene.speed,s+i+a));s+=t+e.scene.gap}}}if(e.exit){const h=!t||s||i?e.exit.delay:0;for(const t of e.exit.motions)n.push(new r.Z(t,e.exit.speed,h+a+o))}return n},c.createSegmentTransitions=e=>{const t=new Array;if(e)for(const s of e.motions)t.push(new r.Z(s,e.speed));return t},c.filterMotions=(e,t,s,i,n)=>{if(!e||!e.motions||0===e.motions.length)return;let a;for(const r of e.motions)if(c.filterMotion(t,s,i,n,r)){a=r.filter;break}return e.motions.filter((e=>e.filter===a))},c.filterMotion=(e,t,s,i,n)=>{if("background"===n.filter)return 0===t&&e.settings.locked;if(0===t&&e.settings.locked)return!1;if("foreground"===n.filter)return t===s-1;if("all"===n.filter||n.filter===e.type)return!0;if("large"===n.filter)return e.getRect().width>.75*i.width||e.getRect().height>.75*i.height;if("medium"===n.filter)return e.getRect().width>.25*i.width&&e.getRect().width<.75*i.width&&e.getRect().height>.25*i.height&&e.getRect().height<.75*i.height;if("small"===n.filter)return e.getRect().width<.25*i.width||e.getRect().height<.25*i.height;switch(n.filter){case"odd":return t%2==1;case"even":return t%2==0;case"1-three":return t%3==0;case"2-three":return t%3==1;case"3-three":return t%3==2;case"1-four":return t%4==0;case"2-four":return t%4==1;case"3-four":return t%4==2;case"4-four":return t%4==3}}},1750:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e){switch(this.type=e,this.type){case i.EASE_LINEAR:this.calculate=i.linear;break;case i.EASE_TWENTY_LADDER:this.calculate=i.ladderTwenty;break;case i.EASE_TEN_LADDER:this.calculate=i.ladderTen;break;case i.EASE_FIVE_LADDER:this.calculate=i.ladderFive;break;case i.EASE_THREE_LADDER:this.calculate=i.ladderThree;break;case i.EASE_IN_SINE:this.calculate=i.inSine;break;case i.EASE_OUT_SINE:this.calculate=i.outSine;break;case i.EASE_IN_OUT_SINE:this.calculate=i.inOutSine;break;case i.EASE_IN_CUBIC:this.calculate=i.inCubic;break;case i.EASE_OUT_CUBIC:this.calculate=i.outCubic;break;case i.EASE_IN_OUT_CUBIC:this.calculate=i.inOutCubic;break;case i.EASE_IN_QUINT:this.calculate=i.inQuint;break;case i.EASE_OUT_QUINT:this.calculate=i.outQuint;break;case i.EASE_IN_OUT_QUINT:this.calculate=i.inOutQuint;break;case i.EASE_IN_CIRC:this.calculate=i.inCirc;break;case i.EASE_OUT_CIRC:this.calculate=i.outCirc;break;case i.EASE_IN_OUT_CIRC:this.calculate=i.inOutCirc;break;case i.EASE_IN_QUAD:this.calculate=i.inQuad;break;case i.EASE_OUT_QUAD:this.calculate=i.outQuad;break;case i.EASE_IN_OUT_QUAD:this.calculate=i.inOutQuad;break;case i.EASE_IN_QUART:this.calculate=i.inQuart;break;case i.EASE_OUT_QUART:this.calculate=i.outQuart;break;case i.EASE_IN_OUT_QUART:this.calculate=i.inOutQuart;break;case i.EASE_IN_EXPO:this.calculate=i.inExpo;break;case i.EASE_OUT_EXPO:this.calculate=i.outExpo;break;case i.EASE_IN_OUT_EXPO:this.calculate=i.inOutExpo;break;case i.EASE_IN_BACK:this.calculate=i.inBack;break;case i.EASE_OUT_BACK:this.calculate=i.outBack;break;case i.EASE_IN_OUT_BACK:this.calculate=i.inOutBack;break;case i.EASE_IN_BOUNCE:this.calculate=i.inBounce;break;case i.EASE_OUT_BOUNCE:this.calculate=i.outBounce;break;case i.EASE_IN_OUT_BOUNCE:this.calculate=i.inOutBounce;break;case i.EASE_IN_ELASTIC:this.calculate=i.inElastic;break;case i.EASE_OUT_ELASTIC:this.calculate=i.outElastic;break;case i.EASE_IN_OUT_ELASTIC:this.calculate=i.inOutElastic}}static inOutQuint(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}static outCirc(e){return Math.sqrt(1-Math.pow(e-1,2))}static inOutCirc(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}}i.EASE_LINEAR="linear",i.EASE_TWENTY_LADDER="twenty-ladder",i.EASE_TEN_LADDER="ten-ladder",i.EASE_FIVE_LADDER="five-ladder",i.EASE_THREE_LADDER="three-ladder",i.EASE_IN_SINE="in-sine",i.EASE_OUT_SINE="out-sine",i.EASE_IN_OUT_SINE="in-out-sine",i.EASE_IN_CUBIC="in-cubic",i.EASE_OUT_CUBIC="out-cubic",i.EASE_IN_OUT_CUBIC="in-out-cubic",i.EASE_IN_QUINT="in-quint",i.EASE_OUT_QUINT="out-quint",i.EASE_IN_OUT_QUINT="in-out-quint",i.EASE_IN_CIRC="in-circ",i.EASE_OUT_CIRC="out-circ",i.EASE_IN_OUT_CIRC="in-out-circ",i.EASE_IN_QUAD="in-quad",i.EASE_OUT_QUAD="out-quad",i.EASE_IN_OUT_QUAD="in-out-quad",i.EASE_IN_QUART="in-quart",i.EASE_OUT_QUART="out-quart",i.EASE_IN_OUT_QUART="in-out-quart",i.EASE_IN_EXPO="in-expo",i.EASE_OUT_EXPO="out-expo",i.EASE_IN_OUT_EXPO="in-out-expo",i.EASE_IN_BACK="in-back",i.EASE_OUT_BACK="out-back",i.EASE_IN_OUT_BACK="in-out-back",i.EASE_IN_BOUNCE="in-bounce",i.EASE_OUT_BOUNCE="out-bounce",i.EASE_IN_OUT_BOUNCE="in-out-bounce",i.EASE_IN_ELASTIC="in-elastic",i.EASE_OUT_ELASTIC="out-elastic",i.EASE_IN_OUT_ELASTIC="in-out-elastic",i.linear=e=>e,i.ladderTwenty=e=>i.ladder(e,20),i.ladderTen=e=>i.ladder(e,10),i.ladderFive=e=>i.ladder(e,5),i.ladderThree=e=>i.ladder(e,3),i.ladder=(e,t)=>Math.ceil(e*t)*(1/t),i.inSine=e=>1-Math.cos(e*Math.PI/2),i.outSine=e=>Math.sin(e*Math.PI/2),i.inOutSine=e=>-(Math.cos(Math.PI*e)-1)/2,i.inCubic=e=>e*e*e,i.outCubic=e=>1-Math.pow(1-e,3),i.inOutCubic=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,i.inQuint=e=>e*e*e*e*e,i.outQuint=e=>1-Math.pow(1-e,5),i.inCirc=e=>1-Math.sqrt(1-Math.pow(e,2)),i.inQuad=e=>e*e,i.outQuad=e=>1-(1-e)*(1-e),i.inOutQuad=e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,i.inQuart=e=>e*e*e*e,i.outQuart=e=>1-Math.pow(1-e,4),i.inOutQuart=e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,i.inExpo=e=>0===e?0:Math.pow(2,10*e-10),i.outExpo=e=>1===e?1:1-Math.pow(2,-10*e),i.inOutExpo=e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,i.inBack=e=>{const t=1.70158;return 2.70158*e*e*e-t*e*e},i.outBack=e=>{const t=1.70158;return 1+2.70158*Math.pow(e-1,3)+t*Math.pow(e-1,2)},i.inOutBack=e=>{const t=2.5949095;return e<.5?Math.pow(2*e,2)*(7.189819*e-t)/2:(Math.pow(2*e-2,2)*((t+1)*(2*e-2)+t)+2)/2},i.inBounce=e=>1-i.outBounce(1-e),i.outBounce=e=>{const t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-=1.5/s)*e+.75:e<2.5/s?t*(e-=2.25/s)*e+.9375:t*(e-=2.625/s)*e+.984375},i.inOutBounce=e=>e<.5?(1-i.outBounce(1-2*e))/2:(1+i.outBounce(2*e-1))/2,i.inElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*t)},i.outElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},i.inOutElastic=e=>{const t=2*Math.PI/4.5;return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1}},3990:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s,n=0,a=0,r=i.SPEED_NORMAL,o=0,h=0){this.name=e,this.motions=t,this.option=s,this.duration=n,this.delay=a,this.speed=r,this.repeat=o,this.gap=h}}i.SPEED_SLOW=2,i.SPEED_NORMAL=1,i.SPEED_FAST=.5},7318:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3655),n=s(3673);class a{constructor(e,t="top"){this.duration=e,this.metod=t}}a.getOffset=(e,t,s)=>{let a=0;if(void 0===s||0===s.duration)return a;switch(s.metod){case"top":a=e.getRect().y/t.height;break;case"bottom":a=1-e.getRect().y/t.height;break;case"left":a=e.getRect().x/t.width;break;case"right":a=1-e.getRect().x/t.width;break;case"back":a=t.layerNr(e.id)/t.layers.length;break;case"front":a=1-t.layerNr(e.id)/t.layers.length;break;case"center":a=new n.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2;break;case"bounds":a=1-new n.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2}return Math.round((0,i.uZ)(a*s.duration,0,s.duration))}},3409:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),n=s(9872),a=s(7339);class r{constructor(e,t=24,s=1,r=!1){this.requestFrame=async()=>{if(this.currentFrame+=1,this.currentFrame>this.totalFrames)return void this.cancel();const e=this.currentFrame*this.interval,t=new n.Z(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(e,t);return this.stage.renderOutputFrame(this.ctx,this.inclusive),1!==this.scale?(await i.iF(),await i.vJ(this.output,this.scaled.width,this.scaled.height,this.scaled)):this.output},this.cancel=()=>{if(this.animators)for(const e of this.animators)e.finish()},this.scale=s,this.stage=e,this.fresco=e.fresco,this.inclusive=r,this.animators=[];let o=this.fresco.width,h=this.fresco.height;if(o%2==1&&(o-=1),h%2==1&&(h-=1),this.output=i.vL(o,h),1!==s){let e=Math.round(this.fresco.width*s),t=Math.round(this.fresco.height*s);e%2==1&&(e-=1),t%2==1&&(t-=1),this.scaled=i.vL(e,t)}this.ctx=this.output.getContext("2d"),this.animators=a.Z.bakeAnimators(e.fresco),this.runTime=0;for(const i of this.animators)this.runTime=Math.max(this.runTime,i.getDuration()),i.prepare(new n.Z(this.fresco.width,this.fresco.height));this.currentFrame=0,this.interval=1e3/t,this.totalFrames=Math.ceil((this.runTime+50)/1e3)*t}}},9422:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(1750);class n{constructor(e,t,s=0){this.shouldRun=e=>{const t=e<this.idelay,s=e>this.idelay+this.iduration;return s&&!this.end?(this.end=!0,!0):!t&&!s},this.getDuration=()=>this.idelay+this.iduration,this.fill=e=>{this.initial=void 0===this.motion.value.set?e:this.motion.value.set;const t=void 0===this.motion.value.from?this.initial:this.motion.value.from,s=void 0===this.motion.value.to?this.initial:this.motion.value.to;return 2===this.motion.direction||4===this.motion.direction?s-(s-t):t+(s-t)},this.begin=e=>{this.end=!1,this.playing=!0,this.initial=void 0===this.motion.value.set?e:this.motion.value.set,this.ibefore=void 0===this.motion.value.from?this.initial:this.motion.value.from,this.iafter=void 0===this.motion.value.to?this.initial:this.motion.value.to},this.step=e=>{if(0===e||e-this.idelay<1||0===this.ipass||0===this.motion.iterations)return this.ibefore;let t=Math.ceil((e-this.idelay)/this.ipass),s=(e-this.idelay)%this.ipass,i=0===s?1:s/this.ipass;(this.end||t>this.motion.iterations)&&(t=this.motion.iterations,i=1);const n=(this.iafter-this.ibefore)*this.ease.calculate(i);return this.flip(t)?this.iafter-n:this.ibefore+n},this.flip=e=>2===this.motion.direction||3===this.motion.direction&&e%2==0||4===this.motion.direction&&e%2==1,this.motion=e,this.ease=new i.Z(e.easing),this.idelay=Math.round(this.motion.delay*t+s),this.iduration=Math.round(this.motion.duration*t),this.ipass=0===this.iduration||0===this.motion.iterations?0:this.iduration/this.motion.iterations}}},165:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>E});var n=s(6548),a=s(3655),r=s(5934),o=s(5574),h=s(3947),c=s(6817),l=s(1030),d=s(3673),u=s(4188),p=s(8776),g=s(4820),m=s(4256),v=s(4211),f=s(4178),y=s(8132),w=s(1951),b=s(1302),x=s(7630),Z=e([y]);y=(Z.then?(await Z)():Z)[0];class k{constructor(e,t,s,i,n,a,r){this.id=e,this.name=t,this.original=s,this.preview=i,this.result=n,this.levels=a,this.saturation=r}}class E{constructor(e,t){this.active=0,this.limit=g.ZP.user.subscription?50:3,this.allTasks=["crop","resize","border","auto","vibrance","saturation","brightness","temperature","tint","contrast","exposure","highlights","shadows","monochrome","sharpen","clarity","glamour","bloom","smooth","blur","grain"],this.appendAddImage=()=>{this.content.append((0,h.T)("div",{id:"batch-add-image"},(0,n.Z)("titleAddImage"))),(0,h.ZP)("batch-add-image").addEventListener("click",this.addImage)},this.addImage=async()=>{this.batch.length>=this.limit?new w.Z(this.home.web.stage,"BATCH"):await(0,r.Q0)(!0).then((async e=>{0!==e.length&&await this.append(e)}))},this.append=async e=>{const t=new Array;for(let s=0;s<e.length&&(this.active+1===this.limit&&(0,h.ZP)("batch-add-image").classList.add("premium"),!(this.active>=this.limit));s++){this.active++;const i=a.M8();t.push({id:i,file:e[s]}),(0,h.ZP)("batch-add-image").after((0,h.T)("div",{id:i,className:"box queue"},(0,h.T)("div",{className:"loading small"})))}t.forEach((async e=>{var t;const s=e.id,i=e.file.name;(0,l.Z)("open-file",null!==(t=e.file.type)&&void 0!==t?t:""),(0,o.s4)(e.file).then((e=>{e&&window.requestAnimationFrame((()=>{const t=c.Z.bestFit(e.width,e.height,800,200),n=c.Z.bestFit(e.width,e.height,g.ZP.user.subscription?8196:4096,g.ZP.user.subscription?8196:4096);let r=a.eY(e,n.width,n.height),o=a.eY(r,t.width,t.height),l=a.dN(o);l.id="result-"+s;const d=a.gr(o),u=a.fu(o);this.batch.push(new k(s,i,r,o,l,d,u)),(0,h.ZP)(s).innerHTML="",(0,h.ZP)(s).classList.remove("queue"),(0,h.ZP)(s).append(l,(0,h.T)("span",{className:"meta"},i)),this.generatePreview(),this.render()}))}))}))},this.generatePreview=()=>{if(this.crop){const e=200,t=Math.round(e/this.crop.y*this.crop.x);this.batch.forEach((s=>{const i=c.Z.fillFit(s.original.width,s.original.height,t,e);s.preview.width=t,s.preview.height=e;s.preview.getContext("2d").drawImage(s.original,i.x,i.y,i.width,i.height),s.result.width=s.preview.width,s.result.height=s.preview.height}))}else this.batch.forEach((e=>{const t=c.Z.bestFit(e.original.width,e.original.height,800,200);e.preview=a.eY(e.original,t.width,t.height),e.result.width=e.preview.width,e.result.height=e.preview.height}))},this.render=()=>{this.batch.forEach((e=>{const t=(0,h.ZP)("result-"+e.id).getContext("2d");"fix"===this.auto&&(this.shaders.addShader("bwpoint",{black:e.levels.x,white:e.levels.y},!0),this.shaders.addShader("vibrance",e.saturation<.7?.7-e.saturation:void 0,!0)),t.drawImage(this.shaders.apply(e.preview),0,0)}))},this.appendAllTasks=()=>{this.allTasks.forEach((e=>{const t=(0,h.T)("div",{id:"task-"+e,className:"batch-task"},(0,h.T)("img",{className:"type ic",src:"/img/tool/"+e+".svg"}),(0,h.T)("div",{id:"task-"+e+"-name",className:"name"},(0,n.Z)(e),(0,h.T)("span",{id:"task-"+e+"-value"})),(0,h.T)("div",{id:"task-"+e+"-settings",className:"settings"}));t.addEventListener("click",this.showTask),t.setAttribute("data",e),(0,h.ZP)("flow-offering").append(t)}))},this.showTask=e=>{const t=e.currentTarget.getAttribute("data");if(t===this.activeTask)return;if(this.activeTask){(0,h.ZP)("task-"+this.activeTask).classList.contains("flow")?this.updateTask(e):((0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.update(void 0))}this.activeTask=t,(0,h.ZP)("task-"+this.activeTask).classList.add("active");const s=(0,h.ZP)("task-"+this.activeTask+"-settings"),i=(0,h.ZP)("task-"+this.activeTask).classList.contains("flow");switch(s.append((0,h.T)("img",{className:"close ic",src:"/img/icon/close.svg",onclick:e=>i?this.updateTask(e):this.closeTask(e)})),this.activeTask){case"crop":const e=(0,h.T)("div");e.innerHTML+='\n                    <div class="select pad-4">\n                        <select id="batch-crop-aspect">\n                            <option value="1:1" selected>1:1 (Square)</option>\n                            \n                            <option value="3:4">3:4 (Social post)</option>\n                            <option value="9:16">9:16 (Social story)</option>\n\n                            <option value="1:2">1:2 (High)</option>\n                            <option value="2:1">2:1 (Wide)</option>\n\n                            <option value="3:2">3:2 (35mm film)</option>\n                            <option value="3:1">3:1 (Panorama)</option>\n                            <option value="4:1">4:1 (4 page social)</option>\n                        \n                            <option value="4:3">4:3 (Monitor)</option>\n\n                            <option value="14:9">14:9</option>\n                            <option value="16:9">16:9 (Widescreen)</option>\n                            <option value="16:10">16:10</option>\n                            \n                            <option value="5:4">5:4</option>\n                            <option value="7:5">7:5</option>\n                            <option value="19:10">19:10</option>\n                            <option value="21:9">21:9 (Cinemascope)</option>\n                            <option value="32:9">32:9 (Super ultra wide)</option>\n                        </select>\n                    </div>\n                ',s.append(e),i&&this.crop?(0,h.ZP)("batch-crop-aspect").value=this.crop.x+":"+this.crop.y:this.update(new d.Z(1,1)),(0,h.ZP)("batch-crop-aspect").addEventListener("change",(()=>{const e=(0,h.ZP)("batch-crop-aspect").value.split(":"),t=new d.Z(Number(e[0]),Number(e[1]));this.update(t)}));break;case"resize":const t=(0,h.T)("div");if(t.innerHTML+='\n                    <div class="select pad-4" style="margin-bottom:10px">\n                        <select id="batch-resize-method">\n                            <option value="fit-inside" selected>Fit inside</option>\n                            <option value="max-width">By width</option>\n                            <option value="max-height">By height</option>\n                        </select>\n                    </div>\n                    <label id="batch-resize-width" class="pad-5 split">Width <input id="batch-resize-width-value" value="500" type="number"></label>\n                    <label id="batch-resize-height" class="pad-5 split">Height <input id="batch-resize-height-value" value="500" type="number"></label>\n                ',s.append(t),(0,h.ZP)("batch-resize-method").addEventListener("change",(()=>{const e=(0,h.ZP)("batch-resize-method").value;(0,h.ZP)("batch-resize-width").style.display="max-height"===e?"none":"block",(0,h.ZP)("batch-resize-height").style.display="max-width"===e?"none":"block"})),i&&this.resize){let e="fit-inside";this.resize.x>0&&0===this.resize.y?e="max-width":0===this.resize.x&&this.resize.y>0&&(e="max-height"),(0,h.ZP)("batch-resize-method").value=e,(0,h.ZP)("batch-resize-width-value").value=this.resize.x.toString(),(0,h.ZP)("batch-resize-height-value").value=this.resize.y.toString(),(0,h.ZP)("batch-resize-width").style.display="max-height"===e?"none":"block",(0,h.ZP)("batch-resize-height").style.display="max-width"===e?"none":"block"}break;case"border":if(s.append((0,h.T)("div",{id:"batch-border-size"}),(0,h.T)("label",{className:"split pad-10"},(0,n.Z)("color"),(0,h.T)("div",{id:"batch-border-color"}))),this.amount=new u.Z("batch-border-size",{label:(0,n.Z)("size"),range:[0,.2],step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.update(0===e?void 0:{size:this.amount.getValue(),color:this.color.getColor()})}),this.color=new v.Z("batch-border-color",new p.Z(255,255,255),(()=>{this.update({size:this.amount.getValue(),color:this.color.getColor()})})),i){let e=this.shaders.getShaderValue(this.activeTask);this.amount.setValue(e.size),this.color.setColor(e.color)}break;case"auto":const r=(0,h.T)("div");r.innerHTML+='\n                    <ul class="push-buttons tiny">\n                        <li id="batch-auto-fix"><img src="/img/tool/thick/wand.svg" class="ic" width="24" height="24" loading="lazy"><span>Fix</span></li>\n                        <li id="batch-auto-bw"><img src="/img/tool/thick/bw.svg" class="ic" width="24" height="24" loading="lazy"><span>BW</span></li>\n                        <li id="batch-auto-pop"><img src="/img/tool/thick/temper.svg" class="ic" width="24" height="24" loading="lazy"><span>Pop</span></li>\n                    </ul>\n                ',s.append(r),(0,h.ZP)("batch-auto-fix").addEventListener("click",(()=>this.setAuto("fix"))),(0,h.ZP)("batch-auto-bw").addEventListener("click",(()=>this.setAuto("bw"))),(0,h.ZP)("batch-auto-pop").addEventListener("click",(()=>this.setAuto("pop"))),i?(0,h.ZP)("batch-auto-"+this.auto).classList.add("selected"):this.setAuto("fix");break;case"monochrome":var a=(0,h.T)("div",{style:"margin-top:2px",className:"select"});if(a.innerHTML='\n                    <select id="batch-monochrome-preset">\n                        <option value="0.299:0.587:0.114" selected>Rec601 Luma (Vision)</option>\n                        <option value="0.2126:0.7152:0.0722">sRGB ITU-R BT.709</option>\n                        <option value="0.2627:0.6780:0.0593">HDR ITU-R BT.2100</option>\n                        <option value="0.3333333:0.3333334:0.3333333">Unweighted</option>\n                        <option value="1:0:0">Red</option>\n                        <option value="0:1:0">Green</option>\n                        <option value="0:0:1">Blue</option>\n                        <option value="0.18:0.41:0.41">Agfa 200X</option>\n                        <option value="0.25:0.39:0.36">Agfapan 25</option>\n                        <option value="0.21:0.40:0.39">Agfapan 100</option>\n                        <option value="0.20:0.41:0.39">Agfapan 400</option>\n                        <option value="0.21:0.42:0.37">Ilford Delta 100 & XP2 Super</option>\n                        <option value="0.22:0.42:0.36">Ilford Delta 400</option>\n                        <option value="0.31:0.36:0.33">Ilford Delta 400 Pro & 3200</option>\n                        <option value="0.28:0.41:0.31">Ilford FP4</option>\n                        <option value="0.23:0.37:0.40">Ilford HP5</option>\n                        <option value="0.33:0.36:0.31">Ilford Pan F</option>\n                        <option value="0.36:0.31:0.33">Ilford SFX</option>\n                        <option value="0.21:0.42:0.37">Ilford</option>\n                        <option value="0.24:0.37:0.39">Kodak Tmax 100</option>\n                        <option value="0.27:0.36:0.37">Kodak Tmax 400</option>\n                        <option value="0.25:0.35:0.40">Kodak Tri-X</option>\n                        <option value="0.5:0.5:0">Red Green</option>\n                        <option value="0:0.5:0.5">Green Blue</option>\n                        <option value="0.5:0:0.5">Blue Red</option>\n                    </select>\n                ',s.append(a),i){let e=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("batch-monochrome-preset").value=e.r+":"+e.g+":"+e.b}else this.update({r:.299,g:.587,b:.114});(0,h.ZP)("batch-monochrome-preset").addEventListener("change",(()=>{let e=(0,h.ZP)("batch-monochrome-preset").value.split(":");this.update({r:Number(e[0]),g:Number(e[1]),b:Number(e[2])})}));break;default:s.append((0,h.T)("div",{id:"batch-task-amount"})),this.amount=new u.Z("batch-task-amount",{label:(0,n.Z)("amount"),range:this.isPosScale()?[0,1]:[-1,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.update(e)}),i&&this.amount.setValue(this.shaders.getShaderValue(this.activeTask))}i?s.append((0,h.T)("div",{className:"buttons small pad-20"},(0,h.T)("a",{className:"button positive",onclick:e=>this.updateTask(e)},(0,n.Z)("update")),(0,h.T)("a",{className:"button negative",onclick:e=>this.removeTask(e)},(0,n.Z)("remove")))):s.append((0,h.T)("a",{className:"button positive pad-20",onclick:e=>this.addTask(e)},(0,n.Z)("add")))},this.isPosScale=(e=this.activeTask)=>"sharpen"===e||"smooth"===e||"blur"===e||"glamour"===e||"bloom"===e||"grain"===e,this.isTaskTypeValid=e=>{for(let t=0;t<this.allTasks.length;t++)if(this.allTasks[t]===e)return!0;return!1},this.addTask=e=>{switch(e.stopPropagation(),e.preventDefault(),this.activeTask){case"crop":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("aspect")+" "+this.crop.x+":"+this.crop.y,this.moveTaskToFlow();break;case"resize":const e=Number((0,h.ZP)("batch-resize-width-value").value),t=Number((0,h.ZP)("batch-resize-height-value").value);if(t>0||e>0){const s=(0,h.ZP)("batch-resize-method").value;this.resize=new d.Z("max-height"!==s?e:0,"max-width"!==s?t:0),(0,h.ZP)("task-"+this.activeTask+"-value").innerText="fit-inside"===s?(0,n.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===s?(0,n.Z)("maxWidth")+" "+this.resize.x+"px":(0,n.Z)("maxHeight")+" "+this.resize.y+"px",this.moveTaskToFlow()}break;case"border":this.amount.getValue()>0&&((0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("size")+": "+Math.round(100*this.amount.getValue())+"%",this.moveTaskToFlow());break;case"auto":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=this.auto.toUpperCase(),this.moveTaskToFlow();break;case"monochrome":let s=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("task-"+this.activeTask+"-value").innerText="R: "+(100*s.r).toFixed(1)+"%, G: "+(100*s.g).toFixed(1)+"%, B: "+(100*s.b).toFixed(1)+"%",this.moveTaskToFlow();break;default:0!==this.amount.getValue()&&((0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("amount")+": "+Math.round(100*this.amount.getValue()),this.moveTaskToFlow())}(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.activeTask=void 0},this.moveTaskToFlow=(e=this.activeTask)=>{(0,h.ZP)("batch-tasks").style.display="block",(0,h.ZP)("batch-description").style.display="none",(0,h.ZP)("batch-tasks").append((0,h.ZP)("task-"+e)),(0,h.ZP)("task-"+e).classList.add("flow")},this.updateTask=e=>{switch(e.stopPropagation(),e.preventDefault(),this.activeTask){case"crop":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("aspect")+" "+this.crop.x+":"+this.crop.y;break;case"resize":const e=Number((0,h.ZP)("batch-resize-width-value").value),t=Number((0,h.ZP)("batch-resize-height-value").value);if(t>0||e>0){const s=(0,h.ZP)("batch-resize-method").value;this.resize=new d.Z("max-height"!==s?e:0,"max-width"!==s?t:0),(0,h.ZP)("task-"+this.activeTask+"-value").innerText="fit-inside"===s?(0,n.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===s?(0,n.Z)("maxWidth")+" "+this.resize.x+"px":(0,n.Z)("maxHeight")+" "+this.resize.y+"px"}break;case"border":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("size")+": "+Math.round(100*this.amount.getValue())+"%";break;case"auto":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=this.auto.toUpperCase();break;case"monochrome":let s=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("task-"+this.activeTask+"-value").innerText="R: "+(100*s.r).toFixed(1)+"%, G: "+(100*s.g).toFixed(1)+"%, B: "+(100*s.b).toFixed(1)+"%";break;default:(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,n.Z)("amount")+": "+Math.round(100*this.amount.getValue())}(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.activeTask=void 0},this.removeTask=e=>{this.activeTask&&(null==e||e.stopPropagation(),null==e||e.preventDefault(),this.update(void 0),(0,h.ZP)("flow-offering").prepend((0,h.ZP)("task-"+this.activeTask)),(0,h.ZP)("task-"+this.activeTask).classList.remove("flow"),(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",(0,h.ZP)("task-"+this.activeTask+"-value").innerHTML="",this.activeTask=void 0)},this.closeTask=e=>{null==e||e.stopPropagation(),null==e||e.preventDefault(),this.activeTask&&(this.update(),(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML=""),this.activeTask=void 0},this.anyTask=()=>void 0!==this.crop||void 0!==this.resize||0!==this.shaders.chain.length||void 0!==this.auto,this.update=(e,t=this.activeTask)=>{switch(t){case"crop":this.crop=e,this.generatePreview();break;case"resize":void 0===e&&(this.resize=void 0);break;case"auto":void 0===e&&(this.shaders.removeShaderSidekick(),this.auto=void 0);break;default:this.shaders.addShader(t,e)}this.render()},this.export=async()=>{let e;if(this.closeTask(),(0,x.Zp)()&&(e=await(0,x.f1)("batch","zip","Zip achive","application/zip"),!1===e))return;const t=(0,h.T)("div",{id:"modal-batch",className:"modal"});document.body.appendChild(t);const s=document.querySelector("input[name=batch-format]:checked").value,i=document.querySelector("input[name=batch-quality]:checked").value,r=new Array;for(let n=0;n<this.batch.length;n++){document.dispatchEvent(new CustomEvent("loading",{detail:"Export "+(n+1)+" of "+this.batch.length}));let e=this.batch[n].original;if(this.crop){let t=e.width,s=e.height;this.crop.y/this.crop.x*(e.width/e.height)<this.crop.x/this.crop.y*(e.height/e.width)?s=Math.round(e.width*(this.crop.y/this.crop.x)):t=Math.round(e.height*(this.crop.x/this.crop.y)),e=a.fg(e,new c.Z(Math.round(.5*(e.width-t)),Math.round(.5*(e.height-s)),t,s))}if(this.resize){const t=this.resize.x>0?this.resize.x:4096,s=this.resize.y>0?this.resize.y:4096,i=c.Z.bestFit(e.width,e.height,t,s);e=a.Ai(e,i.width,i.height)}"fix"===this.auto&&(this.shaders.addShader("bwpoint",{black:this.batch[n].levels.x,white:this.batch[n].levels.y},!0),this.shaders.addShader("vibrance",this.batch[n].saturation<.7?.7-this.batch[n].saturation:void 0,!0));const t=this.shaders.apply(e),o=await new Promise((e=>t.toBlob(e,"image/"+s.replace("jpg","jpeg"),i)));r.push(new File([o],this.batch[n].name.split(".")[0]+"."+s))}document.dispatchEvent(new CustomEvent("loading",{detail:"Create zip"}));let o=new y.ZipWriter;for(let n=0;n<r.length;n++){const e=r[n];let t=await e.arrayBuffer(),s=new Uint8Array(t);o.writeFile(e.name,s,!1)}const l=o.finish(),d=new File([new Blob([l.buffer])],"batch.zip",{type:"application/zip"});e?(await(0,x.BI)(e,d),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")}))):((0,x.vV)(d,"batch","zip"),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))),t.remove()},this.setAuto=(e,t=!0)=>{this.shaders.removeShaderSidekick(),this.auto=e,t&&((0,h.ZP)("batch-auto-bw").classList.toggle("selected","bw"===this.auto),(0,h.ZP)("batch-auto-fix").classList.toggle("selected","fix"===this.auto),(0,h.ZP)("batch-auto-pop").classList.toggle("selected","pop"===this.auto)),"bw"===this.auto&&(this.shaders.addShader("saturation",-1,!0),this.shaders.addShader("contrast",.2,!0),this.shaders.addShader("exposure",.1,!0),this.shaders.addShader("clarity",.1,!0)),"pop"===this.auto&&(this.shaders.addShader("highlights",.5,!0),this.shaders.addShader("shadows",-.5,!0),this.shaders.addShader("vibrance",.5,!0),this.shaders.addShader("saturation",.2,!0),this.shaders.addShader("exposure",.2,!0),this.shaders.addShader("clarity",.2,!0)),this.render()},this.openMacro=async()=>{g.ZP.user.subscription?await(0,r.Q0)(!1,!0).then((async e=>{if(0===e.length)return;const t=new b.m;try{const i=t.parseJsonString(await e[0].text());if(i)for(var s=0;s<i.length;s++){const e=i[s];if(this.isTaskTypeValid(e.task)){switch(e.task){case"crop":let t=e.param.aspect.split(":");this.update(new d.Z(Number(t[0]),Number(t[1])),e.task),(0,h.ZP)("task-"+e.task+"-value").innerText=(0,n.Z)("aspect")+" "+this.crop.x+":"+this.crop.y;break;case"resize":let s=e.param;this.resize=new d.Z(s.width,s.height);let i="fit-inside";this.resize.x>0&&0===this.resize.y?i="max-width":0===this.resize.x&&this.resize.y>0&&(i="max-height"),(0,h.ZP)("task-"+e.task+"-value").innerText="fit-inside"===i?(0,n.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===i?(0,n.Z)("maxWidth")+" "+this.resize.x+"px":(0,n.Z)("maxHeight")+" "+this.resize.y+"px";break;case"border":let a=e.param;(0,h.ZP)("task-"+e.task+"-value").innerText=(0,n.Z)("size")+": "+Math.round(100*a.size)+"%",this.update({size:a.size,color:p.Z.fromHEX(a.color)},e.task);break;case"auto":let r=e.param.method;(0,h.ZP)("task-"+e.task+"-value").innerText=r.toUpperCase(),this.setAuto(r,!1);break;case"monochrome":let o=e.param;(0,h.ZP)("task-"+e.task+"-value").innerText="R: "+(100*o.r).toFixed(1)+"%, G: "+(100*o.g).toFixed(1)+"%, B: "+(100*o.b).toFixed(1)+"%",this.update(e.param,e.task);break;default:let c=e.param.amount;(0,h.ZP)("task-"+e.task+"-value").innerText=(0,n.Z)("amount")+": "+Math.round(100*c),this.update(c,e.task)}this.moveTaskToFlow(e.task)}}}catch(i){console.log(i)}})):new w.Z(this.home.web.stage,"BATCH")},this.saveMacro=async()=>{if(!g.ZP.user.subscription)return void new w.Z(this.home.web.stage,"BATCH");if(!this.anyTask())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("macroNoSave")}));const e=new b.Z;if(this.crop&&e.addTask("crop",{aspect:this.crop.x+":"+this.crop.y}),this.resize){const t=this.resize.x>0&&this.resize.y>0?"fit-inside":this.resize.x>0?"max-width":"max-height";e.addTask("resize",{method:t,width:this.resize.x,height:this.resize.y})}let t;if(this.auto&&e.addTask("auto",{method:this.auto}),e.addChain(this.shaders.chain),(0,x.Zp)()&&(t=await(0,x.f1)("batch-macro","pxm","Pixlr macro","application/json"),!1===t))return;const s=new File([e.toBlob()],"batch-macro.pxm");t?(await(0,x.BI)(t,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")}))):(0,x.vV)(s,"batch-macro","pxm")},this.clear=()=>{this.active=0,this.content.innerHTML="",this.batch=new Array,this.appendAddImage(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("clear")}))},this.close=()=>{(0,h.ZP)("batch-close").removeEventListener("click",this.close),(0,h.ZP)("batch-cancel").removeEventListener("click",this.close),this.flow=void 0,this.content=void 0,(0,h.ZP)("batch-out").remove(),(0,h.ZP)("batch-flow").remove(),(0,h.ZP)("batch-section").remove(),this.shaders.cleanUp(),this.shaders=void 0,this.batch=void 0,this.home.closeBatch(),this.home=void 0},this.home=e,this.shaders=new m.Z([]),this.batch=new Array,this.flow=(0,h.T)("div",{className:"flow"},(0,h.T)("div",{id:"flow-offering",className:"flatbox-content"})),this.flow.style.height=(0,h.ZP)("home").clientHeight-400+"px",this.content=(0,h.T)("div",{id:"batch-content",className:"batch-holder"});const s=(0,h.T)("div",{className:"content"});s.innerHTML=`\n            <label class="pad-0">${(0,n.Z)("dialogSaveFileType")}</label>\n            <div id="batch-format-switch" class="switch-field" style="width:230px">\n                <input type="radio" id="batch-format-jpg" name="batch-format" value="jpg" checked/><label for="batch-format-jpg">jpg</label>\n                <input type="radio" id="batch-format-png" name="batch-format" value="png" /><label for="batch-format-png">png</label>\n                <input type="radio" id="batch-format-webp" name="batch-format" value="webp" /><label for="batch-format-webp">webp</label>\n            </div>\n\n            <label class="pad-20">${(0,n.Z)("quality")}</label>\n            <div id="batch-quality-switch" class="switch-field" style="width:230px">\n                <input type="radio" id="batch-quality-low" name="batch-quality" value="50"/><label for="batch-quality-low">${(0,n.Z)("dialogSaveLow")}</label>\n                <input type="radio" id="batch-quality-med" name="batch-quality" value="70" /><label for="batch-quality-med">${(0,n.Z)("dialogSaveMed")}</label>\n                <input type="radio" id="batch-quality-high" name="batch-quality" value="90" checked /><label for="batch-quality-high">${(0,n.Z)("dialogSaveHigh")}</label>\n            </div>\n        `,(0,h.ZP)("home-wrap").append((0,h.T)("div",{id:"batch-flow"},(0,h.T)("div",{className:"flatbox tasks"},(0,h.T)("span",{className:"title"},(0,n.Z)("batchEdit")),(0,h.T)("div",{className:"icon-button",style:"position:absolute;left:6px;top:6px",onclick:this.close},(0,h.T)("img",{src:"/img/icon/home.svg",className:"ic",width:22,height:22,loading:"lazy"})),(0,h.T)("div",{className:"splitter"}),(0,h.T)("div",{className:"flatbox-content"},(0,h.T)("div",{id:"batch-tasks",style:"display:none"}),(0,h.T)("p",{id:"batch-description"},(0,n.Z)("batchDesk")),(0,h.T)("div",{style:"text-align:center",className:"pad-30"},(0,h.T)("a",{id:"batch-open-macro",className:"link"},(0,n.Z)("macroOpen")),(0,h.T)("span",{style:"display:inline-block;padding-left:8px;padding-right:8px"},(0,n.Z)("or")),(0,h.T)("a",{id:"batch-save-macro",className:"link"},(0,n.Z)("macroSave"))))),(0,h.T)("div",{className:"flatbox tasks pad-20"},(0,h.T)("span",{className:"title"},(0,n.Z)("addTask")),(0,h.T)("div",{className:"splitter"}),this.flow)),(0,h.T)("div",{id:"batch-section",className:"flatbox"},this.content,(0,h.T)("div",{className:"buttons pad-20"},(0,h.T)("a",{id:"batch-clear",className:"button negative"},(0,n.Z)("clear")),(0,h.T)("a",{id:"batch-cancel",className:"button negative"},(0,n.Z)("close")))),(0,h.T)("div",{id:"batch-out",className:"flatbox"},(0,h.T)("img",{id:"batch-close",className:"close ic",src:"/img/icon/close.svg"}),(0,h.T)("span",{className:"title"},(0,n.Z)("output")),(0,h.T)("div",{className:"splitter"}),s,(0,h.T)("div",{className:"buttons pad-20"},(0,h.T)("a",{id:"batch-export",className:"button positive w-100"},(0,n.Z)("export"))))),(0,h.ZP)("batch-clear").addEventListener("click",this.clear),(0,h.ZP)("batch-close").addEventListener("click",this.close),(0,h.ZP)("batch-cancel").addEventListener("click",this.close),(0,h.ZP)("batch-export").addEventListener("click",this.export),(0,h.ZP)("batch-save-macro").addEventListener("click",this.saveMacro),(0,h.ZP)("batch-open-macro").addEventListener("click",this.openMacro),this.appendAllTasks(),this.appendAddImage(),new f.Z(this.flow),t&&this.append(t)}}i()}catch(k){i(k)}}))},6577:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(6548),n=s(3947),a=s(4820),r=s(7909),o=s(9344),h=s(1951),c=s(840);class l extends r.Z{constructor(e,t,r){var l,d,u,p,g;super(!0),this.checkoutUrl="/checkout/payments",this.encryptedCardData={isValid:!1,paymentMethod:null},this.billingAddress={},this.currency="USD",this.subDuration="month",this.checkoutMode="checkout",this.currencySymbol="$",this.monthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.checkoutPlan="premium-monthly",this.renewalPrice=7.99,this.totalPrice=7.99,this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.isPaypal=!1,this.paypalCheckoutSubscriptionsUrl="/paypal/subscriptions",this.paypalCheckoutTemplateUrl="/paypal/templates",this.tax={status:!1},this.paymentMethodOption="",this.contentForm="",this.billingDetailsForm="",this.freeTrial=!1,this.populateCountry=async()=>{const e=await fetch("/api/country"),t=await e.json();this.countryList=Object.assign({},t.data);const s=(0,n.ZP)("country");for(const i in this.countryList.country){const e=(0,n.T)("option",{value:this.countryList.country[i]},this.countryList.country[i]);i===a.ZP.user.country&&(e.selected=!0),s.append(e)}this.updateCountry()},this.creditCardForm=async()=>{var e;const[t]=await Promise.all([s.e(600).then(s.bind(s,4884)).then((e=>e.default)),s.e(600).then(s.bind(s,697))]);(0,n.ZP)("billing-page").classList.add("hide"),(0,n.ZP)("google_pay").classList.add("hide"),(0,n.ZP)("payment-method").classList.remove("hide"),(0,n.ZP)("card-page").classList.remove("hide"),(0,n.ZP)("back-premium-icon").classList.remove("hide"),null===(e=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.classList.remove("hide"),"subscription"===this.checkoutType?this.freeTrial?(0,n.ZP)("subscription-pay-btn").innerText="Start 30 Days free Trial":(0,n.ZP)("subscription-pay-btn").innerText=`Pay ${this.currencySymbol}${this.totalPrice.toFixed(2)}`:(0,n.ZP)("template-pay-btn").innerHTML=(0,i.Z)("payNow"),this.isReadyToPay();const{paymentMethods:r}=await this.getPaymentMethods(this.checkoutPlan);return new t({locale:"en_US",environment:"pixlr.com"===window.location.hostname?"live":"test",clientKey:a.ZP.adyenClientKey,paymentMethodsResponse:r,onChange:this.handleOnChange}).create("card",{hasHolderName:!0,holderNameRequired:!0}).mount("#component-container"),!0},this.paypalForm=()=>{var e;(0,n.ZP)("google_pay").classList.add("hide"),(0,n.ZP)("card-page").classList.add("hide"),(0,n.ZP)(`${this.checkoutType}-pay-btn`).innerHTML="Continue on paypal",null===(e=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled")},this.gPayFrom=()=>{var e;(0,n.ZP)("google_pay").classList.remove("hide"),(0,n.ZP)("card-page").classList.add("hide"),(0,n.ZP)(`${this.checkoutType}-pay-btn`).innerHTML="Continue",null===(e=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled")},this.checkoutMethod=()=>{for(var e=document.getElementsByName("payment"),t=0;t<e.length;t++)1==e[t].checked&&this.paymentSection(e[t].value)},this.paymentMethods=()=>{this.paymentMethodOption=`\n            <div id="payment-method" class="hide top-20">\n                <h2>${(0,i.Z)("paymentMethod")}</h2>\n                <div class="top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" checked />\n                        <label for="adyen-radio-option">${(0,i.Z)("useCreditCard")}</label>\n                    </div>\n                    <div class="radio-options" style="margin-left:10px">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" />\n                        <label for="paypal-radio-option"> <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `},this.paymentSection=async e=>{if("paypal"===e)this.paypalForm(),this.isPaypal=!0;else this.creditCardForm(),this.isPaypal=!1},this.showAndGetBilling=()=>{(0,n.ZP)("card-page").classList.add("hide"),(0,n.ZP)("payment-method").classList.add("hide"),(0,n.ZP)("billing-page").classList.remove("hide"),(0,n.ZP)("back-premium-icon").classList.add("hide");const e=(0,n.ZP)("billing-address").getElementsByTagName("input");for(let t=0;t<e.length;t++){const s=e[t];s.addEventListener("keyup",(()=>{this.billingAddress[s.id]=s.value,this.isReadyToPay()}))}},this.updateCountry=()=>{const e=Object.keys(this.countryList.country).find((e=>this.countryList.country[e]===(0,n.ZP)("country").value));this.countryList.tax[e]?(this.tax.status=!0,this.tax.percentage=this.countryList.tax[e]):this.tax.status=!1,this.countryList.countryEU.some((t=>t===e))?this.currency="EUR":this.currency="USD",this.currencySymbol="USD"===this.currency?"$":"€",Array.from(document.getElementsByClassName("currency")).forEach((e=>e.innerHTML=this.currency)),Array.from(document.getElementsByClassName("currency-symbol")).forEach((e=>e.innerHTML=this.currencySymbol)),this.updatePrice()},this.resultModal=e=>{(0,n.ZP)("overview").style.display="none",(0,n.ZP)("checkout").style.display="none";const t=e.status;return(t||"success"===t)&&(a.ZP.user=e.data.settings),document.contains((0,n.ZP)("result-modal"))&&(0,n.ZP)("result-modal").remove(),e.loading?`\n            <div id="result-modal">\n                <img class="loader" src="/images/myaccount/black-loading.gif" alt="loading">'\n                <h1 class="pad-30">${(0,i.Z)("pleaseCompleteYourPaymentAtPaypal")}!</h1>\n                <p class="pad-10">${(0,i.Z)("pleaseDoNotRefreshOrCloseThisPageWhilePaymentIsProcessing")}.</p>\n                <p>${(0,i.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>\n            `:t||"success"===t?`\n            <div id="result-modal">\n                <img src="/images/myaccount/green-tick.png" alt="success">'\n                <h1 class="pad-30">${(0,i.Z)("thankYouForYourPurchase")}!</h1>\n                ${"template"===this.checkoutType?`<p class="pad-10">${(0,i.Z)("theTemplateIsLoading")}.</p>`:""}\n                <p>${(0,i.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>`:`\n            <div id="result-modal">\n                <img src="/images/myaccount/red-cross.png" alt="fail">\n                <h1 class="pad-30">${(0,i.Z)("paymentFailed")}</h1>\n                <p class="pad-10">${(0,i.Z)("paymentUnsuccessful")}.</p>\n            </div>`},this.billingInput=(e,t=100,s)=>`\n            <div class="form-group w-${t}">\n                <span class="adyen-checkout__label__text">${(0,i.Z)(e)}</span>\n                <input type="text" id="${e}" maxlength="56" ${s?`value="${s}"`:""} required>\n            </div>\n        `,this.countryInput=(e,t=100)=>`\n            <div class="form-group w-${t}">\n                <span class="adyen-checkout__label__text">${(0,i.Z)(e)}</span>\n                <select id="${e}" name="${e}" class="country-select"></select>\n            </div>\n        `,this.handleOnChange=e=>{const{data:{paymentMethod:t},isValid:s}=e;this.encryptedCardData.isValid=s,this.encryptedCardData.paymentMethod=t,this.encryptedCardData.cardHolderName=document.getElementsByClassName("adyen-checkout__input--text")[0].value,this.isReadyToPay()},this.getPaymentMethods=async e=>{try{const t=await fetch("/checkout/paymentmethods",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({splan:e})});return await t.json()}catch({message:t,response:s}){return{message:s.data.message}}},this.getCheckoutData=()=>{const e={paymentMethod:this.encryptedCardData.paymentMethod,billingAddress:this.billingAddress,currency:this.currency,promo:this.promoCode,upgradeDetails:{type:"checkout"},freeTrialSource:"editor",checkoutMethod:this.checkoutMode};return"subscription"===this.checkoutType?(e.splan=this.checkoutPlan,this.freeTrial&&(e.freeTrial="true")):"template"===this.checkoutType&&(e.templateId=this.templateId),e},this.makePayment=async()=>{var e;if(!this.isReadyToPay())return;if(null===(e=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.setAttribute("disabled","true"),this.isPaypal)return this.paypalCheckout();this.billingAddress.country=(0,n.ZP)("country").value;let t="subscription"===this.checkoutType?this.checkoutUrl:this.checkoutUrl+"/template/";const s=this.getCheckoutData();s.captchaToken="!!";const i=this.getUTMParam();try{const e=await fetch(t+"?platform=editor"+i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}),n=await e.json();this.setContent(this.resultModal(n)),n.status&&setTimeout((()=>{this.stage.unblock(),null==this||this.cleanUp()}),2500)}catch({message:a}){this.setContent(this.resultModal({status:!1}))}},this.paypalCheckout=async()=>{const e="subscription"===this.checkoutType?this.paypalCheckoutSubscriptionsUrl:this.paypalCheckoutTemplateUrl,t=this.getCheckoutData();try{const s=await fetch(e+"?platform=editor",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}),i=await s.json();if(i.status){const e=this.createPopupWin(i.redirectUrl,"Paypal Checkout",800,650);this.setContent(this.resultModal({loading:!0}));const t=await(0,o.n)((async()=>{try{const e=await this.getPaypalResult(i.id,this.checkoutType);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}),500,15e3);"success"===t.status?(e.close(),this.setContent(this.resultModal(t)),setTimeout((()=>{null==this||this.cleanUp(),this.stage.unblock()}),2500)):console.log("failed modal?")}else this.setContent(this.resultModal({status:!1}))}catch(s){console.error(s),this.setContent(this.resultModal({status:!1}))}},this.getPaypalResult=async(e,t)=>(await fetch(`/paypal/polling?id=${e}&type=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json(),this.promoCodeOnInput=()=>{const e=(0,n.ZP)("promocode-input");e.value=e.value.toUpperCase()},this.applyPromoCode=async()=>{var e;if("REMOVE"===(0,n.ZP)("promocode-submit").innerText)return this.removePromoCode(),!1;const t=(0,n.ZP)("promocode-input");this.options.code&&((0,n.ZP)("promocode-add").style.display="none",(0,n.ZP)("promocode-toggle").style.display="block",t.value=this.options.code);let s=null!==(e=this.options.code)&&void 0!==e?e:t.value.toUpperCase();try{const e=await fetch(`/api/promo/status/?code=${s}&product=Pixlr Premium&splan=${this.checkoutPlan}`),i=await e.json();if(!i.status)throw new Error("Invalid promocode!");const{percentage:a,amount:r,productName:o,productCode:h}=i.promo;return(0,n.ZP)("promocode-percentage").innerText=a?`${a}% Off first paying month`:`${r} Only first paying month`,this.promoCode=Object.assign(Object.assign({},this.promoCode),{percentage:a,amount:r,productName:o,productCode:h}),this.promoCode.code=s,this.togglePromoApplied(),this.updatePrice(),t.readOnly=!0,(0,n.ZP)("promo-tac").style.display="none",(0,n.ZP)("promocode-submit").innerText="REMOVE",!0}catch({response:i,message:a}){return s="",t.value="",(0,n.ZP)("promocode-error").style.display="block",setTimeout((()=>{(0,n.ZP)("promocode-error").style.display="none"}),1500),!1}},this.removePromoCode=()=>{this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.updatePrice(this.renewalPrice);const e=(0,n.ZP)("promocode-input");e.value="",e.readOnly=!1,(0,n.ZP)("promo-tac").style.display="block",(0,n.ZP)("promo-section").style.display="flex",(0,n.ZP)("promocode-submit").innerText="APPLY"},this.togglePromoApplied=()=>{this.promoCode.promoApplied=!this.promoCode.promoApplied},this.updatePrice=e=>{if(e&&(this.renewalPrice=e,this.totalPrice=e),this.promoCode.promoApplied){const e="All Plans"===this.promoCode.productName,t="Pixlr Premium"===this.promoCode.productName&&!this.promoCode.productCode,s="Pixlr Premium"===this.promoCode.productName&&this.promoCode.productCode===this.checkoutPlan;e||t||s?(this.promoCode.percentage&&(this.promoCode.discountedAmount=this.renewalPrice*(this.promoCode.percentage/100)),this.promoCode.amount&&(this.promoCode.discountedAmount=this.promoCode.amount)):this.removePromoCode()}if(this.tax.status?this.tax.amount=(this.renewalPrice-this.promoCode.discountedAmount)*(this.tax.percentage/100):this.tax.amount=0,this.totalPrice=this.renewalPrice-this.promoCode.discountedAmount+this.tax.amount,this.freeTrial){const e=new Date;e.setMonth(e.getMonth()+1);const t=`${e.getDate()} ${this.monthName[e.getMonth()]} ${e.getFullYear()}`,s=document.getElementById("freetrial-note");null!=s&&(s.innerHTML=`${(0,i.Z)("yourFreeTrialWillEndOn")} <b>${t}</b> ${(0,i.Z)("andYouWillBeCharged")} <b>${this.currencySymbol}${this.totalPrice.toFixed(2)}</b> ${(0,i.Z)("forTheFollowingPayingMonth")}.`,s.style.display="block")}(0,n.ZP)("plan-price")&&((0,n.ZP)("plan-price").innerText=this.renewalPrice.toFixed(2)),(0,n.ZP)("total-price")&&((0,n.ZP)("total-price").innerText=`${this.currencySymbol}${this.freeTrial?"0.00":this.totalPrice.toFixed(2)}`),(0,n.ZP)("subscription-pay-btn")&&(this.freeTrial?(0,n.ZP)("subscription-pay-btn").innerText=`${(0,i.Z)("startOneMonthFreeTrial")}`:(0,n.ZP)("subscription-pay-btn").innerText=`Pay ${this.currencySymbol}${this.totalPrice.toFixed(2)}`),this.shouldShowPriceSummary()},this.toggleCheckoutPlan=()=>{"stack"===this.checkoutMode&&((0,n.ZP)("checkout-plan").checked=!0);const e=(0,n.ZP)("checkout-plan").checked;a.ZP.eligibleFreeTrial&&!e?this.freeTrial=!0:this.freeTrial=!1,e?(this.checkoutPlan="premium-yearly",(0,n.ZP)("switch-handle").classList.remove("switch-label-monthly"),(0,n.ZP)("switch-handle").classList.add("switch-label-yearly"),(0,n.ZP)("save-38").innerHTML='You\'re saving <span style="color:#c70909;">38%</span>',(0,n.ZP)("plan-duration").innerText="year",(0,n.ZP)("yearly-discount").style.display="block",(0,n.ZP)("freetrial-note").style.display="none",this.updatePrice(59),this.checkoutMethod()):(this.checkoutPlan="premium-monthly",(0,n.ZP)("switch-handle").classList.remove("switch-label-yearly"),(0,n.ZP)("switch-handle").classList.add("switch-label-monthly"),(0,n.ZP)("save-38").innerHTML='Pay yearly to <span style="color:#c70909;">Save 38%</span>',(0,n.ZP)("plan-duration").innerText="month",(0,n.ZP)("yearly-discount").style.display="none",(0,n.ZP)("freetrial-note").style.display=this.freeTrial?"block":"none",this.updatePrice(7.99),this.checkoutMethod())},this.isReadyToPay=()=>{var e,t;const{isValid:s,paymentMethod:i}=this.encryptedCardData,a=Object.values(this.billingAddress).length;try{if(this.isPaypal)return!0;if(!s)throw!1;if(0===this.encryptedCardData.cardHolderName.length)throw!1;if(0!==a&&6!==a)throw!1;return null===(e=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled"),!0}catch({message:r}){return null===(t=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.setAttribute("disabled","true"),!1}},this.createPopupWin=(e,t,s,i)=>{const n=(screen.width-s)/2,a=(screen.height-i)/4;return window.open(e,t,`resizable=yes,width=${s},height=${i},top=${a},left=${n}`)},this.backPreviousPopup=()=>{switch(this.cleanUp(),this.options.bounceSource){case"premiumbounce":new h.Z(this.stage,this.options.bounceType);break;case"premiumtemplatebounce":new c.Z(this.stage)}},this.shouldShowPriceSummary=()=>{this.promoCode.promoApplied?((0,n.ZP)("promo-summary").style.display="block",(0,n.ZP)("promo-details").innerHTML=`- ${this.currencySymbol}${this.promoCode.discountedAmount.toFixed(2)}`):((0,n.ZP)("promo-summary").style.display="none",(0,n.ZP)("promo-details").innerHTML=""),this.tax.status?((0,n.ZP)("tax-summary").style.display="block",(0,n.ZP)("tax-details").innerHTML=`${this.currencySymbol}${this.tax.amount.toFixed(2)}`):((0,n.ZP)("tax-summary").style.display="none",(0,n.ZP)("tax-details").innerHTML="")},this.getUTMParam=()=>{const e={};let t="";return this.options.utm_source&&(e.utm_source=this.options.utm_source),this.options.utm_medium&&(e.utm_medium=this.options.utm_medium),this.options.utm_campaign&&(e.utm_campaign=this.options.utm_campaign),t+=Object.keys(e).map((t=>t+"="+e[t])).join("&"),t?`&${t}`:t},this.stage=e,this.checkoutType=t,this.currency="USD",this.options=r,"template"===t&&(this.templateId=null!==(u=null===(d=null===(l=this.stage.fresco)||void 0===l?void 0:l.templateMeta)||void 0===d?void 0:d.templateId)&&void 0!==u?u:"-",this.renewalPrice=1,this.totalPrice=1),"subscription"===t&&this.options.plan&&(this.checkoutPlan=this.options.plan),"subscription"===t&&"premium-yearly"===this.checkoutPlan&&(this.renewalPrice=this.totalPrice=59),"subscription"===t&&"premium-monthly"===this.checkoutPlan&&a.ZP.eligibleFreeTrial&&(this.freeTrial=!0),this.options.checkoutMode&&(this.checkoutMode=this.options.checkoutMode),this.paymentMethodOption=`\n            <div id="payment-method" class="hide top-20">\n                <h2 class="pad-30">${(0,i.Z)("paymentMethod")}</h2>\n                <div class="top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" data-checked="true" checked/>\n                        <label for="adyen-radio-option">${(0,i.Z)("useCreditCard")}</label>\n                    </div>\n                    <div class="radio-options ${"stack"===this.checkoutMode?"hidden":""}" style="margin-left:10px">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" data-checked="false"/>\n                        <label for="paypal-radio-option"> <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `,this.contentForm=`\n            <div id="card-page" class="hide">\n                <div class="w-100">\n                    <div id="component-container" style="padding-top: 25px"></div>\n                    <div id="add-billing-container">\n                        <a id="add-billing-info" class="anchor-blue"><img src="/img/icon/plus-circle-light-blue.svg">${(0,i.Z)("AddOptionalBillingInformation")}</a>\n                    </div>\n                </div>\n            </div>\n            <div id="google_pay" class="hide">\n                <div class="container pt-2">\n                    <div class="row gpay_div d-flex align-content-center flex-wrap ">\n                        <div>\n                            <h3 class="gpay_text_color">Google Play</h3>\n                            <span>click continue button to proceed payment <br /> with google play</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.billingDetailsForm=`\n            <div id="billing-page" class="hide">\n                <img id="back-billing-icon" src="/img/icon/arrow-left-black.svg">\n                <div class="billing-form w-100">\n                    <h2 class="pad-30">${(0,i.Z)("billingDetailsSmallCap")}</h2>\n                    <form id="billing-address">\n                        <div class="flex">\n                            ${this.billingInput("firstName",50)}\n                            ${this.billingInput("lastName",50)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("address",100)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("city",50)}\n                            ${this.billingInput("zipCode",50)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("state",50)}\n                            ${this.countryInput("country",50)}\n                        </div>\n                    </form>\n                </div>\n\t\t\t</div>\n        `;const m=`\n            <div>\n                <input type="checkbox" class="toggle-check" id="checkout-plan" />\n                <label class="switch pad-4" for="checkout-plan">\n                    <span id="switch-handle" class="switch-label-monthly ${"stack"===this.checkoutMode?"cursor-error":""}" data-on="Monthly" data-off="Yearly"></span>\n                </label>\n            </div>\n        `,v=`\n            <a id="promocode-add">${(0,i.Z)("iHaveAPromoCode")}!</a>\n            <span id="gpay-promo" class="hide">Please add promo code in Google Pay window</span>\n            <div id="promocode-toggle" style="display:none">\n                <p class="heavy">Promo Code </p>\n                <div id="promo-section">\n                    <input type="text" id="promocode-input" placeholder="Promo Code *">\n                    <span id="promocode-submit" class="apply">Apply</span>\n                </div>\n                <p id="promocode-error">Invalid promo code!</p>\n                <p id="promo-tac" style="font-size: 10px; color: #666">* ${(0,i.Z)("promoCode")}</p>\n            </div>\n        `,f=`\n            <div id="breakdown-summary" class="top-20">\n                <p id="yearly-discount" style="display:none;margin: 6px 0 0;">\n                    ${(0,i.Z)("yearlyPlanOff")}\n                    <span style="float:right;color:#c70909;">-<span class="currency-symbol">$</span>37.00</span>\n                </p>\n                <p id="promo-summary" style="display:none;margin: 6px 0 0;">\n                    ${(0,i.Z)("promoCode")}: \n                    <span id="promocode-percentage"></span>\n                    <span id="promo-details" style="float:right;"></span>\n                </p>\n                <p id="tax-summary" style="display:none;margin: 6px 0 0;">\n                    GST: 7%\n                    <span id="tax-details" style="float:right;"></span>\n                </p>\n            </div>\n        `,y=`\n            <div id="premium-options" class="padding-35">\n                <div class="card" style="height:100%">\n\n                    <div style="background-color:#fafafa;margin:-15px -15px 0 -15px;padding:15px;">\n                        <h2>${(0,i.Z)("orderSummary")}</h2>\n                        <h3 class="pad-10">Pixlr Premium <a class="link" style="float:right;" href="/pricing/" target="_blank">${(0,i.Z)("planBenefits")}</a></h3>\n                        <div class="row v-center pad-10">\n                            ${m}\n                            <p id="save-38">${(0,i.Z)("payYearlyTo")} <span style="color:#c70909;">${(0,i.Z)("save")} 38%</span></p>\n                        </div>\n                        <p><span class="currency">${this.currency}</span> <span id="plan-price">${this.totalPrice}</span>/<span id="plan-duration">${this.subDuration}</span> • ${(0,i.Z)("autorenewalBasis")}</p>\n                    \n                        <p class="slanted">${(0,i.Z)("youCanCancelAuto")}.</p>\n                    </div>\n\n                    ${v}\n                    ${f}\n                    <div class="row space-between pad-15">\n                        <h3 class="caps heavy" style="opacity: 1;color: #333">${(0,i.Z)("total")}</h3>\n                        <h3 style="font-size: 18px;opacity: 1;color: #333">\n                            <span class="currency heavy">${this.currency}</span>\n                            <span id="total-price">${this.currencySymbol}${this.totalPrice}</span>\n                        </h3>\n                    </div>\n                    <button id="subscription-pay-btn" class="button big blue w-100 pad-15">Pay ${this.currencySymbol}${this.totalPrice}</button>\n                    <span id="freetrial-note" class="pad-10"></span>\n                    \n                </div>\n            </div>\n        `,w=`\n            <div id="premium-options" class="padding-35">\n                <div class="card" style="height:100%">\n                    <h2>${(0,i.Z)("orderSummary")}</h2>\n                    <p style="text-transform: capitalize; font-weight: bold;">Pixlr Template</p>\n                    <p><span class="currency">${this.currency}</span> ${this.currencySymbol}1.00/template</p>\n\n                    <div class="row space-between pad-15 template-info">\n                        <div id="template-canvas" style="padding:9px;"></div>\n                        <div class="desc">${(0,i.Z)("dontJustPayForOne")} <span id="premium-check">here</span></div>\n                    </div>\n                    ${f}\n                    <div class="row space-between pad-15">\n                        <h3 style="font-size:18px" class="caps">${(0,i.Z)("total")}</h3>\n                        <h3 style="font-size:18px">\n                            <span class="currency">${this.currency}</span>\n                            <span id="total-price">${this.currencySymbol}${this.totalPrice.toFixed(2)}</span>\n                        </h3>\n                    </div>\n                    <button id="template-pay-btn" class="button big blue w-100 pad-15">${(0,i.Z)("payNow")}</button>\n                </div>\n            </div>\n        `;this.content.style.padding="40px",this.setContent(`\n            <div id="checkout" class="padding-35 w-50">\n                <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                ${this.paymentMethodOption}\n                ${this.contentForm}\n                ${this.billingDetailsForm}\n            </div>\n            <div id="overview" class="left-panel">\n            </div>\n        `),"template"===t?((0,n.ZP)("overview").innerHTML=w,(0,n.ZP)("template-canvas").appendChild(this.stage.getOutputCanvas(.08)),(0,n.ZP)("premium-check").addEventListener("click",(()=>{this.cleanUp(),new c.Z(this.stage)}))):((0,n.ZP)("overview").innerHTML=y,(0,n.ZP)("checkout-plan").addEventListener("change",this.toggleCheckoutPlan),(0,n.ZP)("promocode-submit").addEventListener("click",this.applyPromoCode),(0,n.ZP)("promocode-input").addEventListener("input",this.promoCodeOnInput),(0,n.ZP)("promocode-add").addEventListener("click",(()=>{(0,n.ZP)("promocode-toggle").style.display="block",(0,n.ZP)("promocode-add").style.display="none"})),"premium-yearly"===this.checkoutPlan&&(0,n.ZP)("checkout-plan").click(),this.options.code&&this.applyPromoCode()),null===(p=(0,n.ZP)(`${this.checkoutType}-pay-btn`))||void 0===p||p.addEventListener("click",this.makePayment),(0,n.ZP)("add-billing-info").addEventListener("click",this.showAndGetBilling),(0,n.ZP)("back-billing-icon").addEventListener("click",this.creditCardForm),(0,n.ZP)("paypal-radio-option").addEventListener("click",this.checkoutMethod),(0,n.ZP)("adyen-radio-option").addEventListener("click",this.checkoutMethod),(0,n.ZP)("back-premium-icon").classList.remove("hide"),(0,n.ZP)("back-premium-icon").addEventListener("click",this.backPreviousPopup),null===(g=(0,n.ZP)("country"))||void 0===g||g.addEventListener("change",this.updateCountry),this.creditCardForm(),this.populateCountry(),this.position()}}},2409:(e,t,s)=>{s.d(t,{Ev:()=>a,V:()=>r,ZF:()=>h});var i=s(3947),n=s(4820);async function a(){if(!("getDigitalGoodsService"in window))return!1;try{return!!(await window.getDigitalGoodsService("https://play.google.com/billing"))}catch(e){return console.log(e),!1}}async function r(e,t){const s=(0,i.pR)("__pat",""),a="premium_monthly",r="product_1",h="com.pixlr."+n.ZP.product;if("getDigitalGoodsService"in window)try{const i=await window.getDigitalGoodsService("https://play.google.com/billing");if(i){if(!("PaymentRequest"in window))return console.log("something went wrong"),!1;{const n=new PaymentRequest([{supportedMethods:"https://play.google.com/billing",data:{sku:e?r:a}}]);try{const c=await n.show();if(await c.complete(),e){let e=await async function(e,t,s,i,n){try{const a=await fetch("/api/purchase/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:i,purchaseToken:s,itemId:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}(s,r,c.details.token,h,t);return e?"acknowledge"in i?(console.log("v1"),await i.acknowledge(c.details.token,"repeatable"),!0):(await i.consume(c.details.token),console.log("v2"),!0):(console.log("status false"),!1)}return!!(await o(s,a,c.details.token,h))&&("acknowledge"in i&&await i.acknowledge(c.details.token,"onetime"),!0)}catch(c){return console.log("catch false"),console.log(c),!1}}}}catch(c){return console.log(c),!1}}async function o(e,t,s,i,n=!1){try{const a=await fetch("/api/subscription/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:i,purchaseToken:s,freeTrial:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}async function h(){const e=(0,i.pR)("__pat",""),t="com.pixlr."+n.ZP.product;if(!("getDigitalGoodsService"in window))return console.log("no digital good window"),!1;try{const i=await window.getDigitalGoodsService("https://play.google.com/billing");if(!i)return console.log("no playbilling service"),!1;{const n=await i.listPurchases();if(n&&n.length)for(const i of n)try{const s=await fetch("/api/subscription/google/get",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({packageName:t,productId:i.itemId,purchaseToken:i.purchaseToken})}),n=await s.json();if(n&&0===n.data.acknowledgementState){return!!(await o(e,i.itemId,i.purchaseToken,t,!0))}}catch({message:s,response:a}){return console.log(a),!1}}}catch(r){return console.error("Play billing",r),!1}}},9344:(e,t,s)=>{async function i(e,t=5e3,s=3e4){const i=(new Date).getTime()+s,n=(s,a)=>{Promise.resolve(e()).then((e=>{console.log(e);const r=(new Date).getTime();"success"===e.status?s(e):r<i||"pending"===e.status?setTimeout(n,t,s,a):a(new Error("AsyncPoller: reached timeout"))})).catch((e=>{a(e)}))};return new Promise(n)}s.d(t,{n:()=>i})},3770:(e,t,s)=>{s.d(t,{X3:()=>n});var i=s(3655);async function n(){try{return await o.open()}catch(e){return Promise.resolve(new l)}}class a{constructor(e){this.next=()=>this.queue.pop(),this.queue=[new i.L5];let t=this.queue[0];e.onsuccess=()=>{const s=e.result;s?(t.resolve({done:!1,value:s.value}),t=new i.L5,this.queue.unshift(t),s.continue()):t.resolve({done:!0,value:void 0})},e.onerror=()=>{t.reject(e.error)}}[Symbol.asyncIterator](){return this}}class r{constructor(e){this.inner=e}static bound(e,t,s=!1,i=!1){return new r(IDBKeyRange.bound(e,t,s,i))}static lowerBound(e,t){return new r(IDBKeyRange.lowerBound(e,t))}static upperBound(e,t){return new r(IDBKeyRange.upperBound(e,t))}static only(e){return new r(IDBKeyRange.only(e))}static unwrap(e){return e instanceof r?e.inner:e}}class o{constructor(e){this.underlying=e}static availiable(){return!navigator.userAgent.includes("Edge")&&!!window.indexedDB}transaction(e,...t){const s=this.underlying.transaction(t,e);return t.map((e=>new h(s.objectStore(e))))}}o.open=async()=>o.availiable()?new Promise(((e,t)=>{const s=window.indexedDB.open("pixlr",2);s.onupgradeneeded=e=>{const t=s.result;0===e.oldVersion?(t.createObjectStore("blobs"),t.createObjectStore("fonts"),t.createObjectStore("document-meta",{keyPath:"id"}),t.createObjectStore("document-selection"),t.createObjectStore("document-thumbnail"),t.createObjectStore("layer-meta",{keyPath:"id"}).createIndex("document","document"),t.createObjectStore("layer-mask"),t.createObjectStore("layer-bitmap")):t.deleteObjectStore("history")},s.onerror=e=>t(s.error),s.onsuccess=()=>e(new o(s.result))})):Promise.reject(new Error("Browser does not support indexedDB"));class h{constructor(e){this.underlying=e}get(e){return new Promise(((t,s)=>{const i=this.underlying.get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}getAll(e,t){return new Promise(((s,i)=>{const n=this.underlying.getAll(r.unwrap(e),t);n.onsuccess=()=>s(n.result),n.onerror=()=>i(n.error)}))}iterate(e,t){const s=this.underlying.openCursor(r.unwrap(e),t);return new a(s)}index(e){const t=this.underlying.index(e);return new c(t)}cursor(e,t,s){return new Promise(((i,n)=>{const a=this.underlying.openCursor(r.unwrap(t),s);a.onsuccess=()=>{const t=a.result;if(t){const s=e(t.value,t);"number"==typeof s?t.advance(s):!1!==s?t.continue():i()}else i()},a.onerror=()=>n(a.error)}))}put(e,t){return new Promise(((s,i)=>{const n=this.underlying.put(e,t);n.onsuccess=()=>{s()},n.onerror=()=>{i(n.error)}}))}add(e,t){return new Promise(((s,i)=>{const n=this.underlying.add(e,t);n.onsuccess=()=>{s()},n.onerror=()=>{i(n.error)}}))}clear(){return new Promise(((e,t)=>{let s=this.underlying.clear();s.onsuccess=()=>e(),s.onerror=()=>t(s.error)}))}count(e){return new Promise(((t,s)=>{let i;i=void 0===e?this.underlying.count():this.underlying.count(r.unwrap(e)),i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}delete(e){return new Promise(((t,s)=>{const i=this.underlying.delete(r.unwrap(e));i.onsuccess=()=>t(),i.onerror=()=>s(i.error)}))}}class c{constructor(e){this.underlying=e,this.name=e.name,this.keyPath=e.keyPath,this.multiEntry=e.multiEntry,this.unique=e.unique}get(e){return new Promise(((t,s)=>{const i=this.underlying.get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}getAll(e,t){return new Promise(((s,i)=>{const n=this.underlying.getAll(r.unwrap(e),t);n.onsuccess=()=>s(n.result),n.onerror=()=>i(n.error)}))}count(e){return new Promise(((t,s)=>{let i;i=void 0===e?this.underlying.count():this.underlying.count(r.unwrap(e)),i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}cursor(e,t,s){return new Promise(((i,n)=>{const a=this.underlying.openCursor(r.unwrap(t),s);a.onsuccess=()=>{const t=a.result;t?(e(t.value,t),t.continue()):i()},a.onerror=()=>n(a.error)}))}iterate(e,t){const s=this.underlying.openCursor(r.unwrap(e),t);return new a(s)}getAllKeys(e,t){return new Promise(((s,i)=>{const n=this.underlying.getAllKeys(r.unwrap(e),t);n.onsuccess=()=>s(n.result),n.onerror=()=>i(n.error)}))}}class l{transaction(e,...t){return t.map((e=>new d(e)))}}class d{constructor(e){this.name=e}index(e){return this}put(e,t){}add(e,t){}clear(){}delete(e){}async get(e){}async getAll(e,t){return[]}async count(e){return 0}async cursor(e,t,s){}iterate(e,t){return{next:()=>Promise.resolve({done:!0,value:void 0}),[Symbol.asyncIterator](){return this}}}}},3947:(e,t,s)=>{s.d(t,{Rg:()=>o,T:()=>a,ZP:()=>n,pR:()=>r});var i=s(3673);function n(e){return document.getElementById(e)}function a(e,...t){const s=document.createElement(e);if(0===t.length)return s;const i=t[0],n=!("string"==typeof i||i instanceof HTMLElement),a=n?t.slice(1):t;if(n&&i)if(i.style){const e=i.style;delete i.style,Object.assign(s,i),"string"==typeof e?s.setAttribute("style",e):Object.assign(s.style,e)}else Object.assign(s,i);return s.append(...a.filter((e=>null!=e))),s}function r(e,t){const s=document.cookie.split(";").map((e=>e.trim().split("="))).find((([t,s])=>t===e));return s?s[1]:t}function o(e,t,s,n){e.style.touchAction="none";const a=e=>{e.stopPropagation(),e.preventDefault(),s&&s(new i.Z(e.clientX,e.clientY))},r=t=>{t.stopPropagation(),t.preventDefault(),n&&n(new i.Z(t.clientX,t.clientY)),e.removeEventListener("pointermove",a,!0),e.removeEventListener("pointerup",r,!0),e.releasePointerCapture(t.pointerId)};e.addEventListener("pointerdown",(s=>{s.preventDefault(),s.button>0||(e.addEventListener("pointermove",a,!0),e.addEventListener("pointerup",r,!0),e.setPointerCapture(s.pointerId),t&&t(new i.Z(s.clientX,s.clientY)))}),!0)}},7163:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),n=s(3770),a=s(5574),r=s(7758);class o{constructor(e,t,s=!1,i="woff",n,a){this.name=e,this.short=t,this.premium=s,this.local=!!n,this.thumb=a,this.font=n,this.type=i}static async save(e){const t=await(0,n.X3)(),[s]=t.transaction("readwrite","fonts");await s.put(e,e.name)}static async delete(e){const t=await(0,n.X3)(),[s]=t.transaction("readwrite","fonts");await s.delete(e.name)}}class h{static async loadFontFromTemplate(e,t,s){var i,n;let a=null===(i=s.split(".")[0])||void 0===i?void 0:i.toLowerCase(),r=null===(n=s.split(".")[1])||void 0===n?void 0:n.toLowerCase();return await h.createLocalFontDesc(e,t,a,r)}static async loadFontFromUpload(e){var t,s;let i=null===(t=e.name.split(".")[0])||void 0===t?void 0:t.toLowerCase().substring(0,50).replace(" ","-"),n=null===(s=e.name.split(".")[1])||void 0===s?void 0:s.toLowerCase(),a=i.substring(0,20).replace("-","").toLowerCase();if(i=(null==i?void 0:i.charAt(0).toUpperCase())+(null==i?void 0:i.slice(1)),h.fontList.find((e=>e.name===i)))return void document.dispatchEvent(new CustomEvent("notification",{detail:"Font already exists!"}));let r=n;switch(n){case"otf":r="opentype";break;case"ttf":r="truetype"}const o=new Blob([e],{type:"font/"+r});let c=await h.createLocalFontDesc(o,i,a,n);return c&&document.dispatchEvent(new CustomEvent("notification",{detail:"Font was added!"})),c}static async createLocalFontDesc(e,t,s,n){const a=new o(t,s,!1,n,e);try{await h.addToDOM(a)}catch(p){return console.log(p),void document.dispatchEvent(new CustomEvent("notification",{detail:"Failed to load font!"}))}let c=new r.Z(t,56);c.height>72&&c.setSize(Math.floor(72/c.height*56));const l=i.vL(400,80),d=l.getContext("2d");d.font=c.getCssFont(),d.fillStyle="#ffffff",d.textBaseline="top",d.fillText(t,0,Math.round((80-c.height)/2)-c.ascent);var u;return a.thumb=await(u=l,new Promise(((e,t)=>{u.toBlob((t=>{e(t)}),"image/png")}))),await o.save(a),h.fontList.unshift(a),a}static async removeLocalFontDesc(e){let t=h.getFontDesc(e);t&&(await o.delete(t),h.fontList=h.fontList.filter((e=>e!==t)))}static async addToDOM(e){if(!e)return;const t=e.local?new FontFace(e.name,await(0,a.h0)(e.font)):new FontFace(e.name,`url(/font/${e.short}.woff) format('woff')`);if(document.fonts.has(t))return Promise.resolve(t);let s=await t.load();return document.fonts.add(s),s}static getFontDesc(e){return h.fontList.find((t=>t.name===e))}static async getFontFile(e){let t=this.getFontDesc(e);if(!t)return;if(t.local)return new File([t.font],t.name);let s=await fetch("/font/"+t.short+".woff").then((e=>e.blob()));return s?new File([s],t.short+".woff",{type:"font/woff"}):void 0}static async loadSaved(){const e=await(0,n.X3)(),[t]=e.transaction("readonly","fonts");return t.iterate()}}h.fontList=[new o("Arial","arial"),new o("Courier New","courier"),new o("Georgia","georgia"),new o("Trebuchet MS","trebuchet"),new o("Verdana","verdana"),new o("Aberus","aberus"),new o("Ablation","ablation",!0),new o("Adeft","adeft"),new o("Adelya","adelya",!0),new o("Adios Amigos","adios"),new o("Adolfine","adolfine"),new o("Agnostic","agnostic",!0),new o("Aiden","aiden"),new o("Amaranth","amaranth"),new o("Amateur Typewriter","amateur",!0),new o("Alder","alder",!0),new o("Almondia","almondia"),new o("Aloma Island","alomaisland",!0),new o("Alvida","alvida"),new o("Amoreiza","amoreiza"),new o("AmoretteLight","amorette"),new o("Angeleno Brush Script","angeleno",!0),new o("Antreas","antreas"),new o("Arm Race","arm"),new o("Artick","artick"),new o("Asap","asap"),new o("Atomsfer","atomosfer"),new o("Atthens","atthens"),new o("Avocado Sans","avocado",!0),new o("Baangkarr Press","baangkarr",!0),new o("Badstar","badstar",!0),new o("Bahram","bahram"),new o("Baileyns","baileyns"),new o("Barooduck","barooduck",!0),new o("Bearley","bearley"),new o("Beat","beat",!0),new o("BebasNeue","bebasneue"),new o("Bellquinas","bellquinas"),new o("Bengrraas","bengrraas"),new o("Beornheard","beornheard"),new o("Berretti","berretti"),new o("Biker New","biker",!0),new o("Blossom Berry Script","blossomberry",!0),new o("Boullervard","boullervard"),new o("Bondie","bondie",!0),new o("Bondrians","bondrians",!0),new o("Braga Deco","braga"),new o("Brave Hearted","brave"),new o("Bright Orchid","brightorchid",!0),new o("Brioche","brioche",!0),new o("Brocklyn","brocklyn"),new o("Bronzier","bronzier",!0),new o("Brooklyn","brooklyn",!0),new o("Brodetto","brodetto"),new o("Bronela","bronela",!0),new o("The Brownies","brownies"),new o("Bubbble Gum","bubbblegum",!0),new o("Brushcheetah","brushcheetah"),new o("Butternut Script","butternut",!0),new o("Caang","caang"),new o("Cakehtreuks","cakehtreuks"),new o("Cannoli Poke","cannoli",!0),new o("Camille","camille"),new o("Calamandria","calamandria"),new o("Caldwell","caldwell",!0),new o("Carafun","carafun"),new o("Carnavonts","carnavonts"),new o("Carvino","carvino"),new o("Cervantes","cervantes"),new o("Chaiaathah","chaiaathah",!0),new o("Chalkyal","chalkyal"),new o("Chiqarine","chiqarine"),new o("Chukies","chukies"),new o("Cincoyo","cincoyo"),new o("Clockwise","clockwise",!0),new o("Coast Redwood","coast"),new o("Colombo","colombo",!0),new o("College","college",!0),new o("Companion","companion"),new o("Corlombus","corlombus"),new o("Conseration","conseration",!0),new o("CuprumFFU","cuprum"),new o("Cupello sons","cupello",!0),new o("Costa Mala","costamala",!0),new o("Cozy","cozy",!0),new o("CreamyMoony","creamy"),new o("Cross Road","crossroad",!0),new o("Cross Road Slab","crossroadslab",!0),new o("Daddy Day","daddy"),new o("Dankduck","dankduck"),new o("Darbots","darbots",!0),new o("Davish","davish",!0),new o("Davish Rounded","davishround",!0),new o("Dear Journal","dearjournal",!0),new o("Delicious","delicious",!0),new o("Desmodus","desmodus"),new o("Desmosedici","desmosedici"),new o("Dhangdose","dhangdose"),new o("Dingle","dingle",!0),new o("Djangart Rough","djangart"),new o("Dolington","dolington",!0),new o("Doppelganger","doppelganger",!0),new o("Dorr","dorr",!0),new o("Dustin","dustin",!0),new o("Earth And Sky","earth"),new o("Easterica","easterica"),new o("Eastone","eastone"),new o("Eastwood","eastwood",!0),new o("Echizen","echizen"),new o("El-Karnito","elkarnito"),new o("Elliot","elliot"),new o("Elysian","elysian",!0),new o("Emery","emery"),new o("Empire View","empire"),new o("Eugiene","eugiene"),new o("Espano","espano",!0),new o("Erleane","erleane"),new o("Everleigh","everleigh",!0),new o("Exquisite","exquisite",!0),new o("Espano","espano",!0),new o("Farewell Angelina","angelina",!0),new o("Father and Son","father"),new o("Fatherly","fatherly"),new o("Fenord","fenord",!0),new o("Finland","finland",!0),new o("Flamingo","flamingo"),new o("FoxyMist","foxy"),new o("Forever Freedom","forever",!0),new o("Game On","game"),new o("Gamour","gamour",!0),new o("Gallerina","gallerina",!0),new o("Geronide","geronide",!0),new o("Geronide Stamp","geronidestamp",!0),new o("Gingle Snowland","ginglesnowland",!0),new o("Gingerbreads","gingerbreads"),new o("Gladiolusy","gladiolusy",!0),new o("Glamper","glamper",!0),new o("Goldie Dreambox","goldiedreambox",!0),new o("Gordon","gordon",!0),new o("Gorgeous","gorgeous",!0),new o("Gingerly","gingerly",!0),new o("Goorraatt","goorraatt"),new o("Grayson","grayson",!0),new o("Great Again","great"),new o("Grovana","grovana",!0),new o("Gustavo","gustavo"),new o("Haahloddoh","haahloddoh"),new o("Hadrea","hadrea"),new o("Hairmusk","hairmusk"),new o("Hakushou","hakushou"),new o("Harietta","harietta",!0),new o("Hattori Hanzo","hattori"),new o("Haystacks","haystacks",!0),new o("Heater","heater"),new o("Hedonist","hedonist",!0),new o("Hello Alpha","helloa"),new o("Hello Daddy","hellod",!0),new o("Hello People","hello"),new o("Hello Spring","hellospring",!0),new o("Hellowins","hellowins"),new o("Heypatricks","heypatricks"),new o("Highway","highway",!0),new o("Hippo Letto","hippo"),new o("Historia","historia",!0),new o("Hollawind","hollawind"),new o("Hodor","hodor",!0),new o("Honey","honey"),new o("Honeyspice","honeyspice",!0),new o("Huckleberries","huckleberries"),new o("Hymned Sans","hymnedsans",!0),new o("Hymned Script","hymnedscript",!0),new o("IacottNeue","iacottneue",!0),new o("Icebold","icebold",!0),new o("Inder","inder"),new o("Indigo","indigo",!0),new o("Irish gold","irishgold"),new o("Irishgreen","irishgreen"),new o("Its mine","itsmine"),new o("Jacinda","jacinda",!0),new o("Jared","jared"),new o("Jarots","jarots"),new o("Jomantara","jomantara"),new o("Josefin","josefin"),new o("Juneville","juneville"),new o("Jura","jura"),new o("Kajika","kajika"),new o("Kakamora","kakamora"),new o("Katey Blue","kateyblue",!0),new o("Keripik","keripik"),new o("Ketapang","ketapang"),new o("Kindel","kindel",!0),new o("Kingbirds","kingbirds",!0),new o("Laahleggek","laahleggek"),new o("Laborations","laborations"),new o("La Fiesta","lafiesta"),new o("Landon","landon"),new o("Landre","landre",!0),new o("Langley","langley"),new o("La Vonn","vonn"),new o("Laudya Bloods","laudya"),new o("Leaderson","leaderson"),new o("Leath","leath"),new o("Legendum","legendum"),new o("Leobronx","leobronx"),new o("Little Edelweiss","little"),new o("Little Girl","littlegirl"),new o("Lotus Eater","lotuseater",!0),new o("Lobster","lobster"),new o("Lovalicious","lovalicious",!0),new o("Loverstruck","loverstruck"),new o("MaaLLaangBronks","maallaangbronks"),new o("Madison","madison"),new o("Magic Winter","magicwinter"),new o("Magic Trick","magic"),new o("Mai Leho Bahhrala","maileho"),new o("Maldisa","maldisa"),new o("Malinsha","malinsha",!0),new o("Maple Leaves","mapleleaves",!0),new o("Maxton","maxton"),new o("Market","market"),new o("Marones","marones",!0),new o("Me and my dog","meandmydog",!0),new o("Meidy","meidy"),new o("Menighampiil","menighampiil"),new o("Mewton","mewton"),new o("Merry Merry","merrymerry",!0),new o("Molot","molot"),new o("Momday","momday"),new o("Moms Note","moms"),new o("Monday Lovers","monday"),new o("Monetta","monetta"),new o("Mongli","mongli"),new o("Montour","montour"),new o("Morissette Script","morissette"),new o("Mountain","mountain"),new o("Mooka","mooka",!0),new o("More Magic","moremagic",!0),new o("Morgana Sonz","morgana",!0),new o("Nature Force","natureforce",!0),new o("Ms Orange Sky","ms"),new o("Najova","najova"),new o("Natarajasana","natarajasana"),new o("Naville","naville"),new o("Neorah","neorah"),new o("New Autumn","new"),new o("No Siesta","nosiesta"),new o("Night Jump","nightjump"),new o("Notes","notes",!0),new o("NoFire","nofire"),new o("North Avellion","northavellion",!0),new o("Northern","northern"),new o("North High Shadow","northhighsdw",!0),new o("North High","northhigh",!0),new o("Novante","novante",!0),new o("Nunu","nunu"),new o("Offlander","offlander",!0),new o("Oliemolly","oliemolly",!0),new o("Oracles","oracles"),new o("Ostern","ostern"),new o("Otakaku","otakaku"),new o("Out Hill","out"),new o("Overdose","overdose"),new o("Paabaalioot","paabaalioot"),new o("Painted Gallery","paintedgallery",!0),new o("Pandoura","pandoura"),new o("PapaRocknRoll","papa"),new o("Paradise","paradise"),new o("Patlabour","patlabour",!0),new o("Peach Market","peachmarket",!0),new o("Peanut","peanut"),new o("Peony Rose","peonyrose",!0),new o("Perfect Thoughts","perfectthoughts",!0),new o("Pina Colada","pinacolada",!0),new o("Piqolo","piqolo"),new o("Pixelo","pixelo"),new o("Plunge","plunge"),new o("Pop Fist","pop"),new o("Ponch","ponch",!0),new o("Popera","popera"),new o("Powder","powder",!0),new o("Practish","practish"),new o("Print Clearly","print"),new o("Pulsate","pulsate",!0),new o("Qlassik","qlassik"),new o("quatro","quatro",!0),new o("Quattrocento","quattrocento"),new o("Queenata","queenata"),new o("Quella Script","quella"),new o("Questro","questro"),new o("Quickie Sweet","quickie"),new o("Quill & Ink","quillink"),new o("Quish","quish"),new o("Ranania","ranania"),new o("Rankings Caps","rankingscaps",!0),new o("Raroedette","raroedette"),new o("Rawwwing","rawwwing"),new o("Raquella","raquella"),new o("Reepouh","reepouh"),new o("Regan Slab","regan"),new o("Reewoooh","reewoooh",!0),new o("Reilly","reilly"),new o("Remembrance","remembrance",!0),new o("Retrocycles","retrocycles"),new o("Retros","retros"),new o("Revans","revans",!0),new o("Reynolds Square","reynoldssquare",!0),new o("Rhapsody","rhapsody"),new o("Riverside","riverside"),new o("Republiko","republiko",!0),new o("Rocky","rocky"),new o("Roars","roars"),new o("Rockford","rockford",!0),new o("Rockrace","rockrace",!0),new o("Romaniesta","romaniesta"),new o("Romelio","romelio"),new o("Roossooh","roossooh"),new o("Ropa","ropa"),new o("Rolves","rolves",!0),new o("Roque","roque"),new o("Rosario","rosario"),new o("Roundaries","roundaries"),new o("Rowan","rowan",!0),new o("Salmonberry","salmonberry",!0),new o("San Barley","san"),new o("Saqanone","saqanone"),new o("Sants","sants"),new o("Sanur beach","sanur"),new o("Scriptonesia","scriptonesia",!0),new o("Secretary Typewriter","secretary",!0),new o("Sedalia","sedalia",!0),new o("Search","search",!0),new o("Searchlight","searchlight",!0),new o("See De Mayo","see"),new o("Serenity","serenity"),new o("The Servant","servant"),new o("Sheraton","sheraton",!0),new o("Shoelaces","shoelaces",!0),new o("Silvertone","silvertone",!0),new o("Smoother","smoother",!0),new o("Spring Break","springbreak",!0),new o("Spotlights Thin","spotlightsthin",!0),new o("Spotlights Chunky","spotlightschunky",!0),new o("Squiborn","squiborn",!0),new o("Staatliches","staatliches"),new o("Stardust Moonlight","stardust"),new o("The Stoothgart","stoothgart"),new o("Summer Coconut","summer"),new o("Summer Joy","summerjoy"),new o("Summer Nude","summernude",!0),new o("Summer Peach","summerpeach"),new o("Summer Solstice","summersolstice",!0),new o("Summery","summery"),new o("Sun Again","sunagain"),new o("Sun Pepper","sun"),new o("Sun Streets","sunstreets"),new o("Sunny Bay","sunnybay",!0),new o("Sunshine Boy","sunshine"),new o("Super Slayers","super"),new o("Surface","surface"),new o("Sweeneey","sweeneey"),new o("Teaspoon","teaspoon"),new o("Tabu","tabu"),new o("Teodore","teodore",!0),new o("TeXGyreHeros","texgyreheros"),new o("The Brocker","brocker"),new o("The California","thecalifornia"),new o("The Harison","harison"),new o("The Love For Money","theloveformoney",!0),new o("The Mastiff","mastiff"),new o("The Patriot","patriot"),new o("The Pinta","pinta"),new o("The Roxv","roxv"),new o("The Rogue","rogue"),new o("The Stegris","thestegris",!0),new o("The Queen","queen"),new o("Thirtylane","thirtylane",!0),new o("Titian","titian"),new o("Todes","todes",!0),new o("Tropical Coast","tropicalcoast"),new o("Torberta","torberta"),new o("Twigs","twigs"),new o("Twirly Ballerina","twirly",!0),new o("Unreal","unreal"),new o("Vaganza","vaganza"),new o("Valeria","valeria",!0),new o("Valery","valery"),new o("Vignette","vignette"),new o("Von Everect","von"),new o("The Voyager","voyager",!0),new o("Wandering Flowers","wandering",!0),new o("Wargate","wargate",!0),new o("Western Shooter","westernshooter",!0),new o("West Java","westjava",!0),new o("Winter Sunrise","wintersunrise",!0),new o("White Wonder","whitewonder",!0),new o("Yanone Kaffeesatz","kaffeesatz"),new o("Wonderul Wilderness","wonderulwilderness",!0),new o("Yoseline","yoseline"),new o("Zombie Dust","zombie")],h.loadFont=e=>{let t=h.fontList.find((t=>t.name===e));if(t)return h.addToDOM(t)}},5574:(e,t,s)=>{async function i(e,t){return new Promise(((s,i)=>{var n=new XMLHttpRequest,a=!1;n.responseType="arraybuffer",n.withCredentials=!1,n.open("GET",e,!0),n.onprogress=function(e){e.lengthComputable?t&&t(e.loaded/e.total*100):a||(a=!0,t&&t(-1))},n.onloadend=function(){n.status.toString().match(/^2/)?(a||t&&t(100),s(new Blob([this.response],{type:n.getResponseHeader("Content-Type")}))):i(n)},n.send()}))}function n(e){return new Promise(((t,s)=>{let i=new Image;i.onload=()=>t(i),i.onerror=e=>s(e),i.src=e}))}function a(e){return new Promise(((t,s)=>{const i=new FileReader;i.onerror=()=>s(i.error),i.onloadend=()=>t(i.result),i.readAsArrayBuffer(e)}))}function r(e){return new Promise((async(t,s)=>{const i=URL.createObjectURL(e);let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{URL.revokeObjectURL(i),n.width+n.height==0?s("Could not open file!"):t(n)},n.onerror=function(){URL.revokeObjectURL(i),s("Could not open file!")},n.name=e instanceof File?e.name:"",n.src=i}))}s.d(t,{OA:()=>n,c6:()=>i,h0:()=>a,s4:()=>r})},1302:(e,t,s)=>{s.d(t,{Z:()=>i,m:()=>n});class i{constructor(){this.addTask=(e,t,s)=>{let i={task:e};void 0!==t&&(i.param=t),void 0!==s&&(i.target=s),this.macro.push(i)},this.addChain=e=>{for(var t=0;t<e.length;t++)if(!1===e[t].sidekick)switch(e[t].type){case"border":let s=e[t].value;this.addTask("border",{size:Number(s.size.toFixed(2)),color:s.color.toHEX()});break;case"monochrome":let i=e[t].value;this.addTask("monochrome",{r:Number(i.r.toFixed(3)),g:Number(i.g.toFixed(3)),b:Number(i.b.toFixed(3))});break;default:this.addTask(e[t].type,{amount:Number(e[t].value.toFixed(2))})}},this.toJson=()=>JSON.stringify({macro:this.macro}),this.toBlob=()=>new Blob([this.toJson()],{type:"application/json"}),this.macro=new Array}}class n{constructor(){this.parseJsonString=e=>JSON.parse(e).macro}}},5934:(e,t,s)=>{s.d(t,{$k:()=>_,Hi:()=>I,Q0:()=>L,ZB:()=>A,d3:()=>F});var i=s(6548),n=s(3655),a=s(4375),r=s(5574),o=s(3947),h=s(2542),c=s(8776),l=s(3673),d=s(9591),u=s(6817),p=s(6584),g=s(9868),m=s(1030),v=s(4820),f=s(4170),y=s(8685),w=s(7108),b=s(1294),x=s(2282),Z=s(7359),k=s(7758),E=s(4686),P=s(9067),S=s(7163),C=(s(5453),s(8027)),T=s(2804);function L(e,t=!1){return new Promise(((s,i)=>{(0,o.ZP)("browse")&&(0,o.ZP)("browse").remove();let n=document.createElement("input");n.id="browse",n.type="file",n.multiple=e,n.className="offscreen",t&&(n.accept="image/*",n.capture="camera"),n.addEventListener("change",(()=>{n.files.length>0&&s(n.files),(0,o.ZP)("workspace").removeChild(n)}),!1),(0,o.ZP)("workspace").appendChild(n),n.click()}))}async function M(e){await async function(e,t,s=3e4){let i=!1;for(let n=0;n<document.head.childNodes.length;n++){const t=document.head.childNodes[n];if(t.nodeType===Node.ELEMENT_NODE&&t.getAttribute("src")===e){i=!0;break}}i||document.head.appendChild((0,o.T)("script",{src:e}));let a=0;for(;!t();){if(a>=s)throw new Error(`Timeout triggered when loading script ${e}`);const t=500;a+=t,await n.Dc(t)}}("/js/psd.js",(()=>window.require&&window.require("psd")));const t=window.require("psd"),s=await new Response(e).arrayBuffer(),i=new t(new Uint8Array(s));return i.parse(),i}async function A(e,t,i=!0,a="add"){var o,c;if(t){const d=null!==(o=t.type)&&void 0!==o?o:"";(0,m.Z)("open-file",d);try{switch(d){case"image/psd":case"application/psd":case"application/photoshop":case"application/x-photoshop":case"image/vnd.adobe.photoshop":(0,m.Z)("open-file","image/psd"),await z(e,t);break;case"image/tiff":await async function(e,t){const i=await async function(e){const t=await s.e(556).then(s.t.bind(s,4166,23));let i=await(0,r.h0)(e);return new t.default({buffer:i})}(t);let n=t.name.replace(/^.*[\\\/]/,"");e.addImage(i.toCanvas(),n,"add")}(e,t);break;default:const o=null===(c=t.name)||void 0===c?void 0:c.toLowerCase();if(o){if(o.endsWith(".psd"))return(0,m.Z)("open-file","image/psd"),void(await z(e,t));if(o.endsWith(".pxd"))return(0,m.Z)("open-file","image/pxd"),void(await async function(e,t){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const{PXD:i}=await s.e(215).then(s.bind(s,8132)),a=await(0,r.h0)(t),o=i.decode(new Uint8Array(a)),h=new C.Z(n.M8(),t.name,o.width,o.height);try{e.supressRender=!0,e.addTab(h,"document");for(let t=0;t<o.layers;t++){const t=o.takeNextLayer(),s=t.width,i=t.height;switch(t.kind){case"bitmap":case"shape":{if(0===s||0===i){const s=new x.Z(n.M8(),t.name,void 0,void 0,!1);s.settings.opacity=t.alpha,s.settings.blendmode=t.blendMode,s.settings.visible=t.visible,s.settings.locked=t.locked,e.fresco.layers.push(s),t.free();continue}const a=n.vL(s,i),r=a.getContext("2d"),o=t.takeCanvas();r.putImageData(new ImageData(o,s,i),0,0);const h=new x.Z(n.M8(),t.name,a,new u.Z(t.x,t.y,s,i,t.rotation),t.locked);h.settings.opacity=t.alpha,h.settings.blendmode=t.blendMode,h.settings.visible=t.visible;const c=t.takeMask();if(c.length>0){const e=n.vL(s,i);e.getContext("2d").putImageData(new ImageData(c,s,i),0,0),h.mask=e,h.render()}e.fresco.layers.push(h);break}case"text":{const a=JSON.parse(t.meta),r=new k.Z(a.textSettings.font,a.textSettings.size);Object.assign(r,a.textSettings);const o=new y.Z(n.M8(),a.text,new u.Z(t.x,t.y,s,i,t.rotation),r);o.settings.opacity=t.alpha,o.settings.blendmode=t.blendMode,o.settings.visible=t.visible,await S.Z.loadFont(r.font),r.measureText(),await o.prepare(),e.fresco.layers.push(o)}}t.free()}}finally{o.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}return await e.syncDocument(e.fresco),e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render")),Promise.reject()}(e,t));if(o.endsWith(".pxz"))return(0,m.Z)("open-file","image/pxz"),void(await R(e,t));if(o.endsWith(".svg")&&"frame"!==a)return(0,m.Z)("open-file","image/svg+xml"),void(await async function(e,t,s=!0,i){let n=await t.text();e.addSVGShape(n,t.name,"add")}(e,t,i));if(o.endsWith(".otf")||o.endsWith(".ttf")||o.endsWith(".woff")||o.endsWith(".woff2"))return(0,m.Z)("open-file","font/"+t.name.split(".")[1]),void(await S.Z.loadFontFromUpload(t))}await async function(e,t,s=!0,i){const a=await(0,r.s4)(t);let o,c,l="e"===v.ZP.product&&s||"e"!==v.ZP.product?"create":"layer";if(("x"===v.ZP.product||"drop"===i)&&(l=s&&e.fresco?await(new g.Z).init():e.fresco?"layer":"create","close"===l))return;if(v.ZP.askToPreResize&&"m"!==v.ZP.product&&"create"===l&&(a.width>2500||a.height>2500)){if([o,c]=await new p.Z(a,await h.Z.rotation(t)).init(),void 0===o)return}else o=u.Z.bestFit(a.width,a.height,v.ZP.user.subscription?8196:4096,v.ZP.user.subscription?8196:4096).size(),c=0;let d=n.qT(a,o.width>o.height?o.width:o.height,c),m=t.name?t.name:a.src.replace(/^.*[\\\/]/,"");"create"===l&&e.addTab(new C.Z(n.M8(),m,d.width,d.height),"image");e.addImage(d,m,i)}(e,t,i,a)}}catch(l){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),l}}else document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}async function I(e,t){let s=await T._y(t);await _(e,s)}async function _(e,t){(0,m.Z)("template-"+t.category,t.id);const{url:s,purchased:n}=await T.cI(t.id),r=new a.Z(e,{title:t.name,referrer:(0,i.Z)("templates")});let o=await r.load(s);if(!o)return;let h={locked:t.premium&&!v.ZP.user.subscription,premium:t.premium,templateId:t.id,categoryId:t.categoryId};n&&(h.locked=!1);try{(0,m.Z)("open-file","image/pxz"),await R(e,o,h)}catch(c){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),c}}async function R(e,t,i){const{ZipReader:a}=await s.e(215).then(s.bind(s,8132));let r;try{e.supressRender=!0;let s=await t.arrayBuffer();r=new a(new Uint8Array(s));let h=r.readString("manifest.json"),c=JSON.parse(h);const d=new C.Z(n.M8(),c.name,c.width,c.height,c.background,c.animation,i);e.addTab(d,"template"),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{let t=r.readFile("thumbnail.webp"),s=await n.Td(new Blob([t.buffer]));e.renderPreview(s)}catch(o){console.log(o)}let u=await D(c,new l.Z,r);e.fresco.layers.push(...u),await e.syncDocument(e.fresco)}catch(h){return console.log(h),void alert("Error while loading PXZ file :(")}finally{null==r||r.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}async function F(e,t){let s;document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));let i=new l.Z;try{const n=await fetch(t),a=await n.json();i.x=Math.round((e.fresco.width-a.width)/2),i.y=Math.round((e.fresco.height-a.height)/2),s=await D(a,i)}catch(n){console.log(n),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}s&&0!==s.length&&(e.addLayer(s),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")))}async function D(e,t=new l.Z,s,i){var a;let o=new Array;if(e.stack)for(let h=0;h<e.stack.length;h++){let l=e.stack[h];switch(l.type){case f.Z.TYPE_IMAGE:case f.Z.TYPE_ELEMENT:{let e,a=l.rect?new u.Z(l.rect.x+t.x,l.rect.y+t.y,l.rect.w,l.rect.h,l.rect.r):void 0;if(void 0!==l.content)if(s){let t=s.readFile(l.content);t&&(e=await n.Td(new Blob([t.buffer])))}else{let t=await(0,r.c6)(i+l.content);t&&(e=await n.Td(t))}let h=new x.Z(n.M8(),l.name,e,a,l.locked);if(void 0!==l.opacity&&(h.settings.opacity=l.opacity),void 0!==l.blendmode&&(h.settings.blendmode=l.blendmode),void 0!==l.locked&&(h.settings.locked=l.locked),void 0!==l.visible&&(h.settings.visible=l.visible),void 0!==l.animation&&(h.animation=l.animation),void 0!==l.macro&&(h.macro=l.macro),void 0!==l.mask&&s){let e=s.readFile(l.mask);e&&(h.mask=await n.Td(new Blob([e.buffer]))),h.render()}o.push(h);break}case f.Z.TYPE_TEXT:{if(!l.format)continue;let e=new k.Z(null===(a=l.format.font)||void 0===a?void 0:a.name,l.format.size);void 0!==l.format.align&&(e.align=l.format.align),void 0!==l.format.bold&&(e.bold=l.format.bold),void 0!==l.format.italic&&(e.italic=l.format.italic),void 0!==l.format.underline&&(e.undeline=l.format.underline),void 0!==l.format.uppercase&&(e.uppercase=l.format.uppercase),void 0!==l.format.linespace&&(e.lineSpace=l.format.linespace),void 0!==l.format.letterspace&&(e.letterSpace=l.format.letterspace);let h=new y.Z(n.M8(),l.content,new u.Z(l.rect.x+t.x,l.rect.y+t.y,l.rect.w,l.rect.h,l.rect.r),e);if(void 0!==l.opacity&&(h.settings.opacity=l.opacity),void 0!==l.blendmode&&(h.settings.blendmode=l.blendmode),void 0!==l.locked&&(h.settings.locked=l.locked),void 0!==l.visible&&(h.settings.visible=l.visible),void 0!==l.animation&&(h.animation=l.animation),void 0!==l.macro&&(h.macro=l.macro),e.font){let t=S.Z.getFontDesc(e.font);if(!t&&l.format.font.content){let e;e=s?new Blob([s.readFile(l.format.font.content)]):await(0,r.c6)(i+l.format.font.content),e&&(t=await S.Z.loadFontFromTemplate(e,l.format.font.name,l.format.font.content))}else t&&await S.Z.addToDOM(t);e.measureText()}if(l.style&&(l.style.curve&&(h.textSettings.curve=!0,void 0!==l.style.curve.type&&(h.textSettings.curveType=l.style.curve.type),void 0!==l.style.curve.amount&&(h.textSettings.curveAmount=l.style.curve.amount),void 0!==l.style.curve.spread&&(h.textSettings.curveSpread=l.style.curve.spread),void 0!==l.style.curve.flip&&(h.textSettings.curveFlip=l.style.curve.flip)),l.style.background&&(h.textSettings.background=!0,void 0!==l.style.background.color&&(h.textSettings.backgroundColor=l.style.background.color),void 0!==l.style.background.type&&(h.textSettings.backgroundType=l.style.background.type),void 0!==l.style.background.punch&&(h.textSettings.backgroundPunch=l.style.background.punch),void 0!==l.style.background.offset&&(h.textSettings.backgroundOffset=l.style.background.offset)),l.style.outline&&(h.textSettings.outline=!0,void 0!==l.style.outline.size&&(h.textSettings.outlineSize=l.style.outline.size),void 0!==l.style.outline.color&&(h.textSettings.outlineColor=l.style.outline.color),void 0!==l.style.outline.punch&&(h.textSettings.outlinePunch=l.style.outline.punch),void 0!==l.style.outline.distance&&(h.textSettings.outlineDistance=l.style.outline.distance),void 0!==l.style.outline.direction&&(h.textSettings.outlineDirection=l.style.outline.direction)),l.style.shadow&&(h.textSettings.shadow=!0,void 0!==l.style.shadow.blur&&(h.textSettings.shadowBlur=l.style.shadow.blur),void 0!==l.style.shadow.color&&(h.textSettings.shadowColor=l.style.shadow.color),void 0!==l.style.shadow.opacity&&(h.textSettings.shadowAlpha=l.style.shadow.opacity),void 0!==l.style.shadow.distance&&(h.textSettings.shadowDistance=l.style.shadow.distance),void 0!==l.style.shadow.direction&&(h.textSettings.shadowDirection=l.style.shadow.direction))),void 0!==l.format.fill){let e;switch(l.format.fill.type){case"color":e=new d.Z(c.Z.fromHEX(l.format.fill.value));break;case"gradient":e=new d.Z(Z.ZP.fromIGradient(l.format.fill.value));break;case"pattern":let t=l.format.fill.value;if(s)t.svg=s.readString(t.svg);else{let e=await(0,r.c6)(i+t.svg);e&&(t.svg=await e.text())}e=new d.Z(await P.Z.fromIPattern(t))}h.textSettings.fillType=e.getType(),h.textSettings.fillValue=e.getStringValue(),h.fill=e}await h.prepare(),h.settings.name=l.name,o.push(h);break}case f.Z.TYPE_SHAPE:{let e=new E.Z;if(e.variant=l.format?l.format.variant:"svg","svg"===e.variant){let t;if(l.content)if(s)t=s.readString(l.content);else{let e=await(0,r.c6)(i+l.content);e&&(t=await e.text())}if(!t)continue;e.content=t}"path"===e.variant&&(e.content=l.content),l.style&&(l.style.outline&&(void 0!==l.style.outline.size&&(e.outlineSize=l.style.outline.size),void 0!==l.style.outline.color&&(e.outlineColor=l.style.outline.color)),l.style.shadow&&(e.shadow=!0,void 0!==l.style.shadow.blur&&(e.shadowBlur=l.style.shadow.blur),void 0!==l.style.shadow.color&&(e.shadowColor=l.style.shadow.color),void 0!==l.style.shadow.opacity&&(e.shadowOpacity=l.style.shadow.opacity),void 0!==l.style.shadow.distance&&(e.shadowDistance=l.style.shadow.distance),void 0!==l.style.shadow.direction&&(e.shadowDirection=l.style.shadow.direction)));let a=new w.Z(n.M8(),l.name,new u.Z(l.rect.x+t.x,l.rect.y+t.y,l.rect.w,l.rect.h,l.rect.r),e);if(void 0!==l.opacity&&(a.settings.opacity=l.opacity),void 0!==l.blendmode&&(a.settings.blendmode=l.blendmode),void 0!==l.locked&&(a.settings.locked=l.locked),void 0!==l.visible&&(a.settings.visible=l.visible),void 0!==l.animation&&(a.animation=l.animation),void 0!==l.macro&&(a.macro=l.macro),void 0!==l.format){if(void 0!==l.format.fill){let e;switch(l.format.fill.type){case"color":e=new d.Z(c.Z.fromHEX(l.format.fill.value));break;case"gradient":e=new d.Z(Z.ZP.fromIGradient(l.format.fill.value));break;case"pattern":let t=l.format.fill.value;if(s)t.svg=s.readString(t.svg);else{let e=await(0,r.c6)(i+t.svg);e&&(t.svg=await e.text())}e=new d.Z(await P.Z.fromIPattern(t))}a.shapeSettings.fillType=e.getType(),a.shapeSettings.fillValue=e.getStringValue(),a.fill=e}l.format.radii&&(a.shapeSettings.radii=l.format.radii)}await a.prepare(),o.push(a);break}case f.Z.TYPE_FRAME:{let e=new b.Z(n.M8(),l.name,new u.Z(l.rect.x+t.x,l.rect.y+t.y,l.rect.w,l.rect.h,l.rect.r));if(void 0!==l.opacity&&(e.settings.opacity=l.opacity),void 0!==l.blendmode&&(e.settings.blendmode=l.blendmode),void 0!==l.locked&&(e.settings.locked=l.locked),void 0!==l.visible&&(e.settings.visible=l.visible),void 0!==l.animation&&(e.animation=l.animation),void 0!==l.macro&&(e.macro=l.macro),l.frame&&(void 0!==l.frame.trim&&(e.trim=new u.Z(l.frame.trim.x,l.frame.trim.y,l.frame.trim.w,l.frame.trim.h)),void 0!==l.frame.clip&&(e.frameSettings.clip=l.frame.clip)),l.content)if(s){let t=s.readFile(l.content);t&&(e.canvas=await n.Td(new Blob([t.buffer])))}else{let t=await(0,r.c6)(i+l.content);t&&(e.canvas=await n.Td(t))}l.style&&(l.style.outline&&(e.frameSettings.outline=!0,void 0!==l.style.outline.size&&(e.frameSettings.outlineSize=l.style.outline.size),void 0!==l.style.outline.color&&(e.frameSettings.outlineColor=l.style.outline.color)),l.style.shadow&&(e.frameSettings.shadow=!0,void 0!==l.style.shadow.blur&&(e.frameSettings.shadowBlur=l.style.shadow.blur),void 0!==l.style.shadow.color&&(e.frameSettings.shadowColor=l.style.shadow.color),void 0!==l.style.shadow.opacity&&(e.frameSettings.shadowOpacity=l.style.shadow.opacity),void 0!==l.style.shadow.distance&&(e.frameSettings.shadowDistance=l.style.shadow.distance),void 0!==l.style.shadow.direction&&(e.frameSettings.shadowDirection=l.style.shadow.direction))),e.prepare(),o.push(e);break}}}return o}async function z(e,t){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const s=await M(t),i=s.tree(),a=new C.Z(n.M8(),t.name,s.header.cols,s.header.rows);try{e.supressRender=!0,e.addTab(a,"document");let t=i.descendants();for(let s=t.length-1;s>=0;s--){const i=t[s];if(!i.isGroup())try{const a=new u.Z(i.layer.left,i.layer.top,i.layer.width,i.layer.height),r=i.get("typeTool");let o;if(r){const e=r.export();let t=e.font.sizes?e.font.sizes[0]:12;const s=e.font.name.trim(),i=new k.Z(s.substr(0,s.length-1),t);o=new y.Z(n.M8(),e.value.trim(),a.clone(),i),o.textSettings.fillType="color",o.textSettings.fillValue=new c.Z(e.font.colors[0][0],e.font.colors[0][1],e.font.colors[0][2],e.font.colors[0][3]).toHEX(),o.prepare()}else{const e=await new Promise(((e,t)=>{const s=i.toPng();s.onload=()=>e(s),s.onerror=e=>t(e)}));let r=n.qT(e,4096);o=new x.Z(n.M8(),i.layer.name,r,a,s==t.length-1)}const h={norm:"source-over",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"source-over",over:"overlay",hLit:"hard-light",sLit:"soft-light",diff:"difference",smud:"exclusion",div:"color-doge",idiv:"color-burn",lbrn:"source-over",lddg:"source-over",vLit:"source-over",lLit:"source-over",pLit:"source-over",hMix:"source-over",pass:"source-over",dkCl:"source-over",lgCl:"source-over",fsub:"source-over",fdiv:"source-over"};o.settings.blendmode=h[i.layer.blendMode.blendKey]||"source-over",o.settings.visible=i.layer.visible,o.settings.opacity=i.layer.opacity/255,e.fresco.layers.push(o)}catch(r){console.log("pxd layer read",r)}}e.selectLayer(e.fresco.layers[0]),await e.syncDocument(e.fresco)}catch(r){throw e.close(a.id),r}finally{e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}},7630:(e,t,s)=>{s.d(t,{BI:()=>v,DD:()=>x,Zp:()=>g,b4:()=>Z,f1:()=>m,iM:()=>y,sj:()=>w,vV:()=>f});var i=s(3947),n=s(3655),a=s(7359),r=s(1030),o=s(8776),h=s(4170),c=s(9067),l=s(3409),d=s(7664),u=s(7163),p=s(7282);function g(){return void 0!==window.showSaveFilePicker}async function m(e,t,s,i="image/png"){try{return await window.showSaveFilePicker({suggestedName:e+"."+t,types:[{description:s,accept:{[i]:["."+t]}}]})}catch(n){return console.log(n,n.name),"AbortError"!==n.name&&void 0}}async function v(e,t){try{const s=await e.createWritable();await s.write(t),await s.close()}catch(s){return console.log(s),!1}return!0}function f(e,t,s){let n=(0,i.T)("a",{id:"download-link"});window.document.body.append(n),n.download=t+"."+s,n.href=URL.createObjectURL(e),void 0===n.download?window.location=n.href:n.click(),n.remove()}async function y(e,t){const{ZipWriter:i}=await s.e(215).then(s.bind(s,8132)),r=e.fresco,l="pixel"!==t.unit,p=r.color&&"component"!==t.type?r.color:void 0;let g=(e,t)=>0==t?e:g(t,e%t),m=e=>l?e/r.width:e,v=e=>l?e/r.height:e;const f=g(r.width,r.height),y=l?r.width/f:r.width,b=l?r.height/f:r.height;let x={id:t.id,name:t.name,type:t.type,unit:t.unit,width:y,height:b,background:p,stack:new Array};r.animation&&(x.animation=r.animation);const Z=new Array,k=new Array,E=e.getOutputCanvas();if("template"===t.type){const t=n.Ai(E,Math.round(r.width*(640/r.height)),640),s=await new Promise((e=>t.toBlob(e,"image/webp",90)));if(Z.push(new File([s],"preview.webp")),e.fresco.hasAnimation()){const t=300/b,s=await w(e,24,t,!0);Z.push(new File([s],"preview.mp4"))}}const P="component"===t.type?480:350,S=n.Ai(E,Math.round(r.width*(P/r.height)),P),C=await new Promise((e=>S.toBlob(e,"image/webp",70)));Z.push(new File([C],"thumbnail.webp"));for(let s=0;s<r.layers.length;s++){let e=r.layers[s];if("document"!==t.type&&!e.settings.visible||!e.rect)continue;const i=n.Zd();let l={name:e.settings.name,type:e.type,rect:e.rect?{x:m(e.rect.x),y:v(e.rect.y),w:m(e.rect.width),h:v(e.rect.height),r:Number(e.rect.rotation.toFixed(2))}:void 0,blendmode:""!==e.settings.blendmode?e.settings.blendmode:void 0,opacity:Math.round(100*e.settings.opacity)/100,locked:e.settings.locked,visible:e.settings.visible};switch(e.animation&&(l.animation=e.animation),e.macro&&(l.macro=e.macro),e.type){case h.Z.TYPE_ELEMENT:case h.Z.TYPE_IMAGE:l.type=h.Z.TYPE_IMAGE;let s=e.canvas;if(e instanceof d.Z&&e.rect&&s&&(e.rect.width===s.width&&e.rect.height===s.height||(s=n.Ai(s,e.rect.width,e.rect.height))),e.mask){let t=n.Zd();const s=await new Promise((t=>e.mask.toBlob(t,"image/webp",60)));Z.push(new File([s],t+".webp")),l.mask=t+".webp"}if(s){const e=await new Promise((e=>s.toBlob(e,t.nonDestructive?"image/png":"image/webp",t.quality)));Z.push(new File([e],i+(t.nonDestructive?".png":".webp"))),l.content=i+(t.nonDestructive?".png":".webp")}break;case h.Z.TYPE_TEXT:let r=e,p=u.Z.getFontDesc(r.textSettings.font);if(p&&!k.find((e=>e.name===p.name))&&k.push(p),l.content=r.text,l.format={size:v(r.textSettings.size),align:r.textSettings.align,bold:r.textSettings.bold,italic:r.textSettings.italic,underline:r.textSettings.undeline,uppercase:r.textSettings.uppercase,linespace:r.textSettings.lineSpace,letterspace:r.textSettings.letterSpace,font:{name:r.textSettings.font,content:p?p.short+"."+p.type:""}},r.fill&&r.fill.value&&(l.format.fill={type:r.fill.getType()},r.fill.value instanceof o.Z&&(l.format.fill.value=r.fill.value.toHEX()),r.fill.value instanceof a.ZP&&(l.format.fill.value=r.fill.value.toIGradient()),r.fill.value instanceof c.Z)){let e=n.Zd();Z.push(new File([new Blob([r.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),l.format.fill.value=r.fill.value.toIPattern(e+".svg")}(r.textSettings.curve||r.textSettings.background||r.textSettings.outline||r.textSettings.shadow)&&(l.style={},r.textSettings.curve&&(l.style.curve={type:r.textSettings.curveType,amount:r.textSettings.curveAmount,spread:r.textSettings.curveSpread,flip:r.textSettings.curveFlip}),r.textSettings.background&&(l.style.background={type:r.textSettings.backgroundType,color:r.textSettings.backgroundColor,punch:r.textSettings.backgroundPunch,offset:r.textSettings.backgroundOffset}),r.textSettings.outline&&(l.style.outline={size:r.textSettings.outlineSize,color:r.textSettings.outlineColor,punch:r.textSettings.outlinePunch,distance:r.textSettings.outlineDistance,direction:r.textSettings.outlineDirection}),r.textSettings.shadow&&(l.style.shadow={blur:r.textSettings.shadowBlur,color:r.textSettings.shadowColor,opacity:r.textSettings.shadowAlpha,distance:r.textSettings.shadowDistance,direction:r.textSettings.shadowDirection}));break;case h.Z.TYPE_SHAPE:let g=e;if("svg"===g.shapeSettings.variant)g.shapeSettings.content&&(Z.push(new File([new Blob([g.shapeSettings.content],{type:"image/svg+xml;charset=utf-8"})],i+".svg")),l.content=i+".svg"),l.format={variant:g.shapeSettings.variant};else if(l.content=g.shapeSettings.content,l.format={variant:g.shapeSettings.variant},0!==g.shapeSettings.radii&&(l.format.radii=g.shapeSettings.radii),g.fill&&g.fill.value&&(l.format.fill={type:g.fill.getType()},g.fill.value instanceof o.Z&&(l.format.fill.value=g.fill.value.toHEX()),g.fill.value instanceof a.ZP&&(l.format.fill.value=g.fill.value.toIGradient()),g.fill.value instanceof c.Z)){let e=n.Zd();Z.push(new File([new Blob([g.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),l.format.fill.value=g.fill.value.toIPattern(e+".svg")}(g.shapeSettings.shadow||g.shapeSettings.outlineSize>0)&&(l.style={},g.shapeSettings.outlineSize>0&&(l.style.outline={size:g.shapeSettings.outlineSize,color:g.shapeSettings.outlineColor}),g.shapeSettings.shadow&&(l.style.shadow={blur:g.shapeSettings.shadowBlur,color:g.shapeSettings.shadowColor,opacity:g.shapeSettings.shadowOpacity,distance:g.shapeSettings.shadowDistance,direction:g.shapeSettings.shadowDirection}));break;case h.Z.TYPE_FRAME:let f=e;if(f.canvas){!f.trim||f.trim.width===f.canvas.width&&f.trim.height===f.canvas.height||(f.canvas=n.Ai(f.canvas,f.trim.width,f.trim.height));const e=await new Promise((e=>f.canvas.toBlob(e,"image/webp",t.quality)));Z.push(new File([e],i+".webp")),l.content=i+".webp"}l.frame={trim:f.trim?{x:m(f.trim.x),y:v(f.trim.y),w:m(f.trim.width),h:v(f.trim.height),r:0}:void 0,clip:f.frameSettings.clip},(f.frameSettings.outline||f.frameSettings.shadow)&&(l.style={},f.frameSettings.outline&&(l.style.outline={size:f.frameSettings.outlineSize,color:f.frameSettings.outlineColor}),f.frameSettings.shadow&&(l.style.shadow={blur:f.frameSettings.shadowBlur,color:f.frameSettings.shadowColor,opacity:f.frameSettings.shadowOpacity,distance:f.frameSettings.shadowDistance,direction:f.frameSettings.shadowDirection}))}x.stack.push(l)}let T=new i;T.writeString("manifest.json",JSON.stringify(x),!0);for(let s=0;s<Z.length;s++){const e=Z[s];let t=await e.arrayBuffer(),i=new Uint8Array(t);T.writeFile(e.name,i,e.name.endsWith(".svg"))}for(let s=0;s<k.length;s++){const e=k[s];let t=await u.Z.getFontFile(e.name);if(t){let s=await t.arrayBuffer(),i=new Uint8Array(s);T.writeFile(e.short+"."+e.type,i,!0)}}const L=T.finish();return new Blob([L.buffer])}function w(e,t,i,a,o){return function(e){let t;try{return t=new window.VideoEncoder({output:()=>{},error:()=>{}}),t.configure({width:16,height:16,codec:e,hardwareAcceleration:"prefer-software",framerate:30,bitrate:4e6}),!0}catch(s){return!1}finally{null==t||t.close()}}("avc1.42001e")?((0,r.Z)("video-encode","fast"),function(e,t,i,a,r){let o,h;return new n.k3((()=>new Promise((async(n,c)=>{try{const{Mp4:d}=await s.e(132).then(s.bind(s,8132)),p=1e6;h=new d(p);const g=Math.round(p/t),m=new l.Z(e,t,i,a);let v=0,f=!1,y=null;o=new VideoEncoder({output:(e,t)=>{if(f)return void console.error("Unexpected frames to process");if(null===y&&"key"===e.type){const e=new Uint8Array(t.decoderConfig.description);y=h.addVideoTrack(t.decoderConfig.codedWidth,t.decoderConfig.codedHeight,e)}const s=new Uint8Array(e.byteLength);e.copyTo(s),h.addFrame(y,g*v,g,0,"key"===e.type,s),v+=1,r&&r(v/m.totalFrames),v===m.totalFrames&&(f=!0,n(new Blob([h.fetchFile()],{type:"video/mp4"})))},error:e=>{console.error(e),c(e)}});let w=await m.requestFrame();const x=b(w.width,w.height,t);for(o.configure({width:w.width,height:w.height,codec:"avc1.42001e",hardwareAcceleration:"prefer-software",framerate:t,bitrate:x});w;){const e=new VideoFrame(w,{timestamp:g*(m.currentFrame-1),duration:g});o.encode(e),e.close(),w=await m.requestFrame()}await o.flush()}catch(d){console.error(d)}finally{try{null==o||o.close()}catch(u){}}}))),(()=>{try{null==o||o.close(),null==h||h.free()}catch(e){}}))}(e,t,i,a,o)):((0,r.Z)("video-encode","slow"),function(e,t,s,i,a){const r=new p.Y3,o=new n.k3((async()=>{try{const h=new l.Z(e,t,s,i);let c,d,u=await h.requestFrame();for(;u;){const e=await new Promise(((e,t)=>{u.toBlob((t=>e(t)),"image/jpeg",.92)})),t=await new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(new Uint8Array(i.result)),i.readAsArrayBuffer(e)}));if(o.isCanceled())throw new n.Mk;r.send({type:"addFile",name:`${h.currentFrame}.jpeg`,data:t},[t.buffer]),c=u.width,d=u.height,a&&a(h.currentFrame/h.totalFrames/2),u=await h.requestFrame()}const p=b(c,d,t);for(r.send({type:"run",arguments:["-r",t.toFixed(0),"-f","image2","-s",`${c}x${d}`,"-i","%d.jpeg","-start_number","1","-vframes",h.totalFrames.toFixed(0),"-vcodec","libx264","-crf","23","-vb",p.toFixed(0),"-pix_fmt","yuv420p","-preset","ultrafast","out.mp4"]});;){const e=await r.receive();switch(e.type){case"progress":a&&a(e.frame/h.totalFrames/2+.5);break;case"result":return new Blob([e.data],{type:"video/mp4"})}}}finally{null==r||r.terminate()}}),(()=>{null==r||r.terminate()}));return o}(e,t,i,a,o))}function b(e,t,s,i=.18){return Math.round(e*t*s*i)}function x(e,t,s,i,a,r,o){const h=new p.Bm;return new n.k3((async()=>{try{let n=new l.Z(e,t,s,r),c=Math.round(100/t/i),d=await n.requestFrame();for(h.send({type:"start",width:d.width,height:d.height,repeat:a}),await h.receive();d;){let e=d.getContext("2d").getImageData(0,0,d.width,d.height);o&&o(n.currentFrame/n.totalFrames),h.send({type:"frame",buffer:e,delay:c},[e.data.buffer]),d=await n.requestFrame(),await h.receive()}h.send({type:"done"});const u=await h.receive();if("result"!==u.type)throw new Error("No file");return new Blob([u.message])}finally{h.terminate()}}),(()=>{null==h||h.terminate()}))}async function Z(e,t){const i=await s.e(500).then(s.bind(s,9055)),n=await i.PDFDocument.create(),a=n.addPage([e.fresco.width,e.fresco.height]),r=await n.embedJpg(await t.arrayBuffer());return a.drawImage(r,{x:0,y:0,width:e.fresco.width,height:e.fresco.height}),new Blob([await n.save()])}},3506:(e,t,s)=>{s.d(t,{ZP:()=>n});class i{constructor(e,t,s,i,n){this.id=e,this.urls=t,this.description=s,this.downloadLink=i,this.credits=n,this.downloadUrl=()=>fetch(this.downloadLink+"&client_id=0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca").then((e=>e.json())).then((e=>e.url)),this.source="unsplash",this.thumbnail=t.thumb}}class n{}n.backends=[{name:"unsplashed",query:e=>function e(t,s){return fetch(`https://api.unsplash.com/search/photos?page=${s}&query=${t}&per_page=50`,{headers:{Authorization:"Client-ID 0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca"}}).then((e=>e.json())).then((e=>e)).then((n=>{const a=n.total_pages===s;return{items:n.results.map((e=>new i(e.id,e.urls,e.description,e.links.download_location,{name:e.user.name,profile:e.user.links.html}))),nextPage:a?void 0:()=>e(t,s+1)}}))}(e,1)}],n.randomDefault=()=>{const e=["candy","cake","cookies","nature","spring","winter","forest","architecture","park","new york","flower","london","tokyo","kyoto","cherry blossom","waterfall","jungle","italy","food","garden","lion","reef","river","mountain","boats"];return e[Math.floor(Math.random()*e.length)]},n.queryAll=e=>{const t=e=>{const t=e.filter((e=>!!e.nextPage)).map((e=>e.nextPage()));if(0!==t.length)return()=>Promise.all(t).then(s)},s=e=>{let s=[];return e.forEach((e=>{s=s.concat(e.items)})),{items:s.sort(((e,t)=>Math.random()>.5?-1:1)),nextPage:t(e)}};return Promise.all(n.backends.map((t=>t.query(e)))).then(s)},n.query=(e,t)=>{const s=n.backends.find((t=>t.name===e));return s?Promise.reject(`No such backend: ${e}`):s.query(t)}},2804:(e,t,s)=>{async function i(e,t={}){const s=function(e,t={}){const s=[];for(var i in t)s.push(`${i}=${encodeURIComponent(t[i].toString())}`);return 0==s.length?e:`${e}?${s.join("&")}`}(`https://${function(){const e=window.location.hostname;return"dev.pixlr.com"===e?e:"pixlr.com"}()}`+e,t),i=await fetch(s),n=i.headers.get("content-type");if(n&&-1===n.indexOf("application/json"))return;const a=await i.json();if(!1===a.status)throw new Error(a.message);return a.data}s.d(t,{Qz:()=>n,RH:()=>r,_y:()=>a,cI:()=>o});const n=(e={})=>i("/api/templates/",Object.assign({features:"image,text,shape,frame,group,animation"},e)),a=e=>i(`/api/templates/${e}/`),r=(e,t)=>i(`/api/templates/collections/${e}/?limit=${t}`),o=e=>i(`/api/templates/${e}/download/`)},3049:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s){this.framebuffer=e,this.renderbuffer=t,this.texture=s}destroy(e){e.deleteFramebuffer(this.framebuffer),e.deleteRenderbuffer(this.renderbuffer),e.deleteTexture(this.texture)}}},2634:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(8776),n=s(9679),a=s(4084),r=s(9389),o=s(1662),h=s(134);class c{static init(){c.presets||(c.grouping={friends:["aladin","alex","amber","anne","antonio","bob","greg","hagrid","harry","ivan","jean","josh","karen","lucas","melissa","peter","salomon","sara","sophia","tony"],"too-old":["agnes","conny","gordon","harrison","henry","logan","olay","porter","sampi","tom","vinny"],instage:["borg","carl","coco","doris","doug","earl","sun","blues","country","lemonpell","tiny dc","minker"],colors:["superone","tonola","reddish","fellowing","grassland","springs","justblues","bluesteel","flowerpot","stinker","violiin","blupur","beyllo","wifortress"],retro:["vib","ranguit","rangeen","creamlow","sven","yenely","ragwarm","greered","danligter","garage"],shades:["strawberry","clementine","pear","apple","blueberry","grapes","dragon"],tuning:["punch","bright","contrast","vivid","clairify"],artzy:["poster","glitch","mozak","frank","pinvet","night vision","darkstreet","blomberg","lolita","atonic"],portrait:["matte","deep","film","sunny","gritty"],food:["berry","ensalat","morning","corn","sharp"],urban:["cement","style","mold","shimmer","stalker","sham"],nature:["beach","flower","forest"]},c.presets={flower:[new n.Z("vibrance",.2),new n.Z("saturation",.1),new n.Z("temperature",.1)],forest:[new n.Z("saturation",-.2),new n.Z("vibrance",1),new n.Z("clarity",.2),new n.Z("temperature",.16),new n.Z("tint",.2),new n.Z("curves",new h.z([[0,0,65,52,173,190,236,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],beach:[new n.Z("saturation",.2),new n.Z("vibrance",.2),new n.Z("curves",new h.z([[0,0,68,56,199,208,255,255],[0,0,255,255],[0,0,98,97,196,201,255,255],[0,0,87,85,201,182,255,255]])),new n.Z("temperature",.1)],sham:[new n.Z("saturation",-.3),new n.Z("fill",new a.Z(new i.Z(153,221,255),"overlay",.3)),new n.Z("curves",new h.z([[60,31,191,217],[0,0,120,134,255,255],[0,0,255,255],[0,0,120,144,255,255]]))],stalker:[new n.Z("curves",new h.z([[62,64,190,191],[0,0,133,125,255,255],[0,0,54,65,209,208,255,255],[60,62,96,99,240,230,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.2)],shimmer:[new n.Z("temperature",-.2),new n.Z("tint",-.12),new n.Z("fill",new a.Z(new i.Z(190,11,255),"screen",.12)),new n.Z("curves",new h.z([[8,23,244,227],[0,0,255,255],[0,0,131,124,255,255],[0,0,149,112,255,255]]))],mold:[new n.Z("curves",new h.z([[65,64,233,233],[0,0,138,121,255,255],[0,0,60,75,184,184,255,255],[0,0,64,75,181,176,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.12)],style:[new n.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,26,89,64,121,126,180,213,255,255],[0,0,71,50,190,210,255,255],[61,64,112,97,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.4),new n.Z("temperature",.1)],cement:[new n.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,0,255,255],[0,0,60,54,198,210,255,255],[0,0,73,37,150,149,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.1)],sharp:[new n.Z("curves",new h.z([[0,0,42,20,199,218,224,246,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.1),new n.Z("sharpen",.1),new n.Z("clarity",.1)],corn:[new n.Z("temperature",.1),new n.Z("vibrance",.3),new n.Z("contrast",.1),new n.Z("curves",new h.z([[0,0,66,78,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],morning:[new n.Z("tint",.18),new n.Z("temperature",.1),new n.Z("highlights",.08),new n.Z("levels",new o.Z(0,245,0,255)),new n.Z("curves",new h.z([[64,64,150,181,254,255],[0,0,122,138,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("fill",new a.Z(new i.Z(194,120,41),"overlay",.2))],ensalat:[new n.Z("highlights",.2),new n.Z("shadows",-.2),new n.Z("brightness",.1),new n.Z("levels",new o.Z(10,245,0,255)),new n.Z("curves",new h.z([[0,0,135,119,191,193,255,255],[0,0,255,255],[0,0,129,121,255,255],[0,0,255,255]])),new n.Z("clarity",.2),new n.Z("sharpen",.15)],berry:[new n.Z("vibrance",.44),new n.Z("curves",new h.z([[0,0,62,66,121,135,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.2),new n.Z("highlights",.4),new n.Z("shadows",-.2),new n.Z("levels",new o.Z(20,255,0,255))],gritty:[new n.Z("saturation",-.4),new n.Z("levels",new o.Z(20,255,0,255)),new n.Z("curves",new h.z([[0,0,50,33,128,112,190,215,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("clarity",1),new n.Z("grain",.3)],sunny:[new n.Z("fill",new a.Z(new i.Z(255,194,96),"overlay",.2)),new n.Z("temperature",.1),new n.Z("glamour",.4),new n.Z("clarity",.3)],film:[new n.Z("sharpen",.2),new n.Z("glamour",.5),new n.Z("grain",.5),new n.Z("highlights",-.2),new n.Z("shadows",-.2),new n.Z("saturation",-.2)],matte:[new n.Z("curves",new h.z([[0,50,38,56,79,82,152,153,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.12),new n.Z("saturation",-.1)],deep:[new n.Z("curves",new h.z([[0,0,117,99,191,198,255,255],[0,0,71,38,177,209,255,255],[0,0,236,255],[0,28,75,101,190,171,254,233]])),new n.Z("saturation",-.3)],aladin:[new n.Z("curves",new h.z([[0,0,255,255],[0,52,87,99,255,255],[0,0,106,107,194,190,254,212],[0,0,166,129,254,142]]))],amber:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,98,150,255,255],[0,0,138,117,255,255],[0,128,254,129]]))],anne:[new n.Z("contrast",.25),new n.Z("curves",new h.z([[0,0,255,255],[0,0,78,66,135,171,255,255],[0,0,99,87,180,208,255,255],[0,0,94,93,171,161,255,255]]))],antonio:[new n.Z("glamour",.8)],alex:[new n.Z("glamour",.6)],bob:[new n.Z("saturation",-.6),new n.Z("highlights",.5)],greg:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,74,50,181,198,255,255],[0,0,61,41,108,170,158,207,254,208],[0,0,83,56,168,204,255,255]]))],hagrid:[new n.Z("vibrance",.9),new n.Z("saturation",.1),new n.Z("clarity",.5),new n.Z("shadows",-.3)],harry:[new n.Z("fill",new a.Z(new i.Z(214,178,119),"overlay",.7)),new n.Z("grain",.5)],ivan:[new n.Z("fill",new a.Z(new i.Z(255,0,68),"overlay",.4)),new n.Z("shadows",.15),new n.Z("levels",new o.Z(6,255,0,255))],jean:[new n.Z("levels",new o.Z(56,233,0,255)),new n.Z("saturation",-1),new n.Z("tint",.1),new n.Z("exposure",.78),new n.Z("bloom",.1)],josh:[new n.Z("curves",new h.z([[0,0,78,52,175,207,255,255],[0,0,255,255],[0,0,255,255],[0,64,87,129,254,193]]))],karen:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,89,144,255,255],[0,0,138,112,255,255],[0,0,162,88,255,255]]))],lucas:[new n.Z("tint",1),new n.Z("saturation",-.85),new n.Z("contrast",.4),new n.Z("shadows",1),new n.Z("temperature",.1)],melissa:[new n.Z("curves",new h.z([[0,0,255,255],[0,62,255,255],[0,0,255,255],[0,61,254,193]]))],peter:[new n.Z("curves",new h.z([[0,0,255,255],[0,6,31,20,65,26,87,51,195,190,254,230],[0,11,24,27,102,131,189,195,255,255],[0,40,126,148,254,177]]))],salomon:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,83,50,177,213,255,255],[0,0,69,55,186,205,255,255],[11,56,254,212]])),new n.Z("contrast",-.2)],sara:[new n.Z("vibrance",1),new n.Z("contrast",.1),new n.Z("highlights",.3)],sophia:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,140,116,222,254],[0,0,70,59,182,201,255,255],[0,29,252,227]])),new n.Z("saturation",.3)],tony:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,92,42,218,252],[0,0,73,75,157,194,255,255],[0,27,254,227]]))],agnes:[new n.Z("desaturate",1),new n.Z("contrast",.5)],conny:[new n.Z("saturation",-.55),new n.Z("temperature",.25),new n.Z("brightness",-.25),new n.Z("levels",new o.Z(14,233,0,255)),new n.Z("exposure",.35),new n.Z("highlights",-.9)],gordon:[new n.Z("desaturate",1),new n.Z("temperature",.7),new n.Z("tint",.3),new n.Z("saturation",-.2)],harrison:[new n.Z("toning",new r.Z(new i.Z(255,240,215),new i.Z(48,26,24),1)),new n.Z("grain",.2)],henry:[new n.Z("toning",new r.Z(new i.Z(255,240,215),new i.Z(48,26,24),1)),new n.Z("saturation",-.5)],logan:[new n.Z("glamour",.5),new n.Z("tint",.4),new n.Z("saturation",-.35),new n.Z("toning",new r.Z(new i.Z(255,240,215),new i.Z(48,26,24),.8))],olay:[new n.Z("saturation",-1),new n.Z("grain",.5),new n.Z("vignette",.5)],porter:[new n.Z("saturation",-1),new n.Z("vignette",.4),new n.Z("levels",new o.Z(50,205))],tom:[new n.Z("desaturate",1)],sampi:[new n.Z("toning",new r.Z(new i.Z(255,228,196),new i.Z(0,0,0),1)),new n.Z("levels",new o.Z(0,217,0,255)),new n.Z("temperature",.3)],vinny:[new n.Z("curves",new h.z([[0,0,133,111,255,255],[0,0,255,255],[0,0,255,255],[0,0,133,138,255,255]])),new n.Z("vibrance",-1),new n.Z("saturation",1),new n.Z("temperature",.8),new n.Z("contrast",-.1),new n.Z("highlights",.1)],borg:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,94,66,227,255],[0,0,93,94,179,198,255,255],[0,19,254,228]])),new n.Z("fill",new a.Z(new i.Z(204,255,0),"",.1))],carl:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,93,64,227,255],[0,0,93,94,181,189,255,255],[0,19,254,228]])),new n.Z("vignette",.3),new n.Z("contrast",.15),new n.Z("saturation",-.3)],coco:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,64,97,255,255],[0,0,142,122,255,255],[0,0,144,112,255,255]]))],doris:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,78,48,177,209,255,255],[0,0,92,94,179,208,255,255],[0,52,254,215]])),new n.Z("saturation",-.2)],doug:[new n.Z("curves",new h.z([[0,0,255,255],[0,64,255,255],[0,0,255,255],[1,64,252,193]]))],earl:[new n.Z("vignette",.4),new n.Z("curves",new h.z([[0,0,255,255],[0,0,222,254],[0,47,223,254],[0,129,222,255]])),new n.Z("fill",new a.Z(new i.Z(247,218,174),"multiply",.8))],sun:[new n.Z("fill",new a.Z(new i.Z(251,242,163),"multiply",.8)),new n.Z("vignette",-.25)],blues:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,77,54,181,207,255,255],[0,0,73,51,180,209,255,255],[0,0,54,75,201,185,255,255]]))],country:[new n.Z("curves",new h.z([[0,0,84,74,115,105,255,255],[0,0,73,80,93,124,255,255],[0,0,50,34,93,105,119,142,255,255],[0,0,85,85,125,112,255,255]]))],lemonpell:[new n.Z("curves",new h.z([[0,36,80,84,156,190,255,255],[0,0,255,255],[0,0,103,105,158,176,255,255],[0,19,107,83,198,196,255,255]]))],"tiny dc":[new n.Z("curves",new h.z([[0,0,255,255],[0,0,79,46,199,217,255,255],[9,1,110,126,254,232],[0,46,92,103,191,158,254,205]])),new n.Z("grain",.3)],minker:[new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4),new n.Z("vibrance",.5)],superone:[new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(77,0,51),.8)),new n.Z("levels",new o.Z(50,175,0,255))],tonola:[new n.Z("toning",new r.Z(new i.Z(221,255,153),new i.Z(77,0,51),.8)),new n.Z("levels",new o.Z(26,213,0,255)),new n.Z("saturation",.36),new n.Z("temperature",.22)],reddish:[new n.Z("toning",new r.Z(new i.Z(255,214,147),new i.Z(110,37,0),.8)),new n.Z("contrast",.3),new n.Z("highlights",1)],fellowing:[new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(77,47,0),.8)),new n.Z("levels",new o.Z(24,203,0,255)),new n.Z("contrast",.14),new n.Z("saturation",.3),new n.Z("temperature",.18)],grassland:[new n.Z("toning",new r.Z(new i.Z(221,255,153),new i.Z(0,77,25),.7)),new n.Z("levels",new o.Z(18,227,0,255)),new n.Z("contrast",.16)],springs:[new n.Z("toning",new r.Z(new i.Z(221,255,153),new i.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],justblues:[new n.Z("toning",new r.Z(new i.Z(198,236,255),new i.Z(26,0,77),.79)),new n.Z("levels",new o.Z(16,189,0,255)),new n.Z("saturation",.2),new n.Z("contrast",.2)],bluesteel:[new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,215,12,255))],flowerpot:[new n.Z("toning",new r.Z(new i.Z(255,153,221),new i.Z(51,77,0),.8)),new n.Z("levels",new o.Z(22,215,0,255)),new n.Z("vignette",-.2)],stinker:[new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4)],violiin:[new n.Z("contrast",.32),new n.Z("toning",new r.Z(new i.Z(195,166,255),new i.Z(33,0,0),1)),new n.Z("levels",new o.Z(22,223,0,255)),new n.Z("exposure",.22),new n.Z("brightness",.12)],blupur:[new n.Z("toning",new r.Z(new i.Z(255,153,221),new i.Z(7,68,97),.8)),new n.Z("vibrance",.7),new n.Z("contrast",.3)],beyllo:[new n.Z("vibrance",1),new n.Z("saturation",1),new n.Z("temperature",-.55),new n.Z("tint",.1),new n.Z("levels",new o.Z(0,255,24,249)),new n.Z("toning",new r.Z(new i.Z(255,213,0),new i.Z(125,3,84),.76)),new n.Z("curves",new h.z([[0,0,255,255],[0,0,131,115,255,255],[0,0,136,128,255,255],[0,0,122,145,255,255]])),new n.Z("vignette",.28)],wifortress:[new n.Z("toning",new r.Z(new i.Z(108,206,255),new i.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],vib:[new n.Z("vibrance",.1),new n.Z("saturation",.5),new n.Z("brightness",.1),new n.Z("temperature",.5),new n.Z("levels",new o.Z(12,253,0,255)),new n.Z("highlights",.2),new n.Z("curves",new h.z([[0,0,255,255],[0,0,70,80,198,181,255,255],[0,0,140,135,255,255],[0,0,74,96,200,172,255,255]])),new n.Z("toning",new r.Z(new i.Z(255,238,210),new i.Z(54,6,6),.07)),new n.Z("contrast",-.1)],ranguit:[new n.Z("saturation",.22),new n.Z("temperature",.96),new n.Z("tint",-.28),new n.Z("contrast",.14),new n.Z("brightness",-.2),new n.Z("levels",new o.Z(0,237,56,255)),new n.Z("toning",new r.Z(new i.Z(221,255,153),new i.Z(41,35,33),.26))],rangeen:[new n.Z("vibrance",1),new n.Z("saturation",.46),new n.Z("temperature",.36),new n.Z("levels",new o.Z(0,251,14,255)),new n.Z("shadows",.34),new n.Z("highlights",.12),new n.Z("toning",new r.Z(new i.Z(121,255,224),new i.Z(245,22,107),.12)),new n.Z("contrast",-.1),new n.Z("curves",new h.z([[0,0,144,152,255,255],[0,0,136,107,255,255],[0,0,115,102,255,255],[0,0,106,91,255,255]]))],creamlow:[new n.Z("vibrance",.82),new n.Z("saturation",-.24),new n.Z("temperature",1),new n.Z("tint",.78),new n.Z("contrast",-.3),new n.Z("levels",new o.Z(40,247,0,255)),new n.Z("highlights",.64),new n.Z("toning",new r.Z(new i.Z(221,255,153),new i.Z(145,39,9),.29)),new n.Z("curves",new h.z([[0,0,5,13,78,83,172,162,255,255],[0,0,255,255],[0,0,131,120,255,255],[0,0,68,61,175,184,255,255]]))],sven:[new n.Z("vibrance",.7),new n.Z("temperature",.5),new n.Z("tint",.3),new n.Z("exposure",.2),new n.Z("contrast",-.2),new n.Z("levels",new o.Z(4,255,0,235)),new n.Z("highlights",-.3),new n.Z("shadows",.3),new n.Z("grain",.3),new n.Z("vignette",.45)],yenely:[new n.Z("tint",.5),new n.Z("levels",new o.Z(0,235,20,255)),new n.Z("saturation",-.62),new n.Z("contrast",-.3),new n.Z("shadows",-.6),new n.Z("curves",new h.z([[0,0,148,105,255,255],[0,0,92,79,128,227,255,255],[0,0,74,103,119,172,255,255],[0,0,111,148,255,255]])),new n.Z("highlights",1),new n.Z("brightness",.14),new n.Z("temperature",.3),new n.Z("vibrance",1),new n.Z("exposure",-.1)],ragwarm:[new n.Z("temperature",.62),new n.Z("levels",new o.Z(32,255,0,243)),new n.Z("highlights",-.14),new n.Z("vignette",.28),new n.Z("toning",new r.Z(new i.Z(153,255,187),new i.Z(21,55,143),.07)),new n.Z("curves",new h.z([[0,0,126,125,255,255],[0,0,255,255],[0,0,130,121,255,255],[0,0,138,124,255,255]]))],greered:[new n.Z("vibrance",.32),new n.Z("temperature",.4),new n.Z("tint",-.5),new n.Z("brightness",.24),new n.Z("contrast",-.1),new n.Z("vignette",.31),new n.Z("shadows",.38)],danligter:[new n.Z("saturation",.86),new n.Z("temperature",-1),new n.Z("tint",-.92),new n.Z("brightness",.22),new n.Z("exposure",.22),new n.Z("contrast",.1),new n.Z("levels",new o.Z(0,239,0,255)),new n.Z("highlights",-.12),new n.Z("dehaze",-.12),new n.Z("toning",new r.Z(new i.Z(255,216,153),new i.Z(0,52,77),.14)),new n.Z("curves",new h.z([[0,0,255,255],[0,0,96,115,162,194,255,255],[0,0,101,97,185,189,255,255],[0,0,144,130,222,228,255,255]]))],garage:[new n.Z("tint",.6),new n.Z("saturation",-.04),new n.Z("shadows",-1),new n.Z("grain",.42),new n.Z("glamour",.3)],strawberry:[new n.Z("fill",new a.Z(new i.Z(255,0,0),"soft-light",.5))],clementine:[new n.Z("fill",new a.Z(new i.Z(255,158,0),"soft-light",.5))],pear:[new n.Z("fill",new a.Z(new i.Z(170,255,0),"soft-light",.5))],apple:[new n.Z("fill",new a.Z(new i.Z(0,255,85),"soft-light",.5))],blueberry:[new n.Z("fill",new a.Z(new i.Z(0,170,255),"soft-light",.5))],grapes:[new n.Z("fill",new a.Z(new i.Z(85,0,255),"soft-light",.5))],dragon:[new n.Z("fill",new a.Z(new i.Z(255,0,170),"soft-light",.5))],punch:[new n.Z("curves",new h.z([[0,0,80,64,173,193,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.5)],bright:[new n.Z("highlights",-.3),new n.Z("shadows",.5),new n.Z("levels",new o.Z(0,215,10,255))],contrast:[new n.Z("contrast",.2),new n.Z("highlights",.2),new n.Z("levels",new o.Z(20,215,0,255)),new n.Z("shadows",.4)],vivid:[new n.Z("vibrance",.4),new n.Z("shadows",.25)],clairify:[new n.Z("clarity",.6),new n.Z("sharpen",.1),new n.Z("glamour",.2)],poster:[new n.Z("posterize",.08)],glitch:[new n.Z("scanlines",{size:.03,amount:.05,colorize:!1,direction:!1}),new n.Z("slice",{seed:86,amount:4,distance:.12,line:!0}),new n.Z("bleed",{seed:58,amplitude:.05,block:1.2})],mozak:[new n.Z("mosaic",.5),new n.Z("fringe",.2)],frank:[new n.Z("fringe",.4)],pinvet:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("pixelate",.7)],blomberg:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("tint",1),new n.Z("temperature",-.8),new n.Z("saturation",-.5)],lolita:[new n.Z("fill",new a.Z(new i.Z(255,153,153),"vivid-light",1))],atonic:[new n.Z("curves",new h.z([[0,0,255,255],[6,235,246,4],[131,3,138,255],[1,42,251,213]]))],"night vision":[new n.Z("fill",new a.Z(new i.Z(30,255,0),"multiply",1)),new n.Z("levels",new o.Z(0,183,0,255)),new n.Z("vignette",.85),new n.Z("grain",.6)],darkstreet:[new n.Z("temperature",-1),new n.Z("highlights",.58),new n.Z("shadows",-1),new n.Z("levels",new o.Z(100,249,0,255)),new n.Z("grain",1),new n.Z("exposure",-1)]})}static named(e){return c.init(),this.presets[e]}static firstInGroup(e){return c.init(),c.grouping[e][0]}static groups(){c.init();const e=[];for(const t in c.grouping)e.push(t);return e}static names(e){c.init();const t=[];for(const s in c.grouping[e])t.push(c.grouping[e][s]);return t}}},2673:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(2381);class n{constructor(e,t,s){this.uniform={},this.attribute={},this.texture=new Map,this.program=e.createProgram(),e.attachShader(this.program,this.compile(e,t,e.VERTEX_SHADER)),e.attachShader(this.program,this.compile(e,s,e.FRAGMENT_SHADER)),e.linkProgram(this.program),e.useProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS)||console.log(e.getProgramInfoLog(this.program));const n=this.collect(t,"attribute");for(const[i,c]of n)this.attribute[i]=e.getAttribLocation(this.program,i);let a=[];const r=this.collect(t,"uniform");for(const[i,c]of r)this.uniform[i]=e.getUniformLocation(this.program,i);const o=this.collect(s,"uniform");for(const[i,c]of o)this.uniform[i]=e.getUniformLocation(this.program,i),"sampler2D"===c&&a.push(i);for(var h in a){let t=a[h],s=e.getUniformLocation(this.program,t);"texture"===t?(e.uniform1i(s,0),this.texture.set(0,new i.Z(t))):(e.uniform1i(s,1),this.texture.set(1,new i.Z(t)))}}collect(e,t){const s=[],i=new RegExp("\\b"+t+" (\\w+) (\\w+)","ig");return e.replace(i,(function(e,t,i){return s.push([i,t]),e})),s}compile(e,t,s){var i=e.createShader(s);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log(e.getShaderInfoLog(i)),console.log(t),null)}getTextureById(e){let t=null;return this.texture.forEach((function(s){s.id!==e||(t=s)})),t||(console.error("Having no texture that is named `%s`.",e),null)}destroy(e){e.deleteProgram(this.program),this.texture.forEach((function(t){t.destroy(e)})),this.texture.clear()}}},4256:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(2634),n=s(3673),a=s(2381),r=s(2673),o=s(3049),h=s(4084),c=s(9389),l=s(1662),d=s(134);class u{constructor(e){this.drawShader=0,this.sourceTexture=null,this.lastInChain=!1,this.currentFramebufferIndex=0,this.tempFramebuffers={},this.width=-1,this.height=-1,this.vertexBuffer=null,this.lastTextureSlot=-1,this.debug=!1,this.addPreset=(e,t=1)=>{const s=i.Z.named(e);s&&(1!==t?s.forEach((e=>{switch(e.name){case"curves":{const s=e.value,i=d.z.createCurveSet(s);i.percent=t,this.addShader(e.name,i);break}case"levels":{const s=e.value,i=new l.Z(Math.round(s.minin*t),Math.round(255-(255-s.maxin)*t));this.addShader(e.name,i);break}case"toning":{const s=e.value,i=new c.Z(s.highlight,s.shadow,s.amount*t);this.addShader(e.name,i);break}case"fill":{const s=e.value,i=new h.Z(s.color,s.blend,s.amount*t);this.addShader(e.name,i);break}default:this.addShader(e.name,e.value*t)}})):s.forEach((e=>this.addShader(e.name,e.value))))},this.cleanUp=()=>{this.sourceTexture=null,this.canvas=null,this.ctx=null},this.VERTEX_IDENTITY="\n        precision highp float;\n        attribute vec2 apos;\n        attribute vec2 auv;\n        varying vec2 uv;\n        uniform vec4 transform;\n\n        void main(void) {\n            uv = auv;\n            gl_Position = vec4(apos.x * transform.x + transform.z, apos.y * transform.y + transform.w, 0.0, 1.0);\n        }",this.FRAGMENT_IDENTITY="\n        precision highp float;\n        varying vec2 uv;\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }",this.GAUSSKERN_MAX=15,this.chain=e||[],this.compiledProgram=new Map,this.canvas=document.createElement("canvas"),this.canvas.id="shaders-temp",this.initContext(),this.canvas.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1)}initContext(){this.ctx=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1})}handleContextLost(){null==this.canvas&&(this.canvas=document.createElement("canvas")),this.initContext()}getError(){this.debug&&this.ctx.getError()}addShader(e,t,s=!1){if("fill"==e&&0==t.amount||"toning"==e&&0==t.amount||"levels"==e&&t.isFlat()||null==t||0===t)this.removeShader(e,s);else{for(var i=0;i<this.chain.length;i++)if(this.chain[i].type===e&&this.chain[i].sidekick===s)return void(this.chain[i].value=t);this.chain.push(new p(e,t,s))}}getShaderValue(e){for(var t=0;t<this.chain.length;t++)if(this.chain[t].type==e)return this.chain[t].value}removeShaderSidekick(){let e=new Array;for(var t=0;t<this.chain.length;t++)this.chain[t].sidekick||e.push(this.chain[t]);this.chain=e}removeShader(e,t=!1){for(var s=0;s<this.chain.length;s++)if(this.chain[s].type===e&&this.chain[s].sidekick===t)return void this.chain.splice(s,1)}runShader(e,t){switch(e){case"vibrance":return this.vibrance(t);case"saturation":return this.saturation(t);case"brightness":return this.brightness(t);case"lightness":return this.lightness(t);case"temperature":return this.temperature(t);case"balance":return this.balance(t);case"tint":return this.tint(t);case"hue":return this.hue(t);case"colorize":return this.colorize(t);case"grain":return this.grain(t);case"noise":return this.noise(t);case"vignette":return this.vignette(t);case"sharpen":return this.sharpen(t);case"blur":return this.blur(t);case"zoom":return this.zoom(t);case"bokeh":return this.bokeh(t);case"gaussian":return this.gaussian(t);case"motion":return this.motion(t);case"radial":return this.radial(t);case"smooth":return this.smooth(t);case"denoise":return this.denoise(t);case"contrast":return this.contrast(t);case"monochrome":return this.monochrome(t);case"desaturate":return this.desaturate();case"invert":return this.invert();case"exposure":return this.exposure(t);case"highlights":return this.highlights(t);case"shadows":return this.shadows(t);case"dehaze":return this.dehaze(t);case"curves":return this.curves(t);case"toning":return this.toning(t);case"lookup":return this.lookup(t);case"fill":return this.fill(t);case"bwpoint":return this.bwpoint(t);case"levels":return this.levels(t);case"multilevels":return this.multilevels(t);case"threshold":return this.threshold(t);case"bloom":return this.bloom(t);case"glamour":return this.glamour(t);case"mimichdr":return this.mimicHDR(t);case"posterize":return this.posterize(t);case"fringe":return this.fringe(t);case"pixelate":return this.pixelate(t);case"clarity":return this.clarity(t);case"mosaic":return this.mosaic(t);case"polarcoordinates":return this.polarcoordinates(t);case"kaleidoscope":return this.kaleidoscope(t);case"reflect":return this.reflect(t);case"wave":return this.wave(t);case"fisheye":return this.fisheye(t);case"scanlines":return this.scanlines(t);case"dealiasing":return this.dealiasing();case"alpha-invert":return this.alphaInvert();case"alpha-mask":return this.alphaMask();case"alpha-shift-mask":return this.alphaShiftMask();case"outer-glow":return this.outerGlow(t);case"inner-glow":return this.innerGlow(t);case"sobel":return this.sobel();case"solarize":return this.solarize();case"halftone":return this.halftone(t);case"stroke":return this.stroke(t);case"bevel":return this.bevel(t);case"border":return this.border(t);case"rgb-split":return this.rgbSplit(t);case"slice":return this.slice(t);case"bleed":return this.bleed(t);case"interference":return this.interference(t);case"melt":return this.melt(t);case"gooey":return this.gooey(t);case"block":return this.block(t);case"curtain":return this.curtain(t);case"blinds":return this.blinds(t);case"wipe":return this.wipe(t);case"slot":return this.slot(t);case"split":return this.split(t);case"circular":return this.circular(t);case"ripple":return this.ripple(t);case"warp":return this.warp(t);default:return console.error("We don't have this type shader, "+e)}}reset(){this.chain=[],this.compiledProgram.forEach((function(e){e.destroy(this.ctx)}),this),this.compiledProgram.clear(),this.sourceTexture&&(this.activeSourceTexture=void 0,this.sourceTexture.destroy(this.ctx),this.sourceTexture=null);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}}apply(e,t=!1){if(0==this.chain.length)return e;this.resize(e.width,e.height),this.drawShader=0,this.sourceTexture&&this.width==e.width&&this.height==e.height||(this.sourceTexture&&(this.sourceTexture.destroy(this.ctx),this.sourceTexture=null),this.sourceTexture=new a.Z("texture"),this.sourceTexture.createTexture(this.ctx,e.width,e.height)),(e!==this.activeSourceTexture||t)&&(this.sourceTexture.uploadData(this.ctx,e),this.activeSourceTexture=e);for(var s=0;s<this.chain.length;s++)this.lastInChain=s==this.chain.length-1,this.runShader(this.chain[s].type,this.chain[s].value);return this.currentFramebufferIndex=0,this.canvas}resize(e,t){if(e!=this.width||t!=this.height){if(this.canvas.width=this.width=e,this.canvas.height=this.height=t,!this.vertexBuffer){var s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]);this.vertexBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.vertexBuffer),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,s,this.ctx.STATIC_DRAW)}this.ctx.viewport(0,0,this.width,this.height);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}}}getTempFramebuffer(e){return this.tempFramebuffers[e]=this.tempFramebuffers[e]||this.createFramebufferTexture(this.width,this.height),this.tempFramebuffers[e]}createFramebufferTexture(e,t){let s=this.ctx.createFramebuffer();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,s);let i=this.ctx.createRenderbuffer();this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,i),this.ctx.renderbufferStorage(this.ctx.RENDERBUFFER,this.ctx.DEPTH_COMPONENT16,e,t);let n=this.ctx.createTexture();return this.ctx.bindTexture(this.ctx.TEXTURE_2D,n),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,e,t,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,null),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,n,0),this.ctx.framebufferRenderbuffer(this.ctx.FRAMEBUFFER,this.ctx.DEPTH_ATTACHMENT,this.ctx.RENDERBUFFER,i),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),new o.Z(s,i,n)}draw(e,t=!1){if((this.chain.length<=1||this.lastInChain)&&!t)this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null);else{let e=this.getTempFramebuffer(this.currentFramebufferIndex);this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,e.framebuffer)}this.ctx.uniform4f(e.uniform.transform,1,1,0,0),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT),this.ctx.clearColor(0,0,0,0),this.setTexture(e.texture),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.drawShader++,this.currentFramebufferIndex^=1,this.getError()}setTexture(e){let t=-1;e.forEach((function(e,s){if(this.ctx.activeTexture(this.ctx.TEXTURE0+s),0===s&&0===this.drawShader)this.ctx.bindTexture(this.ctx.TEXTURE_2D,this.sourceTexture.texture);else if(0===s){let e=1^this.currentFramebufferIndex,t=this.getTempFramebuffer(e);this.ctx.bindTexture(this.ctx.TEXTURE_2D,t.texture)}else this.ctx.bindTexture(this.ctx.TEXTURE_2D,e.texture);t=Math.max(t,s)}),this);for(let s=t+1;s<=this.lastTextureSlot;++s)this.ctx.activeTexture(this.ctx.TEXTURE0+s),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null);this.lastTextureSlot=t}compileShader(e,t=this.VERTEX_IDENTITY){let s=new r.Z(this.ctx,t,e);var i=Float32Array.BYTES_PER_ELEMENT;return this.ctx.enableVertexAttribArray(s.attribute.apos),this.ctx.vertexAttribPointer(s.attribute.apos,2,this.ctx.FLOAT,!1,4*i,0*i),this.ctx.enableVertexAttribArray(s.attribute.auv),this.ctx.vertexAttribPointer(s.attribute.auv,2,this.ctx.FLOAT,!1,4*i,2*i),s}bevel(e){let t=this.compiledProgram.get("bevel");if(!t){let e="\n                precision highp float;\n\n                varying vec2 uv;\n                \n                uniform float zeroPoint;\n                uniform vec3 lightNormal;\n                uniform float dz;\n                uniform float size;\n\n                uniform vec4 lowColor;\n                uniform vec4 highColor;\n                \n                uniform sampler2D dist;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main() {                    \n                    vec2 flipuv = vec2(uv.x, 1.0 - uv.y);\n                                         \n                    /* PER PIXEL OPS */\n                    float tl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x, -px.y)).a);\n                    float tm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0, -px.y)).a);\n                    float tr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x, -px.y)).a);\n                \n                    float ml = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,     0)).a);\n                    float mr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,     0)).a);\n                \n                    float bl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,  px.y)).a);\n                    float bm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0,  px.y)).a);\n                    float br = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,  px.y)).a);\n                \n                    float dx = (tr + 2.0 * mr + br) - (tl + 2.0 * ml + bl);\n                    float dy = (bl + 2.0 * bm + br) - (tl + 2.0 * tm + tr);\n                \n                    vec3 surfaceNormal = vec3(dx, dy, dz);\n                    float norm = sqrt(dx*dx + dy*dy + dz*dz);\n                \n                    // Calculate incident light amount, range [-1, 0]\n                    float incidentLight = ((dot(surfaceNormal, lightNormal) / norm) - zeroPoint) - (1.0 - zeroPoint);\n                    \n                    vec4 slopes = mix(lowColor, highColor, 1.0 - abs(incidentLight));\n                    \n                    // Texture\n                    vec4 color = texture2D(texture, uv);\n\n                    // Bevel color, only use the the color where we need it\n                    float alpha = smoothstep(1e-5, dz + 8.0, distance(vec3(0.0,0.0,dz), surfaceNormal));\n                    vec4 bevelColor = vec4(slopes.rgb, slopes.a * alpha);\n\n                    gl_FragColor = straightBlend(\n                        bevelColor,\n                        color\n                    );\n                }";t=this.compileShader(e),this.compiledProgram.set("bevel",t)}this.ctx.useProgram(t.program);t.getTextureById("dist").setTexture(e.distanceMap);const s=Math.sin(e.lightElevation);this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.zeroPoint,s),this.ctx.uniform3f(t.uniform.lightNormal,Math.cos(e.lightElevation)*-Math.cos(e.lightAngle),Math.cos(e.lightElevation)*-Math.sin(e.lightAngle),s),this.ctx.uniform4f(t.uniform.lowColor,e.lowLightColor.r/255,e.lowLightColor.g/255,e.lowLightColor.b/255,e.lowOpacity),this.ctx.uniform4f(t.uniform.highColor,e.highLightColor.r/255,e.highLightColor.g/255,e.highLightColor.b/255,e.highOpacity),this.ctx.uniform1f(t.uniform.dz,1/e.depth),this.ctx.uniform1f(t.uniform.size,e.size),this.draw(t)}stroke(e){const t="stroke"+(e.cutout?"-cutout":"");let s=this.compiledProgram.get(t);if(!s){let i=`\n                precision highp float;\n\n                #define CUTOUT ${e.cutout?1:0}\n\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size - 3.0, size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    #if CUTOUT == 1\n                        vec4 tran = vec4(0);\n                        gl_FragColor = mix(gColor, tran, texColor.a);\n                    #else\n                        gl_FragColor = straightBlend(texColor, gColor);                    \n                    #endif\n                }\n            `;s=this.compileShader(i),this.compiledProgram.set(t,s)}this.ctx.useProgram(s.program),this.ctx.uniform4f(s.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);s.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(s.uniform.size,e.size),this.draw(s)}innerGlow(e){let t=this.compiledProgram.get("innerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float balance = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        texColor.a\n                    );\n                       \n                    gl_FragColor = mix(texColor, gColor, balance * glowColor.a);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("innerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}outerGlow(e){let t=this.compiledProgram.get("outerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n                    \n                    gl_FragColor = straightBlend(texColor, gColor);                    \n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("outerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}sobel(){let e=this.compiledProgram.get("sobel");if(!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                uniform float m[3];\n                #define M_PI 3.1415926535897932384626433832795\n                #define GET_PIXEL(x,y) (texture2D(texture, uv + px*vec2(x,y)))\n\n                void main() {\n\n                    float dx = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(-1,  0)*m[1] +\n                                GET_PIXEL(-1, +1)*m[2]) -\n                            length(GET_PIXEL(+1, -1)*m[0] +\n                                GET_PIXEL(+1,  0)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float dy = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(0, -1)*m[1] +\n                                GET_PIXEL(+1, -1)*m[2]) -\n                            length(GET_PIXEL(-1, +1)*m[0] +\n                                GET_PIXEL(0, +1)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n\n                    gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobel",e)}if(this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1fv(e.uniform.m,[1,2,1]),this.draw(e,!0),e=this.compiledProgram.get("sobelNMS"),!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                #define M_PI 3.1415926535897932384626433832795\n\n                void main() {\n                    vec4 cc = texture2D(texture, uv);  \n                    float theta = degrees(cc.y*M_PI*2.0); \n                    int ax = 0, ay = 0; \n                    if ((theta >= 337.5) || (theta < 22.5)) { ax = 1; ay = 0; } \n                    else if ((theta >= 22.5) && (theta < 67.5)) { ax = 1; ay = 1; } \n                    else if ((theta >= 67.5) && (theta < 112.5)) { ax = 0; ay = 1; } \n                    else if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; } \n                    else if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; } \n                    else if ((theta >=202.5) && (theta < 247.5)) { ax =-1; ay =-1; } \n                    else if ((theta >=247.5) && (theta < 292.5)) { ax = 0; ay =-1; } \n                    else if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n                \n                    vec4 ca = texture2D(texture, uv + px*vec2(ax, ay));\n                    vec4 cb = texture2D(texture, uv + px*vec2(-ax, -ay));\n                    gl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobelNMS",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}vibrance(e){let t=this.compiledProgram.get("vibrance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv.xy);\n                    vec3 color = col.rgb;\n                \n                    float luminance = color.r*0.299 + color.g*0.587 + color.b*0.114;\n                    float mn = min(min(color.r, color.g), color.b);\n                    float mx = max(max(color.r, color.g), color.b);\n                    float sat = (1.0-(mx - mn)) * (1.0-mx) * luminance * 5.0;\n                    vec3 lightness = vec3((mn + mx)/2.0);\n                \n                    // vibrance\n                    color = mix(color, mix(color, lightness, -amount), sat);\n                \n                    // negative vibrance\n                    gl_FragColor = vec4(mix(color, lightness, (1.0-lightness)*(1.0-amount)/2.0*abs(amount)), col.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("vibrance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}lightness(e){let t=this.compiledProgram.get("lightness");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.rgb += amount;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("lightness",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}brightness(e){let t;if(e>0){if(t=this.compiledProgram.get("brightness-up"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    #define PI 3.1415926535897932384626433832795\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n\n                        color.r = color.r + amount * sin(color.r * PI);\n                        color.g = color.g + amount * sin(color.g * PI);\n                        color.b = color.b + amount * sin(color.b * PI);\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-up",t)}}else if(t=this.compiledProgram.get("brightness-down"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n     \n                        color.r = (1.0 + amount) * color.r;\n                        color.g = (1.0 + amount) * color.g;\n                        color.b = (1.0 + amount) * color.b;\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-down",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e>0?.35*e:.75*e),this.draw(t)}bwpoint(e){let t=this.compiledProgram.get("bwpoint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float white;\n                uniform float black;\n\n                void main() {\n\n                    float bval = black / 255.0;\n                    float wval = (255.0 / (white - black));\n                \n                    vec3 color = texture2D(texture, uv).rgb;\n                    color = color * wval - (bval *  wval);\n\n                    gl_FragColor = vec4(color, texture2D(texture, uv).a);\n                }";t=this.compileShader(e),this.compiledProgram.set("bwpoint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.black,e.black),this.ctx.uniform1f(t.uniform.white,e.white),this.draw(t)}dealiasing(){let e=this.compiledProgram.get("dealiasing");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = (color.a < 0.25) ? 0.0 : 1.0;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("dealiasing",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaInvert(){let e=this.compiledProgram.get("alpha-invert");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = 1.0 - color.a;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-invert",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaMask(){let e=this.compiledProgram.get("alpha-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).a);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaShiftMask(){let e=this.compiledProgram.get("alpha-shift-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).r);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-shift-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}border(e){let t=this.compiledProgram.get("border");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float size;\n                uniform vec4 color;\n                uniform vec2 screen;\n                uniform vec2 px;\n\n                void main() {\n                    vec4 pixel = texture2D(texture, uv);\n\n                    if(uv.y <= size*px.y || uv.y >= (screen.y-size)*px.y ||\n                       uv.x <= size*px.x || uv.x >= (screen.x-size)*px.x) {\n                        gl_FragColor = color;\n                    } else {\n                        gl_FragColor = pixel;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("border",t)}let s=Math.round((this.width+this.height)/2*e.size);this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,s),this.ctx.uniform2f(t.uniform.screen,this.width,this.height),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.draw(t)}balance(e){let t=this.compiledProgram.get("balance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float sr;\n                uniform float sg;\n                uniform float sb;\n                uniform float mr;\n                uniform float mg;\n                uniform float mb;\n                uniform float hr;\n                uniform float hg;\n                uniform float hb;\n                uniform float preserve;\n\n                #define PI 3.1415926535897932384626433832795\n\n                float Lum(vec4 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    \n                    float olum = Lum(color);\n\n                    //highlight\n                    color.r = clamp(color.r + (hr * (exp(color.r) - 1.0)), 0.0, 1.0);\n                    color.g = clamp(color.g + (hg * (exp(color.g) - 1.0)), 0.0, 1.0);\n                    color.b = clamp(color.b + (hb * (exp(color.b) - 1.0)), 0.0, 1.0);\n\n                    //midtone\n                    color.r = clamp(color.r + (mr * 0.25) * sin(color.r * PI), 0.0, 1.0);\n                    color.g = clamp(color.g + (mg * 0.25) * sin(color.g * PI), 0.0, 1.0);\n                    color.b = clamp(color.b + (mb * 0.25) * sin(color.b * PI), 0.0, 1.0);\n\n                    //shadow\n                    color.r = clamp((1.0 - sr * 0.5) * color.r + (1.0 - (1.0 - sr * 0.5)), 0.0, 1.0);\n                    color.g = clamp((1.0 - sg * 0.5) * color.g + (1.0 - (1.0 - sg * 0.5)), 0.0, 1.0);\n                    color.b = clamp((1.0 - sb * 0.5) * color.b + (1.0 - (1.0 - sb * 0.5)), 0.0, 1.0);\n                    \n                    if(preserve == 1.0) {\n                        float nlum = Lum(color);\n                        color.rgb = color.rgb * (olum/nlum);\n                    }\n\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("balance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sr,e.shadowRed),this.ctx.uniform1f(t.uniform.sg,e.shadowGreen),this.ctx.uniform1f(t.uniform.sb,e.shadowBlue),this.ctx.uniform1f(t.uniform.mr,e.midtoneRed),this.ctx.uniform1f(t.uniform.mg,e.midtoneGreen),this.ctx.uniform1f(t.uniform.mb,e.midtoneBlue),this.ctx.uniform1f(t.uniform.hr,e.highlightRed),this.ctx.uniform1f(t.uniform.hg,e.highlightGreen),this.ctx.uniform1f(t.uniform.hb,e.highlightBlue),this.ctx.uniform1f(t.uniform.preserve,Number(e.preserve)),this.draw(t)}temperature(e){let t=this.compiledProgram.get("temperature");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.r = clamp(color.r + amount, 0.0, 1.0);\n                    color.b = clamp(color.b - amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("temperature",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}tint(e){let t=this.compiledProgram.get("tint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.g = clamp(color.g + amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("tint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}threshold(e){let t=this.compiledProgram.get("threshold");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float value = (color.r + color.g + color.b) / 3.0 < amount ? 0.0 : 1.0;\n                    gl_FragColor = vec4(value, value, value, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("threshold",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}noise(e){let t=this.compiledProgram.get("noise");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float random(vec2 p) {\n                    vec2 r = vec2(23.14069263277926,2.665144142690225);\n                    return fract(cos(mod(12345678.,256. * dot(p,r))));\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float noise = (random(uv) -0.5)*amount;\n\n                    gl_FragColor = vec4(color.r+noise, color.g+noise, color.b+noise, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("noise",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}halftone(e){let t=this.compiledProgram.get("halftone");if(!t){this.ctx.getExtension("OES_standard_derivatives");let e="\n                #ifdef GL_OES_standard_derivatives\n                #extension GL_OES_standard_derivatives : enable\n                #endif\n\n                precision highp float;                \n\n                uniform sampler2D texture;\n                uniform vec2 size;\n                uniform float frequency;\n  \n                varying vec2 uv; // Texcoords\n\n                float aastep(float threshold, float value) {\n                #ifdef GL_OES_standard_derivatives\n                    float afwidth = 0.7 * length(vec2(dFdx(value), dFdy(value)));\n                #else\n                    float afwidth = frequency * (1.0/size.x);\n                #endif\n                    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n                }\n\n                // Explicit bilinear texture lookup to circumvent bad hardware precision.\n                // The extra arguments specify the dimension of the texture. (GLSL 1.30\n                // introduced textureSize() to get that information from the sampler.)\n                // 'dims' is the width and height of the texture, 'one' is 1.0/dims.\n                // (Precomputing 'one' saves two divisions for each lookup.)\n                vec4 texture2D_bilinear(sampler2D tex, vec2 st, vec2 dims, vec2 one) {\n                    vec2 uv = st * dims;\n                    vec2 uv00 = floor(uv - vec2(0.5)); // Lower left corner of lower left texel\n                    vec2 uvlerp = uv - uv00 - vec2(0.5); // Texel-local lerp blends [0,1]\n                    vec2 st00 = (uv00 + vec2(0.5)) * one;\n                    vec4 texel00 = texture2D(tex, st00);\n                    vec4 texel10 = texture2D(tex, st00 + vec2(one.x, 0.0));\n                    vec4 texel01 = texture2D(tex, st00 + vec2(0.0, one.y));\n                    vec4 texel11 = texture2D(tex, st00 + one);\n                    vec4 texel0 = mix(texel00, texel01, uvlerp.y); \n                    vec4 texel1 = mix(texel10, texel11, uvlerp.y); \n                    return mix(texel0, texel1, uvlerp.x);\n                }\n\n                vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 permute(vec3 x) { return mod289((( x * 34.0) + 1.0) * x); }\n                \n                float snoise(vec2 v) {\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                    // First corner\n                    vec2 i = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v - i + dot(i, C.xx);\n                    // Other corners\n                    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                    // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                                            + i.x + vec3(0.0, i1.x, 1.0 ));\n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),\n                                            dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m; m = m*m;\n                    // Gradients\n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 a0 = x - floor(x + 0.5);\n                    // Normalise gradients implicitly by scaling m\n                    m *= 1.792843 - 0.853735 * ( a0*a0 + h*h );\n                    // Compute final noise value at P\n                    vec3 g;\n                    g.x = a0.x * x0.x + h.x * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n                \n                void main() {\n                    // Correct UVs for aspect ratio so we get round balls not squished\n                    vec2 auv = uv;\n                    auv.x *= size.x / size.y;\n\n                    vec3 color = texture2D_bilinear(texture, uv, size, 1.0 / size).rgb;\n\n                    float n = 0.1*snoise(auv*200.0); // Fractal noise\n                    n += 0.05*snoise(auv*400.0);\n                    n += 0.025*snoise(auv*800.0);\n\n                    vec3 white = vec3(n*0.2 + 0.97);\n                    vec3 black = vec3(n + 0.1);\n\n                    // Perform a rough RGB-to-CMYK conversion\n                    vec4 cmyk;\n                    cmyk.xyz = 1.0 - color;\n                    cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); // Create K\n                    cmyk.xyz -= cmyk.w; // Subtract K equivalent from CMY\n                \n                    // Distance to nearest point in a grid of\n                    // (frequency x frequency) points over the unit square\n                    vec2 Kst = frequency*mat2(0.707, -0.707, 0.707, 0.707)*auv;\n                    vec2 Kuv = 2.0*fract(Kst)-1.0;\n                    float k = aastep(0.0, sqrt(cmyk.w)-length(Kuv)+n);\n                    vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966)*auv;\n                    vec2 Cuv = 2.0*fract(Cst)-1.0;\n                    float c = aastep(0.0, sqrt(cmyk.x)-length(Cuv)+n);\n                    vec2 Mst = frequency*mat2(0.966, 0.259, -0.259, 0.966)*auv;\n                    vec2 Muv = 2.0*fract(Mst)-1.0;\n                    float m = aastep(0.0, sqrt(cmyk.y)-length(Muv)+n);\n                    vec2 Yst = frequency*auv; // 0 deg\n                    vec2 Yuv = 2.0*fract(Yst)-1.0;\n                    float y = aastep(0.0, sqrt(cmyk.z)-length(Yuv)+n);\n                \n                    vec3 rgbscreen = 1.0 - 0.9*vec3(c,m,y) + n;\n                    rgbscreen = mix(rgbscreen, black, 0.85*k + 0.3*n);\n                \n                    #ifdef GL_OES_standard_derivatives\n                        float afwidth = 2.0 * frequency * max(length(dFdx(uv)), length(dFdy(uv)));\n                    #else\n                        float afwidth = frequency * (1.0/size.x);\n                    #endif\n                    \n                    float blend = smoothstep(0.7, 1.4, afwidth); \n                    gl_FragColor = vec4(mix(rgbscreen, color, blend), 1.0);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("halftone",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.frequency,Math.round(100*e)),this.draw(t)}vignette(e){let t=this.compiledProgram.get(e<0?"vignette-white":"vignette-black");if(!t){let s=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","float grd = smoothstep(0.8, size * 0.799, dist * (amount*0.6 + size*2.0));","color.rgb += vec3(1.0, 1.0, 1.0) * (1.0 - grd);","gl_FragColor = color;","}"].join("\n"),i=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount*0.75 + size*2.0));","gl_FragColor = color;","}"].join("\n");t=this.compileShader(e<0?s:i),this.compiledProgram.set(e<0?"vignette-white":"vignette-black",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,.25),this.ctx.uniform1f(t.uniform.amount,e<0?-1*e:e),this.draw(t)}grain(e){let t=this.compiledProgram.get("grain");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","uniform float width;","uniform float height;","uniform float grainamount;","uniform float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","float grainsize = 1.8;","float lumamount = 1.0;","vec4 rnm(in vec2 tc)","{","float noise =  sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","float noiseR =  fract(noise)*2.0-1.0;","float noiseG =  fract(noise*1.2154)*2.0-1.0; ","float noiseB =  fract(noise*1.3453)*2.0-1.0;","float noiseA =  fract(noise*1.3647)*2.0-1.0;","return vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p)","{","vec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","vec3 pf = fract(p);","float perm00 = rnm(pi.xy).a ;","vec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","float n000 = dot(grad000, pf);","vec3  grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","float perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","vec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","float n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","vec3  grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","float perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","vec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","float n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","vec3  grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","float perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","vec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","float n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","vec3  grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","vec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","vec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","float n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","return n_xyz;","}","vec2 coordRot(in vec2 tc, in float angle)","{","float aspect = width/height;","float rotX = ((tc.x*2.0-1.0)*aspect*cos(angle)) - ((tc.y*2.0-1.0)*sin(angle));","float rotY = ((tc.y*2.0-1.0)*cos(angle)) + ((tc.x*2.0-1.0)*aspect*sin(angle));","rotX = ((rotX/aspect)*0.5+0.5);","rotY = rotY*0.5+0.5;","return vec2(rotX,rotY);","}","void main() ","{","vec3 rotOffset = vec3(1.425,3.892,5.835);","vec2 rotCoordsR = coordRot(uv, timer + rotOffset.x);","vec3 noise = vec3(pnoise3D(vec3(rotCoordsR*vec2(width/grainsize,height/grainsize),0.0)));","vec4 tex = texture2D(texture, uv);","vec3 col = tex.rgb;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float luminance = mix(0.0,dot(col, lumcoeff),lumamount);","float lum = smoothstep(0.2,0.0,luminance);","lum += luminance;","noise = mix(noise,vec3(0.0),pow(lum,4.0));","col = col+noise*grainamount;","gl_FragColor =  vec4(col, tex.w);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("grain",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.width,this.width),this.ctx.uniform1f(t.uniform.height,this.height),this.ctx.uniform1f(t.uniform.grainamount,e/10),this.draw(t)}sharpen(e){let t=this.compiledProgram.get("sharpen");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px); // top left\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y)); // top center\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y)); // top right\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) ); // mid left\n                    vec4 c22 = texture2D(texture, uv); // mid center\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) ); // mid right\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) ); // bottom left\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) ); // bottom center\n                    vec4 c33 = texture2D(texture, uv + px ); // bottom right\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("sharpen",t)}let s=new Float32Array([-1,-1,-1,-1,9,-1,-1,-1,-1]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,s),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e/2),this.draw(t)}blur(e,t=!1){let s=this.compiledProgram.get("blur");if(!s){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 size;\n                float random(vec3 scale, float seed) {\n                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    for (float t = -30.0; t <= 30.0; t++) {\n                        float percent = (t + offset - 0.5) / 30.0;\n                        float weight = 1.0 - abs(percent);\n                        vec4 sample = texture2D(texture, uv + size * percent);\n                        sample.rgb *= sample.a;\n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";s=this.compileShader(e),this.compiledProgram.set("blur",s)}let i=40*e/this.canvas.width,n=40*e/this.canvas.height;this.ctx.useProgram(s.program),this.ctx.uniform2f(s.uniform.size,0,n),this.draw(s,!0),this.ctx.uniform2f(s.uniform.size,i,0),this.draw(s,t)}zoom(e){let t=this.compiledProgram.get("zoom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform vec2 center;\n                uniform float amount;\n                uniform vec2 px;\n                \n                float random(vec3 scale, float seed) {\n                    /* use the fragment position for a different seed per-pixel */                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    vec2 toCenter = (center - uv) * px;\n                    \n                    /* randomize the lookup values to hide the fixed number of samples */\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    \n                    for (float t = 0.0; t <= 40.0; t++) {\n                        float percent = (t + offset) / 40.0;\n                        float weight = 4.0 * (percent - percent * percent);\n                        vec4 sample = texture2D(texture, uv + toCenter * percent * amount / px);\n                        \n                        /* switch to pre-multiplied alpha to correctly blur transparent images */\n                        sample.rgb *= sample.a;\n                        \n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";t=this.compileShader(e),this.compiledProgram.set("zoom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}makeKernel(e){const t=this.GAUSSKERN_MAX+Number(!(1&this.GAUSSKERN_MAX)),s=Math.sqrt(2*Math.PI)*e,i=2*e*e;var n,a,r=~~(t/2),o=new Float32Array(t);for(a=0,n=-r;a<t;n++,a++)o[a]=Math.exp(-n*n/i)/s;return o}scaleKernel(e){const t=e.reduce(((e,t)=>e+t))||1;return e.map((e=>e/t))}gaussian(e){const t=this.makeKernel(10*e),s=t.length+Number(!(1&t.length));let i=this.compiledProgram.get(`guass-${s}`);if(!i){let e=`\n                precision mediump float;\n                #define KERNEL_SIZE ${s}\n                #define KERNEL_HALF KERNEL_SIZE / 2\n                // our texture\n                varying vec2 uv;\n                uniform vec2 px;\n                uniform sampler2D texture;\n                uniform float kernel[KERNEL_SIZE];\n                void main() {\n                    vec4 result = vec4(0.0);\n                    for (int i = 0; i < KERNEL_SIZE; i++) {\n                        result += texture2D(texture, uv + px*vec2(i - KERNEL_HALF))*kernel[i];\n                    }\n                    gl_FragColor = result;\n                }\n            `;i=this.compileShader(e),this.compiledProgram.set(`guass-${s}`,i)}this.ctx.useProgram(i.program),this.ctx.uniform2f(i.uniform.px,0,1/this.height),this.ctx.uniform1fv(i.uniform.kernel,this.scaleKernel(t)),this.draw(i,!0),this.ctx.uniform2f(i.uniform.px,1/this.width,0),this.draw(i)}radial(e){let t=this.compiledProgram.get("radial");if(!t){let e="\n                precision highp float;\n                const float PI = 3.1415926535897932384626433832795;\n                const float samples = 100.;\n\n                uniform sampler2D texture;\n\n                varying vec2 uv;\n                uniform vec2 center;\n                uniform vec2 resolution;\n\n                uniform float amount;\n                uniform int direction;\n                uniform int symmetry;\n               \n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 rotateUV(vec2 uv, mat2 transform, vec2 centerc) {\n                    uv -= centerc;\n                    uv = transform * uv;\n                    uv += centerc;\n                    return uv;\n                }\n             \n                void main(void) {\n                    float ar = resolution.x / resolution.y;\n                    vec2 uvc = uv;\n                    vec2 centerc = center;\n\n                    if (symmetry == 1)\n                    {\n                        if (resolution.x > resolution.y) {\n                            centerc.y /= ar;\n                            uvc.y /= ar;\n                        }\n                        else {\n                            centerc.x *= ar;\n                            uvc.x *= ar;\n                        }\n                    }\n\n                    vec2 coordcw = uvc;\n                    vec2 coordccw = uvc;\n                    vec4 FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    vec2 toCenter = uvc - centerc;\n                    float endsamples = 0.;\n\n                    float a = amount / samples;\n\n                    mat2 matcw = rotate2d(-a * PI / 180.);\n                    mat2 matccw = rotate2d(a * PI / 180.);\n\n                    for (float i = 0.; i < samples; i+=1.) {\n                        if (direction == 1 || direction == 2) {\n                            coordccw = rotateUV(coordccw, matccw, centerc);\n                            FragColor += texture2D(texture, coordccw);\n                            endsamples += 1.;\n                        }\n\n                        if (direction == 0 || direction == 2) {\n                            coordcw = rotateUV(coordcw, matcw, centerc);\n                            FragColor += texture2D(texture, coordcw);\n                            endsamples += 1.;\n                        }\n                    }\n                    FragColor /= endsamples;\n                    gl_FragColor = FragColor;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("radial",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,180*e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.direction,e.direction),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.draw(t)}motion(e){let t=this.compiledProgram.get("motion");if(!t){let e="\n                precision mediump float;\n                uniform float KERNEL_SIZE;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float angle;\n\n                bool outOfRange(vec2 uv) {\n                    return uv.x < 0. || uv. y < 0. || uv.x > 1. || uv.y > 1.;\n                }\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n                void main() {\n                    vec4 result = vec4(0.0);\n                    vec2 resol = vec2 (1./resolution.x, 0.);//1./resolution.y);\n                    resol = rotate2d(angle) * resol;\n                    float divcnt = 1.;\n                    for (float i=1.; i <= 100.; i+=1.) {\n                        vec2 before = uv - resol * i;\n                        if (!outOfRange(before)) {\n                            result += texture2D(texture, before);\n                            divcnt += 1.;\n                        }\n                        vec2 after = uv + resol * i;\n                        if (!outOfRange(after)) {\n                            result += texture2D(texture, after);\n                            divcnt += 1.;\n                        }\n                        if (i >= KERNEL_SIZE) break;\n                    }\n                    result += texture2D(texture, uv);\n                    result /= divcnt;\n                    gl_FragColor = result;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("motion",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.KERNEL_SIZE,100*e.amount),this.ctx.uniform1f(t.uniform.angle,e.angle),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}clarity(e){let t=this.compiledProgram.get("clarity");if(!t){const e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                           \n                float Lum(vec3 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n                float BlendOverlayf(float base, float blend){\n                    return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n                }\n                vec3 BlendOverlay(vec3 base, vec3 blend){\n                    return vec3(BlendOverlayf(base.r, blend.r), BlendOverlayf(base.g, blend.g), BlendOverlayf(base.b, blend.b));\n                }\n                float BlendVividLightf(float base, float blend){\n                    float BlendColorBurnf = (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n                    float BlendColorDodgef =  (((2.0 * (blend - 0.5)) == 1.0) ? (2.0 * (blend - 0.5)) : min(base / (1.0 - (2.0 * (blend - 0.5))), 1.0));\n                    return ((blend < 0.5) ? BlendColorBurnf : BlendColorDodgef);\n                }\n                vec3 BlendVividLight(vec3 base, vec3 blend){\n                    return vec3(BlendVividLightf(base.r, blend.r), BlendVividLightf(base.g, blend.g), BlendVividLightf(base.b, blend.b));\n                }\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n    \n                void main() {\n\n                    vec4 base4 = texture2D(texture, uv.xy);\n                    \n                    vec3 blurMap = blurMap();\n                    vec3 base = base4.rgb;\n                    \n                    float intensity = (amount < 0.0) ? (amount / 2.0) : amount;\n                    float lum = Lum(base);\n                  \n                    vec3 col = vec3(lum);\n                    vec3 mask = vec3(1.0 - pow(lum, 1.8));\n                    // invert blurred texture\n                    vec3 layer = vec3(1.0 - Lum(blurMap));\n                    vec3 detail = clamp(BlendVividLight(col, layer), 0.0, 1.0);\n                    // we get negative detail by inverting the detail layer\n                    vec3 inverse = mix(1.0 - detail, detail, (intensity+1.0)/2.0);\n                  \n                    gl_FragColor = vec4(BlendOverlay(base, mix(vec3(0.5), inverse, mask)), base4.a);       \n                }";t=this.compileShader(e),this.compiledProgram.set("clarity",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,2*e),this.draw(t)}smooth(e){let t=this.compiledProgram.get("smooth");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px);\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y));\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y));\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) );\n                    vec4 c22 = texture2D(texture, uv);\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) );\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) );\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) );\n                    vec4 c33 = texture2D(texture, uv + px );\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("smooth",t)}let s=new Float32Array([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,s),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}denoise(e){const t=Math.round(30*e[0]);let s=this.compiledProgram.get("denoise"+t);if(!s){let e="\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                \n                uniform float sigma;\n                uniform float threshold;\n                uniform vec2 resolution;\n\n                #define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n                #define INV_PI 0.31830988618379067153776752674503\n                #define RADIUS %radius%.0\n              \n                void main(void) {\n\n                       float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n                       float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n                       \n                       float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n                       float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n                       \n                       vec4 center = texture2D(texture,uv); \n                       \n                       float zBuff = 0.0;\n                       vec4 aBuff = vec4(0.0);\n                       \n                       for(float x=-RADIUS; x <= RADIUS; x++) {\n                           float pt = sqrt(RADIUS*RADIUS-x*x);  // pt = yRadius: have circular trend\n                           for(float y=-RADIUS; y <= RADIUS; y++) {\n   \n                               if(y >= pt || y <= pt) {\n   \n                                   vec2 d = vec2(x,y)/resolution;\n                       \n                                   float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2;\n                                   \n                                   vec4 pxx =  texture2D(texture,uv+d);\n                       \n                                   vec4 dC = pxx-center;\n                                   float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n                                                       \n                                   zBuff += deltaFactor;\n                                   aBuff += deltaFactor*pxx;\n                               }\n                           }\n                       }\n                       gl_FragColor = aBuff/zBuff;\n                } ";s=this.compileShader(e.replace(/%radius%/g,t.toString())),this.compiledProgram.set("denoise"+t,s)}this.ctx.useProgram(s.program),this.ctx.uniform1f(s.uniform.sigma,t/3),this.ctx.uniform1f(s.uniform.threshold,e[1]),this.ctx.uniform2f(s.uniform.resolution,this.width,this.height),this.draw(s)}colorMatrix(e){let t=new Float32Array(e);t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255;let s=1==t[18]&&0==t[3]&&0==t[8]&&0==t[13]&&0==t[15]&&0==t[16]&&0==t[17]&&0==t[19],i="colorMatrix"+(s?"0":"1"),n=this.compiledProgram.get(i);if(!n){let e=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float m[20];","void main(void) {","vec4 c = texture2D(texture, uv);","gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];","gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];","gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];","gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];","}"].join("\n"),t=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float m[20];","void main(void) {","vec4 c = texture2D(texture, uv);","gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[4];","gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[9];","gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[14];","gl_FragColor.a = c.a;","}"].join("\n"),a=s?t:e;n=this.compileShader(a),this.compiledProgram.set(i,n)}this.ctx.useProgram(n.program),this.ctx.uniform1fv(n.uniform.m,t),this.draw(n)}saturation(e){var t=2*Number(e)/3+1,s=-.5*(t-1);this.colorMatrix([t,s,s,0,0,s,t,s,0,0,s,s,t,0,0,0,0,0,1,0])}desaturate(){this.saturation(-1)}invert(){this.colorMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0])}contrast(e){var t=Number(e)+1,s=-128*(t-1);this.colorMatrix([t,0,0,0,s,0,t,0,0,s,0,0,t,0,s,0,0,0,1,0])}hue(e){e=e/180*Math.PI;var t=Math.cos(e),s=Math.sin(e),i=.213,n=.715,a=.072;this.colorMatrix([i+.787*t+s*-i,n+t*-n+s*-n,a+t*-a+.928*s,0,0,i+t*-i+.143*s,n+t*(1-n)+.14*s,a+t*-a+-.283*s,0,0,i+t*-i+-.787*s,n+t*-n+s*n,a+.928*t+s*a,0,0,0,0,0,1,0])}colorize(e){const t=.3086,s=.6094,i=.082;var n,a,r,o=(e-=1)/60,h=Math.round(o),c=o-h,l=1*(1-1*c),d=1*(1-1*(1-c));switch(h){case 0:case 6:n=1,a=d,r=0;break;case 1:n=l,a=1,r=0;break;case 2:n=0,a=1,r=d;break;case 3:n=0,a=l,r=1;break;case 4:n=d,a=0,r=1;break;case 5:n=1,a=0,r=l}this.colorMatrix([n*t,n*s,n*i,0,0,a*t,a*s,a*i,0,0,r*t,r*s,r*i,0,0,0,0,0,1,0])}exposure(e){let t=this.compiledProgram.get("exposure");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float ramp(in float t){","t *= 2.0;","if (t >= 1.0) {","t -= 1.0;","t = log(0.5) / log(0.5*(1.0-t) + 0.9332*t);","}","return clamp(t, 0.001, 10.0);","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","vec3 base = col.rgb * matRGBtoROMM;","float a = abs(amount) * col.a + epsilon;","float v = pow(2.0, a*2.0+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (amount > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = pow(res, vec3(ramp(1.0 - (0.0 * col.a + 1.0) / 2.0)));","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("exposure",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}highlights(e){let t=this.compiledProgram.get("highlights");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(amount, 0.0, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("highlights",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}shadows(e){let t=this.compiledProgram.get("shadows");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(0.0, amount, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("shadows",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}dehaze(e){let t=this.compiledProgram.get("dehaze");if(!t){let e="\n\n                #define GLSLIFY 1;\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float amount;  // -1.0 ~ 1.0\n\n                uniform vec2 size;\n\n                float hazeMap(vec4 base) {\n                    vec3 color = vec3(1.0, 1.0, 1.0);\n                    vec2 step = vec2(1.0 / size.xy);\n                    const int patchRadius = 1; // the half size for shift in 3 x 3 patch.\n                    for (int i = -patchRadius; i <= patchRadius; ++i) {\n                       for (int j = -patchRadius; j <= patchRadius; ++j) {\n                           vec2 uv = clamp(uv + (vec2(i, j) * step), 0.0, 1.0);\n                           color = min(color, base.rgb);\n                        }\n                    }\n                    return min(color.r, min(color.g, color.b));\n                }\n\n                void main() {\n                    \n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    lowp float haze = hazeMap(base);\n\n                    float transmission = 1.0 - 0.95 * haze;\n                    const float A = 0.95; //0.95 intensity. We can consider to collect 0.1% brightest pixel from the dark channel image.\n                    const float t0 = 0.1; //0.1 in the paper, we can increase it for solving the color bleeding.\n                    float t = mix(1.0, max(t0, transmission), amount);\n                    vec3 J = (base.rgb - A) / t + A;\n                    gl_FragColor = vec4(J, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("dehaze",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}solarize(){this.paletteMap||(this.paletteMap=new ImageData(256,1));for(let e=0;e<256;++e){let t=255*(e/255>.5?2*(e/255-.5):2*(.5-e/255));t=t>255?255:t<0?0:t,this.paletteMap.data[4*e]=this.paletteMap.data[4*e+1]=this.paletteMap.data[4*e+2]=t}this.mapping(this.paletteMap)}monochrome(e){let t=this.compiledProgram.get("monochrome");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n\n            uniform float r;\n            uniform float g;\n            uniform float b;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(r, g, b));\n            }\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n\n                gl_FragColor = vec4(avg, avg, avg, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("monochrome",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.r,e.r),this.ctx.uniform1f(t.uniform.g,e.g),this.ctx.uniform1f(t.uniform.b,e.b),this.draw(t)}curves(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),void 0!==e.preset&&(e=d.z.createCurveSet(e)),d.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}levels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),l.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}multilevels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),l.Z.fillRGBPaletteMap(e[0].isFlat()?void 0:e[0],e[1].isFlat()?void 0:e[1],e[2].isFlat()?void 0:e[2],this.paletteMap),this.mapping(this.paletteMap)}mapping(e){let t=this.compiledProgram.get("mapping");if(!t){let e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float r = texture2D(paletteMap, vec2(base.r, 0)).r;\n                    float g = texture2D(paletteMap, vec2(base.g, 0)).g;\n                    float b = texture2D(paletteMap, vec2(base.b, 0)).b;\n                    gl_FragColor = vec4(r, g, b, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("mapping",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,e.width,e.height),s.uploadData(this.ctx,e),this.draw(t)}lookup(e){let t=this.compiledProgram.get("lookup");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n\n            uniform sampler2D texture;\n            uniform sampler2D paletteMap;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(0.299, 0.587, 0.114));\n            }\n\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n                float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                gl_FragColor = vec4(r, g, b, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("lookup",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,e.width,e.height),s.uploadData(this.ctx,e),this.draw(t)}toning(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),c.Z.fillPaletteMap(e,this.paletteMap);let t=this.compiledProgram.get("toning");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                uniform float amount;\n                \n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float avg = luma(base.rgb);\n                    float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                    float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                    float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                    gl_FragColor = mix(base, vec4(r, g, b, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("toning",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,this.paletteMap.width,this.paletteMap.height),s.uploadData(this.ctx,this.paletteMap),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}fill(e){let t=this.compiledProgram.get("fill-"+e.blend);if(!t){let s="";switch(e.blend){case"soft-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendSoftLight(float base, float blend) {\n                            return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend) {\n                            return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendSoftLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"hard-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend) {\n                            return blendOverlay(blend,base);\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendHardLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"vivid-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        float blendVividLight(float base, float blend) {\n                            return (blend<0.5)?blendColorBurn(base,(2.0*blend)):blendColorDodge(base,(2.0*(blend-0.5)));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend) {\n                            return vec3(blendVividLight(base.r,blend.r),blendVividLight(base.g,blend.g),blendVividLight(base.b,blend.b));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendVividLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendVividLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"overlay":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n                            return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendOverlay(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"multiply":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendMultiply(vec3 base, vec3 blend) {\n                            return base*blend;\n                        }\n                        vec3 blendMultiply(vec3 base, vec3 blend, float opacity) {\n                            return (blendMultiply(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendMultiply(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-dodge":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend) {\n                            return vec3(blendColorDodge(base.r,blend.r),blendColorDodge(base.g,blend.g),blendColorDodge(base.b,blend.b));\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorDodge(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorDodge(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-burn":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend) {\n                            return vec3(blendColorBurn(base.r,blend.r),blendColorBurn(base.g,blend.g),blendColorBurn(base.b,blend.b));\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorBurn(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorBurn(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"screen":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendScreen(float base, float blend) {\n                            return 1.0-((1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend) {\n                            return vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend, float opacity) {\n                            return (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendScreen(base.rgb, color.rgb, amount), base.a);\n                        }";break;default:s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = mix(base, color, amount);\n                        }"}t=this.compileShader(s),this.compiledProgram.set("fill-"+e.blend,t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}glamour(e){let t=this.compiledProgram.get("glamour");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n\n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    \n                    vec4 base = texture2D(texture, uv);\n                    vec3 color = blurMap();\n                    \n                    color = vec3(luma(color));\n\n                    color = vec3(\n                        (base.r <= 0.5) ? (2.0 * base.r * color.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - color.r)),\n                        (base.g <= 0.5) ? (2.0 * base.g * color.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - color.g)),\n                        (base.b <= 0.5) ? (2.0 * base.b * color.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - color.b))\n                    );\n                \n                    gl_FragColor = mix(base, vec4(color, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("glamour",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}kaleidoscope(e){let t=this.compiledProgram.get("kaleidoscope");if(!t){let e="\n                precision mediump float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 resolution;\n\n                uniform float u_stretch;\n                uniform float u_position;\n                uniform float u_amount;\n\n                int modwhole(float a, float b) {\n                    float m = mod(a, b);\n\n                    return int (m+.5);\n                }\n\n                void main(void) {\n                    int numOfAxis = int(u_amount);\n                    float angleFrac = (2. * PI) / float ( 2 * numOfAxis);\n\n                    vec2 uvc = uv;\n                    uvc -= .5;\n\n                    // Convert to Polar\n                    float phi = abs(atan(uvc.x, uvc.y));\n                    float r = length(uvc);\n\n                    int count = int(phi / angleFrac);\n\n                    phi = mod(phi, angleFrac);\n                    if (modwhole (float(count), 2.) == 1) {\n                        phi = angleFrac - phi;\n                    }\n\n                    // from polar coordiantes\n                    float x = r * cos(phi);\n                    float y = r * sin(phi);\n\n                    float stretch = 1. + (1. - u_stretch);\n                    float position = u_position * PI * .5;\n\n                    uvc = vec2(x, y) * stretch + sin(position);\n\n                    if (uvc.x < 0.) uvc.x += 1.;\n                    if (uvc.x > 1.) uvc.x -= 1.;\n                \n                    if (uvc.y < 0.) uvc.y += 1.;\n                    if (uvc.y > 1.) uvc.y -= 1.;\n\n                    gl_FragColor = texture2D (texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("kaleidoscope",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.u_amount,e.amount),this.ctx.uniform1f(t.uniform.u_stretch,e.stretch),this.ctx.uniform1f(t.uniform.u_position,e.position),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}polarcoordinates(e){let t=this.compiledProgram.get("polarcoordinates");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int flip;\n                uniform float overlap;\n                uniform float rotate;\n                uniform vec2 resolution;\n                uniform int symmetry;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // Aspect Ratio\n                    float ar = resolution.x / resolution.y;\n\n                    // Square the image at the center if rectangular\n                    if (symmetry == 1) {\n                        if (resolution.x > resolution.y) {\n                            float leftEdge = (1.0-1.0/ar) * 0.5;\n                            float rightEdge = 1.0 - leftEdge;\n\n                            if (uv.x < leftEdge) {\n                                uv = vec2(0, uv.y); // Fill in the left edge\n                            } else if (uv.x > rightEdge) {\n                                uv = vec2(1, uv.y); // Fill in the right edge\n                            }\n                            else {\n                                uv.x -= leftEdge; // Square the image on X\n                                uv.x *= ar;\n                            }\n                        } else if (resolution.y > resolution.x) {\n                            float bottomEdge = (1.0-ar) * 0.5;\n                            float topEdge = 1.0 - bottomEdge;\n\n                            if (uv.y < bottomEdge) {\n                                uv = vec2(uv.x, 0); // Fill in the bottom edge\n                            } else if (uv.y > topEdge) {\n                                uv = vec2(uv.x, 1); // Fill in the top edge\n                            }\n                            else {\n                                uv.y -= bottomEdge; // Square the image on Y\n                                uv.y /= ar;\n                            }\n                        }\n                    }\n                    return uv;\n                }\n\n                void main(void) {           \n                    // Square the image\n                    vec2 uvc = squareImage(uv);\n\n                    // Bring uv coordinates to center 0.5\n                    uvc = uvc-0.5;\n\n                    // Rotate uv by angle\n                    uvc = rotate2d( rotate ) * uvc;\n\n                    // Cartesian to polar\n                    float r = length(uvc) * 2.0;\n                    float a = atan(uvc.x, uvc.y);\n\n                    // Move from -PI -> PI to 0 -> 1\n                    vec2 uvp = vec2(a / (PI_2 + overlap) + 0.5, r);\n\n                    // Flip the image by 180 degrees\n                    uvp = flip == 1 ? 1.0 - uvp : uvp;\n\n                    // Compute color\n                    gl_FragColor = texture2D(texture, uvp);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("polarcoordinates",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.flip,e.flip?1:0),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.ctx.uniform1f(t.uniform.overlap,e.overlap),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}fisheye(e){let t=this.compiledProgram.get("fisheye");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 center;\n                uniform float amount;\n                uniform float aperture;\n                uniform int edgeFill;\n                uniform vec2 resolution;\n\n                vec2 edgeFillReflect(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = -uvc.x;\n                    if (uvc.y < 0.) uvc.y = -uvc.y;\n                    if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                    if (uvc.y > 1.) uvc.y = 2. - uvc.y;\n\n                    return uvc;\n                }\n\n                vec2 edgeFillRepeat(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                    if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                    if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                    if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n\n                    return uvc;\n                }\n\n                int edgeFillNone(vec2 uvc) {\n                    if (uvc.x < 0. || uvc.y < 0. || uvc.x > 1. || uvc.y > 1.) {\n                        return 1;\n                    }\n                    return 0;\n                }\n\n                void main(void) {\n\n                    // Normalized device space i.e. range of [-1, 1]\n                    vec2 ndcPos = uv * 2. - center * 2.;\n\n                    // Aspect ratio of the viewport\n                    float aspect = resolution.x / resolution.y;\n\n                    // Relationship between the radius of the perimeter circle (r or half_dist) and\n                    // the angle (eye_angle): \n                    // Bisect the isosceles triangle\n                    float eye_angle = abs(aperture);\n                    float half_angle = eye_angle / 2.;\n                    float half_dist = tan(half_angle);\n\n                    // With the aspect ratio of the viewport (aspect)\n                    vec2 vp_scale = vec2(aspect, 1.);\n                    vec2 P = ndcPos * vp_scale;\n\n                    // Diameter or the length of the viewport\n                    float vp_dia = length(vp_scale);\n\n                    // Relative distance to the center of the viewport\n                    float rel_dist = length(P) / vp_dia;\n\n                    // Relative position of the point P in relation to the aspect ratio\n                    vec2 rel_P = normalize(P) / normalize(vp_scale);\n\n                    vec2 pos_prj = ndcPos;\n                    if (aperture > 0.) {\n                        // Projection from spherical surface to the place\n                        float beta = rel_dist * half_angle;\n                        pos_prj = rel_P * tan(beta) / half_angle * pow(.9, amount * 5.);\n                    } else if (aperture < 0.) {\n                        // Projection from the plane to the spherical surface\n                        float beta = atan(rel_dist * half_dist);\n                        pos_prj = rel_P * beta / half_angle * pow(.9, amount * 5.);\n                    }\n\n                    vec2 uv_prj = pos_prj * .5 + center;\n\n                    // Return transparent if no edge fill\n                    if (edgeFill == 0) {\n                        if (edgeFillNone(uv_prj) == 1) {\n                            discard;\n                        }\n                    }\n                    if (edgeFill == 1) {\n                        uv_prj = edgeFillReflect(uv_prj);\n                    } \n                    if (edgeFill == 2) {\n                        uv_prj = edgeFillRepeat(uv_prj);\n                    }\n\n                    gl_FragColor = texture2D(texture, uv_prj);;\n                }";t=this.compileShader(e),this.compiledProgram.set("fisheye",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.aperture,e.aperture),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.edgeFill,e.edgeFill),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}wave(e){let t=this.compiledProgram.get("wave");if(!t){let e="\n                precision mediump float;\n                uniform int type;\n                uniform float amplitude;\n                uniform float scale;\n                varying vec2 uv;\n                uniform int edgeApprox;\n                // uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float rotate;\n                #define PI 3.14159265359\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                float cot(float angle) {\n                    return cos(angle) / sin(angle);\n                }\n\n                float sinewave(float rad) {\n                    return amplitude * sin(scale * 2. * PI * rad);\n                }\n\n                float trianglewave(float rad) {\n                    return amplitude * 2. / PI * asin(sin(scale * 2. * PI * rad));\n                }\n\n                float squarewave(float rad) {\n                    return amplitude * sign(sin(scale * 2. * PI * rad));\n                }\n\n                void main() {\n                    vec2 uvc = uv;\n\n                    uvc -= 0.5;\n                    uvc = rotate2d(-rotate) * uvc;\n\n                    if (type == 0) {\n                        // sine wave\n                        uvc.y = sinewave(uvc.x) + uvc.y;\n                    } else if (type == 1) {\n                        // triangular wave\n                        uvc.y = trianglewave(uvc.x) + uvc.y;\n                    } else if (type == 2) {\n                        // square wave\n                        uvc.y = squarewave(uvc.x) + uvc.y;\n                    } else {\n                        // sawtooth wave\n                        // uvc.y = amplitude * 2. / PI * atan(cot(scale * 2. * PI * uvc.x));\n                    }\n                    \n                    uvc = rotate2d(rotate) * uvc;\n                    uvc += 0.5;\n                    \n                    // Clamp\n                    // uvc = clamp(uvc, 0., 1.);\n\n                    if (edgeApprox == 2) {\n                        // Repeat acros the edges with the opposite side color\n                        if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                        if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                        if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                        if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n                    } else if (edgeApprox == 1) {\n                        // Approximate (natural) around the edges with the reflection color\n                        if (uvc.x < 0.) uvc.x = -uvc.x;\n                        if (uvc.y < 0.) uvc.y = -uvc.y;\n                        if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                        if (uvc.y > 1.) uvc.y = 2. - uvc.y;    \n                    } else {\n                        // Don't approximate, render transparent\n                        if (uvc.x < 0. || uvc.x > 1. || \n                            uvc.y < 0. || uvc.y > 1.) {\n                            gl_FragColor = vec4 (0.0, 0.0, 0.0, 0.0);\n                            return;\n                        }    \n                    }\n\n                    gl_FragColor = texture2D(texture, uvc);\n                    return;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("wave",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.scale,e.scale),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform1i(t.uniform.edgeApprox,e.edgeApprox),this.draw(t)}reflect(e){let t=this.compiledProgram.get("reflect");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int type;\n                uniform vec2 resolution;\n                uniform vec2 center;\n\n                // constant integers for directions\n                const int RIGHT = 1, LEFT = -1, ZERO = 0;\n\n                const float ALMOST_ZERO = 0.00001;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // return uv;\n\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                    }\n                    else {\n                        uv.x *= ar;\n                    }\n                    return uv;\n                }\n\n                vec2 squareImagereverse(vec2 uv) {\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                        uv.y += (1. - 1./ar) * 0.5;\n                    }\n                    else {\n                        uv.x *= ar;\n                        uv.x += (1. - ar) * 0.5;\n                    }\n                    return uv;\n                }\n\n                int direction(vec2 A, vec2 B, vec2 P) {\n                    // subtracting co-ordinates of point A from\n                    // B and P, to make A as origin\n                    B.x -= A.x;\n                    B.y -= A.y;\n                    P.x -= A.x;\n                    P.y -= A.y;\n                \n                    // Determining cross Product\n                    float cross_product = B.x * P.y - B.y * P.x;\n                \n                    // return RIGHT if cross product is positive\n                    if (cross_product > ALMOST_ZERO)\n                        return LEFT;\n                \n                    // return LEFT if cross product is negative\n                    if (cross_product < -ALMOST_ZERO)\n                        return RIGHT;\n                \n                    // return ZERO if cross product is zero.\n                    return ZERO;\n                }\n                \n                vec2 reflectmagic(vec2 uvc, int reflectfrom, mat2 transf, vec2 A, vec2 B, vec2 center) {\n\n                    vec2 cent = center - 0.5;\n                    uvc -= center;\n\n                    int dircent = direction(A, B, cent);\n                    int diruv = direction(A, B, uvc);\n\n                    uvc = dircent >= ZERO && diruv >= ZERO || dircent == LEFT && diruv == LEFT ? transf * uvc : uvc;\n\n                    uvc += center;\n\n                    uvc -= 0.5;\n\n                    if (reflectfrom == LEFT) {\n                        uvc = dircent >= ZERO ? uvc : transf * uvc;\n                    } else {\n                        uvc = dircent == LEFT ? uvc : transf * uvc;\n                    }\n\n                    uvc += 0.5;\n\n                    return uvc;\n                }\n\n                vec2 reflectx(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(-1., 0., 0., 1.);     \n\n                    vec2 A = vec2 (0., -1.);\n                    vec2 B = vec2 (0., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflecty(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(1., 0., 0., -1.);    \n\n                    vec2 A = vec2 (-1., 0.);\n                    vec2 B = vec2 (1., 0.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflectxequalminusy(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., 1., 1., 0.);\n\n                    vec2 A = vec2 (-1., -1.);\n                    vec2 B = vec2 (1., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, 1.-center.x));\n                }\n\n                vec2 reflectxequaly(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., -1., -1., 0.);\n\n                    vec2 A = vec2 (-1., 1.);\n                    vec2 B = vec2 (1., -1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, center.x));\n                }\n\n                vec2 reflect(vec2 uvc) {\n                    //reflect-type-minus-x\n                    if (type == 1) {\n                        uvc = reflectx(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-y\n                    else if (type == 2) {\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-plus-x\n                    if (type == 3) {\n                        uvc = reflectx(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-y\n                    else if (type == 4) {\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-minus-x-minus-y\n                    else if (type == 5) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-x-plus-y\n                    else if (type == 6) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-plus-y\n                    else if (type == 7) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-minus-y\n                    else if (type == 8) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-above-x-equalto-y\n                    else if (type == 9) {\n                        uvc = reflectxequalminusy(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-minus-y\n                    else if (type == 10) {\n                        uvc = reflectxequaly(uvc, RIGHT);\n                    }\n\n                    // reflect-type-above-x-equalto-minus-y\n                    else if (type == 11) {\n                        uvc = reflectxequaly(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-y\n                    else if (type == 12) {\n                        uvc = reflectxequalminusy(uvc, RIGHT);\n                    }\n\n                    return uvc;\n                }\n\n                void main(void) {\n                    vec2 uvc = reflect(uv);\n                    gl_FragColor = texture2D(texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("reflect",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}bloom(e){let t=this.compiledProgram.get("bloom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                float thresh = .5;\n                \n                void main() {\n                    vec4 sum = vec4(0);\n                \n                    // mess of for loops due to gpu compiler/hardware limitations\n                    int j=-2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=-1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=0;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    sum/=25.0;\n                \n                    gl_FragColor= texture2D(texture, uv);\n                \n                    // use the blurred colour if it's bright enough\n                    if (length(sum) > thresh) {\n                        gl_FragColor += sum*amount;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bloom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}posterize(e){let t=this.compiledProgram.get("posterize");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float areas = 256.0 / amount;\n                float values = 255.0 / (amount - 1.0);\n                \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n\n                    px.r = floor(values * floor((px.r*255.0) / areas))/255.0;\n                    px.g = floor(values * floor((px.g*255.0) / areas))/255.0;\n                    px.b = floor(values * floor((px.b*255.0) / areas))/255.0;\n\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("posterize",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,100*e+1),this.draw(t)}fringe(e){let t=this.compiledProgram.get("fringe");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 amount;\n\n                void main() {\n                    vec2 dir = uv - vec2( .5 );\n                    float d = .7 * length( dir );\n                    normalize( dir );\n                    vec2 value = d * dir * amount;\n                \n                    vec4 c1 = texture2D( texture, uv - value);\n                    vec4 c2 = texture2D( texture, uv );\n                    vec4 c3 = texture2D( texture, uv + value);\n                    \n                    gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b);\n                }";t=this.compileShader(e),this.compiledProgram.set("fringe",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.amount,e,e),this.draw(t)}rgbSplit(e){let t=0,s=0,i=0;const n=e.distance;switch(e.type){case"red-blue":t=n,i=-n;break;case"green-red":t=-n,s=n;break;case"blue-green":s=-n,i=n;break;case"red":t=n;break;case"green":s=n;break;case"blue":i=n}let a=this.compiledProgram.get("rgb-split");if(!a){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                uniform vec2 r;\n                uniform vec2 g;\n                uniform vec2 b;\n\n                void main() {\n                \n                    vec4 px = texture2D(texture, uv);\n\n                    vec4 c1 = texture2D( texture, uv - r);\n                    vec4 c2 = texture2D( texture, uv - g);\n                    vec4 c3 = texture2D( texture, uv - b);\n                    \n                    gl_FragColor = mix(px, vec4( c1.r, c2.g, c3.b, (c1.a + c2.a + c3.a)/3.0), amount);\n                }";a=this.compileShader(e),this.compiledProgram.set("rgb-split",a)}this.ctx.useProgram(a.program),this.ctx.uniform1f(a.uniform.amount,e.amount);var r=e.direction*Math.PI/180,o=Math.cos(r),h=Math.sin(r);this.ctx.uniform2f(a.uniform.r,o*t,h*t),this.ctx.uniform2f(a.uniform.g,o*s,h*s),this.ctx.uniform2f(a.uniform.b,o*i,h*i),this.draw(a)}interference(e){let t=this.compiledProgram.get("interference");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform int direction;\n\n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy, vec2(12.9898,78.233)*3.141)) * 43758.5453);\n                }\n\n                void main() {\n\n                    float rand1 = rand(vec2(seed,seed));\n                    float rand2 = rand(vec2(seed,rand1));\n                \n                    float rand1xy = rand(vec2(rand1*uv.x,rand2*uv.y));\n                    float rand2xy = rand(vec2(rand1*uv.y,rand2*uv.x));\n                  \n                    float rand1x = rand(vec2(rand1*uv.x,rand2));\n                    float rand2x = rand(vec2(rand1x,rand1x));     \n\n                    float rand1y = rand(vec2(rand1*uv.y,rand2));\n                    float rand2y = rand(vec2(rand1y,rand1y));                       \n                    \n                    if(direction == 0) {\n                        if(rand2y/100.0 > rand1y) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x + rand1y * amount, uv.y));\n                        }\n                    } else {\n                        if(rand2x/100.0 > rand1x) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x, uv.y + rand1x * amount));\n                        }\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("interference",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount/15),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}bleed(e){let t=this.compiledProgram.get("bleed");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float block;\n                uniform float amplitude;\n              \n                float rand(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + rand(sd) * (max - min);\n                }\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n\n                float noise(vec2 uv, float blockiness){   \n                    vec2 lv = fract(uv);\n                    vec2 id = floor(uv);\n                    \n                    float n1 = rand(id);\n                    float n2 = rand(id+vec2(1,0));\n                    float n3 = rand(id+vec2(0,1));\n                    float n4 = rand(id+vec2(1,1));\n                    \n                    vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n\n                    return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n                }\n\n                float fbm(vec2 uv, int count, float blockiness, float complexity) {\n                    float val = 0.0;\n                    float amp = 0.5;\n                    \n                    for (int i = 0; i < 1000; i++) {\n                        if(i == count) break;\n                        \n                        val += amp * noise(uv, blockiness);\n                        amp *= 0.5;\n                        uv *= complexity;    \n                    }  \n                    return val;\n                }\n\n                const float shift = 2.0; //2\n\n                void main()\n                {\n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 20.0; i += 1.0) {\n\n                        float sliceY = rand(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = rand(vec2(seed, 3234.0 + float(i)));\n\n                        float sliceH = rand(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = rand(vec2(seed, 3234.0 + float(i))) * 1.5;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0){\n                           \n                            vec2 id = floor(uv * 5.0);\n        \n                            // Generate shift amplitude\n                            float shift = amplitude * fbm(uv, int(id * 6.), shift, block);\n                            //float shift = randomRange(vec2(seed, 5234.0 + float(i)), -amplitude, amplitude);\n        \n                            float r = texture2D(texture, vec2(uv.x + shift, uv.y)).r * (1. - shift) ;\n                            float g = texture2D(texture, vec2(uv.x - shift, uv.y)).g * (1. - shift) + rand(id) * shift;\n                            float b = texture2D(texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n        \n                            px = mix(vec4(r, g, b, px.a), px, 0.5);\n                        }\n                        gl_FragColor = px;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bleed",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.block,e.block),this.draw(t)}slice(e){let t=this.compiledProgram.get("slice");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform float distance;\n                uniform int line;\n\n                //2D (returns 0 - 1)\n                float random2d(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + random2d(sd) * (max - min);\n                }\n                \n                // return 1 if v inside 1d range\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n                  \n                void main() {\n                  \n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 100.0; i += 1.0) {\n\n                        if(i == amount) break;\n\n                        float sliceY = random2d(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = random2d(vec2(seed, 5234.0 + float(i)));\n\n                        float sliceH = random2d(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = random2d(vec2(seed, 5234.0 + float(i))) * 1.5;\n\n                        float hOffset = randomRange(vec2(seed, 2035.0 + float(i)), -distance*.5, distance*.5);\n                        float wOffset = randomRange(vec2(seed, 5234.0 + float(i)), -distance, distance);\n\n                        vec2 uvOff = uv;\n                        uvOff.x += wOffset;\n                        uvOff.y += hOffset;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && (line == 1 || insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0)){\n                            px = texture2D(texture, uvOff);\n                        }\n                    }\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("slice",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.distance,e.distance/3),this.ctx.uniform1i(t.uniform.line,e.line?1:0),this.draw(t)}mimicHDR(e){let t=this.compiledProgram.get("mimicHDR");if(!t){const e="\n                precision highp float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform sampler2D blurMap;\n\n                uniform float amount;\n                uniform float contra;\n                \n                float blendSoftLight(float base, float blend) {\n                    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                }\n                vec4 blendSoftLight(vec4 base, vec4 blend) {\n                    return vec4(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b), base.a);\n                }\n\n                float blendOverlay(float base, float blend) {\n                    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n                vec4 blendOverlay(vec4 base, vec4 blend) {\n                    return vec4(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b), base.a);\n                }\n               \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    vec4 blur = texture2D(blurMap, uv);\n\n                    vec4 blend = blendOverlay(px, blur);\n                    blend = mix(blend, blendSoftLight(px, blend), contra);\n\n                    gl_FragColor = mix(px, blend, amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("mimicHDR",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.contra,e.contra);let s=t.getTextureById("blurMap");s.createTexture(this.ctx,e.blurMap.width,e.blurMap.height),s.uploadData(this.ctx,e.blurMap),this.draw(t)}pixelate(e){let t=this.compiledProgram.get("pixelate");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    float d = 1.0 / amount;\n                    float ar = resolution.x / resolution.y;\n                    float u = floor( uv.x / d ) * d + d*0.5;\n                    d = ar / amount;\n                    float v = floor( uv.y / d ) * d + d*0.5;\n                    gl_FragColor = texture2D(texture, vec2( u, v ) );\n                }";t=this.compileShader(e),this.compiledProgram.set("pixelate",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,4*(100-100*e)),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}scanlines(e){let t=this.compiledProgram.get("scanlines");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float size;\n\n                uniform int colorize;\n                uniform int direction;\n\n                void main() {\n                    \n                    vec2 sl;\n                    vec4 scanlines;\n                    vec4 color = texture2D(texture, uv);\n\n                    if(direction == 0) {\n                        sl = vec2(sin(uv.y * size), cos(uv.y * size)) * amount;\n                    }\n                    else {\n                        sl = vec2(sin(uv.x * size), cos(uv.x * size)) * amount;\n                    }\n\n                    if(colorize == 1) {\n                        scanlines = vec4(sl.x, sl.y, sl.x, 1.0);\n                    } \n                    else {\n                        scanlines = vec4(sl.x, sl.x, sl.x, 1.0);\n                    }\n\n                    gl_FragColor = vec4(color.r + scanlines.r, color.g + scanlines.g, color.b + scanlines.b, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("scanlines",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.direction?Math.round(this.height/e.size):Math.round(this.width/e.size)),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1i(t.uniform.colorize,e.colorize?1:0),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}mosaic(e){let t=this.compiledProgram.get("mosaic");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform vec2 num;\n                \n                void main()\n                {\n                    vec2 uv = uv;\n                    vec2 uv2 = floor(uv*num)/num;\n                    uv -= uv2;\n                    uv *= num;\n                    gl_FragColor = texture2D(texture, \n                                    uv2 + vec2(step(1.0-uv.y,uv.x)/(2.0*num.x),\n                                    step(uv.x,uv.y)/(2.0*num.y)));\n                }";t=this.compileShader(e),this.compiledProgram.set("mosaic",t)}let s=Math.round(100*(1-e)),i=Math.round(this.height/this.width*s);this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.num,s,i),this.draw(t)}bokeh(e){let t=this.compiledProgram.get("bokeh-"+e.type);if(!t){let s="";switch(e.type){case"circle":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);                          \n                            float rc = 0.0;\n\n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    float l = length(vec2(x-spread,y-spread));\n                                    if(l <= spread)\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"square":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg = vec3(0.0);\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                    mcol = max(mcol, col);\n                                    avg += col;\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / (myx * myx), mcol, amount), 1.0);\n                        }";break;case"hexagon":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define PI2 6.283185308\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec2 pt = vec2(x-spread, y-spread);\n        \n                                    float an = 0.33 + atan(pt.x, pt.y); //0.33 Angle\n                                    float ngon = cos(an - (PI2 * floor((PI + 6.0 * an) / PI2)) / 6.0) / cos(PI / 6.0); //6 corners\n                                    float ngonSdf = ngon * length(pt) - spread;\n                            \n                                    if(ngonSdf <= 0.0) {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread, y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"cross":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n        \n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            float myx = spread*2.0;\n                            float low = spread*.7;\n                            float high = spread*1.3;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    if((y > low && y < high) || (x > low && x < high))\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }"}t=this.compileShader(s),this.compiledProgram.set("bokeh-"+e.type,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}art(e){let t=this.compiledProgram.get("art");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","void main() {","vec4 color, tmp, add;","vec2 uv = uv + vec2( sin( uv.y * 100.0 ), sin( uv.x * 100.0 )) * 0.0005;","color = texture2D( texture, uv );","add = tmp = texture2D( texture, uv + vec2( 0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, 0.002 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, -0.002 ));","if( tmp.r < color.r ) color = tmp;","uv = (uv - vec2(0.5)) * vec2(0.7);","gl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("art",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.screenWidth,this.canvas.width),this.ctx.uniform1f(t.uniform.screenHeight,this.canvas.height),this.ctx.uniform1f(t.uniform.sampleDistance,e),this.ctx.uniform1f(t.uniform.waveFactor,.01),this.draw(t)}melt(e){let t=this.compiledProgram.get("melt");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 center;\n              \n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n                }\n                vec3 mod289(vec3 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec2 mod289(vec2 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec3 permute(vec3 x) {\n                    return mod289(((x*34.0)+1.0)*x);\n                }\n                  \n                float snoise(vec2 v) {\n\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                  // First corner\n                    vec2 i  = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v -   i + dot(i, C.xx);\n                  \n                  // Other corners\n                    vec2 i1;\n                    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                  \n                  // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                          + i.x + vec3(0.0, i1.x, 1.0 ));\n                  \n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m ;\n                    m = m*m ;\n                                   \n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 ox = floor(x + 0.5);\n                    vec3 a0 = x - ox;\n                  \n                    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n                  \n                  // Compute final noise value at P\n                    vec3 g;\n                    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n\n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    \n                    float opacity = 0.0;\n\n                    if(amount == 0.0 || amount == 1.0) {\n                        opacity = amount;\n                    } \n                    else {\n                        if(center.x == 0.5) {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(uv.x, 0.0)));\n                            float r = amount - rand(vec2(uv.x, 0.1));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }\n                        else {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(0.0, uv.y)));\n                            float r = amount - rand(vec2(0.1, uv.y));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }   \n                    }\n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("melt",t)}this.ctx.useProgram(t.program);let s=new n.Z(.5,.5);switch(e.direction){case"down":s.y=0;break;case"right":s.x=1;break;case"left":s.x=0;break;case"up":s.y=1}this.ctx.uniform2f(t.uniform.center,s.x,s.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}gooey(e){let t=this.compiledProgram.get("gooey");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                // http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n                float random(vec2 co) {\n\n                    highp float a = 12.9898; //seed;\n                    highp float b = 78.233;\n                    highp float c = 43758.5453;\n                    highp float dt= dot(co.xy ,vec2(a,b));\n                    highp float sn= mod(dt,3.14);\n                    return fract(sin(sn) * c);\n                }\n\n                // 2D Noise based on Morgan McGuire @morgan3d\n                // https://www.shadertoy.com/view/4dS3Wd\n                float noise (in vec2 st) {\n\n                    vec2 i = floor(st);\n                    vec2 f = fract(st);\n\n                    // Four corners in 2D of a tile\n                    float a = random(i);\n                    float b = random(i + vec2(1.0, 0.0));\n                    float c = random(i + vec2(0.0, 1.0));\n                    float d = random(i + vec2(1.0, 1.0));\n\n                    // Cubic Hermine Curve.  Same as SmoothStep()\n                    vec2 u = f*f*(3.0-2.0*f);\n\n                    // Mix 4 coorners porcentages\n                    return mix(a, b, u.x) +\n                            (c - a)* u.y * (1.0 - u.x) +\n                            (d - b) * u.x * u.y;\n                }\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv);\n                    float n = noise(uv * 10.0); //scale\n                    \n                    float p = mix(-0.01, 1.0 + 0.01, amount);\n                    float lower = p - 0.01;\n                    float higher = p + 0.01;\n                    \n                    float opacity = smoothstep(lower, higher, n);\n                    \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("gooey",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}block(e){let t=this.compiledProgram.get("block");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                float rand (vec2 co) {\n                    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n                }\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                    \n                    float r = rand(floor(vec2(10.0) * uv)); //size\n                    float opacity = smoothstep(0.0, -0.5, r - (amount * (1.0 + 0.5)));\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("block",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}curtain(e){let t=this.compiledProgram.get("curtain-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec2 p = uv;\n                    vec4 col = vec4(0);\n                ";"horizontal"===e.direction?s+="                    \n                        if(2.0 * abs(p.x-0.5) - amount > 0.0) {\n                            p = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*amount, 0.0);\n                            col = texture2D(texture, p);\n                        }\n                    ":s+="\n                        if(2.0 * abs(p.y-0.5) - amount > 0.0) {\n                            p = p + (p.y > 0.5 ? -1.0 : 1.0) * vec2(0.0, 0.5*amount);\n                            col = texture2D(texture, p);\n                        }\n                    ",s+="\n                    gl_FragColor = col;\n                }",t=this.compileShader(s),this.compiledProgram.set("curtain-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}blinds(e){let t=this.compiledProgram.get("blinds-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"up":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.y) - amount * (1.0 + 0.5)), fract(12.0 * uv.y));";break;case"right":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.x) - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"left":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.x - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"down":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.y - amount * (1.0 + 0.5)), fract(12.0 * uv.y));"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }",t=this.compileShader(s),this.compiledProgram.set("blinds-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}wipe(e){let t=this.compiledProgram.get("wipe-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"down":s+="float opacity = 1.0 - step(uv.y, amount);";break;case"right":s+="float opacity = step(uv.x, 1.0 - amount);";break;case"left":s+="float opacity = 1.0 - step(uv.x, amount);";break;case"up":s+="float opacity = step(uv.y, 1.0 - amount);"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(s),this.compiledProgram.set("wipe-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}slot(e){let t=this.compiledProgram.get("slot");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                    vec2 f = fract(p);\n                    float opacity = step(0.0, p.y) * step(p.y, 1.0) * step(0.0, p.x) * step(p.x, 1.0);\n                   \n                    vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("slot",t)}let s=new n.Z(0,0);switch(e.direction){case"down":s.y=-1;break;case"right":s.x=1;break;case"left":s.x=-1;break;case"up":s.y=1}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.dir,s.x,s.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}split(e){let t=this.compiledProgram.get("split-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float sections;\n\n                void main() {\n                    vec2 p = uv;\n                ";"horizontal"===e.direction?s+="float num = floor(uv.y*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.x = uv.x + amount*sign(odd-0.5);\n             \n                    float opacity = (p.x * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ":s+="float num = floor(uv.x*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.y = uv.y + amount*sign(odd-0.5);\n             \n                    float opacity = (p.y * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ",s+="vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(s),this.compiledProgram.set("split-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sections,e.sections),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}circular(e){let t=this.compiledProgram.get("circular");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                const float PI = 3.141592653589;\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n\n                    vec2 p = uv*2.-1.;\n                    float opacity = smoothstep(0.0, 0.5, atan(p.y,p.x) - (amount-.5) * PI * 2.5);\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("circular",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}ripple(e){let t=this.compiledProgram.get("ripple");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    \n                    vec2 dir = uv - vec2(.5);\n                    float dist = length(dir);\n                    vec2 offset = dir * (sin(amount * dist * 100.0 - amount * 40.0) + 0.5) / 30.0; //100 amp 40 speed\n\n                    float opacity = smoothstep(0.2, 1.0, amount);\n\n                    vec4 px = texture2D(texture, uv + offset);                   \n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("ripple",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}warp(e){let t=this.compiledProgram.get("warp-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n            ";switch(e.direction){case"up":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"right":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"left":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);";break;case"down":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);"}s+="\n                gl_FragColor = vec4(col.rgb, col.a * (1.0 - amount));\n            }",t=this.compileShader(s),this.compiledProgram.set("warp-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}cloneChain(){const e=[];for(let t=0;t<this.chain.length;t++){const s=this.chain[t];let i;switch(s.type){case"curves":{const e=s.value,t=e.rgb.map((e=>e.clone())),n=e.red.map((e=>e.clone())),a=e.green.map((e=>e.clone())),r=e.blue.map((e=>e.clone()));i=new d.Z(e.scale,t,n,a,r);break}case"levels":{const e=s.value;i=new l.Z(e.minin,e.maxin,e.minout,e.maxout,e.midin,e.mid);break}case"toning":{const e=s.value;i=new c.Z(e.highlight.clone(),e.shadow.clone(),e.amount);break}case"fill":{const e=s.value;i=new h.Z(e.color.clone(),e.blend,e.amount);break}default:i=s.value}e.push(new p(s.type,i))}return e}}class p{constructor(e,t,s=!1){this.type=e,this.value=t,this.sidekick=s}}},2381:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e){this.id=e,this.texture=null}createTexture(e,t,s){this.texture=e.createTexture(),this.width=t,this.height=s}uploadData(e,t,s=e.NEAREST){e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}setTexture(e){this.texture=e}destroy(e){e.deleteTexture(this.texture)}}},1721:(e,t,s)=>{s.d(t,{G:()=>d});var i=s(3655),n=s(9872),a=s(6817),r=s(3673),o=s(9679),h=s(8685),c=s(2282),l=s(1294);function d(e,t){var s,d,u;const p=new Date;switch(t.type){case"bitmapChange":{const e=t.layer,s=i.$E(t.layer.canvas,t.patchRect),n=e.rect?e.rect.clone():void 0;let r=i.dN(e.mask);if(t.patch){const s=t.rect,a=!!e.canvas;e.extendCanvas(s),a&&(t.patchRect.x+=n.x-e.rect.x,t.patchRect.y+=n.y-e.rect.y);if(e.canvas.getContext("2d").putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<e.rect.width||t.rect.height<e.rect.height){const n=i.vL(t.rect.width,t.rect.height);n.getContext("2d").drawImage(e.canvas,e.rect.x-t.rect.x,e.rect.y-t.rect.y),t.patchRect.x+=e.rect.x-s.x,t.patchRect.y+=e.rect.y-s.y,e.canvas=n,e.rect=s}}else e.canvas=null,e.rect=new a.Z(0,0,0,0);return t.mask&&(e.mask=t.mask),e.render(),t.layer.syncRequested=p,{type:"bitmapChange",layer:e,rect:n,kind:t.kind,patch:s,patchRect:t.patchRect.clone(),mask:r}}case"bitmapSwitch":{const e=t.layer,s=i.dN(t.layer.canvas),n=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return e.switchCanvas(t.canvas,t.rect),e.render(),t.layer.syncRequested=p,{type:"bitmapSwitch",kind:t.kind,layer:e,rect:n,canvas:s}}case"selectionAndBitmapSwitch":{const n=t.layer,a=i.dN(t.layer.canvas),r=n.rect.clone();n.switchCanvas(t.canvas,t.rect),n.render(),t.layer.syncRequested=p;const o=i.dN(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask);return t.selection?(e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:o,layer:n,rect:r,canvas:a}):(e.removeSelection(),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:o,layer:n,rect:r,canvas:a})}case"addLayer":return e.layers.splice(t.order,0,t.layer),{type:"addLayer",kind:t.kind,layer:t.layer};case"deleteLayer":return e.deleteLayerById(t.layer.id),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=p,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=p,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=p,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const s=e.color;return e.color=t.color,{type:"background",color:s}}case"mask":{let e;const s=t.layer.hasMask();if(!s&&t.patch&&t.layer.addMask(),t.patch){const n=t.layer.mask.getContext("2d");s&&(e=i.$E(t.layer.mask,new a.Z(t.rect.x,t.rect.y,t.patch.width,t.patch.height))),n.putImageData(t.patch,t.rect.x,t.rect.y)}else t.layer.removeMask();return t.layer.render(),t.layer.syncRequested=p,{type:"mask",layer:t.layer,rect:t.rect,patch:e}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=p,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,s;return t.tool.marked&&(e=t.tool.marked.name,s=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new o.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:s}}case"arrange":switch(t.layer.syncRequested=p,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof l.Z&&t.layer.trimOnResize(e),t.layer instanceof c.Z||t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"rect",rect:e}}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trim",rect:e}}}case"trans":{const e=i.dN(t.layer.canvas),s=i.dN(t.layer.mask),n=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:s,rect:n}}}}case"arrangeStack":{let e=t.stack,s=t.rects,i=new Array;for(let t=0;t<e.length;t++){let n=e[t],a=n.rect?n.rect.clone():void 0;n.rect=s[t],n instanceof h.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),i.push(a),n.syncRequested=p,n.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=p,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=p,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const s=new r.Z(-t.offset.x,-t.offset.y),o=new n.Z(e.width,e.height);let h;if(e.crop(new a.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const s=e.layers[0];h=i.dN(s.canvas),s.syncRequested=p,s.canvas=t.straighten,s.rect=new a.Z(0,0,s.canvas.width,s.canvas.height),e.width=s.rect.width,e.height=s.rect.height}return e.layers.forEach((e=>e.syncRequested=p)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:o,straighten:h}}case"pageSize":{const s=new n.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:s}}case"pageResize":{const s=new n.Z(e.width,e.height),i=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let n=0;n<t.layers.length;n++){const s=t.layers[n];s.syncRequested=p,e.replaceLayer(s),s.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=p)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=p)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const s=e.selection?i.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:s})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:s}))}case"merge":{const s=t.from.map((t=>e.layers.find((e=>e.id===t.id)))),i=t.from,n=e.layers.map((e=>e.id));return e.layers=e.layers.filter((e=>!i.includes(e))),e.layers.splice(t.order,0,t.target),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.target.id),{type:"merge",kind:t.kind,target:t.target,order:n,layers:s}}case"rasterize":{const s=e.layers.findIndex((e=>e.id===t.newId));if(s<0)return;const[i]=e.layers.splice(s,1,t.layer);return(null===(d=null==e?void 0:e.getSelected())||void 0===d?void 0:d.id)===i.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:i,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const s=e.selection.mask;return t.layer.addMask(),t.layer.mask.getContext("2d").drawImage(e.selection.mask,-t.layer.rect.x,-t.layer.rect.y),t.layer.render(),e.removeSelection(),t.layer.syncRequested=p,{type:"convertSelectionToMask",layer:t.layer,selection:s}}case"convertMaskToSelection":{const s=t.layer.mask;return t.layer.removeMask(),e.addSelection(),e.selection.setMask(t.selection),t.layer.syncRequested=p,{type:"convertMaskToSelection",layer:t.layer,mask:s}}case"applyMask":{const e=t.layer.canvas,s=t.layer.mask;let i=t.layer.rect.clone();return t.layer.render(),t.layer.canvas=t.layer.baked,t.layer.removeMask(),t.layer.shrinkWrap(),t.layer.syncRequested=p,{type:"applyMask",layer:t.layer,canvas:e,mask:s,rect:i}}case"frameContent":{let e,s;return t.layer.canvas&&(e=i.dN(t.layer.canvas),s=null===(u=t.layer.trim)||void 0===u?void 0:u.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer instanceof l.Z&&t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:s}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=p,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=p,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const s=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:s}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=p,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this redo type")}}},5453:(e,t,s)=>{s.d(t,{N:()=>d});var i=s(6548),n=s(3655),a=s(1030),r=s(4820),o=s(3402),h=s(1721),c=s(2209),l=s(2282);class d{constructor(e,t,s=!1){this.fresco=e,this.undoStack=[],this.redoStack=[],this.ignore=!1,this.disable=()=>{this.ignore=!0},this.enable=()=>{this.ignore=!1},this.dispatchHistoryStatus=()=>{document.dispatchEvent(new CustomEvent("history-update",{detail:{atStart:this.undoStack.length<=1,atEnd:0===this.redoStack.length}}))},this.undo=()=>{if(!this.ignore&&0!==this.undoStack.length&&"open"!==this.undoStack[this.undoStack.length-1].data.type)try{this.ignore=!0;const{local:e,data:t}=this.undoStack.pop(),s=(0,o.c)(this.fresco,t);s&&(this.redoStack.push({local:e,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("undo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleUndo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),this.dispatchHistoryStatus()}finally{this.ignore=!1}},this.redo=()=>{if(!this.ignore&&0!==this.redoStack.length)try{this.ignore=!0;const{local:e,data:t}=this.redoStack.pop(),s=(0,h.G)(this.fresco,t);s&&(this.undoStack.push({local:e,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("redo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleRedo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,this.dispatchHistoryStatus()}},this.getActiveTransaction=()=>this.transaction,this.redos=e=>this.redoStack.filter((t=>t.local===e)).reverse().map((e=>e.data)),this.undos=e=>this.undoStack.filter((t=>t.local===e)).map((e=>e.data)),this.add=e=>{if(this.ignore)return;if(!(0,c.g)(this.fresco,e))return;this.validateTransaction(e);const t=r.ZP.maxHistoryUndos;!this.transaction&&this.undoStack.length>=t&&(this.undoStack=this.undoStack.slice(this.undoStack.length+1-t)),this.undoStack.push({local:!!this.transaction,data:e}),this.redoStack=[],this.dispatchHistoryStatus(),"open"!==e.type&&document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),(this.undoStack.length<1||!this.undoStack[this.undoStack.length-1].local)&&document.dispatchEvent(new CustomEvent("layer-list-render"))},this.validateTransaction=e=>{if("arrange"===e.type||"arrangeStack"===e.type||"adjust"===e.type||"glitch"===e.type||"effect"===e.type||"textSettings"===e.type||"frameSettings"===e.type||"shapeSettings"===e.type||"pageAnimation"===e.type||"layerAnimation"===e.type){const t="pageAnimation"===e.type?"page":"arrangeStack"===e.type?e.id:e.layer.id;this.transaction&&this.transaction.id!==e.type+"-"+t&&this.commitTransaction(!0),this.transaction||(this.transaction={id:e.type+"-"+t,type:e.type})}else this.commitTransaction(!0)},this.abortTransaction=()=>{this.transaction&&(this.transaction=void 0,this.redoStack=this.redoStack.filter((e=>!e.local)),this.undoStack=this.undoStack.filter((e=>!e.local)),this.dispatchHistoryStatus())},this.commitTransaction=(e=!1)=>{if(!this.transaction)return;const t=new Date;this.transaction=void 0;const s=this.undoStack.filter((e=>e.local));if(0===s.length)return;this.undoStack=this.undoStack.filter((e=>!e.local)),this.redoStack=[];let i=s[0].data,a=!1;switch(i.type){case"arrange":{const e=i.layer,s=i.action.rect;if(e instanceof l.Z&&e.wouldApplyTransform()){const t=n.dN(e.canvas),i=n.dN(e.mask);e.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:e,action:{type:"trans",data:t,mask:i,rect:s}}})}else this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:e,action:{type:"rect",rect:s}}});e.syncRequested=t,a=!0;break}case"arrangeStack":{let e=i.stack,s=i.rects,o=Array(),h=Array();for(let i=0;i<e.length;i++){let a=e[i],c=s[i];if(a instanceof l.Z&&a.wouldApplyTransform()){const e=n.dN(a.canvas),t=n.dN(a.mask);a.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:a,action:{type:"trans",data:e,mask:t,rect:c}}})}else o.push(a),h.push(c);a.syncRequested=t}o.length>1?this.undoStack.push({local:!1,data:{type:"arrangeStack",id:i.id,kind:"arrange",stack:o,rects:h}}):1===o.length&&this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:o[0],action:{type:"rect",rect:h[0]}}}),a=!0;break}case"glitch":case"effect":case"adjust":break;case"textSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"textSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,a=!0;break}case"frameSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"frameSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,a=!0;break}case"shapeSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"shapeSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,a=!0;break}case"pageAnimation":{const e=i.animation;this.undoStack.push({local:!1,data:{type:"pageAnimation",kind:"",animation:e}}),a=!0;break}case"layerAnimation":{const e=i.layer,s=i.animation;this.undoStack.push({local:!1,data:{type:"layerAnimation",kind:"",layer:e,animation:s}}),e.syncRequested=t,a=!0;break}}a&&!e&&(document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("layer-list-render"))),this.dispatchHistoryStatus()},s?this.ignore=!0:(this.add({type:"open",kind:t}),this.dispatchHistoryStatus())}jump(e){if(!this.ignore&&0!==e)try{if(this.ignore=!0,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!1})),e<0){const t=Math.min(this.undoStack.length,Math.abs(e));for(let e=0;e<t;e++){const{local:e,data:t}=this.undoStack.pop(),s=(0,o.c)(this.fresco,t);s&&this.redoStack.push({local:e,data:s})}t>0&&((0,a.Z)("undo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleUndo")})))}else{const t=Math.min(this.redoStack.length,e);for(let e=0;e<t;e++){const{local:e,data:t}=this.redoStack.pop(),s=(0,h.G)(this.fresco,t);s&&this.undoStack.push({local:e,data:s})}t>0&&((0,a.Z)("redo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleRedo")})))}document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),this.dispatchHistoryStatus()}}}},3402:(e,t,s)=>{s.d(t,{c:()=>d});var i=s(3655),n=s(9872),a=s(6817),r=s(3673),o=s(9679),h=s(8685),c=s(2282),l=s(1294);function d(e,t){var s,d,u,p;const g=new Date;switch(t.type){case"bitmapChange":{if(!e.hasLayer(t.layer))return;const s=t.layer,n=s.rect?s.rect.clone():void 0;let r,o=i.dN(s.mask);if(s.canvas){r=s.canvas.getContext("2d").getImageData(t.patchRect.x,t.patchRect.y,t.patchRect.width,t.patchRect.height)}if(t.patch){const e=t.rect,a=!!s.canvas;s.extendCanvas(e);const r=s.canvas.getContext("2d");if(a&&(t.patchRect.x+=n.x-s.rect.x,t.patchRect.y+=n.y-s.rect.y),r.putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<s.rect.width||t.rect.height<s.rect.height){const n=i.vL(t.rect.width,t.rect.height);n.getContext("2d").drawImage(s.canvas,s.rect.x-t.rect.x,s.rect.y-t.rect.y),t.patchRect.x+=s.rect.x-e.x,t.patchRect.y+=s.rect.y-e.y,s.canvas=n,s.rect=e}}else s.canvas=null,s.rect=new a.Z(0,0,0,0);return t.mask&&(s.mask=t.mask),s.render(),t.layer.syncRequested=g,{type:"bitmapChange",kind:t.kind,layer:s,rect:n,patch:r,patchRect:t.patchRect.clone(),mask:o}}case"bitmapSwitch":{const e=i.dN(t.layer.canvas),s=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=g,{type:"bitmapSwitch",kind:t.kind,layer:t.layer,rect:s,canvas:e}}case"selectionAndBitmapSwitch":{const n=i.dN(t.layer.canvas),a=t.layer.rect.clone();t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=g;const r=i.dN(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask);return e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:r,layer:t.layer,rect:a,canvas:n}}case"addLayer":{const s=e.layerNr(t.layer.id),i=e.deleteLayerById(t.layer.id);return{type:"addLayer",kind:t.kind,layer:i,order:s}}case"deleteLayer":return e.layers.splice(t.index,0,t.layer),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=g,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=g,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=g,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const s=e.color;return e.color=t.color,{type:"background",color:s}}case"mask":{const e=t.layer;let s;const i=e.hasMask();if(!i&&t.patch&&t.layer.addMask(),t.patch){const n=t.patch,a=e.mask.getContext("2d");i&&(s=a.getImageData(t.rect.x,t.rect.y,t.rect.width,t.rect.height)),a.putImageData(n,t.rect.x,t.rect.y)}else{if(i){s=e.mask.getContext("2d").getImageData(0,0,e.mask.width,e.mask.height)}t.layer.removeMask()}return e.render(),t.layer.syncRequested=g,{type:"mask",layer:e,rect:t.patch&&t.rect?t.rect:new a.Z(0,0,e.canvas.width,e.canvas.height),patch:s}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=g,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,s;return t.tool.marked&&(e=t.tool.marked.name,s=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new o.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:s}}case"arrange":switch(t.layer.syncRequested=g,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof l.Z&&t.layer.trimOnResize(e),t.layer instanceof c.Z||t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"rect",rect:e},layer:t.layer}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"trim",rect:e},layer:t.layer}}case"trans":{const e=i.dN(t.layer.canvas),s=i.dN(t.layer.mask),n=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:s,rect:n}}}}case"arrangeStack":{let e=t.stack,s=t.rects,i=new Array;for(let t=0;t<e.length;t++){let n=e[t],a=n.rect?n.rect.clone():void 0;n.rect=s[t],n instanceof h.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),i.push(a),n.syncRequested=g,n.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=g,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=g,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const s=new r.Z(-t.offset.x,-t.offset.y),o=new n.Z(e.width,e.height);let h;if(e.crop(new a.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const s=e.layers[0];h=i.dN(s.canvas),s.syncRequested=g,s.canvas=t.straighten,s.rect=new a.Z(0,0,s.canvas.width,s.canvas.height),e.width=s.rect.width,e.height=s.rect.height}return e.layers.forEach((e=>e.syncRequested=g)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:o,straighten:h}}case"pageSize":{const s=new n.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:s}}case"pageResize":{const s=new n.Z(e.width,e.height),i=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let n=0;n<t.layers.length;n++){const s=t.layers[n];s.syncRequested=g,e.replaceLayer(s),s.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=g)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(!t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=g)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const s=e.selection?i.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:s})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:s}))}case"merge":{const s=e.layers.findIndex((e=>e===t.target));if(s<0)return;const[i]=e.layers.splice(s,1);return t.layers.forEach((s=>{const i=t.order.findIndex((e=>e===s.id));i<0?e.layers.push(s):e.layers.splice(i,0,s)})),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.layers[0].id),{type:"merge",kind:t.kind,target:i,from:t.layers,order:s}}case"rasterize":{const s=e.layers.findIndex((e=>e.id===t.newId));if(s<0)return;const[i]=e.layers.splice(s,1,t.layer);return(null===(d=null==e?void 0:e.getSelected())||void 0===d?void 0:d.id)===i.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:i,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const s=t.layer.mask;return t.layer.removeMask(),t.layer.syncRequested=g,e.addSelection(),e.selection.mask=t.selection,e.selection.ctx=t.selection.getContext("2d"),e.selection.createOutline(),{type:"convertSelectionToMask",layer:t.layer,mask:s}}case"convertMaskToSelection":{const s=e.selection.mask;return e.removeSelection(),t.layer.mask=t.mask,t.layer.render(),t.layer.syncRequested=g,{type:"convertMaskToSelection",layer:t.layer,selection:s}}case"applyMask":return t.layer.canvas=t.canvas,t.layer.mask=t.mask,t.layer.rect=null===(u=t.rect)||void 0===u?void 0:u.clone(),t.layer.render(),t.layer.syncRequested=g,{type:"applyMask",layer:t.layer};case"frameContent":{let e,s;return t.layer.canvas&&(e=i.dN(t.layer.canvas),s=null===(p=t.layer.trim)||void 0===p?void 0:p.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:s}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const s=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:s}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=g,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this undo type")}}},2209:(e,t,s)=>{s.d(t,{g:()=>h});var i=s(1030),n=s(8685),a=s(1294),r=s(7108),o=s(7664);function h(e,t){const s=new Date;switch(t.type){case"open":return(0,i.Z)("open",t.kind),!0;case"addLayer":return(0,i.Z)("layer-add",t.layer.type),!0;case"bitmapSwitch":case"bitmapChange":return(0,i.Z)(t.kind),t.layer.syncRequested=s,!0;case"flipLayer":return(0,i.Z)("layer-flip"),t.layer.syncRequested=s,!0;case"rotateLayer":return(0,i.Z)("layer-rotate"),t.layer.syncRequested=s,!0;case"frameContent":return(0,i.Z)("frame-content"),t.layer.syncRequested=s,!0;case"frameSettings":return!t.layer.frameSettings.equalTo(t.settings)&&((0,i.Z)("frame-settings"),t.layer.syncRequested=s,!0);case"order":return(0,i.Z)("layer-order"),!0;case"layerSettings":return(0,i.Z)("layer-settings",t.kind),t.layer.syncRequested=s,!0;case"deleteLayer":return(0,i.Z)(t.layer.type+"-delete"),!0;case"textChange":return t.layer.text!==t.text&&((0,i.Z)("text-change"),t.layer.syncRequested=s,!0);case"textSettings":return!t.layer.textSettings.equalTo(t.settings)&&((0,i.Z)("text-settings"),t.layer.syncRequested=s,!0);case"shapeSettings":return!t.layer.shapeSettings.equalTo(t.settings)&&((0,i.Z)("shape-settings"),t.layer.syncRequested=s,!0);case"pageAnimation":return e.animation!==t.animation;case"layerAnimation":return t.layer.animation!==t.animation&&(t.layer.syncRequested=s,!0);case"mask":return(0,i.Z)("mask"),t.layer.syncRequested=s,!0;case"crop":return(0,i.Z)("crop"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"background":return(0,i.Z)("background"),!0;case"maskInvert":return(0,i.Z)("mask-invert"),t.layer.syncRequested=s,!0;case"arrange":switch(t.action.type){case"rect":if(t.layer.rect.equalTo(t.action.rect))return!1;break;case"trim":if(t.layer.trim.equalTo(t.action.rect))return!1}return(0,i.Z)("arrange"),!0;case"arrangeStack":{let e=!1;for(let s=0;s<t.stack.length;s++)t.stack[s].rect&&!t.stack[s].rect.equalTo(t.rects[s])&&(e=!0);return(0,i.Z)("arrangeStack"),e}case"pageSize":return(0,i.Z)("page-size"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"pageResize":return(0,i.Z)("page-resize"),t.layers.forEach((e=>e.syncRequested=s)),!0;case"flip":return(0,i.Z)("flip",t.vertical?"vertical":"horizontal"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"rotate":return(0,i.Z)("rotate",t.counterClock?"left":"right"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"merge":return(0,i.Z)("merge-layers",t.kind),!0;case"adjust":return(0,i.Z)("adjust",t.kind),!0;case"effect":return(0,i.Z)("effect",t.name),!0;case"glitch":return(0,i.Z)("glitch",t.kind),!0;case"selectionChange":case"selectionAndBitmapSwitch":return(0,i.Z)("selection",t.kind),!0;case"rasterize":return(0,i.Z)("rasterize",t.layer.type),t.layer instanceof o.Z||(t.layer instanceof n.Z||(t.layer instanceof a.Z||(t.layer instanceof r.Z||(console.warn("Tried to rasterize an unknown layer type"),!1))));case"convertSelectionToMask":return(0,i.Z)("selection-to-mask"),t.layer.syncRequested=s,!0;case"convertMaskToSelection":return(0,i.Z)("mask-to-selection"),t.layer.syncRequested=s,!0;case"applyMask":return(0,i.Z)("apply-mask"),t.layer.syncRequested=s,!0;default:return!1}}},3607:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>C});var n=s(6548),a=s(165),r=s(3655),o=s(1030),h=s(3673),c=s(4820),l=s(5934),d=s(3506),u=s(4375),p=s(8093),g=s(3947),m=s(4652),v=s(6969),f=s(3747),y=s(6854),w=s(2804),b=s(4699),x=s(7976),Z=s(1951),k=s(6995),E=s(9924),P=s(2409),S=e([a]);a=(S.then?(await S)():S)[0];class C{constructor(e,t){var s,i,S,C,T,L,M;if(this.pollNews=async()=>{const e=new Date(c.ZP.lastNewsCheck);this.news=await fetch(`https://pixlr.com/api/news/poll/?product=${c.ZP.product}&from=${e.toISOString()}&limit=10`).then((e=>e.json()));const t=await this.news;!1!==t.status?(t.data.unread>0&&!t.data.pop&&(0,g.ZP)("news-tab").append((0,g.T)("span",{id:"news-count"},t.data.unread.toFixed(0))),t.data.pop&&new m.Z(t.data.news.docs)):console.error(t.message)},this.newsClick=async()=>{var e;(0,o.Z)("news-click");const t=await this.news;!1!==t.status&&t.data.news.docs.length?(null===(e=(0,g.ZP)("news-count"))||void 0===e||e.remove(),new m.Z(t.data.news.docs)):document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("noNews")}))},this.urlClick=e=>{(0,o.Z)("open-url"),new f.Z(this.web.stage)},this.newClick=e=>{(0,o.Z)("open-new"),new v.Z(this.web.stage)},this.openClick=async e=>{(0,o.Z)("open-browse"),await l.Q0("e"===c.ZP.product).then((async e=>{for(let t=0;t<e.length;t++)await l.ZB(this.web.stage,e[t])}))},this.batchClick=async e=>{await l.Q0(!0).then((async e=>{0!==e.length&&this.setBatch(e)}))},this.menuClick=e=>{const t=e.currentTarget.getAttribute("data");t!==this.section&&("news"!==t?this.web.navigate(t):this.newsClick())},this.activate=(e,t=!1)=>{try{this.section&&this.section!==e&&((0,g.ZP)(this.section+"-content").style.display="none",(0,g.ZP)(this.section+"-tab").classList.remove("selected")),this.section=e||"home",(0,g.ZP)(this.section+"-content").style.display="block",(0,g.ZP)(this.section+"-tab").classList.add("selected")}catch(s){this.section="home",(0,g.ZP)(this.section+"-content").style.display="block",(0,g.ZP)(this.section+"-tab").classList.add("selected"),history.replaceState(null,null," ")}switch(this.section){case"home":this.setHome();break;case"history":this.setHistory();break;case"template":this.setTemplate();break;case"search":this.setSearch()}},this.showOrHideBackToEditor=()=>{(0,g.ZP)("editor-tab").style.display=this.web.stage&&this.web.stage.fresco?"block":"none",(0,g.ZP)("editor-open-count").innerHTML=this.web.stage?this.web.stage.tabs.length.toString():"0"},this.setHome=async()=>{if((0,g.ZP)("history-carousel")){this.historyCarousel||(this.historyCarousel=new p.Z("history-carousel")),this.historyCarousel.clearItem();const e=await b.q.history();(0,g.ZP)("home-history").style.display=0===e.length?"none":"block";for(let t=0;t<e.length&&(this.historyCarousel.addItem(this.createHistoryBox(e[t],"home")),!(t>14));t++);}if((0,g.ZP)("template-carousel")&&!this.templateCarousel){const e="e"===c.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a";let t=await w.RH(e,40);if(t&&t.templates){this.templateCarousel=new p.Z("template-carousel");const e=r.Sy(t.templates);for(let t=0;t<e.length&&!(t>20);t++){const s=e[t],i=(0,g.T)("div",{id:s.id,className:"template-box"});s.premium?i.appendChild((0,g.T)("div",{className:"premium"})):i.appendChild((0,g.T)("div",{className:"free"},(0,n.Z)("free"))),i.title=s.name,i.addEventListener("click",(()=>this.previewTemplate(s)),!0);let a=(0,g.T)("img",{src:s.thumbnailSmall});a.height=180,a.width=Math.round(Number(s.ratio.width)/Number(s.ratio.height)*180),a.loading="lazy",a.alt=s.name,i.appendChild(a),this.templateCarousel.addItem(i)}}}},this.previewTemplate=e=>{new k.Z(this.web.stage,e)},this.setHistory=async()=>{const e=(0,g.ZP)("history-latest"),t=(0,g.ZP)("history-pinned");e.innerHTML="",t.innerHTML="";const s=await b.q.history();if(0==s.length)return(0,g.ZP)("history-latest").style.display="none",void((0,g.ZP)("history-no-content").style.display="block");const i=(0,g.ZP)("history-controls"),a=(0,g.ZP)("history-clear"),r=(0,g.ZP)("history-no-content");a.onclick=async()=>{await new x.Z("Confirm",(0,n.Z)("historyClearConfirm"),(0,n.Z)("clear")).init()&&(await b.q.deleteAll(),await this.setHistory(),this.web.stage&&this.web.stage.fresco&&(this.web.stage.close(),(0,g.ZP)("toggle-editor").style.display="none"))},s.forEach((s=>{let i=this.createHistoryBox(s,"hist");s.pinned?t.appendChild(i):e.appendChild(i)})),e.children.length>0?(e.style.display="flex",i.style.display="block",r.style.display="none"):(e.style.display="none",i.style.display="none",r.style.display="block"),t.children.length>0?((0,g.ZP)("history-pinned-divider").style.display="block",t.style.display="flex"):((0,g.ZP)("history-pinned-divider").style.display="none",t.style.display="none")},this.createHistoryBox=(e,t)=>{const s=this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id)),i=s&&e.id===this.web.stage.fresco.id;let a=document.createElement("div");a.id=t+"-"+e.id,a.classList.add("image-box");let o,c=(0,g.T)("div",{className:"holder"});a.appendChild(c),s&&(a.classList.add("selected"),a.appendChild((0,g.T)("label",{id:"active-image"},i?"active":"open"))),e.getThumbnail().then((t=>{t&&(o=t,t.alt=e.name,t.width=Math.round(t.width*(180/t.height)),t.height=180,c.appendChild(t))}));const l=async s=>{null==s||s.preventDefault(),null==s||s.stopPropagation(),await b.q.duplicate(e.id),"home"===t?this.setHome():this.setHistory()},d=async n=>{var a;null==n||n.preventDefault(),null==n||n.stopPropagation(),await e.remove(),s&&this.web.tabClose(e.id),i&&this.showOrHideBackToEditor(),null===(a=(0,g.ZP)(t+"-"+e.id))||void 0===a||a.remove()},u=(0,g.T)("div",{className:"top"});a.appendChild(u);const p=document.createElement("img");p.classList.add("close"),p.src="/img/icon/close.svg",p.title=`${(0,n.Z)("historyDelete")} ${e.name}`,p.alt=p.title,p.addEventListener("click",d),u.appendChild(p);const m=async s=>{null==s||s.preventDefault(),null==s||s.stopPropagation(),await(e.pinned?e.unpin():e.pin()),"home"===t?this.setHome():this.setHistory()},v=document.createElement("img");v.classList.add("pin"),v.src=e.pinned?"/img/icon/unpin.svg":"/img/icon/pin.svg",v.title=e.pinned?`${(0,n.Z)("historyUnpin")} ${e.name}`:`${(0,n.Z)("historyPin")} ${e.name}`,v.alt=v.title,v.addEventListener("click",m),u.appendChild(v);const f=document.createElement("img");f.classList.add("more"),f.src="/img/icon/three-dot.svg",f.title=(0,n.Z)("documentActions"),f.alt=(0,n.Z)("documentActions"),f.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const s=t.currentTarget.getBoundingClientRect();new E.C(new h.Z(s.x+(0,g.ZP)("home").scrollLeft+10,s.y+(0,g.ZP)("home").scrollTop+10),[new E.Z(e.pinned?(0,n.Z)("historyUnpin"):(0,n.Z)("historyPin"),m),new E.Z((0,n.Z)("historyDuplicate"),l),new E.Z,new E.Z((0,n.Z)("historyDelete"),d)])})),u.appendChild(f);let y=document.createElement("input");y.value=e.name.toLowerCase(),y.className="name",y.addEventListener("click",(e=>(e.stopPropagation(),!1))),y.addEventListener("keyup",r.d4(500,(()=>{e.name=y.value,e.save()}))),a.appendChild(y);let w=document.createElement("span");return w.innerText=r.ly(e.lastModified),w.className="since",a.appendChild(w),a.addEventListener("click",(()=>{this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id))?(this.web.navigate("editor"),this.web.tabSelect(e.id)):this.web.stage.openFromHistory(e,o).catch((e=>{alert("Error restoring document"),console.error(e)}))}),!1),a},this.setTemplate=async()=>{this.categoryCarousel||(this.categoryCarousel=new p.Z("category-carousel")),await this.getTemplates(!0),window.onhashchange=()=>{this.getTemplates(!1)}},this.getTemplates=async e=>{var t,s,i;(0,g.ZP)("template-more").style.display="none",(0,g.ZP)("template-loading").style.display="block";var a=window.location.hash.substr(1).split("&").reduce(((e,t)=>{var s=t.split("=");return e[s[0]]=s[1],e}),{});if(this.category&&(null===(t=(0,g.ZP)(this.category))||void 0===t||t.classList.remove("selected")),!a.page||e){let e=(0,g.ZP)("template-holder");e.innerHTML="",e.classList.value="template-holder",a.category&&e.classList.add(a.category)}if(a.keyword||a.category){let e={limit:50};e.page=Number(null!==(s=a.page)&&void 0!==s?s:1),a.category&&(e.category=a.category),a.keyword&&(e.keywords=a.keyword),a.sort&&(e.sort=a.sort),e.category?((0,g.ZP)("template-holder-title").innerHTML=(0,n.Z)(e.category),null===(i=(0,g.ZP)(e.category))||void 0===i||i.classList.add("selected"),this.category=e.category,"facebook-post"!==e.category&&"instagram-post"!==e.category||(e.category="social-media-post"),"facebook-story"!==e.category&&"instagram-story"!==e.category||(e.category="social-media-story")):(0,g.ZP)("template-holder-title").innerHTML=(0,n.Z)("keyword")+": "+e.keywords;const t=await w.Qz(e);if(t.page!==t.pages){const t=(0,g.ZP)("template-more");t.style.display="block",t.onclick=async()=>{let t="#template";a.category&&(t+="&category="+a.category),a.keyword&&(t+="&keyword="+a.keyword),a.sort&&(t+="&sort="+a.sort),t+="&page="+(e.page+1),window.location.hash=t,(0,g.ZP)("home").scrollBy(0,220)}}await this.renderTemplateResult(t.templates)}else{(0,g.ZP)("template-holder-title").innerHTML=(0,n.Z)("recommended"),(0,g.ZP)("curated").classList.add("selected"),this.category="curated";const e="e"===c.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a",t=await w.RH(e,50);await this.renderTemplateResult(t.templates)}},this.renderTemplateResult=async e=>{if(!e||0===e.length)return;let t=(0,g.ZP)("template-holder");e.forEach((e=>{const s=(0,g.T)("div",{id:e.id,className:"template-box large"});e.premium?s.appendChild((0,g.T)("div",{className:"premium"})):s.appendChild((0,g.T)("div",{className:"free"},(0,n.Z)("free"))),s.title=e.name,s.addEventListener("click",(()=>this.previewTemplate(e)),!0);let i=(0,g.T)("img",{src:e.thumbnailMedium});i.height=300,i.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*300),i.loading="lazy",i.alt=e.name,s.appendChild(i),t.append(s)})),(0,g.ZP)("template-loading").style.display="none"},this.setSearch=async()=>{const e=(0,g.ZP)("search-content-result"),t=(0,g.ZP)("search-input");t.value=d.ZP.randomDefault(),t.focus(),t.onkeyup=s=>{switch(s.key){case"Down":case"ArrowDown":case"Up":case"ArrowUp":case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Meta":return}let i=t.value;i.length<=2||(e.innerHTML="",(0,g.ZP)("search-more").style.display="none",(0,g.ZP)("search-loading").style.display="block",(0,g.ZP)("search-error").style.display="none",(0,g.ZP)("search-offline").style.display="none",r.Ds("search-input",800,(()=>{this.doSearch(i,e)})))},(0,g.ZP)("search-loading").style.display="block",(0,g.ZP)("search-error").style.display="none",(0,g.ZP)("search-offline").style.display="none",this.doSearch(t.value,e)},this.doSearch=async(e,t)=>{t.innerHTML="",(0,g.ZP)("search-more").style.display="none";try{const s=await d.ZP.queryAll(e);this.renderResult(s,t)}catch(s){(0,g.ZP)("search-loading").style.display="none",window.navigator.onLine?(0,g.ZP)("search-error").style.display="block":(0,g.ZP)("search-offline").style.display="block"}},this.renderResult=(e,t)=>{e.items.forEach((e=>{let s=document.createElement("div");s.classList.add("box");let i=document.createElement("img");if(i.src=e.thumbnail,i.title=e.description,s.appendChild(i),e.credits){let t=document.createElement("a");t.className="meta",t.target="_blank",t.innerText=e.credits.name,t.title=`${e.credits.name} on ${e.source}`,t.href=e.credits.profile,s.appendChild(t)}s.onclick=()=>this.searchOpen(e),t.appendChild(s)}));const s=(0,g.ZP)("search-more");s.style.display=e.nextPage&&e.items.length>0?"block":"none",(0,g.ZP)("search-loading").style.display="none",(0,g.ZP)("search-no-result").style.display=0===e.items.length?"block":"none",s.onclick=async()=>{const s=await e.nextPage();this.renderResult(s,t)}},this.searchOpen=async e=>{(0,o.Z)("open-stock");const t=new u.Z(this.web.stage,{title:e.id,referrer:e.source}),s=await e.downloadUrl();let i=await t.load(s);l.ZB(this.web.stage,i)},this.setBatch=e=>{(0,o.Z)("open-batch"),history.pushState(null,null,"#batch"),(0,g.ZP)("menu-section").style.display="none",(0,g.ZP)("home-section").style.display="none",this.web.stage&&this.web.stage.fresco&&(this.web.stage.closeAll(),this.showOrHideBackToEditor()),new a.Z(this,e)},this.closeBatch=()=>{(0,g.ZP)("menu-section").style.display="block",(0,g.ZP)("home-section").style.display="block",this.web.navigate("home")},this.web=e,this.section="home",(0,g.ZP)("login")){(0,g.ZP)("login").addEventListener("click",(()=>{new y.k}));"true"===new URLSearchParams(window.location.search).get("showAgreements")&&new y.k("socialAgreements")}if((0,g.ZP)("try-premium")){const e=(0,g.ZP)("try-premium");e.removeAttribute("href"),e.addEventListener("click",(()=>{new Z.Z(this.web.stage,"HOME")}))}null===(s=(0,g.ZP)("welcome-open-image"))||void 0===s||s.addEventListener("mousedown",this.openClick,!0),null===(i=(0,g.ZP)("home-open-image"))||void 0===i||i.addEventListener("mousedown",this.openClick,!0),null===(S=(0,g.ZP)("home-open-new"))||void 0===S||S.addEventListener("mousedown",this.newClick,!0),null===(C=(0,g.ZP)("home-open-url"))||void 0===C||C.addEventListener("mousedown",this.urlClick,!0),null===(T=(0,g.ZP)("home-open-batch"))||void 0===T||T.addEventListener("mousedown",this.batchClick,!0);let A=(0,g.ZP)("home-menu").getElementsByTagName("li");for(var I=0;I<A.length;I++)A[I].addEventListener("click",this.menuClick,!1);null===(L=(0,g.ZP)("mobile-ignore"))||void 0===L||L.addEventListener("click",(()=>{(0,g.ZP)("mobile-variant").remove()}),!0),(0,g.ZP)("history-view-all").addEventListener("click",(()=>this.web.navigate("history",!0)),!0),null===(M=(0,g.ZP)("recommended-view-more"))||void 0===M||M.addEventListener("click",(()=>this.web.navigate("template",!0)),!0),this.pollNews(),this.activate(t,!0),"getDigitalGoodsService"in window&&(0,P.ZF)()}}i()}catch(C){i(C)}}))},6548:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3947);let n=(0,i.ZP)("config_i18n")&&""!==(0,i.ZP)("config_i18n").innerText?JSON.parse((0,i.ZP)("config_i18n").innerText):"";function a(e,...t){let s=n[e];if(s||(console.log("No translation for key",e),s=e),!t||0===t.length)return s;let i=0;return s.replace(/%(\d+\$)?(s|d|f){1}/gm,((e,...s)=>{const[n,a]=s,r=n?parseInt(n.slice(0,-1),10):i++;switch(a){case"d":const s=t[r];return"number"!=typeof s?"NaN":s.toFixed(0);case"s":const i=t[r];return i?i.toString():e;default:return e}}))}},2257:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),n=s(3655),a=s(8776),r=s(3673),o=s(972);class h{constructor(e){this.getSettingsString=()=>JSON.stringify(this.settings),this.setSettingsString=e=>{this.settings=n.mS(o.Z,JSON.parse(e)),this.generate()},this.getStep=()=>Math.round(this.settings.distance*this.settings.size),this.getCursorImage=(e,t=new a.Z(255,255,255,255))=>{if(!(this.canvas.width*e>512||this.canvas.height*e>512))return this.generatetOutline(e,t)},this.generateBasic=(e,t)=>{let s=this.settings.softness;if(this.settings.size<3){if(1===this.settings.size||s<.25)return this.canvas.width=this.settings.size,this.canvas.height=this.settings.size,this.context.fillStyle=e.toRGBA(),void this.context.fillRect(0,0,this.canvas.width,this.canvas.height);s-=.25}const i=this.settings.size,n=(i%2?i:i+1)/2;let a,o,h,c,l,d,u,p,g,m=0,v=0,f=new r.Z(0,0),y=new r.Z(0,0);switch(d=Math.sin(this.settings.angle*Math.PI/180),l=Math.cos(this.settings.angle*Math.PI/180),g=n*this.settings.aspect,f.x=l*n,f.y=d*n*-1,y.x=d*g,y.y=l*g,this.settings.type){case"circle":m=Math.ceil(Math.sqrt(f.x*f.x+y.x*y.x)),v=Math.ceil(Math.sqrt(f.y*f.y+y.y*y.y));break;case"square":m=Math.ceil(Math.abs(f.x)+Math.abs(y.x)),v=Math.ceil(Math.abs(f.y)+Math.abs(y.y));break;case"diamond":m=Math.ceil(Math.max(Math.abs(f.x),Math.abs(y.x))),v=Math.ceil(Math.max(Math.abs(f.y),Math.abs(y.y)))}this.settings.spikes>2&&(m=v=Math.ceil(Math.sqrt(n*n+g*g)),y.x=d*n,y.y=l*n),this.canvas.width=2*m+1,this.canvas.height=2*v+1;const w=this.lookupTable(n,s);u=Math.cos(-2*Math.PI/this.settings.spikes),p=Math.sin(-2*Math.PI/this.settings.spikes);const b=this.context.canvas.width,x=this.context.getImageData(0,0,b,this.context.canvas.height);for(h=-v;h<=v;++h)for(o=-m;o<=m;++o){let s=0,i=l*o-d*h,r=Math.abs(d*o+l*h);if(this.settings.spikes>2){let e,t,s=Math.atan2(r,i);for(;s>Math.PI/this.settings.spikes;)t=i,e=r,i=u*t-p*e,r=p*t+u*e,s-=2*Math.PI/this.settings.spikes}switch(r/=this.settings.aspect,this.settings.type){case"circle":s=Math.sqrt(i*i+r*r);break;case"square":s=Math.max(Math.abs(i),Math.abs(r));break;case"diamond":s=Math.abs(i)+Math.abs(r)}a=s<n+1?w[Math.floor(4*s)]:0,t&&(a=a<64?0:255),c=4*((h+v)*b+(o+m)),x.data[c]=e.r,x.data[c+1]=e.g,x.data[c+2]=e.b,x.data[c+3]=a}this.context.putImageData(x,0,0)},this.generateCustom=(e,t)=>{},this.canvas=(0,i.T)("canvas"),this.settings=e,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.generate()}generate(e=new a.Z,t=!1){"custom"===this.settings.type?this.generateCustom(e,t):this.generateBasic(e,t)}generatetOutline(e=1,t=new a.Z(255,255,255,255)){const s=Math.round(this.canvas.width*e)||1,i=Math.round(this.canvas.height*e)||1;let r=n.vL(s+2,i+2);const o=r.getContext("2d");o.fillStyle=t.toRGBA(),o.shadowColor=new a.Z(0,0,0).toRGBA(),o.shadowBlur=1,s>20&&i>20&&(o.fillRect(~~(s/2)-3,~~(i/2),8,2),o.fillRect(~~(s/2),~~(i/2)-3,2,8));let h,c,l,d,u,p=1!=e?n.eY(this.canvas,s,i,!1).getContext("2d").getImageData(0,0,s,i):this.context.getImageData(0,0,s,i);for(let n=0;n<i;++n){c=!0,l=Boolean(p.data[n*s*4+3]<64);for(let e=0;e<s;++e)h=c,c=l,l=e+1===s||p.data[4*(n*s+e+1)+3]<64,c||(d=n-1<0||p.data[4*((n-1)*s+e)+3]<64,u=n+1===i||p.data[4*((n+1)*s+e)+3]<64,(h||d||l||u)&&o.fillRect(e+1,n+1,1,1))}if(s<=20&&i<=20){const e=n.vL(33,33),s=e.getContext("2d");s.drawImage(r,Math.floor((33-r.width)/2),Math.floor((33-r.height)/2)),s.fillStyle=t.toRGBA(),s.shadowColor=new a.Z(0,0,0).toRGBA(),s.shadowBlur=1,s.fillRect(2,15,4,2),s.fillRect(26,15,4,2),s.fillRect(15,2,2,4),s.fillRect(15,26,2,4),r=e}return r}lookupTable(e,t){const s=new Array;let i,n,a=0;const r=new Array(4),o=Math.round(e+1),h=4*Math.ceil(1+Math.sqrt(o*o*2));let c;for(n=t<4e-7?1e6:.4/t,c=0;c<4;c++)i=Math.abs((c+.5)/4-.5),r[c]=i>e?0:this.gaussian(Math.pow(i/e,n)),a+=r[c];for(c=0;i<e||a>1e-5;i+=1/4){a-=r[c%4],r[c%4]=i>e?0:this.gaussian(Math.pow(i/e,n)),a+=r[c%4];let t=Math.floor(63.75*a);s[c++]=Math.max(0,t)}for(;c<h;)s[c++]=0;return s}gaussian(e){return e<-.5?2*(e=-1-e)*e:e<.5?1-2*e*e:2*(e=1-e)*e}}},972:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e="circle",t=40,s=.2,i=1,n=0,a=1,r=2,o=.2,h){this.type=e,this.size=t,this.softness=s,this.opacity=i,this.angle=n,this.aspect=a,this.spikes=r,this.distance=o,this.source=h}}i.isEqual=(e,t)=>!(!e||!t)&&(e.type===t.type&&e.size===t.size&&e.softness===t.softness&&e.angle===t.angle&&e.aspect===t.aspect&&e.spikes===t.spikes&&e.source===t.source)},1662:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=255,s=0,i=255,n=1,a=.5){this.minin=e,this.maxin=t,this.minout=s,this.maxout=i,this.midin=n,this.mid=a,this.map=e=>(e=(e-this.minin)/(this.maxin-this.minin),e=Math.pow(e,this.midin),(e=this.minout+e*(this.maxout-this.minout))>this.maxout?e=this.maxout:e<this.minout&&(e=this.minout),Math.round(e))}reset(){this.minout=0,this.maxout=255,this.midin=1,this.minin=0,this.maxin=255,this.mid=.5}isFlat(){return Boolean(0==this.minout&&255==this.maxout&&.5==this.mid&&0==this.minin&&255==this.maxin)}setMid(e){this.mid=(e-this.minin)/(this.maxin-this.minin),this.midin=this.midToIn(this.mid)}midToIn(e){return Math.min(Math.max(Math.pow(9.99,2*e-1),.1),9.99)}static fillPaletteMap(e,t){for(let s=0;s<256;++s){let i=e.map(s);t.data[4*s]=i,t.data[4*s+1]=i,t.data[4*s+2]=i}}static fillRGBPaletteMap(e,t,s,i){for(let n=0;n<256;++n)i.data[4*n]=e?e.map(n):n,i.data[4*n+1]=t?t.map(n):n,i.data[4*n+2]=s?s.map(n):n}}},2468:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t){var s,i,n,a,r,o,h,c,l,d,u,p,g;if(null!=e&&null!=t){for(c=e.length-1,a=[],u=[],h=[],d=[],p=[],i=[],s=[],n=[],o=[],l=[],r=0;0<=c?r<c:r>c;0<=c?r+=1:r-=1)a[r]=e[r+1]-e[r],o[r]=t[r+1]-t[r],l[r]=o[r]/a[r];for(r=1;1<=c?r<c:r>c;1<=c?r+=1:r-=1)u[r]=3/a[r]*(t[r+1]-t[r])-3/a[r-1]*(t[r]-t[r-1]);for(h[0]=1,d[0]=0,p[0]=0,r=1;1<=c?r<c:r>c;1<=c?r+=1:r-=1)h[r]=2*(e[r+1]-e[r-1])-a[r-1]*d[r-1],d[r]=a[r]/h[r],p[r]=(u[r]-a[r-1]*p[r-1])/h[r];for(h[c]=1,p[c]=0,i[c]=0,r=g=c-1;g<=0?r<=0:r>=0;g<=0?r+=1:r-=1)i[r]=p[r]-d[r]*i[r+1],s[r]=(t[r+1]-t[r])/a[r]-a[r]*(i[r+1]+2*i[r])/3,n[r]=(i[r+1]-i[r])/(3*a[r]);this.x=e.slice(0,c+1),this.a=t.slice(0,c),this.b=s,this.c=i.slice(0,c),this.d=n}}interpolate(e){var t,s,i;for(s=i=this.x.length-1;(i<=0?s<=0:s>=0)&&!(this.x[s]<=e);i<=0?s+=1:s-=1);return t=e-this.x[s],this.a[s]+this.b[s]*t+this.c[s]*Math.pow(t,2)+this.d[s]*Math.pow(t,3)}}},134:(e,t,s)=>{s.d(t,{Z:()=>r,z:()=>a});var i=s(3673),n=s(2468);class a{constructor(e){this.preset=e}static createCurveSet(e){const t=new Array,s=new Array,n=new Array,a=new Array;for(let r=0;r<e.preset[0].length;r+=2)t.push(new i.Z(e.preset[0][r],e.preset[0][r+1]));for(let r=0;r<e.preset[1].length;r+=2)s.push(new i.Z(e.preset[1][r],e.preset[1][r+1]));for(let r=0;r<e.preset[2].length;r+=2)n.push(new i.Z(e.preset[2][r],e.preset[2][r+1]));for(let r=0;r<e.preset[3].length;r+=2)a.push(new i.Z(e.preset[3][r],e.preset[3][r+1]));return new r(1,t,s,n,a)}}class r{constructor(e=255,t=[],s=[],i=[],n=[]){this.scale=e,this.rgb=t,this.red=s,this.green=i,this.blue=n,this.percent=1}static getInterpolation(e,t){let s=[],i=[],a=new Float32Array(256);for(var r=0;r<t.length;r++)s.push(t[r].x*e),i.push(t[r].y*e);let o=new n.Z(s,i);for(var h=0;h<Math.ceil(s[0]);h++)a[h]=i[0];for(h=Math.ceil(s[0]);h<Math.ceil(s[s.length-1]);h++)a[h]=o.interpolate(h);for(h=Math.ceil(s[s.length-1]);h<256;h++)a[h]=i[i.length-1];return a}static fillPaletteMap(e,t){let s=r.getInterpolation(e.scale,e.rgb),i=r.getInterpolation(e.scale,e.red),n=r.getInterpolation(e.scale,e.green),a=r.getInterpolation(e.scale,e.blue);for(let r=0;r<256;++r){let o=r-s[r];t.data[4*r]=r-Math.round((r-(i[r]-o))*e.percent),t.data[4*r+1]=r-Math.round((r-(n[r]-o))*e.percent),t.data[4*r+2]=r-Math.round((r-(a[r]-o))*e.percent)}}}},4084:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s){this.color=e,this.blend=t,this.amount=s}}},2817:(e,t,s)=>{s.d(t,{Z:()=>y});var i=s(3947),n=s(6548),a=s(3655),r=s(9872),o=s(6817),h=s(3646),c=s(3673),l=s(4820),d=s(4170),u=s(1726),p=s(8685),g=s(1294),m=s(7108),v=s(2282),f=s(9924);class y{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e)},this.addListener=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1),this.raster.addEventListener("dblclick",this.dblClick,!1),this.raster.addEventListener("contextmenu",this.contextMenu,!0),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1)},this.removeListener=()=>{this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1),this.raster.removeEventListener("contextmenu",this.contextMenu,!0),document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isShiftDown=e.shiftKey,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.shiftKey||e.ctrlKey,e.altKey,e.ctrlKey,e.pointerType))},this.pointerMove=e=>{e.stopPropagation(),this.isShiftDown=e.shiftKey,this.pointers.length<2&&this.move(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.pointerUp=e=>{e.stopPropagation(),this.removePointer(e.pointerId),this.up(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.supress=e=>{e&&!this.supressed?(this.raster.style.cursor="unset",this.supressed=!0,this.removeListener()):!e&&this.supressed&&(this.supressed=!1,this.addListener())},this.keyDown=e=>{if("INPUT"!==document.activeElement.nodeName&&"TEXTAREA"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName&&("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)){let t=e.shiftKey?10:1,s="ArrowLeft"===e.key||"ArrowRight"===e.key?"ArrowLeft"===e.key?-t:t:0,i="ArrowUp"===e.key||"ArrowDown"===e.key?"ArrowUp"===e.key?-t:t:0;this.step(s,i)}},this.keyUp=e=>{},this.contextMenu=e=>{if(e.preventDefault(),e.stopPropagation(),"SIMPLE"===this.mode)return;const t=new c.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop),s=this.getLayerAt(t);if(!s)return;const i=new Array;s.type===d.Z.TYPE_TEXT&&i.push(new f.Z((0,n.Z)("titleEditText"),(()=>this.dblClick())),new f.Z((0,n.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new f.Z),s.type!==d.Z.TYPE_SHAPE&&s.type!==d.Z.TYPE_ELEMENT||i.push(new f.Z((0,n.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new f.Z),s.type===d.Z.TYPE_FRAME&&i.push(new f.Z(s.canvas?(0,n.Z)("titleChangeImage"):(0,n.Z)("titleAddImage"),(()=>this.stage.browseFrameImage())),new f.Z(s.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),s.canvas?this.dblClick:void 0),new f.Z((0,n.Z)("titleAutoFitContent"),s.canvas?()=>this.stage.fitFrameContent():void 0),new f.Z((0,n.Z)("titleRasterizeLayer"),s.canvas?()=>this.stage.rasterize():void 0),new f.Z((0,n.Z)("titleRemoveFrameImage"),s.canvas?()=>this.stage.deleteLayer(!0):void 0),new f.Z),i.push(new f.Z((0,n.Z)("titleHideLayer"),(()=>this.stage.changeVisible(s,!1))),new f.Z((0,n.Z)("titleLockLayer"),(()=>this.stage.changeLocked(s,!0))),new f.Z,new f.Z((0,n.Z)("titleCutLayer"),(()=>this.stage.cutLayer())),new f.Z((0,n.Z)("titleCopyLayer"),(()=>this.stage.copyLayer())),new f.Z((0,n.Z)("titlePasteLayer"),Array.isArray(this.stage.clipboard)?()=>this.stage.pasteLayer():void 0),new f.Z((0,n.Z)("titleDuplicateLayer"),(()=>this.stage.duplicateLayer())),new f.Z((0,n.Z)("titleDeleteLayer"),(()=>this.stage.deleteLayer()),"DEL")),s instanceof v.Z&&s.hasMask()&&i.push(new f.Z,new f.Z((0,n.Z)("titleLayerApplyMask"),(()=>this.stage.maskApply())),new f.Z((0,n.Z)("titleLayerDeleteMask"),(()=>this.stage.maskDelete())));const a=this.getLayersAt(t);if(a.length>1){const e=new Array;a.forEach((t=>{e.push(new f.Z(t.settings.name,(()=>this.stage.selectLayerById(t.id))))})),i.push(new f.Z,new f.Z((0,n.Z)("titleSelectLayer"),void 0,void 0,void 0,e))}new f.C(new c.Z(e.clientX,e.clientY),i)},this.setMode=e=>{this.mode=e,"ARRANGE"===this.mode||"SIMPLE"===this.mode?this.defaultCursor="unset":"TEXT"===this.mode?this.defaultCursor="text":this.defaultCursor="crosshair",this.render()},this.down=async(e,t,s,i,n)=>{if("INPUT"===document.activeElement.nodeName&&"radio"!==document.activeElement.getAttribute("type")||"SELECT"===document.activeElement.nodeName)return;"mouse"!==n&&this.move(e,n),this.isDown=!0,this.layerOver=void 0,this.downPoint=this.stage.translateRasterToFresco(e,void 0,!1);let a=this.stage.fresco.getSelectedStack();const r=a.length>1||1===a.length&&("TEXT"===this.mode&&a[0].type===d.Z.TYPE_TEXT||"FRAME"===this.mode&&a[0].type===d.Z.TYPE_FRAME||"SHAPE"===this.mode&&a[0].type===d.Z.TYPE_SHAPE);if(!this.isControl(a,e)&&l.ZP.autoSelect){let s=this.getLayerAt(e);!this.stage.fresco.isSelectedById(null==s?void 0:s.id)||i?(this.stage.selectLayer(s,t,i,!0),a=this.stage.fresco.getSelectedStack(),this.method="move"):window.requestAnimationFrame(this.render)}if(a.length>0){s&&(await this.stage.duplicateLayer(!1),a=this.stage.fresco.getSelectedStack());let e=1===a.length;if(!e||this.shouldReformLayer(a[0])){let t,s;if(e&&a[0].editMode&&a[0]instanceof g.Z?(this.anchorAlt=this.getAnchor(a[0].trim,a[0].trim.center(),0),this.downRect=[a[0].trim.clone()]):this.downRect=this.stage.fresco.getSelectedStackRect(),e?(s=a[0].rect.center(),t=a[0].editMode?a[0].trim:a[0].rect,t.rotation=a[0].rect.rotation):(a.forEach((e=>{e.rect&&(t=o.Z.merge(t,e.rect.getRotatedBounds()))})),s=t?t.center():void 0),"rotate"===this.method)this.raster.style.cursor="grabbing",this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-s.y,this.downPoint.x-s.x)-t.rotation;else if("move"!==this.method){let e,i;switch(this.method){case"nw-resize":i=t.topLeft(),e=t.bottomRight();break;case"n-resize":i=new c.Z(s.x,t.y),e=new c.Z(s.x,t.bottom());break;case"ne-resize":i=t.topRight(),e=t.bottomLeft();break;case"e-resize":i=new c.Z(t.right(),s.y),e=new c.Z(t.x,s.y);break;case"se-resize":i=t.bottomRight(),e=t.topLeft();break;case"s-resize":case"t-resize":i=new c.Z(s.x,t.bottom()),e=new c.Z(s.x,t.y);break;case"sw-resize":i=t.bottomLeft(),e=t.topRight();break;case"w-resize":i=new c.Z(t.x,s.y),e=new c.Z(t.right(),s.y)}this.downControl=this.rotatePoint(i,s,360-t.rotation),this.downAnchor=this.rotatePoint(e,s,360-t.rotation)}else this.downControl=t.topLeft()}}this.proxy&&(0===a.length||1===a.length&&!this.shouldReformLayer(a[0]))?this.proxy(e,r):(0===a.length||1===a.length&&a[0].settings.locked)&&(this.downPoint=e,this.method="select")},this.move=(e,t)=>{if(this.stage.fresco)if(this.isDown)this.stage.fresco.isSelectedStack()&&this.downRect.length>0?this.moveStack(e):this.stage.fresco.hasSelected()&&this.downRect.length>0?this.moveSingle(e):"select"===this.method&&(this.stage.coating.ctx.lineWidth=2,this.stage.coating.ctx.strokeStyle=a.xZ,this.stage.coating.ctx.clearRect(0,0,this.stage.coating.ctx.canvas.width,this.stage.coating.ctx.canvas.height),this.stage.coating.ctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y));else{if("INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName)return void(this.raster.style.cursor="unset");let t=this.stage.fresco.getSelectedStack();if(this.isControl(t,e))this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render));else if(l.ZP.autoSelect){let t=this.getLayerAt(e);if(this.layerOver&&this.layerOver===t)return;this.raster.style.cursor=this.method=t?"move":"ARRANGE"===this.mode||"SIMPLE"===this.mode?"unset":this.defaultCursor,t&&!this.stage.fresco.isSelectedById(t.id)?(this.layerOver=t,window.requestAnimationFrame(this.render)):this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render))}else 1!==t.length||t[0].settings.locked?this.raster.style.cursor=this.method=this.defaultCursor:this.raster.style.cursor=this.method="move"}},this.moveSingle=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),s=this.stage.fresco.getSelected();if(this.shouldReformLayer(s)){if("move"===this.method){if(s instanceof g.Z)if(s.editMode&&s.trim){const e=this.rotatePoint(t,s.rect.center(),s.rect.rotation),i=this.rotatePoint(this.downPoint,s.rect.center(),s.rect.rotation);s.position(Math.round(this.downControl.x+(e.x-i.x)),Math.round(this.downControl.y+(e.y-i.y)))}else s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)));else{if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)))}this.checkMoveGuides()}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),s.position(void 0,Math.round(this.downControl.y+(t.y-this.downPoint.y))),this.checkMoveGuides();else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),void 0),this.checkMoveGuides();else if("rotate"===this.method){const e=s.rect.center();let i=180/Math.PI*Math.atan2(t.y-e.y,t.x-e.x)-this.downRotation;this.isShiftDown&&(i=11.25*Math.round(i/11.25)),i<0?i+=360:i>=360&&(i-=360),s.rect.rotation=i}else{let e=t.neg(this.downPoint),i=this.downAnchor,n=this.downControl.add(e);if(n=this.checkReformGuides(n),0!==s.rect.rotation){const e=new c.Z((i.x+n.x)/2,(i.y+n.y)/2);n=this.rotatePoint(n,e,s.rect.rotation),i=this.rotatePoint(i,e,s.rect.rotation)}let a=(void 0!==this.constrain?this.constrain:!this.isShiftDown)?this.downRect[0].getAspect():0;switch(this.method){case"nw-resize":s.calculate(n,i,a);break;case"ne-resize":s.calculate(new c.Z(i.x,n.y),new c.Z(n.x,i.y),a);break;case"sw-resize":s.calculate(new c.Z(n.x,i.y),new c.Z(i.x,n.y),a);break;case"se-resize":s.calculate(i,n,a);break;case"w-resize":s.calculate(n,i,a),s.render(!0);break;case"e-resize":s.calculate(i,n,a),s.render(!0);break;case"t-resize":let e=n.y-i.y;s.rect.height=Math.round(e),s.rect.width=Math.round(this.downRect[0].width*(e/this.downRect[0].height)),s.resetBaked()}if(s.editMode&&s instanceof g.Z){let e=this.anchorAlt.neg(this.getAnchor(s.trim,s.trim.center(),0));s.trim.x=Math.round(s.trim.x+e.x),s.trim.y=Math.round(s.trim.y+e.y),s.render()}else{let e=this.downAnchor.neg(this.getAnchor(s.rect,s.rect.center(),s.rect.rotation));s.rect.x=Math.round(s.rect.x+e.x),s.rect.y=Math.round(s.rect.y+e.y)}"move"!==this.method&&s instanceof m.Z&&s.render(!0),"move"!==this.method&&s instanceof g.Z&&s.update()}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))}},this.moveStack=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),s=this.stage.fresco.getSelectedStack();if("move"===this.method){if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("vertical"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(void 0,Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("horizontal"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),void 0);this.checkMoveGuides()}else{let e=t.neg(this.downPoint),i=this.downControl.add(e);i=this.checkReformGuides(i);let n=o.Z.calculate(this.downAnchor,this.downControl),a=o.Z.calculate(this.downAnchor,i,n.getAspect());a.width<4&&(a.width=4);let r=a.getComparedScale(n),h=this.downAnchor.neg(this.getAnchor(a,a.center(),0));a.x+=h.x,a.y+=h.y;for(let t=0;t<s.length;t++){let e=this.downRect[t];e&&(s[t].rect.x=Math.round(a.x+(e.x-n.x)*r.width),s[t].rect.y=Math.round(a.y+(e.y-n.y)*r.height),s[t].rect.width=Math.round(e.width*r.width),s[t].rect.height=Math.round(e.height*r.height)),s[t]instanceof p.Z&&s[t].bect&&s[t].resetBaked()}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.getAnchor=(e,t,s)=>{let i;switch(this.method){case"nw-resize":i=e.bottomRight();break;case"n-resize":i=new c.Z(t.x,e.bottom());break;case"ne-resize":i=e.bottomLeft();break;case"e-resize":i=new c.Z(e.x,t.y);break;default:i=e.topLeft();break;case"s-resize":case"t-resize":i=new c.Z(t.x,e.y);break;case"sw-resize":i=e.topRight();break;case"w-resize":i=new c.Z(e.right(),t.y)}return this.rotatePoint(i,t,360-s)},this.rotatePoint=(e,t,s)=>0!==s&&360!==s&&t?(this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(s),this.matrix.invert(),this.matrix.transformPoint(e).add(t)):e,this.up=(e,t)=>{if(this.isDown)if(this.downRect.length>0)this.downPoint.equalTo(this.stage.translateRasterToFresco(e,void 0,!1))||this.commitHistory();else if("select"===this.method){const t=this.stage.translateToRect(this.downPoint,e,!1,!0),s=this.getLayersInside(t);s.length>0&&this.stage.selectLayerStack(s,this.isShiftDown,!0)}"rotate"===this.method&&(this.raster.style.cursor="grab"),this.isDown=!1,this.layerOver=void 0,this.downPoint=void 0,this.downControl=void 0,this.downAnchor=void 0,this.downRect=[],this.guides=[],window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.commitHistory=(e=this.method)=>{const t=this.stage.fresco.getSelectedStack();if(this.historyRect){let e;1===t.length?e=t[0].editMode&&t[0]instanceof g.Z?t[0].trim:t[0].rect:t.forEach((t=>{t.rect&&(e=o.Z.merge(e,t.rect.getRotatedBounds()))}));const s=e.equalTo(this.historyRect);if(this.historyRect=void 0,s)return}for(let s=0;s<t.length;s++){let i=t[s];if(i instanceof p.Z&&this.downRect[s])if("w-resize"===e||"e-resize"===e)this.downRect[s].height=i.textSettings.size;else{let e=i.rect.height/this.downRect[s].height;this.downRect[s].height=i.textSettings.size,1!==e&&i.setHeightScale(e)}else"move"!==e&&i instanceof g.Z&&!i.editMode&&i.trimOnResize(this.downRect[s])}t.length>0&&(1===t.length?this.stage.history.add({type:"arrange",kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",layer:t[0],action:{type:t[0].editMode?"trim":"rect",rect:this.downRect[0]}}):this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getSelectedStackId(),kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",stack:Array.from(t),rects:this.downRect})),"move"!==e&&this.stage.fresco.getSelectedStack().forEach((e=>{e.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.beginHistory=()=>{let e=this.stage.fresco.getSelectedStack();1===e.length?(this.downRect=[e[0].editMode&&e[0]instanceof g.Z?e[0].trim.clone():e[0].rect.clone()],this.historyRect=this.downRect[0]):(this.downRect=this.stage.fresco.getSelectedStackRect(),e.forEach((e=>{e.rect&&(this.historyRect=o.Z.merge(this.historyRect,e.rect.getRotatedBounds()))})))},this.inputRotation=e=>{const t=this.stage.fresco.getSelected();t&&t.rect&&(t.rect.rotation=e,window.requestAnimationFrame((()=>{this.stage.render(),this.render()})))},this.inputSize=(e,t)=>{let s=new r.Z;if(!this.historyRect)return s;e&&(e=Math.min(e,9999)),t&&(t=Math.min(t,9999));let i=this.stage.fresco.getSelectedStack();if(1===i.length)e&&i[0].setWidth(e,this.constrain?this.historyRect.getAspect():0),t&&i[0].setHeight(t,this.constrain||i[0]instanceof p.Z?this.historyRect.getAspect():0),s=i[0].editMode?i[0].trim.size():i[0].rect.size();else{let n=this.historyRect,a=this.historyRect.clone();e&&(a.width+=e-n.width,a.height=Math.round(a.width/n.getAspect())),t&&(a.height+=t-n.height,a.width=Math.round(a.height*n.getAspect()));let r=a.getComparedScale(n);for(let e=0;e<i.length;e++){let t=this.downRect[e];t&&(i[e].rect.x=Math.round(a.x+(t.x-n.x)*r.width),i[e].rect.y=Math.round(a.y+(t.y-n.y)*r.height),i[e].rect.width=Math.round(t.width*r.width),i[e].rect.height=Math.round(t.height*r.height))}s.width=a.width,s.height=a.width}return window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),s},this.inputPosition=(e,t)=>{let s=this.stage.fresco.getSelectedStack();if(1===s.length)s[0].position(e,t);else{e-=this.historyRect.x,t-=this.historyRect.y;for(let i=0;i<s.length;i++){let n=this.downRect[i];s[i].position(n.x+e,n.y+t)}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.step=(e,t)=>{const s=this.stage.fresco.getSelectedStack();if(0!==s.length&&!this.historyRect&&!this.isDown){if(1===s.length){const i=s[0].editMode?s[0].trim.clone():s[0].rect.clone();s[0].position(i.x+e,i.y+t),this.stage.history.add({type:"arrange",kind:"move",layer:s[0],action:{type:s[0].editMode?"trim":"rect",rect:i}})}else{let i=this.stage.fresco.getSelectedStackRect();s.forEach((s=>{this.shouldReformLayer(s)&&s.position(s.rect.x+e,s.rect.y+t)})),this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getSelectedStackId(),kind:"move",stack:Array.from(s),rects:i})}document.dispatchEvent(new CustomEvent("layer-arrange")),window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))}},this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;let e,t;if(this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx.lineWidth=1,this.layerOver){if(this.ctx.translate(.5,.5),this.ctx.strokeStyle=a.TA,e=this.stage.getLayerLocationRect(this.layerOver),0!==e.rotation){let t=e.center();this.ctx.translate(t.x,t.y),this.ctx.rotate(e.rotation*Math.PI/180),e.x-=t.x,e.y-=t.y}this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.ctx.setTransform(1,0,0,1,0,0)}let s=this.stage.fresco.getSelectedStack();if(s.length>0){let e=1===s.length;if(e&&!this.shouldReformLayer(s[0]))return;let i,n,r=!0,h=a.xZ,c=a.wf;if(e?s[0].editMode&&s[0]instanceof g.Z?(i=this.stage.getLayerLocationTrim(s[0]),t=this.stage.getLayerLocationRect(s[0]),n=t.center(),h=a.kD,r=!1):(i=this.stage.getLayerLocationRect(s[0]),n=i.center()):(s.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(i=o.Z.merge(i,t.getRotatedBounds()))})),n=i.center(),r=!1),!i)return;this.ctx.translate(.5,.5);let l=10,u=5;i.width<20||i.height<20?(l=6,u=3):(i.width<40||i.height<40)&&(l=8,u=4),0!==i.rotation&&(this.ctx.translate(n.x,n.y),this.ctx.rotate(i.rotation*Math.PI/180),i.x-=n.x,i.y-=n.y,t&&(t.x-=n.x,t.y-=n.y),n.x=0,n.y=0),t&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=a.XI,this.ctx.strokeRect(t.x-2,t.y-2,t.width+2,t.height+2),this.ctx.lineWidth=1),this.ctx.strokeStyle=h,this.ctx.fillStyle=c,this.ctx.strokeRect(i.x-1,i.y-1,i.width+1,i.height+1),this.isDown&&"unset"!==this.method||(0===i.rotation&&this.ctx.translate(-.5,-.5),r&&(this.ctx.fillStyle=h,this.ctx.fillRect(Math.round(i.x+i.width/2-1),i.y-10,2,10),this.ctx.beginPath(),this.ctx.arc(i.x+i.width/2,i.y-10-u,u+1,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath(),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.arc(i.x+i.width/2,i.y-10-u,u,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath()),this.ctx.fillStyle=h,e&&s[0].type===d.Z.TYPE_TEXT?(this.ctx.fillRect(i.x-4,i.y,5,i.height),this.ctx.fillRect(i.x+i.width-1,i.y,5,i.height),i.width>40&&this.ctx.fillRect(n.x-20,i.y+i.height-1,40,4),this.ctx.fillStyle=c,this.ctx.fillRect(i.x-2,i.y+1,1,i.height-2),this.ctx.fillRect(i.x+i.width+1,i.y+1,1,i.height-2),i.width>40&&this.ctx.fillRect(n.x-19,i.y+i.height+1,38,1)):(i.height>10&&(this.ctx.fillRect(i.x-u,i.y+i.height-u,l,l),this.ctx.fillRect(i.x+i.width-u,i.y-u,l,l)),this.ctx.fillRect(i.x-u,i.y-u,l,l),this.ctx.fillRect(i.x+i.width-u,i.y+i.height-u,l,l),this.ctx.fillStyle=c,i.height>10&&(this.ctx.fillRect(i.x-u+1,i.y+i.height-u+1,l-2,l-2),this.ctx.fillRect(i.x+i.width-u+1,i.y-u+1,l-2,l-2)),this.ctx.fillRect(i.x-u+1,i.y-u+1,l-2,l-2),this.ctx.fillRect(i.x+i.width-u+1,i.y+i.height-u+1,l-2,l-2))),this.ctx.setTransform(1,0,0,1,0,0)}this.guides&&this.guides.length>0&&(this.ctx.translate(.5,.5),this.guides.forEach((e=>{e.soft?this.ctx.strokeStyle=a.$n:this.ctx.strokeStyle=a.CE,this.ctx.beginPath(),this.ctx.moveTo(e.start.x,e.start.y),this.ctx.lineTo(e.end.x,e.end.y),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))},this.isControl=(e,t)=>{if(0===e.length)return!1;let s,i,n=1===e.length,r=this.hitSize/2,h=this.hitSize;if(n&&e[0].editMode&&e[0]instanceof g.Z?(s=this.stage.getLayerLocationTrim(e[0]),i=this.stage.getLayerLocationRect(e[0]).center()):(n?s=this.stage.getLayerLocationRect(e[0]):e.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(s=o.Z.merge(s,t.getRotatedBounds()))})),i=s?s.center():void 0),s){if((s.width<40||s.height<40)&&(r/=2,h/=2),t=this.rotatePoint(t,i,s.rotation),n&&e[0].type===d.Z.TYPE_TEXT){if(a.aG(s.x-this.hitSize,s.y,2*this.hitSize,s.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(90,s.rotation),this.method="w-resize",!0;if(a.aG(s.x+s.width-this.hitSize,s.y,2*this.hitSize,s.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(270,s.rotation),this.method="e-resize",!0;if(s.width>40&&a.aG(i.x-20,s.y+s.height-3,40,10,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(0,s.rotation),this.method="t-resize",!0}else{if(s.height>10){if(a.aG(s.x+s.width-r,s.y-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(45,s.rotation),this.method="ne-resize",!0;if(a.aG(s.x-r,s.y+s.height-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(225,s.rotation),this.method="sw-resize",!0}if(a.aG(s.x-r,s.y-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(315,s.rotation),this.method="nw-resize",!0;if(a.aG(s.x+s.width-r,s.y+s.height-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(135,s.rotation),this.method="se-resize",!0}return!(!n||e[0].editMode||!a.aG(s.x+s.width/2-r,s.y-(h+8),h,h,t.x,t.y))&&(this.raster.style.cursor="grab",this.method="rotate",!0)}},this.getRotatedCursor=(e,t)=>{let s=e+t;s<0&&(s+=360),s>360&&(s-=360),s+=22.5;let i=7;for(;i>0&&!(s>45*i&&s<360);)i--;return["n","ne","e","se","s","sw","w","nw"][i]+"-resize"},this.checkReformGuides=e=>{var t,s;if(this.guides=[],l.ZP.showGuides||l.ZP.snapToGuides){const i=this.stage.fresco.getSelectedStack(),n=5/this.stage.zoom,a=l.ZP.snapToGuides,r=l.ZP.showGuides;let h=1===i.length&&i[0].editMode&&i[0].trim;const d=h?i[0].rect:new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),u=h?360-i[0].rect.rotation:0,p=d.center(),g=h?this.rotatePoint(e,p,1===i.length?i[0].rect.rotation:0):e;if(!h){const s=this.stage.fresco.getNotSelectedStack();for(let i=0;i<s.length;i++){const o=s[i].rect;if(o&&0===o.rotation&&s[i].settings.visible){if(this.willSnap(g.x,o.x,n)&&(a&&(e.x=o.x),r)){const e="ne-resize"===this.method||"se-resize"===this.method||"e-resize"===this.method;this.addGuide(new c.Z(o.x,o.y),new c.Z(o.x,o.bottom()),void 0,0,!0,new c.Z(e?0:-1,-1),new c.Z(e?0:-1,0))}if(this.willSnap(g.x,o.right(),n)&&(a&&(e.x=o.right()),r)){const e="nw-resize"===this.method||"sw-resize"===this.method||"w-resize"===this.method;this.addGuide(new c.Z(o.right(),o.y),new c.Z(o.right(),o.bottom()),void 0,0,!0,new c.Z(e?-1:0,-1),new c.Z(e?-1:0,0))}if(null!==(t=!this.constrain)&&void 0!==t?t:this.isShiftDown){if(this.willSnap(g.y,o.y,n)&&(a&&(e.y=o.y),r)){const e="sw-resize"===this.method||"se-resize"===this.method;this.addGuide(new c.Z(o.x,o.y),new c.Z(o.right(),o.y),void 0,0,!0,new c.Z(-1,e?0:-1),new c.Z(0,e?0:-1))}if(this.willSnap(g.y,o.bottom(),n)&&(a&&(e.y=o.bottom()),r)){const e="ne-resize"===this.method||"nw-resize"===this.method;this.addGuide(new c.Z(o.x,o.bottom()),new c.Z(o.right(),o.bottom()),void 0,0,!0,new c.Z(-1,e?-1:0),new c.Z(0,e?-1:0))}}}}}this.willSnap(g.x,d.x,n)&&(a&&(e.x=h?this.rotatePoint(new c.Z(d.x,g.y),p,u).x:d.x),r&&this.addGuide(new c.Z(d.x,d.y),new c.Z(d.x,d.bottom()),p,u,!1,new c.Z(-1,-1),new c.Z(-1,0))),this.willSnap(g.x,d.right(),n)&&(a&&(e.x=h?this.rotatePoint(new c.Z(d.right(),g.y),p,u).x:d.right()),r&&this.addGuide(new c.Z(d.right(),d.y),new c.Z(d.right(),d.bottom()),p,u,!1,new c.Z(0,-1))),(null!==(s=!this.constrain)&&void 0!==s?s:this.isShiftDown)&&(this.willSnap(g.y,d.top(),n)&&(a&&(e.y=h?this.rotatePoint(new c.Z(g.x,d.top()),p,u).y:d.top()),r&&this.addGuide(new c.Z(d.x,d.y),new c.Z(d.right(),d.y),p,u,!1,new c.Z(-1,-1),new c.Z(0,-1))),this.willSnap(g.y,d.bottom(),n)&&(a&&(e.y=h?this.rotatePoint(new c.Z(g.x,d.bottom()),p,u).y:d.bottom()),r&&this.addGuide(new c.Z(d.x,d.bottom()),new c.Z(d.right(),d.bottom()),p,u,!1,new c.Z(-1))))}return e},this.checkMoveGuides=()=>{if(this.guides=[],l.ZP.showGuides||l.ZP.snapToGuides){const e=this.stage.fresco.getSelectedStack(),t=this.stage.fresco.getNotSelectedStack(),s=5/this.stage.zoom,i=l.ZP.snapToGuides,n=l.ZP.showGuides;let a,r,h;if(1===e.length&&e[0].editMode?(a=e[0].getGlobalTrim(),r=e[0].rect,h=360-r.rotation):(r=new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),e.forEach((e=>{e.rect&&(a=o.Z.merge(a,e.rect.getRotatedBounds()))}))),!a)return;let d=new c.Z(0,0);const u=a.center(),p=20/this.stage.zoom;for(let o=0;o<t.length;o++){const e=t[o].rect;if(e&&0===e.rotation&&t[o].settings.visible){const t=e.center();if(this.willSnap(a.x,e.x,s)&&(d.x=a.x-e.x,n)){const s=(e.y<a.y?e.y:a.y)-p,i=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x,s),new c.Z(e.x,i),t,h,!0,new c.Z(-1),new c.Z(-1))}if(this.willSnap(a.x,e.x+e.width,s)&&(d.x=a.x-(e.x+e.width),n)){const s=(e.y<a.y?e.y:a.y)-p,i=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x+e.width,s),new c.Z(e.x+e.width,i),t,h,!0,new c.Z(-1),new c.Z(-1))}if(this.willSnap(a.x+a.width,e.x,s)&&(d.x=a.x+a.width-e.x,n)){const s=(e.y<a.y?e.y:a.y)-p,i=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x,s),new c.Z(e.x,i),t,h,!0)}if(this.willSnap(a.x+a.width,e.x+e.width,s)&&(d.x=a.x+a.width-(e.x+e.width),n)){const s=(e.y<a.y?e.y:a.y)-p,i=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x+e.width,s),new c.Z(e.x+e.width,i),t,h,!0)}if(this.willSnap(a.y,e.y,s)&&(d.y=a.y-e.y,n)){const s=(e.x<a.x?e.x:a.x)-p,i=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(s,e.y),new c.Z(i,e.y),t,h,!0,new c.Z(0,-1),new c.Z(0,-1))}if(this.willSnap(a.y,e.y+e.height,s)&&(d.y=a.y-(e.y+e.height),n)){const s=(e.x<a.x?e.x:a.x)-p,i=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(s,e.y+e.height),new c.Z(i,e.y+e.height),t,h,!0,new c.Z(0,-1),new c.Z(0,-1))}if(this.willSnap(a.y+a.height,e.y,s)&&(d.y=a.y+a.height-e.y,n)){const s=(e.x<a.x?e.x:a.x)-p,i=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(s,e.y),new c.Z(i,e.y),t,h,!0)}if(this.willSnap(a.y+a.height,e.y+e.height,s)&&(d.y=a.y+a.height-(e.y+e.height),n)){const s=(e.x<a.x?e.x:a.x)-p,i=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(s,e.y+e.height),new c.Z(i,e.y+e.height),t,h,!0)}if(this.willSnap(u.x,t.x,s)&&(d.x=a.x-Math.round(t.x-a.width/2),n)){const s=(e.y<a.y?e.y:a.y)-p,i=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(Math.floor(t.x),s),new c.Z(Math.floor(t.x),i),t,h,!0)}if(this.willSnap(u.y,t.y,s)&&(d.y=a.y-Math.round(t.y-a.height/2),n)){const s=(e.x<a.x?e.x:a.x)-p,i=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(s,Math.floor(t.y)),new c.Z(i,Math.floor(t.y)),t,h,!0)}}}const g=r.center();this.willSnap(u.x,g.x,s)&&(d.x=a.x-Math.round(g.x-a.width/2),n&&this.addGuide(new c.Z(Math.floor(g.x),r.y),new c.Z(Math.floor(g.x),r.bottom()),g,h)),this.willSnap(u.y,g.y,s)&&(d.y=a.y-Math.round(g.y-a.height/2),n&&this.addGuide(new c.Z(r.x,Math.floor(g.y)),new c.Z(r.right(),Math.floor(g.y)),g,h)),this.willSnap(a.x,r.x,s)&&(d.x=a.x-r.x,n&&this.addGuide(new c.Z(r.x,r.y),new c.Z(r.x,r.bottom()),g,h,!1,new c.Z(-1,-1),new c.Z(-1,0))),this.willSnap(a.right(),r.right(),s)&&(d.x=a.x-(r.right()-a.width),n&&this.addGuide(new c.Z(r.right(),r.y),new c.Z(r.right(),r.bottom()),g,h,!1,new c.Z(0,-1))),this.willSnap(a.y,r.y,s)&&(d.y=a.y-r.y,n&&this.addGuide(new c.Z(r.x,r.y),new c.Z(r.right(),r.y),g,h,!1,new c.Z(-1,-1),new c.Z(0,-1))),this.willSnap(a.bottom(),r.bottom(),s)&&(d.y=a.y-(r.bottom()-a.height),n&&this.addGuide(new c.Z(r.x,r.bottom()),new c.Z(r.right(),r.bottom()),g,h,!1,new c.Z(-1))),!i||0===d.x&&0===d.y||(1===e.length&&e[0].editMode?e[0].position(e[0].trim.x-d.x,e[0].trim.y-d.y):e.forEach((e=>{this.shouldReformLayer(e)&&e.position(e.rect.x-d.x,e.rect.y-d.y)})))}},this.addGuide=(e,t,s,i=0,n=!1,a,r)=>{0!==i&&(e=this.rotatePoint(e,s,i),t=this.rotatePoint(t,s,i)),e=this.stage.translateFrescoToRaster(e).add(a),t=this.stage.translateFrescoToRaster(t).add(r),this.guides.push(new h.Z(e,t,n))},this.willSnap=(e,t,s)=>e<t+s&&e>t-s,this.shouldReformLayer=e=>{if(e&&e.settings.visible&&!e.settings.locked&&e.rect){if("ARRANGE"!==this.mode&&"SIMPLE"!==this.mode){if("TEXT"===this.mode&&e.type!==d.Z.TYPE_TEXT)return;if("FRAME"===this.mode&&e.type!==d.Z.TYPE_FRAME)return;if("SHAPE"===this.mode&&e.type!==d.Z.TYPE_SHAPE)return}return!0}},this.getLayerAt=e=>{if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let t=this.stage.fresco.layers.length-1;t>=0;t--){if(!this.shouldReformLayer(this.stage.fresco.layers[t]))continue;let s,i;if(this.stage.fresco.layers[t].editMode&&this.stage.fresco.layers[t]instanceof g.Z?(s=this.stage.getLayerLocationTrim(this.stage.fresco.layers[t]),i=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]).center()):(s=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]),i=s?s.center():void 0),s&&s.isInside(this.rotatePoint(e,i,s.rotation)))return this.stage.fresco.layers[t]}},this.getLayersAt=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){if("TEXT"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_TEXT)continue;if("FRAME"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_FRAME)continue;if("SHAPE"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_SHAPE)continue;let i,n;if(this.stage.fresco.layers[s].editMode&&this.stage.fresco.layers[s]instanceof g.Z?(i=this.stage.getLayerLocationTrim(this.stage.fresco.layers[s]),n=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]).center()):(i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]),n=i?i.center():void 0),i&&i.isInside(this.rotatePoint(e,n,i.rotation))&&t.push(this.stage.fresco.layers[s]),t.length>5)break}return t},this.getLayersInside=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){const i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]);i&&e.contains(i)&&t.push(this.stage.fresco.layers[s])}return t},this.dblClick=()=>{let e=this.stage.fresco.getSelected();if(e instanceof p.Z){if((0,i.ZP)("floating-text-input"))return;e.settings.visible=!1,this.removeListener(),this.stage.render(),this.render(),this.stage.supressRender=!0;let t=this.stage.getLayerLocationRect(e);t.y+t.height>this.raster.offsetHeight&&(t.y=this.raster.offsetHeight-t.height-20),t.y<20&&(t.y=20),t.width>this.raster.offsetWidth&&(t.width=this.raster.offsetWidth-40),t.x+t.width>this.raster.offsetWidth&&(t.x=this.raster.offsetWidth-t.width-20),t.x<20&&(t.x=20);let s=document.createElement("textarea");s.id="floating-text-input",s.style.top=t.y+this.raster.offsetTop+"px",s.style.left=t.x+this.raster.offsetLeft+"px",s.style.width=t.width+"px",s.style.color="#111";let n=e.textSettings;const r=a.uZ(Math.round(n.size*this.stage.zoom),12,100);s.style.font=n.getCssFont(r),s.style.letterSpacing=Math.floor(n.letterSpace*(r/2.2))+"px",s.style.textAlign=n.align,s.value=e.text;const o=()=>window.setTimeout((()=>{let e=s.cloneNode();e.style.visibility="false",s.parentNode.insertBefore(e,s),e.style.height="auto",e.value=s.value;let t=e.scrollTop+e.scrollHeight+16;s.offsetTop+t>(0,i.ZP)("workspace").offsetHeight-20&&(t=(0,i.ZP)("workspace").offsetHeight-20-s.offsetTop,s.style.overflowY="auto"),s.style.height=t+"px",s.parentNode.removeChild(e)}),0);s.addEventListener("input",(()=>{o()}),!0),(0,i.ZP)("workspace").appendChild(s),window.setTimeout((()=>{o(),s.focus(),s.select()}),10),document.addEventListener("mousedown",this.outsideTextClick,!0)}else e instanceof g.Z&&!e.settings.locked&&(e.canvas&&e.trim?(e.editMode=!e.editMode,window.requestAnimationFrame(this.render),document.dispatchEvent(new CustomEvent("layer-select"))):this.stage.browseFrameImage())},this.outsideTextClick=e=>{let t=(0,i.ZP)("floating-text-input");if(e.target!==t){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),this.stage.supressRender=!1;let s=this.stage.fresco.getSelected();if(s instanceof p.Z){s.settings.visible=!0;let e=s.text;s.setText(t.value),this.stage.history.add({type:"textChange",layer:s,text:e})}this.addListener(),document.removeEventListener("mousedown",this.outsideTextClick,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("text-change")),t.remove()}},this.cleanUp=()=>{this.proxy=void 0,this.removeListener(),this.raster.style.cursor="unset",this.matrix=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0},this.stage=e,this.ctx=e.coating.ctx,this.raster=e.coating.raster,this.pointers=new Array,this.matrix=new u.Z,this.hitSize=this.stage.canTouch?32:16,this.downRect=[],this.guides=[],this.addListener(),this.setMode(t)}}},2758:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),n=s(6817),a=s(4256),r=s(3673),o=s(7175);class h{constructor(e,t){this.setMask=e=>{this.mask=e,this.ctx=this.mask.getContext("2d"),this.createOutline()},this.isSelected=e=>{var t;return!!(null===(t=this.bounds)||void 0===t?void 0:t.isInside(e))&&this.ctx.getImageData(e.x,e.y,1,1).data[3]>=64},this.applyOffset=()=>{let e=i.dN(this.mask);this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.ctx.drawImage(e,this.offset.x,this.offset.y),this.offset.x=this.offset.y=0,this.createOutline()},this.editRectangle=(e,t,s)=>{let n=i.vL(this.mask.width,this.mask.height),a=n.getContext("2d");o.Z.fill(a,"rectangle",e.topLeft(),e.bottomRight()),a=void 0,this.drawOnMask(n,t,!1,s)},this.editEllipse=(e,t,s,n)=>{let a=i.vL(this.mask.width,this.mask.height),r=a.getContext("2d");o.Z.fill(r,"ellipse",e.topLeft(),e.bottomRight()),r=void 0,this.drawOnMask(a,t,s,n)},this.editBezier=(e,t,s,n)=>{let a=i.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i+=2)i+1===e.length?r.lineTo(e[i].x,e[i].y):r.quadraticCurveTo(e[i+1].x,e[i+1].y,e[i].x,e[i].y);r.fill(),r=void 0,this.drawOnMask(a,t,s,n)},this.editPolygon=(e,t,s,n)=>{let a=i.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(e[0].x,e[0].y),e.forEach((e=>r.lineTo(e.x,e.y))),r.fill(),r=void 0,this.drawOnMask(a,t,s,n)},this.drawOnMask=(e,t=0,s=!1,i=!1,n=new r.Z(0,0))=>{if(t>0){let s=new a.Z;s.addShader("blur",t),e=s.apply(e)}else if(s){let t=new a.Z;t.addShader("dealiasing",!0),e=t.apply(e)}this.ctx.save(),i&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(e,n.x,n.y),this.ctx.restore(),this.createOutline()},this.selectAll=()=>{this.ctx.fillRect(0,0,this.mask.width,this.mask.height),this.createOutline()},this.invert=()=>{const e=new a.Z([]);e.addShader("alpha-invert",1),this.mask=i.dN(e.apply(this.mask)),this.ctx=this.mask.getContext("2d"),this.createOutline()},this.size=(e,t)=>{const s=i.vL(e,t);this.ctx=s.getContext("2d");const n=Math.round(.5*(s.width-this.mask.width)),a=Math.round(.5*(s.height-this.mask.height));this.ctx.drawImage(this.mask,n,a),this.mask=s,this.createOutline()},this.resize=(e,t)=>{this.mask=i.eY(this.mask,e,t),this.ctx=this.mask.getContext("2d"),this.createOutline()},this.createOutline=()=>{let e=this.ctx.getImageData(0,0,this.mask.width,this.mask.height);if(this.bounds=i.vO(e),!this.bounds)return;let t=this.bounds.top(),s=this.bounds.left(),n=this.bounds.right(),a=this.bounds.bottom(),r=this.mask.width,o=this.mask.height;this.outline=new Array;let h,c,l,d,u,p=-1;for(let i=t;i<a;++i){c=0===s||e.data[4*(i*r+s-1)+3]<64,l=e.data[4*(i*r+s)+3]<64;for(let t=s;t<n;++t)h=c,c=l,l=t+1===r||e.data[4*(i*r+t+1)+3]<64,c||(p=-1,d=i-1<0||e.data[4*((i-1)*r+t)+3]<64,u=i+1===o||e.data[4*((i+1)*r+t)+3]<64,h&&d&&l&&u?p=8:h&&d&&u?p=9:l&&d&&u?p=10:l&&d&&h?p=11:l&&u&&h?p=12:h&&l?p=13:u&&d?p=14:h&&d?p=0:d&&l?p=2:h&&u?p=5:u&&l?p=7:d?p=1:h?p=3:l?p=4:u&&(p=6),-1!==p&&this.outline.push(t,i,p))}},this.clear=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array},this.reset=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array,this.offset=new r.Z,this.bounds=new n.Z},this.cleanUp=()=>{this.outline=void 0,this.offset=void 0,this.bounds=void 0,this.mask=void 0,this.ctx=void 0},this.mask=i.vL(e,t),this.offset=new r.Z,this.bounds=new n.Z,this.ctx=this.mask.getContext("2d")}}},9389:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s=1){this.highlight=e,this.shadow=t,this.amount=s}static fillPaletteMap(e,t){for(let s=0;s<256;++s){let i=s/255;t.data[4*s]=Math.round(e.highlight.r*i+e.shadow.r*(1-i)),t.data[4*s+1]=Math.round(e.highlight.g*i+e.shadow.g*(1-i)),t.data[4*s+2]=Math.round(e.highlight.b*i+e.shadow.b*(1-i))}}}},8203:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3673);class n{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e.pointerId){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e.pointerId)},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isDown=!0,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure))},this.pointerMove=e=>{e.stopPropagation(),this.pointers.length<2&&this.move(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure)},this.pointerUp=e=>{e.stopPropagation(),this.isDown=!1,this.up(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.dblClick=e=>{e.stopPropagation(),this.dbl(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.addDownListeners=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointerup",this.removePointer,!1)},this.removeDownListeners=()=>{this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointerup",this.removePointer,!1)},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.down=(e,t,s)=>{},this.move=(e,t,s)=>{},this.dbl=e=>{},this.up=e=>{},this.apply=()=>{},this.cancel=()=>{},this.cleanUp=()=>{},this.name=e,this.stage=t,this.pointers=new Array}}},8776:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3655);class n{constructor(e,t,s){this.h=e,this.s=t,this.b=s}toColor(){let e,t,s,i,n,r,o,h;if(0==this.b)e=0,t=0,s=0;else if(0==this.s)e=t=s=this.b;else switch(i=this.h/60,n=i-Math.floor(i),r=this.b*(1-this.s),h=this.b*(1-this.s*n),o=this.b*(1-this.s*(1-n)),Math.floor(i)){case 0:case 6:e=this.b,t=o,s=r;break;case 1:e=h,t=this.b,s=r;break;case 2:e=r,t=this.b,s=o;break;case 3:e=r,t=h,s=this.b;break;case 4:e=o,t=r,s=this.b;break;case 5:e=this.b,t=r,s=h}return new a(Math.round(255*e),Math.round(255*t),Math.round(255*s))}toHEX(){const e=this.toColor(),t=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${t(e.r)}${t(e.g)}${t(e.b)}`}}class a{constructor(e=255,t=255,s=255,a=255){this.isEqual=e=>!!e&&(this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a),this.toHEX=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}`},this.toHEXA=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}${e(this.a)}`},this.toRGBA=(e=this.a)=>`rgba(${this.r},${this.g},${this.b},${e/255})`,this.toHSB=()=>{let e,t,s,i=Math.min(this.r,this.g,this.b),a=Math.max(this.r,this.g,this.b);s=a/255;let r=a-i;return r?(t=r/a,e=this.r==a?(this.g-this.b)/r*60:this.g==a?60*(2+(this.b-this.r)/r):60*(4+(this.r-this.g)/r),e>360?e-=360:e<0&&(e+=360)):e=t=0,new n(e,t,s)},this.r=i.uZ(e,0,255),this.g=i.uZ(t,0,255),this.b=i.uZ(s,0,255),this.a=i.uZ(a,0,255)}rotateHue(e){let t,s,i,n=Math.min(this.r,this.g,this.b),r=Math.max(this.r,this.g,this.b);t=r/255;var o=r-n;return o?(s=o/r,i=this.r==r?(this.g-this.b)/o*60:this.g==r?60*(2+(this.b-this.r)/o):60*(4+(this.r-this.g)/o)):i=s=0,i+=e,i>360?i-=360:i<0&&(i+=360),360===i&&(i=0),a.fromHSB(i,s,t)}static fromRGB(e){if(/^#[0-9A-F]{6}$/i.test(e))return a.fromHEX(e);let t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return!t||t.length<4?new a:new a(Number(t[1]),Number(t[2]),Number(t[3]))}static fromHEXA(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!t||t.length<4?new a:new a(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16))}static fromHEX(e,t=255){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!s||s.length<3?new a:new a(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),t)}static fromHSB(e,t,s){let i,n,r,o,h,c,l,d;if(0==s)i=0,n=0,r=0;else if(0==t)i=n=r=s;else switch(o=e/60,h=o-Math.floor(o),c=s*(1-t),d=s*(1-t*h),l=s*(1-t*(1-h)),Math.floor(o)){case 0:case 6:i=s,n=l,r=c;break;case 1:i=d,n=s,r=c;break;case 2:i=c,n=s,r=l;break;case 3:i=c,n=d,r=s;break;case 4:i=l,n=c,r=s;break;case 5:i=s,n=c,r=d}return new a(Math.round(255*i),Math.round(255*n),Math.round(255*r))}clone(){return new a(this.r,this.g,this.b,this.a)}}},2542:(e,t,s)=>{s.d(t,{Z:()=>i});class i{static rotation(e){return new Promise(((t,s)=>{const i=new FileReader;i.onload=e=>{e.target||t(0);const s=e.target,i=new DataView(s.result);65496!==i.getUint16(0,!1)&&t(0);const n=i.byteLength;let a=2;for(;a<n;){i.getUint16(a+2,!1)<=8&&t(0);const e=i.getUint16(a,!1);if(a+=2,65505===e){1165519206!==i.getUint32(a+=2,!1)&&t(0);const e=18761===i.getUint16(a+=6,!1);a+=i.getUint32(a+4,e);const s=i.getUint16(a,e);a+=2;for(let n=0;n<s;n++)if(274===i.getUint16(a+12*n,e)){switch(i.getUint16(a+12*n+8,e)){case 8:t(-90);break;case 6:t(90);break;case 3:t(180);break;default:t(0)}return}}else{if(65280!=(65280&e))break;a+=i.getUint16(a,!1)}}t(0)},i.readAsArrayBuffer(e)}))}}},9591:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(8776),n=s(7359),a=s(9067);class r{constructor(e){this.value=e,this.getType=()=>this.value instanceof i.Z?"color":this.value instanceof n.ZP?"gradient":this.value instanceof a.Z?"pattern":void 0,this.getStringValue=()=>this.value instanceof i.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toJSON():void 0,this.getCssValue=()=>this.value instanceof i.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toCSS():void 0,this.addToCanvas=e=>{this.value instanceof i.Z?e.fillStyle=this.value.toHEX():this.value instanceof n.ZP?e.fillStyle=this.value.createCanvasGradient(e):this.value instanceof a.Z&&(e.fillStyle=this.value.createCanvasPattern(e))}}}r.fromString=async(e,t)=>{let s;return"color"===e&&/^#[0-9A-F]{6}$/i.test(t)?s=new r(i.Z.fromHEX(t)):"gradient"===e?s=new r(n.ZP.fromJSON(t)):"pattern"===e&&(s=new r(await a.Z.fromJSON(t))),s}},7359:(e,t,s)=>{s.d(t,{Rt:()=>a,ZP:()=>o});var i=s(3655),n=s(8776);class a{constructor(e,t,s=135,i="linear"){this.colors=e,this.positions=t,this.direction=s,this.type=i,this.toCSS=()=>{let e="linear-gradient("+this.direction+"deg";for(let t=0;t<this.colors.length;++t)e+=", "+n.Z.fromHEXA(this.colors[t]).toRGBA()+" "+(100*this.positions[t]).toFixed(0)+"%";return e+=")",e}}}class r{constructor(e,t,s){this.id=e,this.color=t,this.position=s}}class o{constructor(){this.direction=0,this.type="linear",this.addStop=(e,t)=>{t=i.uZ(t,0,1);const s=new r(i.Zd(),e,t);return this.stops.push(s),this.sort(),s},this.removeStop=e=>{const t=this.stops.findIndex((t=>t.id===e));return-1!==t&&this.stops.splice(t,1),this.sort(),this.stops[0].id},this.getStop=e=>{let t;return this.stops.forEach((s=>{s.id===e&&(t=s)})),t},this.sort=()=>{this.stops.sort(((e,t)=>e.position-t.position))},this.toCSS=()=>{let e="linear-gradient(to right";for(let t=0;t<this.stops.length;++t)e+=", "+this.stops[t].color.toRGBA()+" "+(100*this.stops[t].position).toFixed(0)+"%";return e+=")",e},this.toJSON=()=>JSON.stringify(this.toIGradient()),this.toIGradient=()=>{let e=new Array;return this.stops.forEach((t=>{e.push({id:t.id,color:t.color.toHEXA(),position:t.position})})),{type:this.type,direction:this.direction,stops:e}},this.createCanvasGradient=e=>{let t;if("linear"===this.type){const s=(this.direction-90)*Math.PI/180,i=e.canvas.width,n=e.canvas.height,a=Math.sqrt(i*i+n*n)/2,r=Math.asin(n/2/a);let o=(s%(2*Math.PI)+4*Math.PI)%(2*Math.PI);o>Math.PI&&(o-=Math.PI),o>Math.PI/2&&o<=Math.PI&&(o=Math.PI/2-(o-Math.PI/2));let h=Math.PI/2-r-Math.abs(o),c=Math.abs(r-Math.abs(o)),l=Math.max(Math.cos(c)*i,Math.cos(h)*n)/2,d=Math.cos(s)*l,u=Math.sin(s)*l;t=e.createLinearGradient(i/2+d,n/2+u,i/2-d,n/2-u)}else{let s=e.canvas.width/2,i=e.canvas.height/2,n=Math.max(e.canvas.width,e.canvas.height)/2;t=e.createRadialGradient(s,i,0,s,i,n)}return this.addStopToCanvasGradient(t),t},this.addStopToCanvasGradient=(e,t=!1)=>{for(let s=0;s<this.stops.length;++s)e.addColorStop(this.stops[s].position,this.stops[s].color.toRGBA(t?255-this.stops[s].color.a:this.stops[s].color.a))},this.stops=new Array}static fromJSON(e){let t=JSON.parse(e);return o.fromIGradient(t)}static fromIGradient(e){const t=new o;if(t.type=e.type&&"radial"===e.type?"radial":"linear",t.direction=e.direction,e.stops)for(let s=0;s<e.stops.length;++s){let i="string"==typeof e.stops[s].color?n.Z.fromHEXA(e.stops[s].color):new n.Z(e.stops[s].color.r,e.stops[s].color.g,e.stops[s].color.b,e.stops[s].color.a);t.addStop(i,e.stops[s].position)}return t}static fromPreset(e){const t=new o;for(let s=0;s<e.colors.length;++s)t.addStop(n.Z.fromHEXA(e.colors[s]),e.positions[s]);return t.direction=e.direction+180,t.type=e.type,t}static fromColors(e,t){const s=new o;return s.addStop(e,0),s.addStop(t,1),s}}},3646:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s=!1){this.start=e,this.end=t,this.soft=s}}},1726:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3673);class n{constructor(e=1,t=0,s=0,i=1,a=0,r=0){this.a=e,this.b=t,this.c=s,this.d=i,this.e=a,this.f=r,this.reset=()=>{this.a=this.d=1,this.b=this.c=this.e=this.f=0},this.translate=e=>{this.transform(1,0,0,1,e.x,e.y)},this.rotate=e=>{let t=Math.cos(e),s=Math.sin(e);this.transform(t,s,-s,t,0,0)},this.rotateDegree=function(e){this.rotate(.017453292519943295*e)},this.transform=(e,t,s,i,n,a)=>{const r=this.a,o=this.b,h=this.c,c=this.d,l=this.e,d=this.f;this.a=r*e+h*t,this.b=o*e+c*t,this.c=r*s+h*i,this.d=o*s+c*i,this.e=r*n+h*a+l,this.f=o*n+c*a+d},this.invert=()=>{let e=this.a,t=this.b,s=this.c,i=this.d,a=this.e,r=this.f,o=(new n,e*i-t*s);this.a=i/o,this.b=-t/o,this.c=-s/o,this.d=e/o,this.e=(s*r-i*a)/o,this.f=-(e*r-t*a)/o}}transformPoint(e){return new i.Z(e.x*this.a+e.y*this.c+this.e,e.x*this.b+e.y*this.d+this.f)}}},9067:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3655),n=s(5574);class a{constructor(e,t=1,s=0){this.svg=e,this.scale=t,this.direction=s,this.createCanvasPattern=e=>{let t;if(1!=this.scale){let s=i.vL(Math.round(this.image.width*this.scale),Math.round(this.image.height*this.scale));s.getContext("2d").drawImage(this.image,0,0,s.width,s.height),t=e.createPattern(s,"repeat")}else t=e.createPattern(this.image,"repeat");return 0!==this.direction&&t.setTransform((new DOMMatrix).rotate(this.direction)),t},this.toCSS=()=>"url(data:image/svg+xml;base64,"+btoa(this.svg)+")",this.toJSON=()=>JSON.stringify(this.toIPattern())}toIPattern(e=this.svg){return{svg:e,scale:this.scale,direction:this.direction}}}a.fromIPattern=async e=>{let t=new a(e.svg,e.scale,e.direction),s=new Blob([t.svg],{type:"image/svg+xml"});return t.image=await(0,n.s4)(s),t},a.fromJSON=async e=>{let t=JSON.parse(e);return a.fromIPattern(t)}},3673:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=0){this.x=e,this.y=t}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}angleTo(e){let t=-(this.x-e.x),s=this.y-e.y,i=360-Math.atan2(s,t)*(180/Math.PI);return i<0&&(i+=360),i>360&&(i-=360),i}dot(e){return this.x*e.x+this.y*e.y}lengthSQ(){return this.dot(this)}length(){return Math.sqrt(this.lengthSQ())}hypot2(){return this.dot(this)}hypot(){return Math.hypot(this.x,this.y)}add(e){return e?e instanceof i?new i(this.x+e.x,this.y+e.y):new i(this.x+e,this.y+e):this}neg(e){return e instanceof i?new i(this.x-e.x,this.y-e.y):new i(this.x-e,this.y-e)}mul(e){return e instanceof i?new i(this.x*e.x,this.y*e.y):new i(this.x*e,this.y*e)}rotateAround(e,t){let s=Math.sin(t),n=Math.cos(t),a=this.x-e.x,r=this.y-e.y,o=a*s+r*n;return new i(a*n-r*s+e.x,o+e.y)}equalTo(e){return this.x===e.x&&this.y===e.y}clone(){return new i(this.x,this.y)}}},6817:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(1726),n=s(3673),a=s(9872);class r{constructor(e=0,t=0,s=0,i=0,n=0){this.x=e,this.y=t,this.width=s,this.height=i,this.rotation=n}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}size(){return new a.Z(this.width,this.height)}center(){return new n.Z(this.x+this.width/2,this.y+this.height/2)}topLeft(){return new n.Z(this.x,this.y)}topRight(){return new n.Z(this.right(),this.y)}bottomLeft(){return new n.Z(this.x,this.bottom())}bottomRight(){return new n.Z(this.right(),this.bottom())}setTop(e){this.height=this.y+this.height-e,this.y=e}setLeft(e){this.width=this.x+this.width-e,this.x=e}setRight(e){this.width=Math.round(e-this.x)}setBottom(e){this.height=Math.round(e-this.y)}setCenter(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}setCenterX(e){this.x=e-.5*this.width}setCenterY(e){this.y=e-.5*this.height}moveRight(e){this.x=Math.round(e-this.width)}moveBottom(e){this.y=Math.round(e-this.height)}isSet(){return this.x>0||this.y>0||this.width>0||this.height>0||this.rotation>0}isInside(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}contains(e){return e.x>=this.x&&e.y>=this.y&&e.bottom()<=this.bottom()&&e.right()<=this.right()}equalTo(e){return!!e&&(this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.rotation===e.rotation)}clone(){return new r(this.x,this.y,this.width,this.height,this.rotation)}scale(e){return new r(Math.round(this.x*e),Math.round(this.y*e),Math.round(this.width*e),Math.round(this.height*e),this.rotation)}flipWidthAndHeight(){return new r(this.y,this.x,this.height,this.width)}union(e){if(!e)return this;const t=Math.min(this.x,e.x),s=Math.min(this.y,e.y),i=Math.max(this.x+this.width,e.x+e.width),n=Math.max(this.y+this.height,e.y+e.height);return new r(t,s,i-t,n-s)}intersect(e){let t=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width);if(s<=t)return;let i=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return n<=i?void 0:new r(t,i,s-t,n-i)}rebase(e,t){return new r(Math.round(this.x-e),Math.round(this.y-t),Math.round(this.width),Math.round(this.height))}gridAlign(){return new r(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width),Math.ceil(this.height))}getRotatedBounds(){if(0===this.rotation)return this;let e=new i.Z,t=this.center();e.translate(t),e.rotate(this.rotation*Math.PI/180),e.invert();const s=e.transformPoint(this.topLeft()),n=e.transformPoint(this.topRight()),a=e.transformPoint(this.bottomLeft()),o=e.transformPoint(this.bottomRight());let h=r.fromPoints([s,n,a,o]);return h.x=Math.round(h.x+t.x),h.y=Math.round(h.y+t.y),h.rotation=this.rotation,h}rotatedSize(e){const t=this.width,s=this.height,i=(e,t)=>{var s=e[0].x,i=e[0].y,a=e[1].x,r=e[1].y,o=t[0].x,h=t[0].y,c=t[1].x,l=t[1].y;return new n.Z(((s*r-i*a)*(o-c)-(s-a)*(o*l-h*c))/((s-a)*(h-l)-(i-r)*(o-c)),((s*r-i*a)*(h-l)-(i-r)*(o*l-h*c))/((s-a)*(h-l)-(i-r)*(o-c)))};let r,o,h,c,l,d,u;var p=e*(Math.PI/180),g=[new n.Z(0,0),new n.Z(t,0),new n.Z(t,s),new n.Z(0,s)],m=((e,t)=>{for(var s=new Array,i=0;i<e.length;++i)s.push(new n.Z(e[i].x*Math.cos(t)-e[i].y*Math.sin(t),e[i].x*Math.sin(t)+e[i].y*Math.cos(t)));return s})(g=((e,t,s)=>{for(var i=new Array,a=0;a<e.length;++a)i.push(new n.Z(e[a].x+t,e[a].y+s));return i})(g,-t/2,-s/2),p);return e>=0?(r=[new n.Z(0,0),new n.Z(-t/2,-s/2)],h=[m[0],m[3]],d=i(r,h),o=[new n.Z(0,0),new n.Z(t/2,-s/2)],c=[m[0],m[1]],u=i(o,c)):(r=[new n.Z(0,0),new n.Z(t/2,-s/2)],h=[m[1],m[2]],u=i(r,h),o=[new n.Z(0,0),new n.Z(-t/2,-s/2)],c=[m[0],m[1]],d=i(o,c)),l=new n.Z(Math.max(d.x,-u.x),Math.max(d.y,u.y)),new a.Z(Math.round(-l.x-l.x),Math.round(-l.y-l.y))}pad(e){return new r(this.x-e,this.y-e,this.width+2*e,this.height+2*e)}getAspect(){return this.width/this.height}getComparedScale(e){if(e)return new a.Z(this.width/e.width,this.height/e.height)}static calculate(e,t,s=0){if(!e||!t)return;let i=new r;return i.x=Math.round(e.x<t.x?e.x:t.x),i.y=Math.round(e.y<t.y?e.y:t.y),i.width=Math.round(e.x<t.x?t.x-i.x:e.x-i.x),i.height=0!==s?Math.round(i.width/s):Math.round(e.y<t.y?t.y-i.y:e.y-i.y),i}static merge(e,t){if(!e&&!t)return;if(e&&!t)return e;if(!e&&t)return t;const s=Math.round(Math.min(e.x,t.x)),i=Math.round(Math.min(e.y,t.y)),n=Math.round(Math.max(e.x+e.width,t.x+t.width)),a=Math.round(Math.max(e.y+e.height,t.y+t.height));return new r(s,i,n-s,a-i)}static fillFit(e,t,s,i,n=!1){let a=1;return a=e/t<s/i?s/e:i/t,n&&a>1&&(a=1),new r(Math.round((s-e*a)/2),Math.round((i-t*a)/2),Math.round(e*a),Math.round(t*a))}static bestFit(e,t,s,i){let n=1;return n=e/t>s/i?s/e:i/t,n>1&&(n=1),new r(Math.round((s-e*n)/2),Math.round((i-t*n)/2),Math.round(e*n),Math.round(t*n))}static fromPoints(e){let t=e[0].x,s=e[0].x,i=e[0].y,n=e[0].y;return e.forEach((e=>{t=Math.min(e.x,t),s=Math.max(e.x,s),i=Math.min(e.y,i),n=Math.max(e.y,n)})),new r(Math.round(t),Math.round(i),Math.round(s-t),Math.round(n-i))}static fromPointRects(e,t,s){let i=e[0].x,n=e[0].x+t,a=e[0].y,o=e[0].y+s;return e.forEach((e=>{i=Math.min(e.x,i),n=Math.max(e.x+t,n),a=Math.min(e.y,a),o=Math.max(e.y+s,o)})),new r(i,a,n-i,o-a)}}},9679:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t){this.name=e,this.value=t}}},7175:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(6817);class n{static roundRect(e,t,s,i,n,a=0){const r=Math.min(i/2,n/2,a);e.beginPath(),e.moveTo(t+r,s),e.lineTo(t+i-r,s),e.quadraticCurveTo(t+i,s,t+i,s+r),e.lineTo(t+i,s+n-r),e.quadraticCurveTo(t+i,s+n,t+i-r,s+n),e.lineTo(t+r,s+n),e.quadraticCurveTo(t,s+n,t,s+n-r),e.lineTo(t,s+r),e.quadraticCurveTo(t,s,t+r,s),e.closePath()}}n.ellipse=(e,t,s)=>{let i=.5*(s.x-t.x),n=.5*(s.y-t.y),a=t.x+i,r=t.y+n,o=.01,h=o,c=2*Math.PI-o;for(e.beginPath(),e.moveTo(a+i*Math.cos(0),r+n*Math.sin(0));h<c;h+=o)e.lineTo(a+i*Math.cos(h),r+n*Math.sin(h));e.closePath()},n.triangle=(e,t,s)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.lineTo(t.x-(s.x-t.x),s.y),e.lineTo(t.x,t.y),e.closePath()},n.star=(e,t,s)=>{let i=Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2));e.beginPath(),e.translate(t.x,t.y),e.moveTo(0,0-i);for(var n=0;n<5;n++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*i),e.rotate(Math.PI/5),e.lineTo(0,0-i);e.translate(-t.x,-t.y)},n.heart=(e,t,s)=>{let i=Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2)),n=.8*i;e.save(),e.translate(t.x,t.y-i/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-n,0,-n,i,0,i),e.lineTo(i,i),e.lineTo(i,0),e.bezierCurveTo(i,-n,0,-n,0,0),e.closePath(),e.restore()},n.rectangle=(e,t,s,i,n)=>{e.beginPath(),e.moveTo(t,s),e.lineTo(t+i,s),e.lineTo(t+i,s+n),e.lineTo(t,s+n),e.lineTo(t,s),e.closePath()},n.line=(e,t,s)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y)},n.bezier=(e,t,s,i)=>{e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(i.x,i.y,s.x,s.y)},n.arc=(e,t,s)=>{e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI)},n.fill=(e,t,s,a,r)=>{switch(t){case"rectangle":e.fillRect(s.x,s.y,a.x-s.x,a.y-s.y);break;case"rounded":const t=i.Z.fromPoints([s,a]);n.roundRect(e,t.x,t.y,t.width,t.height,r),e.fill();break;case"ellipse":n.ellipse(e,s,a),e.fill();break;case"triangle":n.triangle(e,s,a),e.fill();break;case"star":n.star(e,s,a),e.fill();break;case"heart":n.heart(e,s,a),e.fill();break;case"line":n.line(e,s,a),e.stroke()}},n.stroke=(e,t,s,a,r)=>{switch(t){case"rectangle":e.strokeRect(s.x,s.y,a.x-s.x,a.y-s.y);break;case"rounded":const t=i.Z.fromPoints([s,a]);n.roundRect(e,t.x,t.y,t.width,t.height,r),e.stroke();break;case"ellipse":n.ellipse(e,s,a),e.stroke();break;case"triangle":n.triangle(e,s,a),e.stroke();break;case"star":n.star(e,s,a),e.stroke();break;case"heart":n.heart(e,s,a),e.stroke();break;case"line":n.line(e,s,a),e.stroke()}}},9872:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=0){this.width=e,this.height=t}}},9064:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(3655),n=s(3947),a=s(3673),r=s(8776),o=s(1726),h=s(4820);class c{constructor(e){this.zoomor=!1,this.hypo=void 0,this.cursorPos=new a.Z(-999,-999),this.lastPos=new a.Z(-999,-999),this.ants=Array(!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1),this.hide=()=>{this.raster.style.display="none"},this.show=()=>{this.raster.style.display="block"},this.drawDropPreviewRect=(e,t)=>{this.ctx.save(),this.ctx.strokeStyle=i.TA,this.clear();const s=this.stage.rasterRect,n=this.stage.zoom,a=t.rect.width*n,r=t.rect.height*n;this.ctx.strokeRect(e.x-s.x-a/2,e.y-s.y-r/2,a,r),this.dirty=!0,this.ctx.restore()},this.setPan=(e=this.raster)=>{this.override||(this.override=!0,e.addEventListener("mousedown",this.panDown,!1),e.classList.add("grab"),this.stage.resetAnchor(),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove())},this.removePan=(e=this.raster)=>{(0,n.ZP)("color-picker-quick")||(this.override=!1,e.classList.remove("grab"),e.removeEventListener("mousedown",this.panDown,!1),this.cursorImage&&((0,n.ZP)("workspace").appendChild(this.cursorImage),this.positionCursorImage()))},this.panDown=e=>{e.stopPropagation(),this.stage.resetAnchor(),this.downPoint=new a.Z(e.clientX,e.clientY),this.downAnchor=this.stage.anchor.clone(),document.addEventListener("mousemove",this.panMove,!0),document.addEventListener("mouseup",this.panUp,!0)},this.panMove=e=>{let t=~~((e.clientX-this.downPoint.x)/this.stage.zoom),s=~~((e.clientY-this.downPoint.y)/this.stage.zoom);this.stage.setAnchor(new a.Z(this.downAnchor.x-t,this.downAnchor.y-s)),this.stage.updateViewport()},this.panUp=e=>{document.removeEventListener("mousemove",this.panMove,!0),document.removeEventListener("mouseup",this.panUp,!0)},this.setPicker=(e=this.raster)=>{var t;if(this.override)return;this.override=!0,e.addEventListener("mousedown",this.pickerDown,!1),e.addEventListener("mousemove",this.pickerMove,!1),e.classList.add("crosshair");const s=this.lastPos.clone(),c=new o.Z;let l=null!==(t=(0,n.ZP)("color-picker-quick"))&&void 0!==t?t:(0,n.T)("div",{id:"color-picker-quick"});for(let i=0;i<h.ZP.oldColor.length;i++){c.reset(),c.rotateDegree(14*-i);let e=c.transformPoint(new a.Z(-100,0));e.x+=s.x+20,e.y+=s.y-46;let t=(0,n.T)("div",{className:"color-pod small floater"});t.style.backgroundColor=h.ZP.oldColor[i],t.style.left=e.x+"px",t.style.top=e.y+"px",t.addEventListener("mousemove",(e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone()),this.preview.style.backgroundColor=e.currentTarget.style.backgroundColor})),t.addEventListener("click",(e=>{let t=r.Z.fromRGB(e.currentTarget.style.backgroundColor);this.preview.style.backgroundColor=t.toHEX(),document.dispatchEvent(new CustomEvent("set-color",{detail:t}))})),l.append(t)}(0,n.ZP)("workspace").appendChild(l),this.pickerCanvas=i.dN(document.getElementsByClassName("canvas")[0]),this.pickerCanvasCTX=this.pickerCanvas.getContext("2d"),this.preview=document.createElement("div"),this.preview.id="color-picker-preview",this.preview.style.display="none",(0,n.ZP)("workspace").appendChild(this.preview),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove(),this.pickerPreview(s)},this.updateHistoryPods=()=>{var e=(0,n.ZP)("color-picker-quick").children;for(let t=0;t<e.length;t++)e[t].style.backgroundColor=h.ZP.oldColor[t]},this.pickerMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone())},this.pickerPreview=e=>{if(this.preview.style.top=e.y-50+"px",this.preview.style.left=e.x+10+"px",this.preview.style.display="block",e.x-=this.stage.canvas.offsetLeft,e.y-=this.stage.canvas.offsetTop,e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return void(this.preview.style.display="none");let t=this.pickerCanvasCTX.getImageData(e.x,e.y,1,1).data;this.preview.style.backgroundColor=new r.Z(t[0],t[1],t[2]).toHEX()},this.pickerDown=e=>{let t=new a.Z(e.clientX-this.stage.canvas.offsetLeft,e.clientY-this.stage.canvas.offsetTop);if(t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return;let s=this.pickerCanvasCTX.getImageData(t.x,t.y,1,1).data;const i=new r.Z(s[0],s[1],s[2]);this.updateColorHistory(i),this.updateHistoryPods(),document.dispatchEvent(new CustomEvent("set-color",{detail:i}))},this.updateColorHistory=e=>{let t=e.toHEX(),s=h.ZP.oldColor.findIndex((e=>e===t));s>-1?h.ZP.oldColor.splice(0,0,h.ZP.oldColor.splice(s,1)[0]):(h.ZP.oldColor.pop(),h.ZP.oldColor.unshift(t)),(0,h.Lt)("oldColor",h.ZP.oldColor)},this.removePicker=(e=this.raster)=>{var t;this.override&&(this.override=!1,e.classList.remove("crosshair"),e.removeEventListener("mousedown",this.pickerDown,!1),e.removeEventListener("mousemove",this.pickerMove,!1),this.preview.remove(),null===(t=(0,n.ZP)("color-picker-quick"))||void 0===t||t.remove(),this.cursorImage&&(this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage()),this.pickerCanvasCTX=void 0,this.pickerCanvas=void 0)},this.setCursorImage=e=>{this.cursorImage&&(0,n.ZP)("cursor-image")&&(this.cursorImage.remove(),this.cursorImage=void 0),this.raster.style.cursor=e?"none":"crosshair",e&&(this.cursorImage=e,this.cursorImage.id="cursor-image",this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage())},this.animateCursorTap=()=>{const e=(0,n.T)("div",{className:"clickEffect"});e.style.top=this.cursorPos.y+this.stage.rasterRect.y+"px",e.style.left=this.cursorPos.x+this.stage.rasterRect.x+"px",e.addEventListener("animationend",(()=>e.remove())),this.stage.workspace.appendChild(e)},this.positionCursorImage=()=>{this.cursorImage&&(this.cursorImage.style.left=this.cursorPos.x-~~(this.cursorImage.width/2)+this.raster.offsetLeft+"px",this.cursorImage.style.top=this.cursorPos.y-~~(this.cursorImage.height/2)+this.raster.offsetTop+"px")},this.removeCursorImage=()=>{this.raster.style.cursor="unset",this.cursorImage&&(this.cursorImage.remove(),this.cursorImage=void 0,this.cursorPos.x=this.cursorPos.y=-999)},this.throttle=0,this.mouseWheel=e=>{if("none"!==h.ZP.scrollMode&&(e.preventDefault(),e.stopPropagation(),this.throttle+20<Date.now())){if(this.throttle=Date.now(),this.stage.supressRender=!0,"zoom"===h.ZP.scrollMode&&!e.shiftKey||"move"===h.ZP.scrollMode&&e.shiftKey){const t=this.stage.getViewPortCenter(),s=new a.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),i=this.stage.translateRasterToFresco(s);this.stage.setFluidZoom(e.deltaY<0);const n=this.stage.translateRasterToFresco(s);this.stage.setAnchor(new a.Z(t.x+(i.x-n.x),t.y+(i.y-n.y)))}else{const t=this.stage.anchor.add(new a.Z(e.deltaX,e.deltaY));this.stage.setAnchor(t)}this.stage.supressRender=!1,this.stage.updateViewport()}},this.mouseMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.cursorPos.x=e.clientX-this.stage.rasterRect.x,this.cursorPos.y=e.clientY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.mouseLeave=e=>{this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.touchMove=e=>{if(e.targetTouches.length>1){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=Math.hypot(e.targetTouches[0].pageX-e.targetTouches[1].pageX,e.targetTouches[0].pageY-e.targetTouches[1].pageY);if(void 0===this.hypo)return this.hypo=t,this.downPoint=new a.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),this.stage.resetAnchor(),void(this.downAnchor=this.stage.anchor.clone());if(this.hypo-t<-20||this.hypo-t>20)this.stage.setFluidZoom(Boolean(t>this.hypo)),this.hypo=t;else{const t=new a.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),s=this.stage.isHDPI?.5*this.stage.zoom:this.stage.zoom,i=Math.round(t.x-this.downPoint.x)/s,n=Math.round(t.y-this.downPoint.y)/s;this.stage.setAnchor(new a.Z(this.downAnchor.x-i,this.downAnchor.y-n)),this.stage.updateViewport()}}else this.lastPos.x=e.targetTouches[0].pageX,this.lastPos.y=e.targetTouches[0].pageY,this.cursorPos.x=e.targetTouches[0].pageX-this.stage.rasterRect.x,this.cursorPos.y=e.targetTouches[0].pageY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.hypo=void 0,this.downPoint=void 0,this.downAnchor=void 0,this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.freeze=(e=!0)=>{this.frozen=e,e||this.render()},this.sleep=()=>{this.sleeping=!0,this.clear(!0)},this.wake=()=>{this.sleeping=!1,this.render()},this.so=7,this.render=(e,t=!0)=>{if(t&&this.clear(),this.sleeping)return;if(window.clearTimeout(this.timer),!this.stage||!this.stage.fresco||this.stage.supressRender)return;if(!this.stage.fresco.hasSelection())return void(e&&this.ctx.putImageData(e,0,0));let s,i,n,a,r,o=this.stage.zoom,h=this.stage.fresco.selection,c=this.stage.getViewPort(),l=this.stage.offset.x>0?this.stage.offset.x:0,d=this.stage.offset.y>0?this.stage.offset.y:0;if(e||(e=this.getImageData()),o>1){var u=Math.ceil(o)-1;for(let t=0,o=0,l=h.outline.length;t<l;t+=3)if(n=h.outline[t],a=h.outline[t+1],r=h.outline[t+2],n+h.offset.x>=c.x&&n+h.offset.x<c.x+c.width&&a+h.offset.y>=c.y&&a+h.offset.y<c.y+c.height)switch(s=Math.round((n+h.offset.x)*this.stage.zoom)+this.stage.offset.x,i=Math.round((a+h.offset.y)*this.stage.zoom)+this.stage.offset.y,r){case 0:for(this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s+o,i,e),this.drawAnt(s,i+o,e);break;case 1:for(o=0;o<=u;++o)this.drawAnt(s+o,i,e);break;case 2:for(s+=u,this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s-o,i,e),this.drawAnt(s,i+o,e);break;case 3:for(o=0;o<=u;++o)this.drawAnt(s,i+o,e);break;case 4:for(s+=u,o=0;o<=u;++o)this.drawAnt(s,i+o,e);break;case 5:for(i+=u,this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s,i-o,e),this.drawAnt(s+o,i,e);break;case 6:for(i+=u,o=0;o<=u;++o)this.drawAnt(s+o,i,e);break;case 7:for(s+=u,i+=u,this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s,i-o,e),this.drawAnt(s-o,i,e);break;case 8:for(this.drawAnt(s,i,e),this.drawAnt(s+u,i+u,e),o=1;o<=u;++o)this.drawAnt(s+o,i,e),this.drawAnt(s,i+o,e),this.drawAnt(s+u,i-o+u,e),this.drawAnt(s-o+u,i+u,e);break;case 9:for(this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s+o,i,e),this.drawAnt(s,i+o,e),this.drawAnt(s+o,i+u,e);break;case 10:for(s+=u,i+=u,this.drawAnt(s,i,e),o=1;o<=u;++o)this.drawAnt(s+o-u,i-u,e),this.drawAnt(s,i-o,e),this.drawAnt(s-o,i,e);break;case 11:for(o=0;o<=u;++o)this.drawAnt(s+o,i,e),this.drawAnt(s,i+o,e),this.drawAnt(s+u,i+o,e);break;case 12:for(o=0;o<=u;++o)this.drawAnt(s+o,i+u,e),this.drawAnt(s,i+o,e),this.drawAnt(s+u,i+o,e);break;case 13:for(o=0;o<=u;++o)this.drawAnt(s,i+o,e),this.drawAnt(s+u,i+o,e);break;case 14:for(o=0;o<=u;++o)this.drawAnt(s+o,i,e),this.drawAnt(s+o,i+u,e)}}else for(let p=0,g=h.outline.length;p<g;p+=3)n=h.outline[p],a=h.outline[p+1],r=h.outline[p+2],s=Math.round((n+h.offset.x-c.x)*o)+l,i=Math.round((a+h.offset.y-c.y)*o)+d,this.drawAnt(s,i,e);this.ctx.putImageData(e,0,0),this.dirty=!0,this.frozen||(this.timer=window.setTimeout((()=>{--this.so<0&&(this.so=7),this.frozen||this.render()}),400))},this.drawAnt=(e,t,s)=>{if(t=~~t,(e=~~e)>=0&&t>=0&&e<this.raster.width&&t<this.raster.height){let i=4*(t*this.raster.width+e);this.ants[(e+this.so)%8*8+t%8]?(s.data[i]=0,s.data[i+1]=0,s.data[i+2]=0,s.data[i+3]=255):(s.data[i]=255,s.data[i+1]=255,s.data[i+2]=255,s.data[i+3]=255)}},this.clear=(e=!1)=>{(e||this.dirty)&&(this.ctx&&this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.dirty=!1)},this.stage=e,this.raster=e.raster,this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.raster.addEventListener("mousemove",this.mouseMove,!0),this.raster.addEventListener("mouseout",this.mouseLeave,!0),this.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.raster.addEventListener("wheel",this.mouseWheel,{passive:!1}),this.raster.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),"e"===h.ZP.product&&document.addEventListener("viewport-render",(()=>window.requestAnimationFrame((()=>this.render()))),!1)}getImageData(){return this.ctx.getImageData(0,0,this.raster.width,this.raster.height)}drawAntPolygon(e){this.clear(),e.length>0&&(this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.restore(),this.dirty=!0),this.render(void 0,!1)}drawAntBezier(e){if(this.clear(),e.length>0){this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.restore(),this.dirty=!0}this.render(void 0,!1)}drawAntRectangle(e){this.clear();let t=this.getImageData();for(var s=0;s<e.height;++s)this.drawAnt(e.x,e.y+s,t),this.drawAnt(e.right()-1,e.y+s,t);for(var i=0;i<e.width;++i)this.drawAnt(e.x+i,e.y,t),this.drawAnt(e.x+i,e.bottom()-1,t);this.dirty=!0,this.render(t,!1)}drawAntEllipse(e){this.clear();let t=this.getImageData();var s,i,n,a,r,o,h,c,l,d,u,p,g,m,v,f,y=e.width%2==0?1:0,w=e.height%2==0?1:0;s=.5*e.width,h=0,c=i=.5*e.height,u=(l=s*s)*(1-(i<<1))+(m=(d=i*i)<<1),p=d-(g=l<<1)*((i<<1)-1),n=3*m,a=f=d<<2,r=(v=l<<2)*(i-1),o=g*((i<<1)-3),this.drawAnt(e.x+h+s-y,e.y+c+i-w,t),this.drawAnt(e.x-h+s,e.y+c+i-w,t),this.drawAnt(e.x-h+s,e.y-c+i,t),this.drawAnt(e.x+h+s-y,e.y-c+i,t);do{u<0?(u+=n,p+=a,n+=f,a+=f,h++):p<0?(u+=n-r,n+=f,r-=v,p+=a-o,a+=f,o-=v,h++,c--):(u-=r,r-=v,p-=o,o-=v,c--),this.drawAnt(e.x+h+s-y,e.y+c+i-w,t),this.drawAnt(e.x-h+s,e.y+c+i-w,t),this.drawAnt(e.x-h+s,e.y-c+i,t),this.drawAnt(e.x+h+s-y,e.y-c+i,t)}while(c>0);this.dirty=!0,this.render(t,!1)}cleanUp(){window.clearTimeout(this.timer)}}},4699:(e,t,s)=>{s.d(t,{F:()=>w,q:()=>y});var i=s(3655),n=s(3770),a=s(5574),r=s(6817),o=s(8685),h=s(2282),c=s(1294),l=s(7108),d=s(7664),u=s(4170),p=s(7758),g=s(694),m=s(4686),v=s(7163),f=s(2396);class y{constructor(e,t,s,i,n,a,r){this.name=t,this.width=s,this.height=i,this.color=n,this.animation=r,this.templateMeta=a,this.id=e,this.lastModified=new Date,this.pinned=!1}async restore(e){const t=await(0,n.X3)();try{const[s,n]=t.transaction("readonly","layer-meta","document-selection"),[a,o]=await Promise.all([s.index("document").getAll(this.id),n.get(this.id)]);this.order||(this.order=a.sort(((e,t)=>e.order-t.order)).map((e=>e.id)));let h=[];if(this.order.forEach((e=>{const t=a.find((t=>t.id===e));t&&("bitmap"===t.type&&(t.type=u.Z.TYPE_IMAGE),t.settings.rotation&&t.rect&&void 0===t.rect.rotation&&(t.rect.rotation=t.settings.rotation),t.rect&&void 0===t.rect.rotation&&(t.rect=new r.Z(t.rect.x,t.rect.y,t.rect.width,t.rect.height,0)),h.push(t))})),h.length!==a.length){console.warn("Had layers that could not be sorted, this is a problem");const e=a.filter((e=>!this.order.includes(e.id)));h=h.concat(e)}if(o){e.fresco.addSelection();const t=e.fresco.selection;t.mask=await i.Td(o),t.ctx=t.mask.getContext("2d"),t.createOutline()}const c=await Promise.all(h.map((async e=>{const s=i.mS(w,e),[n,a]=t.transaction("readonly","layer-bitmap","layer-mask"),[r,o]=await Promise.all([n.get(s.id),a.get(s.id)]);return s.toLayer(r,o)})));c.forEach((t=>e.fresco.layers.push(t))),e.fresco.layers.length>0&&e.selectLayer(e.fresco.layers[0])}catch(s){throw console.error("Restore",s),s}}async save(){const e=await(0,n.X3)(),[t]=e.transaction("readwrite","document-meta");await t.put(this)}async remove(){const e=await(0,n.X3)(),[t,s,i,a,r,o]=e.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),h=[t.delete(this.id),s.delete(this.id),i.delete(this.id)],c=await a.index("document").getAll(this.id);for(let n=0;n<c.length;n++){const e=c[n];h.push(a.delete(e.id)),h.push(o.delete(e.id)),h.push(r.delete(e.id))}await Promise.all(h)}static async saveOrder(e){const t=e.layers.map((e=>e.id)),s=await(0,n.X3)(),[i]=s.transaction("readwrite","document-meta"),a=await i.get(e.id);a.order=t,await i.put(a)}static async duplicate(e){const t=await(0,n.X3)(),[s,a,r,o,h,c]=t.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),l=i.M8(),d=[(async()=>{const t=await a.get(e);t&&await a.add(t,l)})(),(async()=>{const t=await r.get(e);t&&await r.add(t,l)})()],u=await o.index("document").getAll(e),p={};for(let n=0;n<u.length;n++){const e=u[n],t=e.id,s=i.M8();p[t]=s,d.push((async()=>{e.id=s,e.document=l,await o.add(e)})(),(async()=>{const e=await c.get(t);e&&await c.add(e,s)})(),(async()=>{const e=await h.get(t);e&&await h.add(e,s)})())}d.push((async()=>{const t=await s.get(e);t.id=l,t.pinned=!1,t.order=t.order.map((e=>p[e])),t.lastModified=new Date,await s.add(t)})()),await Promise.all(d)}static async deleteAll(){const e=await(0,n.X3)(),[t]=e.transaction("readwrite","document-meta"),s=await t.getAll();for(let n=0;n<s.length;n++){const e=i.mS(y,s[n]);e.pinned||await e.remove()}}async getThumbnail(){const e=await(0,n.X3)(),[t]=e.transaction("readonly","document-thumbnail"),s=await t.get(this.id);return s?"string"==typeof s?(0,a.OA)(s):(0,a.s4)(s):Promise.resolve(void 0)}static async getAll(){const e=await(0,n.X3)(),[t]=e.transaction("readonly","document-meta");return(await t.getAll()).map((e=>i.mS(y,e)))}static async history(){return y.getAll().then((e=>e.sort(((e,t)=>e.lastModified===t.lastModified?0:e.lastModified<t.lastModified?1:-1))))}static async getByID(e){const t=await(0,n.X3)(),[s]=t.transaction("readonly","document-meta"),a=await s.get(e);return i.mS(y,a)}async pin(){this.pinned=!0,await this.save()}async unpin(){this.pinned=!1,await this.save()}}class w{constructor(e,t){this.order=0,this.id=e.id,this.type=e.type,this.document=t,this.settings=e.settings,this.animation=e.animation,this.rect=e.rect,this.trim=e.trim,e instanceof o.Z&&(this.textSettings=e.textSettings,this.text=e.text),e instanceof d.Z&&(this.url=e.url,this.variant=e.variant,this.scalemethod=e.scalemethod),e instanceof l.Z&&(this.shapeSettings=e.shapeSettings),e instanceof c.Z&&(this.frameSettings=e.frameSettings)}async toLayer(e,t){const s="string"==typeof e?await i.lU(e):await i.Td(e),n="string"==typeof t?await i.lU(t):await i.Td(t);switch(this.type){case u.Z.TYPE_IMAGE:{const e=new h.Z(this.id,this.settings.name,s,i.mS(r.Z,this.rect),this.settings.locked);return n&&(e.mask=n,e.render()),e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),e}case u.Z.TYPE_ELEMENT:{const e=new d.Z(this.id,this.settings.name,s,this.url,this.variant,this.settings.blendmode,this.scalemethod);return e.settings=this.settings,e.rect=i.mS(r.Z,this.rect),e.animation=i.mS(f.Z,this.animation),e}case u.Z.TYPE_TEXT:{const e=new o.Z(this.id,this.text,i.mS(r.Z,this.rect),i.mS(p.Z,this.textSettings));return e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),await v.Z.loadFont(this.textSettings.font),await e.prepare(),e}case u.Z.TYPE_SHAPE:{const e=new l.Z(this.id,this.settings.name,i.mS(r.Z,this.rect),i.mS(m.Z,this.shapeSettings));return e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),await e.prepare(),e}case u.Z.TYPE_FRAME:{const e=new c.Z(this.id,this.settings.name,i.mS(r.Z,this.rect),i.mS(g.Z,this.frameSettings));return e.canvas=s,e.settings=this.settings,e.trim=i.mS(r.Z,this.trim),e.animation=i.mS(f.Z,this.animation),e.canvas&&e.render(),e}}}static async delete(e){const t=await(0,n.X3)();let[s,i,a]=t.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([s.delete(e),i.delete(e),a.delete(e)])}static async sync(e,t){if(!t.hasLayer(e))throw new Error("This is probably a bug, cant create layermeta from layer not in the fresco");const s=new w(e,t.id);let a=!1;if(e.type===u.Z.TYPE_IMAGE||e.type===u.Z.TYPE_ELEMENT?a=e.rect&&e.rect.isSet()&&!!e.canvas||!e.rect&&!e.canvas:e.type===u.Z.TYPE_FRAME&&(a=e.trim&&e.trim.isSet()&&!!e.canvas||!e.trim&&!e.canvas),a){const[t,a]=await Promise.all([i._c(e.canvas),i._c(e.mask)]),r=await(0,n.X3)();let[o,h,c]=r.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([h.put(s),t?o.put(t,s.id):o.delete(s.id),a?c.put(a,s.id):c.delete(s.id)])}else{const e=await(0,n.X3)();let[t]=e.transaction("readwrite","layer-meta");await t.put(s)}e.syncLatest=new Date}}},7664:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),n=s(4170),a=s(6817),r=s(3673),o=s(2282);class h extends n.Z{constructor(e=i.M8(),t,s,c,l,d="",u=h.SCALE_METHOD_NONE){super(n.Z.TYPE_ELEMENT),this.id=e,this.rotateAndFit=(e,t)=>{this.settings.locked&&this.variant===h.VARIANT_OVERLAY?(this.rotate(e),this.calculate(new r.Z(0,0),new r.Z(t.width,t.height),0)):this.rect.rotation+=e?-90:90},this.calculate=(e,t,s)=>{this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10))},this.rasterize=()=>{const e=new o.Z(i.M8(),this.settings.name,i.dN(this.canvas),this.rect.clone(),this.settings.locked);return e.settings=Object.assign({},this.settings),e.applyTransform(),e},this.clone=(e=!1)=>{let t=new h(e?this.id:i.M8(),this.settings.name,i.dN(this.canvas),this.url,this.variant,this.settings.blendmode,this.scalemethod);return t.settings=Object.assign({},this.settings),t.rect=this.rect.clone(),e&&(t.id=this.id,t.settings.name=this.settings.name),t},this.url=c,this.canvas=s,this.variant=l,this.scalemethod=u,this.settings.name=t,this.settings.blendmode=d,this.rect=new a.Z(0,0,s.width,s.height)}}h.VARIANT_OVERLAY="overlay",h.VARIANT_STICKER="sticker",h.SCALE_METHOD_STRETCH="stretch",h.SCALE_METHOD_FILL="fill",h.SCALE_METHOD_NONE="none"},1294:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3655),n=s(4170),a=s(6817),r=s(8776),o=s(3673),h=s(2282),c=s(694),l=s(2396);class d extends n.Z{constructor(e=i.M8(),t,s,u=new c.Z){super(n.Z.TYPE_FRAME),this.id=e,this.prepare=()=>{this.setPath()},this.calculate=(e,t,s)=>{this.editMode&&this.trim?(this.trim.x=Math.round(e.x),this.trim.y=Math.round(e.y),this.trim.width=Math.round(t.x-e.x),this.trim.height=0===s?Math.round(t.y-e.y):Math.round(this.trim.width/(this.canvas.width/this.canvas.height)),this.trim.width<10&&(this.trim.width=10),this.trim.height<10&&(this.trim.height=10)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.height=0!==s?Math.round(this.rect.width/s):Math.round(t.y-e.y),this.rect.width<10&&(this.rect.width=10),this.rect.height<10&&(this.rect.height=10))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.width=e,0!==t&&(this.trim.height=Math.round(this.trim.width/(this.canvas.width/this.canvas.height)))):(this.rect.width=e,0!==t&&(this.rect.height=this.rect.width*t)),this.render())},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.height=e,0!==t&&(this.trim.height=Math.round(this.trim.height/(this.canvas.height/this.canvas.width)))):(this.rect.height=e,0!==t&&(this.rect.width=this.rect.height/t)),this.render())},this.position=(e,t)=>{this.rect&&(this.editMode?(this.trim&&(void 0!==e&&(this.trim.x=e),void 0!==t&&(this.trim.y=t)),this.render()):(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.trim&&(this.trim.x=Math.round(this.trim.x*e),this.trim.y=Math.round(this.trim.y*t),this.trim.width=Math.round(this.trim.width*e),this.trim.height=Math.round(this.trim.height*t)),this.frameSettings.outlineSize>0&&(this.frameSettings.outlineSize=Math.round(this.frameSettings.outlineSize*e)),this.frameSettings.shadow&&(this.frameSettings.shadowDistance=Math.round(100*this.frameSettings.shadowDistance*e)/100,this.frameSettings.shadowBlur=Math.round(100*this.frameSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.flip=e=>{this.canvas&&(this.canvas=i.x2(this.canvas,e),this.render())},this.setPath=(e=this.frameSettings.clip,t=!1)=>{e&&(t||(this.frameSettings.clip=e),this.path2D=new Path2D(e)),this.render()},this.setOutline=(e,t,s)=>{this.frameSettings.outline=e,this.frameSettings.outlineSize=t,this.frameSettings.outlineColor=s,this.render()},this.setShadow=(e,t,s,i,n,a)=>{this.frameSettings.shadow=e,this.frameSettings.shadowBlur=t,this.frameSettings.shadowOpacity=s,this.frameSettings.shadowColor=i,this.frameSettings.shadowDistance=n,this.frameSettings.shadowDirection=a,this.render()},this.setFrameSettings=e=>{this.frameSettings=e,this.render()},this.setContent=e=>{this.canvas=e,this.fitContent()},this.trimOnResize=e=>{if(!this.trim)return;let t=this.rect.getComparedScale(e);this.trim.x=Math.round(this.trim.x*t.width),this.trim.y=Math.round(this.trim.y*t.height),this.trim.width=Math.round(this.trim.width*t.width),this.trim.height=Math.round(this.trim.height*t.height)},this.fitContent=()=>{this.canvas?this.trim=a.Z.fillFit(this.canvas.width,this.canvas.height,this.rect.width,this.rect.height):this.trim=void 0,this.render()},this.getGlobalTrim=()=>{if(this.trim)return new a.Z(this.rect.x+this.trim.x,this.rect.y+this.trim.y,this.trim.width,this.trim.height,this.rect.rotation)},this.update=()=>{if(this.bect=this.rect.clone(),this.frameSettings.shadow){let e=100*this.frameSettings.shadowBlur;e+=Math.abs(100*this.frameSettings.shadowDistance),this.bect.width+=2*e,this.bect.height+=2*e,this.bect.x-=e,this.bect.y-=e}},this.render=()=>{this.update();const e=this.baked.getContext("2d");if(this.baked.width!==this.bect.width||this.baked.height!==this.bect.height?(this.baked.height=this.bect.height,this.baked.width=this.bect.width):e.clearRect(0,0,this.baked.width,this.baked.height),this.canvas){const t=new Path2D;let s=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):0;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-s)/100,(this.rect.height-s)/100)),e.save(),e.translate(this.rect.x-this.bect.x+s/2,this.rect.y-this.bect.y+s/2),this.frameSettings.outline?(e.strokeStyle=this.frameSettings.outlineColor,e.lineWidth=s,this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t)):this.frameSettings.shadow&&(this.shadowContext(e),e.fill(t)),e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0,e.clip(t),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(this.canvas,this.trim.x-s/2,this.trim.y-s/2,this.trim.width,this.trim.height),e.restore()}else{const t=new Path2D;let s=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):2;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-s)/100,(this.rect.height-s)/100)),e.save(),e.translate(this.rect.x-this.bect.x+s/2,this.rect.y-this.bect.y+s/2),this.frameSettings.outline?e.strokeStyle=this.frameSettings.outlineColor:e.strokeStyle="#ccc",e.fillStyle="rgba(0, 0, 0, 0.3)",this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t),e.restore();const i=new o.Z(Math.round(this.bect.width/2),Math.round(this.bect.height/2));let n=20;e.lineWidth=8,this.rect.width>500&&this.rect.height>500&&(e.lineWidth=16,n=40),e.save(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.beginPath(),e.moveTo(i.x-n,i.y),e.lineTo(i.x+n,i.y),e.moveTo(i.x,i.y-n),e.lineTo(i.x,i.y+n),e.closePath(),e.stroke(),e.restore()}},this.shadowContext=e=>{const t=r.Z.fromHEX(this.frameSettings.shadowColor,Math.round(255*this.frameSettings.shadowOpacity)).toRGBA();var s=(this.frameSettings.shadowDirection-90)*Math.PI/180,i=Math.cos(s)*this.frameSettings.shadowDistance,n=Math.sin(s)*this.frameSettings.shadowDistance;e.fillStyle=t,e.shadowColor=t,e.shadowBlur=100*this.frameSettings.shadowBlur,e.shadowOffsetX=100*i,e.shadowOffsetY=100*n},this.replaceCanvas=e=>{const t=this.canvas.getContext("2d");t.save(),t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.switchCanvas=(e,t)=>{this.canvas=e,this.trim=t.clone(),this.render()},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new h.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{var t;let s=new d(e?this.id:i.M8(),this.settings.name,this.rect.clone(),this.frameSettings.clone());return s.settings=Object.assign({},this.settings),s.animation=l.Z.clone(this.animation),s.trim=null===(t=this.trim)||void 0===t?void 0:t.clone(),s.canvas=i.dN(this.canvas),s.render(),e&&(s.id=this.id,s.settings.name=this.settings.name),s},this.rect=s,this.settings.name=t,this.frameSettings=u,this.baked=i.vL(s.width,s.height),this.prepare()}}},694:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(){this.clip="M 0,0 H 100 V 100 H 0 Z",this.outline=!1,this.outlineColor="#555555",this.outlineSize=.3,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(i.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.clip===e.clip&&this.outline===e.outline&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},8027:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(4170),n=s(6817),a=s(1294),r=s(9198),o=s(2758);class h{constructor(e,t,s,r,o,h,c){this.block=!1,this.layerAddedCounterForUserEase=0,this.savedTimesCounterForUserEase=0,this.setBlock=(e=!1)=>{this.block=e||Boolean(!!this.templateMeta&&this.templateMeta.locked)},this.unblock=()=>{this.block=!1,this.templateMeta&&(this.templateMeta.locked=!1)},this.getSelected=()=>1!==this.selected.length?void 0:this.selected[0],this.getSelectedStack=()=>this.selected,this.getNotSelectedStack=()=>this.layers.filter((e=>!this.selected.includes(e))),this.getSelectedStackRect=()=>{let e=new Array;return this.selected.forEach((t=>{e.push(t.rect?t.rect.clone():void 0)})),e},this.getSelectedStackBounds=(e=this.selected)=>{let t;return 1===e.length?t=e[0].editMode&&e[0]instanceof a.Z?e[0].trim.clone():e[0].rect?e[0].rect.clone():void 0:e.forEach((e=>{e.rect&&(t=n.Z.merge(t,e.rect.getRotatedBounds()))})),t},this.getSelectedId=()=>{let e=new Array;return this.selected.forEach((t=>{e.push(t.id)})),e},this.getSelectedStackId=()=>{if(0===this.selected.length)return;if(1===this.selected.length)return this.selected[0].id;let e=this.getSelectedId().join(),t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return t.toString()},this.getLayerById=e=>{let t;return this.layers.forEach((s=>{s.id===e&&(t=s)})),t},this.hasSelected=()=>this.selected.length>0,this.isSelectedStack=()=>this.selected.length>1,this.isSelectedType=e=>1===this.selected.length&&this.selected[0].type===e,this.isSelectedImageWithCanvas=()=>(!this.selected||1===this.selected.length)&&(this.selected[0].type===i.Z.TYPE_IMAGE&&!!this.selected[0].canvas),this.isSelectedShaderbleWithCanvas=()=>(!this.selected||1===this.selected.length)&&((this.selected[0].type===i.Z.TYPE_IMAGE||this.selected[0].type===i.Z.TYPE_FRAME||this.selected[0].type===i.Z.TYPE_ELEMENT)&&!!this.selected[0].canvas),this.isSelectedById=e=>{if(e)return-1!==this.selected.findIndex((t=>t.id===e))},this.selectLayerById=(e,t=!1,s=!1)=>{this.selected[0]&&(this.selected[0].editMode=!1);let n=!1;return e?t?this.isSelectedById(e)?s&&(this.unselectLayerById(e),n=!0):(this.selected.push(this.getLayerById(e)),n=!0):this.isSelectedById(e)&&1===this.selected.length||(this.selected=[this.getLayerById(e)],n=!0):0!==this.layers.length&&this.layers[0].settings.locked&&this.layers[0].type===i.Z.TYPE_IMAGE?0===this.selected.length||1===this.selected.length&&this.selected[0]===this.layers[0]||(this.selected=[this.layers[0]],n=!0):0!==this.selected.length&&(this.selected=[],n=!0),this.selected.length>1&&this.selected.sort(((e,t)=>this.layers.indexOf(e)-this.layers.indexOf(t))),n},this.unselectLayerById=e=>{const t=this.selected.findIndex((t=>t.id===e));return-1!==t&&(this.selected.splice(t,1),!0)},this.unselectLayers=()=>{this.selected=[]},this.selectLayerStack=(e,t=!1)=>{this.selected=e},this.deleteLayerById=e=>{const t=this.layers.findIndex((t=>t.id===e));let s;return-1!==t&&(s=this.layers[t],this.layers.splice(t,1),this.unselectLayerById(e)),!this.hasSelected()&&this.layers.length>0&&(this.selected=[this.layers[t>0?t-1:0]]),s},this.id=e,this.name=t,this.width=s,this.height=r,this.color=o,this.animation=h,this.templateMeta=c,this.layers=[],this.selected=[],this.setBlock()}addScratch(){return this.scratch||(this.scratch=new r.Z),this.scratch}removeScratch(){this.scratch=void 0}hasScratch(){return!!this.scratch&&"none"!==this.scratch.renderMode}addSelection(){this.selection||(this.selection=new o.Z(this.width,this.height))}removeSelection(){this.selection&&(this.selection.cleanUp(),this.selection=void 0)}hasSelection(){return this.selection&&this.selection.bounds&&this.selection.outline&&this.selection.outline.length>0}hasAnimation(){if(this.animation)return!0;for(const e of this.layers)if(e.animation&&!e.animation.block)return!0;return!1}hasLayers(){return this.layers.length>0}hasLayer(e){return this.layerNr(e.id)>=0}numLayers(){return this.layers.length}nextAddedLayerNumber(){return this.numLayers()>this.layerAddedCounterForUserEase&&(this.layerAddedCounterForUserEase=this.numLayers()),(this.layerAddedCounterForUserEase+1).toString()}lockedBackground(){return this.layers.length>0&&this.layers[0].settings.locked&&this.layers[0].type===i.Z.TYPE_IMAGE}selectedLayerNr(){if(0===this.selected.length)return-1;if(1===this.selected.length)return this.layerNr(this.selected[0].id);let e=0;return this.selected.forEach((t=>{e=Math.max(e,this.layerNr(t.id))})),e}layerNr(e){return this.layers.findIndex((t=>t.id===e))}changeLayerOrder(e,t){this.layers.splice(t,0,this.layers.splice(e,1)[0])}rotate(e){let t=this.width;this.width=this.height,this.height=t;for(let s=0;s<this.layers.length;s++)this.layers[s].rotate(e),this.layers[s].render()}flip(e){for(let t=0;t<this.layers.length;t++)this.layers[t].type===i.Z.TYPE_IMAGE&&(this.layers[t].flip(e),this.layers[t].render())}straighten(e,t,s){if(this.lockedBackground()){let i=this.layers[0];i.rect.rotation=e,i.rect.x=-(i.rect.width-t)/2,i.rect.y=-(i.rect.height-s)/2}this.width=t,this.height=s}crop(e){this.width=e.width,this.height=e.height;for(let t=0;t<this.layers.length;t++)this.layers[t].rect&&(this.layers[t].rect.x-=e.x,this.layers[t].rect.y-=e.y,this.layers[t].render());this.selection&&this.selection.size(this.width,this.height)}resize(e,t,s){let i=e/this.width,n=t/this.height;this.width=Math.round(this.width*i),this.height=Math.round(this.height*n),this.width=e,this.height=t;for(let a=0;a<this.layers.length;a++)this.layers[a].scale(i,n,s);this.selection&&this.selection.resize(this.width,this.height)}size(e,t,s,i){let n=s?e:e-this.width,a=s?t:t-this.height;if(this.width=s?this.width+e:e,this.height=s?this.height+t:t,"TL"!=i){"CL"!=i&&"BL"!=i||(n=0),"TC"!=i&&"CC"!=i&&"BC"!=i||(n=Math.round(n/2)),"TC"!=i&&"TR"!=i||(a=0),"CL"!=i&&"CC"!=i&&"CR"!=i||(a=Math.round(a/2));for(let e=0;e<this.layers.length;e++)this.layers[e].rect&&(this.layers[e].rect.x+=n,this.layers[e].rect.y+=a,this.layers[e].render())}this.selection&&this.selection.size(this.width,this.height)}addLayer(e){this.layerAddedCounterForUserEase++;let t=this.selectedLayerNr();return t>-1?this.layers.splice(t+1,0,e):this.layers.push(e),this.selected=[e],e}replaceLayer(e){const t=this.layers.findIndex((t=>t.id===e.id));this.layers[t]=e;const s=this.selected.findIndex((t=>t.id===e.id));-1!==s&&(this.selected[s]=e)}}},2282:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(4170),n=s(3655),a=s(6817),r=s(2396);class o extends i.Z{constructor(e=n.M8(),t,s,h,c=!1){super(i.Z.TYPE_IMAGE),this.id=e,this.calculate=(e,t,s)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.scale=(e,t,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.applyTransform(s))},this.wouldApplyTransform=()=>!(!this.canvas||!this.rect)&&(0!==this.rect.rotation||this.rect.width!==this.canvas.width||this.rect.height!==this.canvas.height),this.applyStraighten=e=>{this.canvas=n.zs(this.canvas,this.rect.rotation,e),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,e)),this.rect=e,this.render()},this.applyTransform=(e=!0)=>{if(!this.wouldApplyTransform())return!1;if(this.rect.width===this.canvas.width&&this.rect.height===this.canvas.height||(this.canvas=e?n.Ai(this.canvas,this.rect.width,this.rect.height):n.ZE(this.canvas,this.rect.width,this.rect.height),this.mask&&(this.mask=n.Ai(this.mask,this.rect.width,this.rect.height))),0!==this.rect.rotation){this.rect=this.rect.getRotatedBounds(),this.canvas=n.zs(this.canvas,this.rect.rotation,this.rect),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,this.rect));let e=n.l(this.canvas);e.equalTo(new a.Z(0,0,this.canvas.width,this.canvas.height))||(this.canvas=n.fg(this.canvas,e),this.mask&&(this.mask=n.fg(this.mask,e)),this.rect.width=e.width,this.rect.height=e.height,this.rect.x+=e.x,this.rect.y+=e.y),this.rect.rotation=0}return this.render(),!0},this.switchCanvas=(e,t)=>{this.mask&&!this.rect.equalTo(t)&&(this.mask=n.ST(this.mask,this.rect,t)),this.canvas=e,this.rect=t.clone()},this.extendCanvas=e=>{if(!this.canvas)return this.rect=e,void(this.canvas=n.vL(e.width,e.height));let t=this.rect.union(e);this.rect.equalTo(t)||(this.canvas=n.ST(this.canvas,this.rect,t),this.mask&&(this.mask=n.ST(this.mask,this.rect,t)),this.rect=t)},this.hasMask=()=>!!this.mask,this.addMask=(e="clear")=>{if(this.mask=n.vL(this.canvas.width,this.canvas.height),"fill"===e){this.mask.getContext("2d").fillRect(0,0,this.mask.width,this.mask.height)}},this.invertMask=()=>{if(this.mask){let e=n.vL(this.mask.width,this.mask.height),t=e.getContext("2d");t.save(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="xor",t.drawImage(this.mask,0,0),t.restore(),this.mask=e}},this.removeMask=()=>{this.mask=void 0,this.baked=void 0},this.render=()=>{if(this.mask){if(!this.canvas)return;this.baked&&this.baked.width===this.canvas.width&&this.baked.height===this.canvas.height||(this.baked=n.vL(this.canvas.width,this.canvas.height));var e=this.baked.getContext("2d");e.save(),e.globalCompositeOperation="copy",e.drawImage(this.canvas,0,0),e.globalCompositeOperation="destination-in",e.drawImage(this.mask,0,0),e.restore(),e=void 0}},this.shrinkWrap=()=>{const e=n.l(this.canvas);if(!e)return this.canvas=void 0,this.mask=void 0,this.baked=void 0,this.rect=void 0,!0;if(!e.equalTo(this.rect)){const t=n.vL(e.width,e.height);return t.getContext("2d").drawImage(this.canvas,-e.x,-e.y),this.canvas=t,this.rect=e.rebase(-this.rect.x,-this.rect.y),this.mask&&(this.mask=n.WL(this.mask,e)),!0}return!1},this.rasterize=()=>this.clone(),this.clone=(e=!1)=>{var t;let s=new o(e?this.id:n.M8(),this.settings.name,n.dN(this.canvas),null===(t=this.rect)||void 0===t?void 0:t.clone(),!1);return s.settings=Object.assign({},this.settings),s.settings.locked=!1,s.animation=r.Z.clone(this.animation),this.baked&&(s.baked=n.dN(this.baked)),this.hasMask()&&(s.mask=n.dN(this.mask)),s},this.canvas=s,this.rect=h,this.settings.name=t,this.settings.locked=c}}},4170:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655);class n{constructor(e){this.settings={opacity:1,blendmode:"",locked:!1,visible:!0,name:""},this.rotate=e=>{this.canvas&&(this.canvas=i.Xj(this.canvas,e?-90:90),this.mask&&(this.mask=i.Xj(this.mask,e?-90:90)),this.rect=this.rect.flipWidthAndHeight())},this.flip=e=>{this.canvas&&(this.canvas=i.x2(this.canvas,e),this.mask&&(this.mask=i.x2(this.mask,e)))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.width=e,0!==t&&(this.rect.height=Math.round(this.rect.width/t),this.rect.height<0&&(this.rect.height=1)))},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.height=e,0!==t&&(this.rect.width=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t))},this.scale=(e,t,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1))},this.setRect=e=>{this.bect?this.bect=e:this.rect=e},this.getRect=()=>this.bect?this.bect:this.rect,this.getCanvas=()=>this.transient?this.transient:this.baked?this.baked:this.canvas,this.setAltCanvas=()=>{this.transient=i.dN(this.canvas)},this.replaceCanvas=e=>{this.canvas?this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas.width=e.width,this.canvas.height=e.height):this.canvas=i.vL(this.rect.width,this.rect.height);const t=this.canvas.getContext("2d");t.save(),t.imageSmoothingEnabled=!1,t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.extendCanvas=e=>{},this.switchCanvas=(e,t)=>{},this.render=()=>{},this.calculate=(e,t,s)=>{},this.rasterize=()=>{},this.clone=(e=!1)=>{},this.id=i.M8(),this.type=e}}n.TYPE_SCRATCH="scratch",n.TYPE_ELEMENT="element",n.TYPE_IMAGE="image",n.TYPE_SHAPE="shape",n.TYPE_FRAME="frame",n.TYPE_TEXT="text"},9198:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),n=s(4170),a=s(3673);class r extends n.Z{constructor(){super(n.Z.TYPE_SCRATCH),this.renderMode="none",this.setRenderMode=e=>{this.renderMode=e},this.calculate=(e,t,s)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.clear=e=>{e?i.lI(this.canvas,e,new a.Z(0,0)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.baked&&this.btx.clearRect(0,0,this.baked.width,this.baked.height)},this.addBake=()=>{this.baked=i.dN(this.canvas),this.btx=this.baked.getContext("2d"),this.btx.imageSmoothingEnabled=!1},this.getCanvas=()=>this.baked?this.baked:this.canvas,this.applySelection=e=>{if(e.fresco.hasSelection()){let t=this.baked?this.btx:this.ctx;t.save(),this.baked&&(t.globalCompositeOperation="copy",t.drawImage(this.canvas,0,0)),t.globalCompositeOperation="destination-in",t.drawImage(e.fresco.selection.mask,-this.rect.x,-this.rect.y),t.restore()}},this.drawCanvas=(e,t="source-over",s=1)=>{e&&(this.ctx.save(),this.ctx.save(),this.ctx.globalAlpha=s,this.ctx.globalCompositeOperation=t,this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore())},this.drawToLayer=(e,t="source-over",s=1)=>{if(e&&e.canvas&&e.rect)if(e.type===n.Z.TYPE_FRAME){this.canvas.width===e.canvas.width&&this.canvas.height===e.canvas.height||(e.canvas.width=this.canvas.width,e.canvas.height=this.canvas.height);const t=e.canvas.getContext("2d");t.imageSmoothingEnabled=!1,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.drawImage(this.canvas,0,0)}else{const i=e.canvas.getContext("2d");i.save(),i.globalAlpha=s,i.imageSmoothingEnabled=!1,i.globalCompositeOperation=t,i.drawImage(this.baked?this.baked:this.canvas,Math.round(this.rect.x-e.rect.x),Math.round(this.rect.y-e.rect.y),this.rect.width,this.rect.height),i.restore()}}}setTarget(e,t,s,n){this.id=e,this.rect=t.clone(),this.renderMode=s,this.canvas=n?i.dN(n):i.vL(t.width,t.height),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1}}},7108:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3655),n=s(4170),a=s(9591),r=s(6817),o=s(8776),h=s(3673),c=s(7175),l=s(2282),d=s(5574),u=s(2396);class p extends n.Z{constructor(e=i.M8(),t,s,g){super(n.Z.TYPE_SHAPE),this.id=e,this.prepare=async()=>{if("svg"===this.shapeSettings.variant&&!this.image){let e=new Blob([this.shapeSettings.content],{type:"image/svg+xml"});this.image=await(0,d.s4)(e),this.rect||(this.rect=new r.Z(0,0,this.image.width,this.image.height))}"path"===this.shapeSettings.variant&&(this.path2D=new Path2D(this.shapeSettings.content)),this.shapeSettings.fillType&&(this.fill=await a.Z.fromString(this.shapeSettings.fillType,this.shapeSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),"line"===this.shapeSettings.variant&&this.shapeSettings.outlineSize!==this.rect.height&&(this.rect.height=this.shapeSettings.outlineSize),this.canvas||(this.canvas=i.vL(this.rect.width,this.rect.height)),this.render()},this.setVariant=e=>{switch(e){case"rounded":this.shapeSettings.variant="rounded";break;case"rectangle":this.shapeSettings.variant="rectangle";break;case"ellipse":this.shapeSettings.variant="ellipse";break;case"line":this.shapeSettings.variant="line"}this.render()},this.setPath=(e,t=!1)=>{t||(this.shapeSettings.content=e),this.shapeSettings.variant="path",this.path2D=new Path2D(e),this.render()},this.setFill=(e,t=!1)=>{this.fill=e,t||(this.shapeSettings.fillType=e.getType(),this.shapeSettings.fillValue=e.getStringValue()),this.render()},this.setOutline=(e,t)=>{this.shapeSettings.outlineSize=e,this.shapeSettings.outlineColor=t,"line"===this.shapeSettings.variant&&(this.rect.height=0===e?1:e),this.render()},this.setShadow=(e,t,s,i,n,a)=>{this.shapeSettings.shadow=e,this.shapeSettings.shadowBlur=t,this.shapeSettings.shadowOpacity=s,this.shapeSettings.shadowColor=i,this.shapeSettings.shadowDistance=n,this.shapeSettings.shadowDirection=a,this.render()},this.setRadii=e=>{this.shapeSettings.radii=e,this.render()},this.render=(e=!1)=>{if(!this.canvas)return;const t=this.canvas.getContext("2d");if(this.canvas.width!==this.rect.width||this.canvas.height!==this.rect.height?(this.canvas.height=this.rect.height,this.canvas.width=this.rect.width):t.clearRect(0,0,this.canvas.width,this.canvas.height),"svg"===this.shapeSettings.variant)return t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",void t.drawImage(this.image,0,0,this.rect.width,this.rect.height);if("line"===this.shapeSettings.variant)t.fillStyle=this.shapeSettings.outlineColor,t.fillRect(0,0,this.rect.width,this.rect.height);else{t.save();let e,s=2*this.shapeSettings.outlineSize,i=this.shapeSettings.outlineSize,n=this.rect.width-s,a=this.rect.height-s,r=i>0,o=!(!this.fill||!this.fill.value);switch(t.lineWidth=s,t.strokeStyle=this.shapeSettings.outlineColor,this.shapeSettings.variant){case"path":e=new Path2D,e.addPath(this.path2D,(new DOMMatrix).scale(n/100,a/100)),t.translate(i,i);break;case"rounded":c.Z.roundRect(t,i,i,n,a,this.shapeSettings.radii);break;case"rectangle":c.Z.rectangle(t,i,i,n,a);break;case"ellipse":c.Z.ellipse(t,new h.Z(i,i),new h.Z(i+n,i+a))}r&&e?t.stroke(e):r&&t.stroke(),o?this.fill.addToCanvas(t):(t.fillStyle="#ffffff",t.globalCompositeOperation="destination-out"),e?t.fill(e):t.fill(),t.restore()}if(this.shapeSettings.shadow&&!e){this.baked||(this.baked=document.createElement("canvas"));var s=100*this.shapeSettings.shadowBlur;s+=Math.abs(100*this.shapeSettings.shadowDistance),this.bect=new r.Z(this.rect.x-s,this.rect.y-s,this.rect.width+2*s,this.rect.height+2*s,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let e=this.baked.getContext("2d");var i=(this.shapeSettings.shadowDirection-90)*Math.PI/180,n=Math.cos(i)*this.shapeSettings.shadowDistance,a=Math.sin(i)*this.shapeSettings.shadowDistance;e.save(),e.shadowColor=o.Z.fromHEX(this.shapeSettings.shadowColor,Math.round(255*this.shapeSettings.shadowOpacity)).toRGBA(),e.shadowBlur=100*this.shapeSettings.shadowBlur,e.shadowOffsetX=100*n,e.shadowOffsetY=100*a,e.drawImage(this.canvas,s,s),e.restore()}else this.baked=void 0,this.bect=void 0},this.calculate=(e,t,s)=>{"line"===this.shapeSettings.variant?(this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<2&&(this.rect.width=2),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<2&&(this.rect.height=2)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1),this.shapeSettings.outlineSize>0&&(this.shapeSettings.outlineSize=Math.round(this.shapeSettings.outlineSize*e)),this.shapeSettings.shadow&&(this.shapeSettings.shadowDistance=Math.round(100*this.shapeSettings.shadowDistance*e)/100,this.shapeSettings.shadowBlur=Math.round(100*this.shapeSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new l.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{let t=new p(e?this.id:i.M8(),this.settings.name,this.rect.clone(),this.shapeSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=u.Z.clone(this.animation),t.prepare(),e&&(t.id=this.id),t},this.rect=s,this.settings.name=t,this.shapeSettings=g}}},4686:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(){this.radii=0,this.outlineSize=0,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(i.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.variant===e.variant&&this.radii===e.radii&&this.content===e.content&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},6792:(e,t,s)=>{s.d(t,{Z:()=>L});var i=s(6548),n=s(3947),a=s(3770),r=s(1030),o=s(4820),h=s(5934),c=s(8027),l=s(9064),d=s(7339),u=s(3655),p=s(9872),g=s(6817),m=s(3673),v=s(4170),f=s(4256),y=s(8685),w=s(1294),b=s(2282),x=s(7108),Z=s(7664),k=s(7758),E=s(4686),P=s(5453),S=s(4699),C=s(840);class T{constructor(e,t){this.zoom=1,this.zoomMode="fit",this.anchor=new m.Z(0,0),this.fresco=e,this.history=new P.N(e,t)}}class L{constructor(e){this.tabLimit=10,this.showTabs=!1,this.bounds=20,this.isHDPI=!1,this.canTouch=!1,this.syncDisabled=!1,this.supressRender=!1,this.zoom=1,this.zoomMode="fit",this.notify=e=>{document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)(e)}))},this.syncQueue=0,this.browseFrameImage=async()=>{await h.Q0(!1,!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await h.ZB(this,e[t],!1,"frame");document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.setFrameContent=e=>{var t;const s=this.fresco.getSelected();let i,n;s.canvas&&(i=u.dN(s.canvas),n=null===(t=s.trim)||void 0===t?void 0:t.clone()),s.setContent(e),s.editMode=!1;const a=i?e?"replace":"delete":"add";this.history.add({type:"frameContent",kind:a,layer:s,canvas:i,trim:n}),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.fitFrameContent=()=>{var e;const t=this.fresco.getSelected();if(t instanceof w.Z){let s=null===(e=t.trim)||void 0===e?void 0:e.clone();t.fitContent(),this.history.add({type:"arrange",layer:t,kind:"fitContent",action:{type:"trim",rect:s}})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.addLayer=e=>{for(let t=0;t<e.length;t++)this.fresco.addLayer(e[t]),this.history.add({type:"addLayer",kind:"add"+e[t].type,layer:e[t]});this.fresco.selectLayerStack(e)},this.addCopiedLayer=async e=>{let t,s=new Array,n=new g.Z(0,0,this.fresco.width,this.fresco.height),a=this.fresco.getSelectedStackBounds(e);n.contains(a)||(t=new m.Z(Math.round((n.width-a.width)/2),Math.round((n.height-a.height)/2)));for(let r=0;r<e.length;r++){let n=e[r].clone();-1===n.settings.name.indexOf((0,i.Z)("copy"))&&(n.settings.name+=" "+(0,i.Z)("copy")),t&&(n.rect.x=n.rect.x-a.x+t.x,n.rect.y=n.rect.y-a.y+t.y),n instanceof x.Z||n instanceof y.Z||n instanceof w.Z?await n.prepare():n.render(),this.fresco.addLayer(n),this.history.add({type:"addLayer",kind:"paste"+n.type,layer:n}),s.push(n)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.duplicateLayer=async(e=!0)=>{let t=this.fresco.getSelectedStack();if(0===t.length)return;let s=new Array;for(let n=0;n<t.length;n++){let e=t[n].clone();-1===e.settings.name.indexOf((0,i.Z)("copy"))&&(e.settings.name+=" "+(0,i.Z)("copy")),e instanceof x.Z||e instanceof y.Z||e instanceof w.Z?await e.prepare():e.render(),this.fresco.addLayer(e),this.history.add({type:"addLayer",kind:"duplicate"+e.type,layer:e}),s.push(e)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),e&&this.notify("duplicated")},this.deleteLayer=(e=!1)=>{let t=this.fresco.getSelectedStack();if(0!==t.length){if(1===t.length&&t[0]instanceof w.Z&&(e||t[0].editMode))this.setFrameContent(void 0);else{this.fresco.getSelectedId().forEach((e=>{const t=this.fresco.layerNr(e),s=this.fresco.deleteLayerById(e);this.history.add({type:"deleteLayer",layer:s,index:t})})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))}this.notify("deleted")}},this.selectLayer=(e,t=!1,s=!1,i=!1)=>{this.selectLayerById(e?e.id:void 0,t,s,i)},this.selectLayerStack=(e,t=!1,s=!1)=>{this.fresco.selectLayerStack(e,t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayerById=(e,t=!1,s=!1,i=!1)=>{this.fresco.selectLayerById(e,t,s)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),i&&document.dispatchEvent(new CustomEvent("layer-marked")))},this.unselectLayerById=e=>{this.fresco.unselectLayerById(e)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")))},this.isSelectedLayerShaderble=()=>{var e;const t=null===(e=this.fresco)||void 0===e?void 0:e.getSelected();return t&&(t.type===v.Z.TYPE_IMAGE||t.type===v.Z.TYPE_FRAME||t.type===v.Z.TYPE_ELEMENT)&&!!t.canvas},this.mergeDown=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected(),t=this.fresco.layers.findIndex((t=>e.id===t.id)),s=this.fresco.layers.map((e=>e.id));if(t<1)return void this.notify("noMerger");const i=this.fresco.layers[t-1],n=e.rect?e.rect.getRotatedBounds():void 0,a=i.rect?i.rect.getRotatedBounds():void 0,r=n?n.union(a):a;let o;if(r){o=u.vL(r.width,r.height);const t=o.getContext("2d");this.renderLayer(t,i,!1,r.topLeft()),this.renderLayer(t,e,!1,r.topLeft())}const h=new b.Z(u.M8(),e.settings.name,o,r,i.settings.locked),c=this.fresco.layers.splice(t-1,2,h);this.fresco.selectLayerById(h.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"down",layers:c,order:s,target:h}),this.notify("layersMerged")},this.mergeVisible=()=>{const e=this.fresco.layers.findIndex((e=>e.settings.visible)),t=this.fresco.layers.map((e=>e.id));if(e<0)return void this.notify("noMerge");const s=this.fresco.layers[e];let i=this.getOutputCanvas();const n=new b.Z(u.M8(),s.settings.name,i,new g.Z(0,0,i.width,i.height),!0),a=this.fresco.layers.filter((e=>e.settings.visible));this.fresco.layers=this.fresco.layers.filter((e=>!e.settings.visible)),this.fresco.layers.splice(e,0,n),this.fresco.selectLayerById(n.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"visible",order:t,layers:a,target:n}),this.notify("layersMerged")},this.mergeFlatten=()=>{let e=this.getOutputCanvas();const t=new b.Z(u.M8(),(0,i.Z)("background"),e,new g.Z(0,0,e.width,e.height),!0),s=this.fresco.layers.slice(),n=this.fresco.layers.map((e=>e.id));this.fresco.layers=[t],this.fresco.selectLayerById(t.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"flatten",layers:s,order:n,target:t}),this.notify("imageFlattend")},this.moveUp=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e+1;(0!=e||!this.fresco.lockedBackground())&&t<this.fresco.numLayers()&&this.changeOrder(e,t)}},this.moveDown=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e-1;(t>0||!this.fresco.lockedBackground()&&1==e)&&this.changeOrder(e,t)}},this.changeOrder=(e,t)=>{this.fresco.changeLayerOrder(e,t),this.render(),this.history.add({type:"order",from:e,to:t})},this.changeVisible=(e,t)=>{if(!e)return;const s=Object.assign({},e.settings);e.settings.visible=t,this.history.add({type:"layerSettings",kind:"visible",layer:e,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=(e,t)=>{if(e||(e=this.fresco.getSelected()),!e)return;const s=Object.assign({},e.settings);e.settings.locked=t,this.history.add({type:"layerSettings",kind:"locked",layer:e,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.unblock=()=>{var e;this.fresco.unblock(),null===(e=(0,n.ZP)("premium-unlock-message"))||void 0===e||e.remove(),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.rasterize=()=>{let e=this.fresco.getSelectedStack();if(0===e.length)return;let t=new Array;for(let s=0;s<e.length;s++){let i=e[s];if(i instanceof b.Z||i instanceof w.Z&&!i.canvas){t.push(i);continue}const n=this.fresco.layers.findIndex((e=>e.id===i.id)),a=i.rasterize();this.fresco.layers.splice(n,1,a),this.history.add({type:"rasterize",kind:i.type,newId:a.id,layer:i}),t.push(a)}t.length>0?(this.fresco.selectLayerStack(t),this.notify("layerRasterized")):this.notify("noRasterization"),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cutLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getSelectedStackBounds(t).size(),this.deleteLayer(),this.notify("cut")}},this.copyLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getSelectedStackBounds(t).size(),this.notify("copy")}},this.pasteLayer=()=>{Array.isArray(this.clipboard)&&(this.addCopiedLayer(this.clipboard),this.notify("paste"))},this.cut=()=>{if(!this.fresco.hasSelection())return void this.cutLayer();let e=this.copy();return e?(this.clear("cut"),this.selectionDeselect(),e):void 0},this.copy=()=>{if(!this.fresco)return;if(!this.fresco.hasSelection()&&this.fresco.hasSelected())return void this.copyLayer();const e=this.fresco.getSelected();if(!e||!e.rect||!e.rect.isSet())return void this.notify("selectionEmpty");let t=this.fresco.selection.bounds.intersect(e.rect);if(t){let s=u.vL(t.width,t.height),i=s.getContext("2d");i.drawImage(e.baked?e.baked:e.canvas,e.rect.x-t.x,e.rect.y-t.y);const n=new m.Z(-t.x,-t.y);return i.save(),i.globalCompositeOperation="destination-in",i.drawImage(this.fresco.selection.mask,n.x,n.y),i.restore(),i=void 0,s}this.notify("selectionEmpty")},this.clear=(e="clear")=>{if(!this.fresco||!this.fresco.hasSelection())return!1;if(!this.fresco.isSelectedImageWithCanvas())return this.notify("notAImageLayer"),!1;const t=this.fresco.getSelected();let s=this.fresco.selection.bounds.intersect(t.rect);if(!s)return void this.notify("selectionEmpty");s=s.rebase(t.rect.x,t.rect.y);const i=u.$E(t.canvas,s),n=t.rect.clone();let a=t.canvas.getContext("2d");return a.save(),a.globalCompositeOperation="destination-out",a.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),a.restore(),a=void 0,t.shrinkWrap(),t.render(),t.rect&&(s=s.rebase(t.rect.x-n.x,t.rect.y-n.y)),this.history.add({type:"bitmapChange",kind:e,layer:t,patchRect:s,rect:n,patch:i}),this.render(),!0},this.primeCut=(e=!0)=>{if(!this.fresco||!this.fresco.hasSelection())return[void 0,void 0];const t=this.fresco.getSelected();if(!t||!t.rect)return this.notify("noLayerSelected"),[void 0,void 0];const s=this.fresco.selection.bounds.intersect(t.rect);if(s){let i=u.vL(s.width,s.height),n=i.getContext("2d");n.drawImage(t.canvas,t.rect.x-s.x,t.rect.y-s.y);const a=new m.Z(-s.x,-s.y);return n.save(),n.globalCompositeOperation="destination-in",n.drawImage(this.fresco.selection.mask,a.x,a.y),n.restore(),n=void 0,e&&(n=t.canvas.getContext("2d"),n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),n.restore(),n=void 0,t.render()),[i,s]}return this.notify("selectionEmpty"),[void 0,void 0]},this.selectionSave=()=>{this.fresco&&this.fresco.selection&&((0,n.ZP)("edit-selection-restore").classList.remove("disabled"),this.selection=u.dN(this.fresco.selection.mask),this.notify("selectionSaved"))},this.selectionRestore=()=>{var e,t;this.selection&&(this.history.add({type:"selectionChange",kind:"restore",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.drawOnMask(this.selection,0,!1,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionAll=()=>{var e,t;this.fresco&&(this.history.add({type:"selectionChange",kind:"all",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.selectAll(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionDeselect=()=>{var e,t;this.fresco&&this.fresco.selection&&(this.history.add({type:"selectionChange",kind:"deselect",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionInvert=()=>{var e,t;this.fresco&&this.fresco.hasSelection()&&(this.history.add({type:"selectionChange",kind:"invert",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.selection.invert(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionPixels=()=>{var e,t;const s=this.fresco.getSelected();if(!s||!s.canvas)return;this.history.add({type:"selectionChange",kind:"pixels",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection();let i=new f.Z;i.addShader("alpha-mask",1),this.fresco.selection.drawOnMask(i.apply(s.canvas),0,!1,!1,s.rect.topLeft()),i.cleanUp(),i=void 0,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionConvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;if(!this.fresco.hasSelection())return;const e=this.fresco.getSelected(),t=u.dN(this.fresco.selection.mask);e.addMask(),e.mask.getContext("2d").drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),this.fresco.removeSelection(),this.history.add({type:"convertSelectionToMask",layer:e,selection:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskAdd=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;const e=this.fresco.getSelected();this.history.add({type:"mask",layer:e,rect:e.rect.clone()}),e.addMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskApply=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}));const e=this.fresco.getSelected(),t=e.mask,s=e.canvas,n=e.rect.clone();e.render(),e.canvas=e.baked,e.removeMask(),e.shrinkWrap(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("maskApplied")})),this.history.add({type:"applyMask",layer:e,canvas:s,mask:t,rect:n})},this.maskInvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}));const e=this.fresco.getSelected();e.hasMask()?(e.invertMask(),e.render(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("invert")})),document.dispatchEvent(new CustomEvent("layer-select")),this.history.add({type:"maskInvert",layer:e})):document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}))},this.maskDelete=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected();if(!e.hasMask())return;const t=u.$E(e.mask);e.removeMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("reset")})),this.history.add({type:"mask",layer:e,rect:new g.Z(0,0,t.width,t.height),patch:t})},this.maskExtract=()=>{const e=this.fresco.getSelected();if(e&&e.mask){let t=u.dN(e.canvas),s=t.getContext("2d");s.save(),s.globalCompositeOperation="destination-in",s.drawImage(e.mask,0,0),s.restore(),s=void 0;let n=u.l(e.mask),a=u.vL(n.width,n.height);s=a.getContext("2d"),s.drawImage(t,-n.x,-n.y),this.addImage(a,"Cutout","extract"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("layerCreated")}))}else document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}))},this.maskConvert=()=>{const e=this.fresco.getSelected();if(!e||!e.hasMask())return;const t=e.mask;this.fresco.addSelection(),this.fresco.selection.drawOnMask(e.mask,0,!1,!1,e.rect.topLeft()),e.removeMask(),this.history.add({type:"convertMaskToSelection",layer:e,mask:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.setZoomStep=(e,t=1)=>{this.fresco&&(1===t&&(this.zoom=Math.round(10*this.zoom)/10),this.zoom+=e?this.zoom>=5?1*t:.1*t:this.zoom>=6?-1*t:-.1*t,this.zoom=u.uZ(this.zoom,.1,50),this.zoomMode="free",this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setFluidZoom=e=>{if(!this.fresco)return;const t=this.isHDPI?.1:.12;this.zoomMode="free",this.zoom+=e?this.zoom*t:-this.zoom*t,this.zoom=u.uZ(this.zoom,.1,50),this.zoom>.95&&this.zoom<1.05&&(this.zoom=1),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change"))},this.setZoom=e=>{this.fresco&&("fit"===e?(this.zoomMode="fit",this.zoom=u.q7(this.fresco.width,this.fresco.height,this.raster.width-2*this.bounds,this.raster.height-2*this.bounds),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"fill"===e?(this.zoomMode="fill",this.zoom=u.UF(this.fresco.width,this.fresco.height,this.raster.width,this.raster.height),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"free"!==e&&(this.zoomMode="free",this.zoom=Number.parseFloat(e),this.zoom=u.uZ(this.zoom,.1,50)),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setAnchor=e=>{e.equalTo(this.anchor)||(this.anchor.x=u.uZ(e.x,0,this.fresco.width),this.anchor.y=u.uZ(e.y,0,this.fresco.height))},this.resetAnchor=()=>{this.setAnchor(this.getViewPortCenter())},this.resize=(e,t,s,i)=>{this.raster.height=this.isHDPI?2*i:i,this.raster.width=this.isHDPI?2*s:s,this.raster.style.left=e+"px",this.raster.style.top=t+"px",this.raster.style.width=s+"px",this.raster.style.height=i+"px";let n=this.raster.getBoundingClientRect();this.rasterRect=new g.Z(n.x,n.y,n.width,n.height),this.setZoom(this.zoomMode)},this.updateViewport=()=>{if(this.fresco){if(this.fresco.width*this.zoom<this.raster.width)this.canvas.width!==~~(this.fresco.width*this.zoom)&&(this.canvas.width=~~(this.fresco.width*this.zoom)),this.isHDPI?(this.canvas.style.left=~~(.25*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=2*(this.canvas.offsetLeft-this.raster.offsetLeft)):(this.canvas.style.left=~~(.5*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=this.canvas.offsetLeft-this.raster.offsetLeft);else{this.canvas.style.left=this.raster.style.left,this.canvas.width=this.raster.width;let e=this.anchor.x*this.zoom-this.canvas.width/2,t=this.fresco.width*this.zoom-this.canvas.width;if(this.offset.x=-u.uZ(~~e,0,~~t),e<0){let t=u.uZ(-1*e,0,250);this.offset.x+=t,this.canvas.style.left=this.raster.offsetLeft+t+"px",this.canvas.width=this.raster.width-t}if(e>t){let s=u.uZ(e-t,0,250);this.canvas.width=this.raster.width-s,this.offset.x-=s}}if(this.fresco.height*this.zoom<this.raster.height)this.canvas.height!==~~(this.fresco.height*this.zoom)&&(this.canvas.height=~~(this.fresco.height*this.zoom)),this.isHDPI?(this.canvas.style.top=~~(.25*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=2*(this.canvas.offsetTop-this.raster.offsetTop)):(this.canvas.style.top=~~(.5*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=this.canvas.offsetTop-this.raster.offsetTop);else{this.canvas.style.top=this.raster.style.top,this.canvas.height=this.raster.height;let e=this.anchor.y*this.zoom-this.canvas.height/2,t=this.fresco.height*this.zoom-this.canvas.height;if(this.offset.y=-u.uZ(~~e,0,~~t),e<0){let t=u.uZ(-1*e,0,250);this.offset.y+=t,this.canvas.style.top=this.raster.offsetTop+t+"px",this.canvas.height=this.raster.height-t}if(e>t){let s=u.uZ(e-t,0,250);this.canvas.height=this.raster.height-s,this.offset.y-=s}}this.isHDPI&&(this.canvas.style.width=~~(.5*this.canvas.width)+"px",this.canvas.style.height=~~(.5*this.canvas.height)+"px"),this.supressRender||document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("viewport-update"))}},this.getViewPort=()=>new g.Z(this.offset.x>0?0:-1*~~(this.offset.x/this.zoom),this.offset.y>0?0:-1*~~(this.offset.y/this.zoom),Math.ceil(this.canvas.width/this.zoom),Math.ceil(this.canvas.height/this.zoom)),this.getViewPortCenter=()=>{let e=new m.Z;return e.x=(this.offset.x>0?-this.offset.x/this.zoom:this.offset.x/this.zoom*-1)+this.raster.width/this.zoom/2,e.y=(this.offset.y>0?-this.offset.y/this.zoom:this.offset.y/this.zoom*-1)+this.raster.height/this.zoom/2,e},this.getLayerLocationRect=e=>{if(!e.rect)return;const t=this.isHDPI?.5*this.zoom:this.zoom;return new g.Z(Math.round(e.rect.x*t+this.offset.x),Math.round(e.rect.y*t+this.offset.y),Math.round(e.rect.width*t),Math.round(e.rect.height*t),e.rect.rotation)},this.getLayerLocationTrim=e=>{if(!e.trim)return;const t=this.isHDPI?.5*this.zoom:this.zoom;let s=e.getGlobalTrim();return new g.Z(Math.round(s.x*t+this.offset.x),Math.round(s.y*t+this.offset.y),Math.round(s.width*t),Math.round(s.height*t),s.rotation)},this.isAnimating=!1,this.animationId=0,this.playAnimation=(e=24,t=new Array)=>{if(this.isAnimating)return;this.animators=t,0===this.animators.length&&(this.animators=d.Z.bakeAnimators(this.fresco));let s=0;for(const i of this.animators)s=Math.max(s,i.getDuration()),i.prepare(new p.Z(this.fresco.width,this.fresco.height));if(s>0){this.coating.hide(),this.isAnimating=!0,document.dispatchEvent(new CustomEvent("animation-play",{detail:s}));let t=0,i=performance.now(),n=performance.now();const a=1e3/e,r=Math.ceil((s+50)/1e3)*e,o=()=>{const e=performance.now(),s=e-i;s>a&&(t++,i=e-s%a,this.stepAnimation(i-n)),t>r?this.finnishAnimation():this.animationId=window.requestAnimationFrame(o)};o()}},this.stepAnimation=e=>{if(!this.animators)return;const t=new p.Z(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(e,t);document.dispatchEvent(new CustomEvent("animation-step",{detail:e})),this.render()},this.stopAnimation=()=>{window.cancelAnimationFrame(this.animationId),this.finnishAnimation()},this.finnishAnimation=()=>{if(this.isAnimating){if(this.animators)for(const e of this.animators)e.finish();this.isAnimating=!1,this.coating.show(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("animation-stop"))}},this.render=()=>{if(!this.supressRender&&this.ctx&&this.fresco){if(this.fresco.color?(this.ctx.fillStyle=this.fresco.color,this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.offset.x<0?this.offset.x:0,this.offset.y<0?this.offset.y:0),this.ctx.scale(this.zoom,this.zoom),this.isAnimating)for(var e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(t.transform?this.renderTransformedLayer(this.ctx,t):this.renderLayer(this.ctx,t,!1))}else for(let e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(this.fresco.hasScratch()&&this.fresco.scratch.id===t.id?("over"===this.fresco.scratch.renderMode&&this.renderLayer(this.ctx,t,this.zoom<1),this.renderLayer(this.ctx,this.fresco.scratch,this.zoom<1)):this.renderLayer(this.ctx,t,this.zoom<1))}if(this.ctx.setTransform(1,0,0,1,0,0),this.fresco.block){this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over";let e=this.canvas.width<this.canvas.height?this.canvas.height:this.canvas.width;this.ctx.drawImage(this.premiumGrid,0,this.canvas.height-e,e,e)}}},this.renderOutputFrame=(e,t)=>{e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=this.fresco.color?this.fresco.color:"#000000",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";for(var s=0;s<this.fresco.layers.length;s++){const i=this.fresco.layers[s];(t||i.settings.visible)&&(i.transform?this.renderTransformedLayer(e,i):this.renderLayer(e,i,!1))}e.setTransform(1,0,0,1,0,0)},this.renderTransformedLayer=(e,t)=>{if((t.canvas||t.baked)&&t.rect){e.globalAlpha=t.settings.opacity*t.transform.opacity,e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const s=t.bect?t.bect:t.rect,i=t.transient?t.transient:t.baked?t.baked:t.canvas;e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let n=s.x+.5*s.width+t.transform.offset.x,a=s.y+.5*s.height+t.transform.offset.y;e.translate(n,a),n=-.5*s.width,a=-.5*s.height,1===t.transform.scale.x&&1===t.transform.scale.y||(e.translate(s.width*(t.transform.sAnchor.x-.5),s.height*(t.transform.sAnchor.y-.5)),e.scale(t.transform.scale.x,t.transform.scale.y),n=-s.width*t.transform.sAnchor.x,a=-s.height*t.transform.sAnchor.y),t.rect.rotation&&e.rotate(t.rect.rotation*Math.PI/180),t.transform.rotation&&(e.translate(s.width*(t.transform.rAnchor.x-.5),s.height*(t.transform.rAnchor.y-.5)),e.rotate(t.transform.rotation*Math.PI/180),n=-s.width*t.transform.rAnchor.x,a=-s.height*t.transform.rAnchor.y),e.drawImage(i,n,a,s.width,s.height),e.restore()}catch(s){console.log(s)}}},this.renderLayer=(e,t,s,i)=>{if((t.canvas||t.baked)&&t.rect){e.imageSmoothingQuality="high",e.globalAlpha=t.settings.opacity,e.imageSmoothingEnabled=s||0!==t.rect.rotation,e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const s=t.bect?t.bect:t.rect,n=t.transient?t.transient:t.baked?t.baked:t.canvas;t.rect.rotation?(this.ix=s.x+.5*s.width,this.iy=s.y+.5*s.height,i&&(this.ix-=i.x,this.iy-=i.y),e.save(),e.translate(this.ix,this.iy),e.rotate(t.rect.rotation*Math.PI/180),e.drawImage(n,-.5*s.width,-.5*s.height,s.width,s.height),e.restore()):(this.ix=s.x,this.iy=s.y,i&&(this.ix-=i.x,this.iy-=i.y),e.drawImage(n,this.ix,this.iy,s.width,s.height))}catch(n){console.log(n)}}},this.renderPreview=e=>{this.ctx&&e&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e,0,0,this.canvas.width,this.canvas.height))},this.getThumbnail=()=>{if(this.canvas)return this.getOutputCanvas(u.UF(this.fresco.width,this.fresco.height,200,180))},this.getSingleLayerOutputCanvas=()=>{const e=this.fresco.getSelected();if(!e||!e.canvas)return;let t=u.vL(this.fresco.width,this.fresco.height),s=t.getContext("2d");return this.renderLayer(s,e,!1),s=null,t},this.getOutputCanvas=(e=1,t)=>{e>1&&(e=1);let s=u.vL(Math.round(this.fresco.width*e),Math.round(this.fresco.height*e)),i=s.getContext("2d");(this.fresco.color||t)&&(i.fillStyle=this.fresco.color?this.fresco.color:t,i.fillRect(0,0,s.width,s.height)),i.scale(e,e);for(var n=0;n<this.fresco.layers.length;n++){const t=this.fresco.layers[n];t.settings.visible&&this.renderLayer(i,t,e<1)}return i=null,s},this.translateToRect=(e,t,s,i)=>{if(s){const s=e.x-t.x,i=e.y-t.y;let n=Math.sqrt(s*s+i*i)/Math.sqrt(2);t.x=e.x+(s>0?-n:n),t.y=e.y+(i>0?-n:n)}let n=e.x<t.x?e.x:t.x,a=e.y<t.y?e.y:t.y,r=e.x<t.x?t.x:e.x,o=e.y<t.y?t.y:e.y;return e=this.translateRasterToFresco(new m.Z(n,a),void 0,!0),(t=this.translateRasterToFresco(new m.Z(r,o),void 0,!1)).x=Math.ceil(t.x),t.y=Math.ceil(t.y),i&&(e=this.translateFrescoToRaster(e),t=this.translateFrescoToRaster(t)),new g.Z(e.x,e.y,t.x-e.x,t.y-e.y)},this.translateRasterToFresco=(e,t,s=!0)=>{const i=this.isHDPI?.5*this.zoom:this.zoom;let n=e.x/i-this.offset.x/this.zoom,a=e.y/i-this.offset.y/this.zoom;return t&&(n-=t.x,a-=t.y),s?new m.Z(Math.floor(n),Math.floor(a)):new m.Z(n,a)},this.translateFrescoToRaster=(e,t)=>{let s=e.x,i=e.y;const n=this.isHDPI?.5*this.zoom:this.zoom;return t&&(s+=t.x,i+=t.y),s=Math.round(s*n)+this.offset.x,i=Math.round(i*n)+this.offset.y,new m.Z(s,i)},this.togglePremiumMessage=()=>{var e;null===(e=(0,n.ZP)("premium-unlock-message"))||void 0===e||e.remove(),this.fresco.block&&this.fresco.templateMeta&&(0,n.ZP)("workspace").appendChild((0,n.T)("div",{id:"premium-unlock-message",onclick:()=>new C.Z(this)},(0,i.Z)("unlockPremiumMessage"),(0,n.T)("img",{className:"close",src:"/img/icon/close.svg",width:14,height:14,onclick:e=>(e.preventDefault(),e.stopImmediatePropagation(),(0,n.ZP)("premium-unlock-message").remove(),!1)})))},this.layerDragMove=()=>{this.layerDrag.fresco!==this.fresco.id&&this.coating.drawDropPreviewRect(this.layerDrag.position,this.layerDrag.layer)},this.layerDragDrop=()=>{const e=this.layerDrag;if(e.fresco===this.fresco.id)return;const t=this.layerDrag.layer.clone(),s=new m.Z(e.position.x-this.rasterRect.x,e.position.y-this.rasterRect.y),i=this.translateRasterToFresco(s);t.rect.x=i.x-e.layer.rect.width/2,t.rect.y=i.y-e.layer.rect.height/2,this.fresco.addLayer(t),this.coating.clear(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"duplicate"+t.type,layer:t})},this.closeAll=()=>{this.tabs=[],this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.close=e=>{this.stopAnimation(),void 0===e&&this.fresco&&(e=this.fresco.id);const t=this.tabs.findIndex((t=>t.fresco.id===e)),s=this.fresco&&this.fresco.id===e;if(!(t<0)){if(this.tabs.splice(t,1),0===this.tabs.length)return this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),void document.dispatchEvent(new CustomEvent("layer-list-render"));if(s){const e=Math.min(t,this.tabs.length-1);this.select(this.tabs[e].fresco.id)}else document.dispatchEvent(new CustomEvent("fresco-select"))}},this.workspace=e,this.tabs=[];let t=this;document.addEventListener("touchstart",(function e(s){document.documentElement.classList.add("touch"),document.removeEventListener("touchstart",e,!1),t.canTouch=!0}),!1);this.isHDPI="m"===o.ZP.product&&matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches,this.canvas=this.workspace.querySelector(".canvas"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.className="canvas",e.appendChild(this.canvas)),this.canvas.width=this.canvas.height=0,this.ctx=this.canvas.getContext("2d"),this.raster=this.workspace.querySelector(".raster"),this.raster||(this.raster=document.createElement("canvas"),this.raster.className="raster",e.appendChild(this.raster)),this.anchor=new m.Z(0,0),this.offset=new m.Z(0,0),this.coating=new l.Z(this),document.addEventListener("viewport-render",(()=>window.requestAnimationFrame(this.render)),!1),document.addEventListener("sync-document",(e=>{e instanceof CustomEvent&&this.syncDocument(e.detail)})),document.addEventListener("layer-drag-move",this.layerDragMove),document.addEventListener("layer-drag-drop",this.layerDragDrop),document.addEventListener("render-enabled",(e=>{e instanceof CustomEvent&&(this.supressRender=!1===e.detail)})),document.addEventListener("reset-viewport",(()=>{this.setZoom(this.zoomMode)})),o.ZP.user.subscription||(this.premiumGrid=(0,n.T)("img",{src:"/img/misc/premium-grid.svg"}))}async syncDocument(e){var t,s,i;if(!(!e||this.syncQueue>0||this.syncDisabled))try{this.syncQueue++;let n,r=new Date;e.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)&&(n=await u._c(this.getThumbnail()));const o=e.layers.map((e=>e.id)),h=await u._c(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask),c=await(0,a.X3)(),[l,d,p,g]=c.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta");let m=u.mS(S.q,await l.get(e.id));m||(m=new S.q(e.id,e.name,e.width,e.height,e.color,e.templateMeta,e.animation)),m.lastModified=r,m.width=e.width,m.color=e.color,m.height=e.height,m.selected=null===(i=null==e?void 0:e.getSelected())||void 0===i?void 0:i.id,m.templateMeta=e.templateMeta,m.animation=e.animation,m.order=o;const[v]=await Promise.all([g.index("document").getAllKeys(e.id),n?d.put(n,e.id):void 0,h?p.put(h,e.id):p.delete(e.id),l.put(m)]),f=v.filter((t=>!e.layers.some((e=>e.id===t)))),y=e.layers.filter((e=>!v.includes(e.id)));await Promise.all(y.map((t=>S.F.sync(t,e)))),await Promise.all(f.map((async e=>S.F.delete(e))));const w=e.layers.filter((e=>e.syncRequested&&(!e.syncLatest||e.syncRequested>e.syncLatest)));await Promise.all(w.map((t=>S.F.sync(t,e)))),document.cookie="has-history=true; path=/; SameSite=Strict; expires=Fri, 31 Dec 9999 23:59:59 GMT"}finally{this.syncQueue--}}createNew(e,t,s,i){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.addTab(new c.Z(u.M8(),e,t,s,i),"create"),this.addEmpty(),this.setZoom("fit"),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}async openFromHistory(e,t){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),e.templateMeta&&e.templateMeta.premium&&o.ZP.user.subscription&&(e.templateMeta.locked=!1),this.addTab(new c.Z(e.id,e.name,e.width,e.height,e.transparent?void 0:e.color,e.animation,e.templateMeta),"document"),this.setZoom("fit"),this.renderPreview(t),this.supressRender=!0,document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{await e.restore(this)}catch(s){console.log(s)}document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),this.supressRender=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("selection-update")),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}addEmpty(){let e="Layer "+this.fresco.nextAddedLayerNumber(),t=new b.Z(u.M8(),e);return this.fresco.addLayer(t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addemptyimage",layer:t}),t}addImage(e,t,s){if(document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.fresco||this.addTab(new c.Z(u.M8(),t,e.width,e.height),"image"),"frame"===s&&this.fresco.getSelected()instanceof w.Z)return void this.setFrameContent(e);const n=0===this.fresco.layers.length;let a=this.fresco.addLayer(new b.Z(u.M8(),n?(0,i.Z)("background"):t,e,new g.Z(0,0,e.width,e.height),n));if(n)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();a.rect.x=Math.round(e.x-a.rect.width/2),a.rect.y=Math.round(e.y-a.rect.height/2),this.history.add({type:"addLayer",kind:s+"image",layer:a})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),a}async addSVGShape(e,t,s){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));let i=new E.Z;i.variant="svg",i.content=e;let n=new x.Z(u.M8(),t,void 0,i);if(await n.prepare(),this.fresco||this.addTab(new c.Z(u.M8(),n.settings.name,n.rect.width,n.rect.height),"shape"),this.fresco.addLayer(n),1===this.fresco.layers.length)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();n.rect.x=Math.round(e.x-n.rect.width/2),n.rect.y=Math.round(e.y-n.rect.height/2),this.history.add({type:"addLayer",kind:s+"shape",layer:n})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),n}async addShape(e,t,s="add"){e||(e=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2))),t||((t=new E.Z).variant="rectangle",t.fillType="color",t.fillValue="#444444");let n=(0,i.Z)("shape")+" "+this.fresco.nextAddedLayerNumber(),a=new x.Z(u.M8(),n,e,t);return await a.prepare(),this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:s+"shape",layer:a}),a}addElement(e,t,s,i,n){let a;if((0,r.Z)("add-element",s),n!==Z.Z.SCALE_METHOD_NONE)if((this.fresco.height>this.fresco.width&&e.height<e.width||this.fresco.width>this.fresco.height&&e.width<e.height)&&(e=u.Xj(e,90)),a=new Z.Z(u.M8(),t,e,s,"overlay",i,n),n==Z.Z.SCALE_METHOD_FILL){let t=g.Z.fillFit(e.width,e.height,this.fresco.width,this.fresco.height);a.calculate(new m.Z(t.x,t.y),new m.Z(t.right(),t.bottom()),0)}else a.calculate(new m.Z(0,0),new m.Z(this.fresco.width,this.fresco.height),0);else{let r=g.Z.bestFit(e.width,e.height,this.fresco.width,this.fresco.height);(e.height>this.fresco.height||e.width>this.fresco.width)&&(e=u.Ai(e,r.width,r.height)),a=new Z.Z(u.M8(),t,e,s,"sticker",i,n),a.rect.x=r.x,a.rect.y=r.y}return this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addelement",layer:a}),a}async addText(e,t,s,i="add"){if(!e||!t||!s){e="Lorem ipsum ..",(s=new k.Z("Verdana",40)).fillType="color",s.fillValue="#ffffff";let i=this.getViewPort();t=new g.Z(Math.round(i.x+(i.width-Math.round(i.width/1.2))/2),Math.round(i.y+i.height/2.5),Math.round(i.width/1.2),40)}const n=new y.Z(u.M8(),e,t,s);return await n.prepare(),this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:i+"text",layer:n}),n}addFrame(e){e||(e=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2)));let t=(0,i.Z)("frame")+" "+this.fresco.nextAddedLayerNumber();const s=new w.Z(u.M8(),t,e);return this.fresco.addLayer(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:"addframe",layer:s}),s}crop(e){const t=new p.Z(this.fresco.width,this.fresco.height),s=new m.Z(-e.x,-e.y);this.fresco.crop(e),this.updateViewport(),this.history.add({type:"crop",offset:s,size:t})}flip(e){this.fresco.flip(e),this.render(),this.history.add({type:"flip",vertical:e})}rotate(e){this.fresco.rotate(e),this.updateViewport(),this.history.add({type:"rotate",counterClock:e})}rotateSelected(e){const t=this.fresco.getSelected();t?t.settings.locked?this.notify("layer locked"):(this.history.add({type:"rotateLayer",layer:t,counterClock:e}),t.rotate(e),document.dispatchEvent(new CustomEvent("viewport-render"))):this.notify("no layer selected")}flipSelected(e){if(!this.isSelectedLayerShaderble())return void this.notify("onlyImageLayer");const t=this.fresco.getSelected();t.settings.locked?this.notify("layerLocked"):(this.history.add({type:"flipLayer",layer:t,vertical:e}),t.flip(e),t.render(),this.render())}straighten(e){if(!this.fresco.lockedBackground())return;const t=this.fresco.layers[0].rect.rotatedSize(e);this.fresco.straighten(e,t.width,t.height),this.updateViewport()}addTab(e,t,s=!0){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));const i=new T(e,t);this.tabs.push(i),s&&(this.fresco=i.fresco,this.history=i.history,this.setZoom("fit"),i.zoom=this.zoom,i.zoomMode=this.zoomMode,i.anchor=this.anchor,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()),this.tabs.length>this.tabLimit&&this.close(this.tabs[0].fresco.id),this.tabs.length>1&&(this.showTabs=!0),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))}select(e){this.stopAnimation();const t=this.tabs.find((t=>t.fresco.id===e));if(!t)return;const s=this.tabs.find((e=>{var t;return e.fresco.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)}));s&&(s.zoom=this.zoom,s.zoomMode=this.zoomMode,s.anchor=this.anchor.clone()),this.fresco=t.fresco,this.history=t.history,this.zoom=t.zoom,this.zoomMode=t.zoomMode,this.anchor=t.anchor,this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()}}},8685:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(3655),n=s(4170),a=s(9591),r=s(6817),o=s(8776),h=s(3673),c=s(2282),l=s(7758),d=s(2396);class u extends n.Z{constructor(e=i.M8(),t,s,p){super(n.Z.TYPE_TEXT),this.id=e,this.prepare=async(e=!1)=>{this.fill&&!e||(this.fill=await a.Z.fromString(this.textSettings.fillType,this.textSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),this.setText()},this.setText=(e=this.text)=>{this.text=e,this.settings.name=e.substring(0,25)+"..",this.textSettings.uppercase?this.words=this.text.replace(/[\n]/g," §§§ ").toUpperCase().split(" "):this.words=this.text.replace(/[\n]/g," §§§ ").split(" "),this.render()},this.setTextSize=e=>{this.textSettings.setSize(e),this.render()},this.setLineSpace=e=>{this.textSettings.lineSpace=e,this.render()},this.setLetterSpace=e=>{this.textSettings.letterSpace=e,this.render()},this.setTextFill=(e,t=!1)=>{this.fill=e,t||(this.textSettings.fillType=e.getType(),this.textSettings.fillValue=e.getStringValue()),this.render()},this.setTextFont=(e,t=!1)=>{this.textSettings.setFont(e),this.render(t)},this.setTextUpperCase=e=>{this.textSettings.uppercase=e,this.setText(this.text)},this.setTextItalic=e=>{this.textSettings.italic=e,this.setText(this.text)},this.setTextBold=e=>{this.textSettings.bold=e,this.setText(this.text)},this.setTextAlign=e=>{this.textSettings.align=e,this.render()},this.setCurve=(e,t,s,i,n)=>{this.textSettings.curve=e,this.textSettings.curveType=t,this.textSettings.curveAmount=s,this.textSettings.curveSpread=i,this.textSettings.curveFlip=n,this.render()},this.setBackground=(e,t,s,i,n)=>{this.textSettings.background=e,this.textSettings.backgroundType=t,this.textSettings.backgroundColor=s,this.textSettings.backgroundPunch=i,this.textSettings.backgroundOffset=n,this.render()},this.setOutline=(e,t,s,i,n,a)=>{this.textSettings.outline=e,this.textSettings.outlineSize=t,this.textSettings.outlineColor=s,this.textSettings.outlinePunch=i,this.textSettings.outlineDistance=n,this.textSettings.outlineDirection=a,this.render()},this.setShadow=(e,t,s,i,n,a)=>{this.textSettings.shadow=e,this.textSettings.shadowBlur=t,this.textSettings.shadowAlpha=s,this.textSettings.shadowColor=i,this.textSettings.shadowDistance=n,this.textSettings.shadowDirection=a,this.render()},this.setTextSettings=e=>{this.textSettings=e,this.render()},this.setCanvasStyle=()=>{var e;this.ctx.textBaseline="top",this.ctx.font=this.textSettings.getCssFont(),this.ctx.strokeStyle=this.textSettings.outlineColor,this.ctx.lineWidth=Math.round(this.textSettings.outlineSize*this.textSettings.padding),this.ctx.lineJoin="miter",this.ctx.miterLimit=2,null===(e=this.fill)||void 0===e||e.addToCanvas(this.ctx)},this.render=(e=!1)=>{this.speeed=e;let t=this.textSettings.padding;this.canvas||(this.canvas=document.createElement("canvas")),this.ctx=this.canvas.getContext("2d"),this.setCanvasStyle();const s=new h.Z;if(this.textSettings.outline&&this.textSettings.outlineDistance>0){var i=(this.textSettings.outlineDirection-90)*Math.PI/180;s.x=Math.cos(i)*this.textSettings.outlineDistance*t,s.y=Math.sin(i)*this.textSettings.outlineDistance*t}const n=this.textSettings.getLineSpacing();let a=this.textSettings.height+t+n,c=this.textSettings.background?Math.round(this.textSettings.backgroundOffset*t):0;this.textSettings.background&&this.textSettings.backgroundType!=l.Z.BACKGROUND_FULL&&(a+=2*t);let d=!1,u=this.splitTextIntoLines(a);if(this.setCanvasSize(u.length,n,a),this.setCanvasStyle(),this.textSettings.curve&&"arc"===this.textSettings.curveType){if(d=!0,0!==this.textSettings.curveAmount){const e=this.textSettings.getLetterSpacing();let t=this.ctx.measureText(" ").width,[s,i]=this.calculateArcRadius();d=(t+e)/((s-this.textSettings.height/2)*Math.PI*2)*Math.PI*2<5e-4}this.textSettings.curveAmount<=0&&!d&&(u=u.reverse())}for(let r=0;r<u.length;r++){if(""===u[r])continue;const e=this.lineWidth(u[r]);this.textSettings.curve&&!d?this.drawCurveLine(u[r],t+r*a,e,c,s):this.drawLine(u[r],t+r*a,e,c,s,d)}if(this.textSettings.shadow&&!this.speeed){this.baked||(this.baked=document.createElement("canvas")),this.bect=new r.Z(this.rect.x-4*t,this.rect.y-4*t,this.rect.width+8*t,this.rect.height+8*t,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let e=this.baked.getContext("2d");e.save();i=(this.textSettings.shadowDirection-90)*Math.PI/180;var p=Math.cos(i)*this.textSettings.shadowDistance,g=Math.sin(i)*this.textSettings.shadowDistance;e.shadowBlur=this.textSettings.shadowBlur*this.textSettings.padding*2,e.shadowOffsetX=p*this.textSettings.padding*2,e.shadowOffsetY=g*this.textSettings.padding*2,e.shadowColor=o.Z.fromHEX(this.textSettings.shadowColor,Math.round(255*this.textSettings.shadowAlpha)).toRGBA(),e.drawImage(this.canvas,4*t,4*t),e.restore()}else this.resetBaked()},this.resetBaked=()=>{this.baked=void 0,this.bect=void 0},this.setCanvasSize=(e,t,s)=>{if(this.textSettings.background&&this.textSettings.backgroundType!=l.Z.BACKGROUND_FULL?this.rect.height=(this.textSettings.height+3*this.textSettings.padding)*e+t*(e-1)-this.textSettings.padding:this.rect.height=(this.textSettings.height+this.textSettings.padding)*e+t*(e-1)+this.textSettings.padding,this.textSettings.curve)switch(this.textSettings.curveType){case"arc":let e=this.calculateArcHeight();this.rect.height+=e;break;case"circle":this.rect.height=this.rect.width;break;case"half":this.rect.height=Math.round(this.rect.width/2)}this.canvas.width=this.rect.width,this.canvas.height=this.rect.height,this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_FULL&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.splitTextIntoLines=e=>{let t="",s=new Array,i=this.textSettings.curve?this.curveMaxWidth(0,e):this.rect.width;for(var n=0;n<this.words.length;n++){let a=""!=t?t+" "+this.words[n]:this.words[n];if("§§§"===this.words[n]||this.lineWidth(a)>i&&a!==this.words[n]){if(s.push(t),t="§§§"===this.words[n]?"":this.words[n],this.textSettings.curve&&(i=this.curveMaxWidth(s.length,e),i<0))return s}else t=a}return s.push(t),s},this.lineWidth=e=>{let t=0,s=this.textSettings.getLineSpacing(),i=this.textSettings.getLetterSpacing();if(this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let n=e.split(" ");for(let e=0;e<n.length;e++)t+=this.measureTextWidth(n[e],i,!0)+2*this.textSettings.padding;t+=(this.textSettings.curve&&"circle"===this.textSettings.curveType?n.length:n.length-1)*(this.textSettings.padding+s)}else this.textSettings.curve&&"circle"===this.textSettings.curveType?(t=this.measureTextWidth(e,i,!1),t+=this.measureTextWidth(" ",i,!1)):(t=this.measureTextWidth(e,i,!0),t+=2*this.textSettings.padding);return t},this.curveMaxWidth=(e,t)=>{if("arc"===this.textSettings.curveType){if(0===this.textSettings.curveAmount)return this.rect.width;let[e,s]=this.calculateArcRadius();return this.textSettings.curveAmount<0&&(s+=-t/4),s}if("circle"===this.textSettings.curveType){let s=this.rect.width/2-this.textSettings.padding-e*t;return s<t?-1:s*Math.PI*2}{let s=this.rect.width/2-e*t;return s<t?-1:s*Math.PI}},this.calculateArcHeight=()=>Math.round(this.rect.width/5*Math.abs(this.textSettings.curveAmount)),this.calculateArcRadius=()=>{let e=this.calculateArcHeight(),t=new h.Z(0,e),s=new h.Z(this.canvas.width/2,0),i=new h.Z(this.canvas.width,e),n=(s.y-t.y)/(s.x-t.x),a=(i.y-s.y)/(i.x-s.x),r=-1*((n*a*(t.y-i.y)+a*(t.x+s.x)-n*(s.x+i.x))/(2*(a-n))-(t.x+s.x)/2)/n+(t.y+s.y)/2;return[r,Math.atan2(this.rect.width/2,r-e)*r*2]},this.drawHalfLine=(e,t,s,i,n)=>{const a=this.textSettings.curveFlip,r=this.textSettings.curveSpread,o=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let c=!1,d=this.rect.width/2-t,u=d*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=d-this.textSettings.height/2;e>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,a?0:this.rect.width/2,e,e,0,Math.PI,0,a),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=r?-u/4:-s/2,i=(u/2-s)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=e.split(" ");for(var p=0;p<this.words.length;p++)if(n[p]&&""!==n[p]){let e=this.measureTextWidth(n[p],h,!0)+2*this.textSettings.padding;r&&(e+=i*n[p].length);let s=d-this.textSettings.height/2;if(s<0)continue;let c=e/u*360*(Math.PI/180),l=t/u*360*(Math.PI/180),g=a?90:270,m=g*(Math.PI/180)+(a?-l:l),v=g*(Math.PI/180)+(a?-(c+l):c+l);this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,a?0:this.rect.width/2,s,m,v,a),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+o)}this.ctx.restore(),c=!0}if(this.ctx.save(),e.length>0){this.ctx.translate(this.rect.width/2,a?0:this.rect.width/2);let t=a?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent;this.ctx.textAlign="center";let l=a?-1:1,p=0;if(r){p=(u/2-s)/(c?e.replace(/\s/g,"").length:e.length+1)/2,s=c?u/2:u/2-2*p}let m=c?2*h+2*this.textSettings.padding:2*this.textSettings.padding+2*h;this.ctx.rotate((s-m)/u*Math.PI*-l),this.ctx.textAlign="center";for(var g=0;g<e.length;g++){if(c&&" "===e[g]){this.ctx.rotate((3*this.textSettings.padding+o+h)/u*(2*Math.PI)*l);continue}let s=this.ctx.measureText(e[g]).width/2;this.ctx.rotate((s+p)/u*Math.PI*2*l),this.drawChar(e[g],0,t+i,n),this.ctx.rotate((s+h+p)/u*Math.PI*2*l)}}this.ctx.restore()},this.drawCircleLine=(e,t,s,i,n)=>{const a=this.textSettings.curveFlip,r=this.textSettings.curveSpread,o=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let c=!1,d=this.rect.width/2-t,u=d*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=d-this.textSettings.height/2;e>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,this.rect.width/2,e,e,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=r?this.textSettings.padding/2+o/2-u/2:this.textSettings.padding/2+o/2-s/2,i=(u-s)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=e.split(" ");for(var p=0;p<this.words.length;p++)if(n[p]&&""!==n[p]){let e=this.measureTextWidth(n[p],h,!0)+2*this.textSettings.padding;r&&(e+=i*n[p].length);let s=d-this.textSettings.height/2;if(s<0)continue;let c=e/u*360*(Math.PI/180),l=t/u*360*(Math.PI/180),g=a?90:270,m=g*(Math.PI/180)+(a?-l:l),v=g*(Math.PI/180)+(a?-(c+l):c+l);this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,s,m,v,a),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+o)}this.ctx.restore(),c=!0}if(this.ctx.save(),e.length>0){this.ctx.translate(this.rect.width/2,this.rect.width/2);let t=a?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent,l=a?-1:1,p=0;if(r){p=(u-s)/(c?e.replace(/\s/g,"").length:e.length+1)/2,s=c?u:u-2*p}let m=c?2*h+3*this.textSettings.padding+o:this.measureTextWidth(" ",h,!0);this.ctx.rotate((s-m)/u*Math.PI*-l),this.ctx.textAlign="center";for(var g=0;g<e.length;g++){if(c&&" "===e[g]){this.ctx.rotate((3*this.textSettings.padding+o+h)/u*(2*Math.PI)*l);continue}let s=this.ctx.measureText(e[g]).width/2;this.ctx.rotate((s+p)/u*Math.PI*2*l),this.drawChar(e[g],0,t+i,n),this.ctx.rotate((s+h+p)/u*Math.PI*2*l)}}this.ctx.restore()},this.drawArcLine=(e,t,s,i,n)=>{const a=this.textSettings.getLineSpacing(),r=this.textSettings.getLetterSpacing();let[o,h]=this.calculateArcRadius(),c=o-t,d=c*Math.PI*2,u=this.textSettings.curveAmount<0,p=!1;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=c-this.textSettings.height/2;if(e>0){let t=s/(c*Math.PI*2)*360*(Math.PI/180/2),i=u?this.canvas.height-o:o,n=u?90:270,a=n*(Math.PI/180)-t,r=n*(Math.PI/180)+t;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,i,e,a,r),this.ctx.stroke(),this.ctx.restore()}}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=-s/2;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let i=e.split(" ");for(var g=0;g<this.words.length;g++)if(i[g]&&""!==i[g]){let e=this.measureTextWidth(i[g],r,!0)+2*this.textSettings.padding,s=c-this.textSettings.height/2;if(s<0)continue;let n=c*Math.PI*2,h=e/n*360*(Math.PI/180),l=t/n*360*(Math.PI/180),d=u?this.canvas.height-o:o,p=u?90:270,m=p*(Math.PI/180)+(u?-l:l),v=p*(Math.PI/180)+(u?-(h+l):h+l);this.ctx.beginPath(),u?this.ctx.arc(this.rect.width/2,d,s,v,m):this.ctx.arc(this.rect.width/2,d,s,m,v),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+a)}this.ctx.restore(),p=!0}if(this.ctx.save(),e.length>0){let t=u?-1:1,h=u?c-this.textSettings.height-this.textSettings.ascent:-c-this.textSettings.ascent;this.ctx.textAlign="center",this.ctx.translate(this.ctx.canvas.width/2,u?this.canvas.height-o:o),this.ctx.rotate((s-2*r-2*this.textSettings.padding)/d*Math.PI*-t);for(var m=0;m<e.length;m++){if(p&&" "===e[m]){this.ctx.rotate((3*this.textSettings.padding+a+r)/d*(2*Math.PI)*t);continue}let s=this.ctx.measureText(e[m]).width;s/d*Math.PI*2>5e-4?(this.ctx.rotate(s/2/d*Math.PI*2*t),this.drawChar(e[m],0,h+i,n),this.ctx.rotate((s/2+r)/d*Math.PI*2*t)):(this.drawChar(e[m],s/2,h+i,n),this.ctx.rotate((s+r)/d*Math.PI*2*t))}}this.ctx.restore()},this.drawLine=(e,t,s,i,n,a=!1)=>{var r,o;let h=0;const c=this.textSettings.getLetterSpacing();if("center"==this.textSettings.align?h=Math.round((this.rect.width-s)/2):"right"==this.textSettings.align&&(h=Math.round(this.rect.width-s)),this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_LINE&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(s),this.textSettings.height+2*this.textSettings.padding),null===(r=this.fill)||void 0===r||r.addToCanvas(this.ctx)),this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let a=this.textSettings.getLineSpacing(),r=e.split(" ");for(var d=0;d<this.words.length;d++)r[d]&&""!==r[d]&&(s=this.measureTextWidth(r[d],c,!0),this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(s+2*this.textSettings.padding),this.textSettings.height+2*this.textSettings.padding),null===(o=this.fill)||void 0===o||o.addToCanvas(this.ctx),0===c?this.drawText(r[d],h+this.textSettings.padding+c,t-this.textSettings.ascent+i,n):this.drawSpacedText(r[d],h+this.textSettings.padding+c,t-this.textSettings.ascent+i,c,n),h+=Math.round(s+3*this.textSettings.padding+a))}else 0!==c||a?this.drawSpacedText(e,h+this.textSettings.padding+c,t-this.textSettings.ascent+i,c,n):this.drawText(e,h+this.textSettings.padding+c,t-this.textSettings.ascent+i,n)},this.drawSpacedText=(e,t,s,i,n)=>{let a=0,r="";for(;a<e.length;)r=e[a++],this.drawChar(r,t,s,n),t+=this.ctx.measureText(r).width+i},this.drawText=(e,t,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&!this.speeed&&this.ctx.strokeText(e,t,s),(!this.speeed&&void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch)&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.speeed||this.ctx.strokeText(e,t+i.x,s+i.y)},this.drawChar=(e,t,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&!this.speeed&&this.ctx.strokeText(e,t,s),(!this.speeed&&void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch)&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.speeed||this.ctx.strokeText(e,t+i.x,s+i.y)},this.measureTextWidth=(e,t,s)=>{if(!e)return;let i=0;if(0!==t)for(let n=0;n<e.length;n++)i+=this.ctx.measureText(e[n]).width;else i=this.ctx.measureText(e).width;return s&&(i+=t),i+e.length*t},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-4*this.textSettings.padding,this.bect.y=this.rect.y-4*this.textSettings.padding))},this.scale=(e,t)=>{this.textSettings.setSize(Math.round(this.textSettings.size*t)),this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.render()},this.calculate=(e,t)=>{this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x),this.rect.width<20&&(this.rect.width=20),this.render()},this.setWidth=e=>{this.rect.width=Math.round(e),this.rect.width<20&&(this.rect.width=20),this.render()},this.getHeight=()=>this.textSettings.height,this.setHeightScale=e=>{let t=Math.round(this.textSettings.size*e);this.setTextSize(t)},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new c.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{let t=new u(e?this.id:i.M8(),this.text,this.rect.clone(),this.textSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=d.Z.clone(this.animation),t.rect=this.rect.clone(),t.canvas=i.dN(this.canvas),t.prepare(),e&&(t.id=this.id),t},this.textSettings=p,this.text=t,this.rect=s}drawCurveLine(e,t,s,i,n){switch(this.textSettings.curveType){case"arc":this.drawArcLine(e,t,s,i,n);break;case"circle":this.drawCircleLine(e,t,s,i,n);break;case"half":this.drawHalfLine(e,t,s,i,n)}}}},7758:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3947),n=s(3655);class a{constructor(e,t,s=!0){this.lineSpace=0,this.letterSpace=0,this.bold=!1,this.italic=!1,this.uppercase=!1,this.undeline=!1,this.align="center",this.curve=!1,this.curveAmount=0,this.curveType="arc",this.curveFlip=!1,this.curveSpread=!1,this.background=!1,this.backgroundOffset=0,this.backgroundPunch=!1,this.backgroundColor="#555555",this.backgroundType=a.BACKGROUND_FULL,this.outline=!1,this.outlinePunch=!1,this.outlineColor="#555555",this.outlineSize=.3,this.outlineDistance=0,this.outlineDirection=305,this.shadow=!1,this.shadowBlur=.3,this.shadowColor="#444444",this.shadowAlpha=.3,this.shadowDistance=.3,this.shadowDirection=160,this.font=e,this.size=t,s&&this.measureText()}setSize(e){this.size=e,this.measureText()}setFont(e){this.font=e,this.measureText()}measureText(){if(this.size<1)return;var e=document.createElement("canvas");e.width=20*this.size,e.height=Math.round(2*this.size);var t=e.getContext("2d");t.textBaseline="top",t.fillStyle="white",t.font=this.getCssFont(),t.fillText("SfTgMjkHpqLRnliIFIABCDEFGIJKNOPQSUVXYZabcdeghmnorstuvxyz",0,Math.round(.5*this.size)),t=void 0;const s=n.l(e);this.ascent=s.y-Math.round(.5*this.size),this.height=s.height,this.height<=0&&this.measureTextFallback(),this.padding=Math.round(.2*this.height)}measureTextFallback(){var e=document.createElement("span");e.innerHTML="ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz",e.style.fontFamily=this.font,e.style.fontSize=this.size+"px";var t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px";var s=document.createElement("div");s.appendChild(e),s.appendChild(t),(0,i.ZP)("workspace").appendChild(s);try{t.style.verticalAlign="baseline",this.ascent=t.offsetTop-e.offsetTop+1,t.style.verticalAlign="bottom",this.height=t.offsetTop-e.offsetTop+1}finally{s.remove()}}getLineSpacing(){var e;return Math.ceil(this.height*Number(null!==(e=this.lineSpace)&&void 0!==e?e:0))}getLetterSpacing(){var e;return Math.ceil(this.height/2*Number(null!==(e=this.letterSpace)&&void 0!==e?e:0))}getCssFont(e=this.size){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+e+"px "+this.font}clone(){const e=Object.create(a.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.font===e.font&&this.size===e.size&&this.lineSpace===e.lineSpace&&this.letterSpace===e.letterSpace&&this.bold===e.bold&&this.italic===e.italic&&this.uppercase===e.uppercase&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.align===e.align&&this.curve===e.curve&&this.curveAmount===e.curveAmount&&this.curveType===e.curveType&&this.curveSpread===e.curveSpread&&this.curveFlip===e.curveFlip&&this.background===e.background&&this.backgroundPunch===e.backgroundPunch&&this.backgroundColor===e.backgroundColor&&this.backgroundType===e.backgroundType&&this.outline===e.outline&&this.outlinePunch===e.outlinePunch&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.outlineDistance===e.outlineDistance&&this.outlineDirection===e.outlineDirection&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowAlpha===e.shadowAlpha&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}a.BACKGROUND_FULL="full",a.BACKGROUND_LINE="line",a.BACKGROUND_WORD="word"},4820:(e,t,s)=>{s.d(t,{Lt:()=>r,ZP:()=>c,nS:()=>o});var i=s(3947),n=s(1030),a=s(3673);function r(e,t){(0,n.Z)("setting-"+e,t.toString());const s=window.localStorage.getItem("user-settings"),i=JSON.parse(s||"{}");h[e]=i[e]=t,window.localStorage.setItem("user-settings",JSON.stringify(i)),document.dispatchEvent(new CustomEvent("user-setting-updated",{detail:e}))}function o(e){let t=e.toHEX(),s=h.oldColor.findIndex((e=>e===t));s>-1?h.oldColor.splice(0,0,h.oldColor.splice(s,1)[0]):(h.oldColor.pop(),h.oldColor.unshift(t)),r("oldColor",h.oldColor)}const h=function(){const e={product:"",api:!1,debug:"",premium:"",locktarget:!1,cdnUrl:"",accent:"default",workspace:"default",allTooltip:!1,autoSelect:!0,showGuides:!0,snapToGuides:!0,smoothScaling:!0,askToAddLayer:!0,askToPreResize:!0,scrollMode:"zoom",maxHistoryUndos:25,boxBarXState:"maximized",panelFloating:!1,panelNavigator:!0,panelLayer:!0,panelHistory:!0,mainColor:"#ffffff",altColor:"#000000",oldColor:["#A8534B","#EC9D75","#F9D697","#DCE6A7","#9ADFB0","#57CBAB","#38A793","#5A5E5A"],gradients:[],dialogPos:new a.Z(0,0),user:void 0,adyenClientKey:"",eligibleFreeTrial:!1,lastNewsCheck:"1970-01-01T00:00:00Z"};return Object.assign(e,(()=>{const e=window.localStorage.getItem("user-settings");return JSON.parse(e||"{}")})()),Object.assign(e,(()=>{const e=new URL(window.location.href),t={};return e.searchParams.forEach(((e,s)=>{t[s]=e})),t})()),Object.assign(e,(()=>{const e=(0,i.ZP)("config_data");if(e&&e.innerText){let e=JSON.parse((0,i.ZP)("config_data").innerText);return(0,i.ZP)("config_data").remove(),e}return{}})()),e.api=e.locktarget=!!e.image&&!!e.referrer,"pixlr.com"!==location.hostname&&"true"===e.premium&&(e.user.subscription=!0,e.user.subscriptionType="premium"),e}(),c=h},5700:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),n=s(3947),a=s(1030),r=s(1951);class o{constructor(e){this.showPremium=()=>{this.close(),new r.Z(this.stage,"")},this.close=()=>{this.pop.remove(),this.modal.remove(),this.pop=void 0,this.modal=void 0},(0,a.Z)("ads","pop"),this.modal=(0,n.T)("div",{id:"modal-pop",className:"modal dim centercenter"}),document.body.appendChild(this.modal);let t=(0,n.T)("div",{id:"pop-ad"}),s=(0,n.T)("div",{id:"pop-sales"},(0,i.Z)("premiumSkipAds"),(0,n.T)("span",{className:"anchor",style:"padding-left:6px",onclick:this.showPremium},(0,i.Z)("premiumTryFree")));this.pop=(0,n.T)("div",{id:"pop"},t,s,(0,n.T)("img",{id:"pop-close",src:"/img/icon/close.svg",style:"display:none",onclick:()=>this.close()})),this.modal.append(this.pop),t.appendChild((0,n.T)("iframe",{src:"/dad/pop/",frameBorder:"0",scrolling:"no",style:"width:300px;height:250px;overflow:hidden;"})),(0,a.Z)("ads","pop"),window.setTimeout((()=>{(0,n.ZP)("pop-close").style.display="block"}),3e3)}}},5402:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3947),n=s(1030),a=s(4820);class r{constructor(){this.INTERVALL=11e4,this.timeToSneak=()=>{if(!(document.body.offsetWidth<750||a.ZP.user.subscription))if(this.stamp){if(this.stamp+this.INTERVALL<(new Date).getTime()&&(this.stamp=(new Date).getTime(),!(0,i.ZP)("sneaky"))){let e=(0,i.T)("div",{id:"sneaky-ad"}),t=(0,i.T)("div",{id:"sneaky"},e,(0,i.T)("img",{id:"sneaky-close",src:"/img/icon/close.svg",style:"display:none",onclick:()=>this.close()}));(0,i.ZP)("workspace").append(t),e.appendChild((0,i.T)("iframe",{src:"/dad/sneaky/",frameBorder:"0",scrolling:"no",style:"width:728px;height:90px;overflow:hidden;"})),(0,n.Z)("ads","sneaky"),window.setTimeout((()=>{(0,i.ZP)("sneaky-close").style.display="block"}),3e3)}}else this.stamp=(new Date).getTime()},this.close=()=>{var e;this.stamp=(new Date).getTime(),null===(e=(0,i.ZP)("sneaky"))||void 0===e||e.remove()}}}},7909:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3655),n=s(3947);class a{constructor(e=!0){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0]},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2)+"px";let e=this.dialog.getBoundingClientRect(),t=this.modal.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{(0,n.ZP)("workspace")&&(0,n.ZP)("workspace").classList.remove("blur"),(0,n.ZP)("home")&&(0,n.ZP)("home").classList.remove("blur"),document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=i.Zd(),(0,n.ZP)("workspace")&&(0,n.ZP)("workspace").classList.add("blur"),(0,n.ZP)("home")&&(0,n.ZP)("home").classList.add("blur"),this.modal=(0,n.T)("div",{id:"modal-"+this.mid,className:"modal"}),e&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,n.T)("div",{className:"announce"}),this.modal.appendChild(this.dialog),this.content=(0,n.T)("div",{className:"content"}),this.dialog.append((0,n.T)("img",{id:"announce-close"+this.mid,className:"close",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),this.content),document.addEventListener("keydown",this.keyDown,!1)}}},4652:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),n=s(3947),a=s(7909),r=s(1030),o=s(4820);class h extends a.Z{constructor(e,t=0){if(super(),this.selectedIndex=t,this.dialog.classList.add("news-dialog"),e.length>1){const s=e.map(((s,i)=>(0,n.T)("a",{id:`news-menu-item-${i}`,className:i===t?"item selected":"item",href:"javascript:;",onclick:()=>{(0,n.ZP)(`news-menu-item-${this.selectedIndex}`).classList.remove("selected"),(0,n.ZP)(`news-menu-item-${i}`).classList.add("selected"),(0,n.ZP)("news-current").replaceWith(c(e[i])),this.selectedIndex=i,(0,r.Z)("news-select")}},(0,n.T)("div",{className:"block"}),(0,n.T)("div",s.title))));this.setContent((0,n.T)("div",{className:"news-split"},(0,n.T)("div",{className:"news-menu"},(0,n.T)("div",{className:"headline"},(0,i.Z)("whatsNew")),...s),c(e[t],this.position)))}else this.setContent(c(e[0],this.position));this.position(),(0,o.Lt)("lastNewsCheck",(new Date).toISOString())}}function c(e,t){const s=new Date(e.publishDate);let a;if(e.video){const s=()=>{const t=Math.max(360,i.getBoundingClientRect().height),s=`https://www.youtube.com/embed/${e.video}?autoplay=1&modestbranding=1`;a.style.height=t+"px",i.style.filter="blur(6px)",(0,r.Z)("news-play"),a.append((0,n.T)("div",{className:"player-container"},(0,n.T)("iframe",{width:"640",height:"360",src:s,className:"player",allow:"autoplay"})))};let i=(0,n.T)("img",{className:"news-cover",src:e.cover,onload:t}),o=(0,n.T)("div",{className:"play-button",onclick:s},(0,n.T)("img",{src:"/img/icon/play-circle.svg"}));a=(0,n.T)("div",{className:"cover-stack"},i,o)}else a=(0,n.T)("img",{className:"news-cover",src:e.cover,onload:t});return(0,n.T)("div",{id:"news-current"},a,(0,n.T)("div",{className:"news-content"},(0,n.T)("div",{className:"news-title"},(0,n.T)("span",{className:"news-headline"},e.title),(0,n.T)("span",s.toLocaleDateString())),(0,n.T)("div",{className:"news-text"},e.text),e.learnMore?(0,n.T)("a",{className:"button positive",href:e.learnMore,target:"_blank",onmousedown:()=>{(0,r.Z)("news-learnmore")}},(0,i.Z)("learnMore")):null))}},1951:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),n=s(6548),a=s(1030),r=s(7909),o=s(4820),h=s(6577),c=s(6854),l=s(2409);class d extends r.Z{constructor(e,t){super(!0),this.hasPlayBilling=!1,this.isPlayBilling=async()=>{this.hasPlayBilling=await(0,l.Ev)(),this.hasPlayBilling&&((0,i.ZP)("play-info").style.display="block")},this.showAuth=async()=>{(0,i.ZP)("bounce-content").style.display="none",(0,i.ZP)("bounce-entry").style.display="flex",new c.k("login",{method:"embed",holder:(0,i.ZP)("bounce-entry")})},this.stage=e,(0,a.Z)("premium-bounce","show"),this.content.style.minHeight="600px",this.isPlayBilling();let s="",r="premium.jpg";switch(t){case"FONT":s=(0,n.Z)("premiumFontSalesPitch"),r="premium-font.webp";break;case"CUTOUT":s=(0,n.Z)("premiumCutoutSalesPitch"),r="premium-cutout.webp";break;case"ELEMENT":s=(0,n.Z)("premiumElementSalesPitch"),r="premium-element.webp";break;case"STUDIO":s=(0,n.Z)("premiumStudioSalesPitch"),r="premium-studio.webp";break;case"BATCH":s=(0,n.Z)("premiumBatchSalesPitch"),r="premium-batch.webp";break;case"PHOTOMASH":s=(0,n.Z)("premiumPhotomashSalesPitch"),r="premium-studio.webp"}this.setContent(`\n            <div id="bounce-content" style="display:flex;flex-direction:column;width:50%;padding:30px;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>\n                   \n                <h1 class="pad-30">${(0,n.Z)("premiumBounceTitle")}</h1>\n\n                <p class="pad-20">${s}</p>\n\n                <p class="pad-30" style="text-align:left;font-weight:bold">${(0,n.Z)("premiumFeatureAlso")}</p>\n\n                <ul>\n                    <li>${(0,n.Z)("premiumFeaturePitchOne")}</li>\n                    <li>${(0,n.Z)("premiumFeaturePitchTwo")}</li>\n                    <li>${(0,n.Z)("premiumFeaturePitchThree")}</li>\n                    <li>${(0,n.Z)("premiumFeaturePitchFour")}</li>\n                    <li>${(0,n.Z)("premiumFeaturePitchFive")}</li>\n                </ul>\n\n                <button target="_blank" id="premium-go-now" style="margin-top:auto" class="button big green w-100">${(0,n.Z)("try30DayFreePremium")}</button>\n                <div id="play-info" class="pad-10" style="display:none;font-size:12px;font-style:italic">\n                    *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                </div>\n                <p class="pad-20 center" id="one-of-us">${(0,n.Z)("alreadyMember")} <a id="premium-auth" class="link" style="cursor:pointer">${(0,n.Z)("logInNow")}</a></p>\n            </div>\n            <div id="bounce-entry" style="display:none;flex-direction:column;width:50%;"></div>\n            <div style="width:50%;background-image:url(/img/misc/${r});background-repeat:no-repeat;background-size:cover"></div>\n        `),"guest"!==o.ZP.user.name?((0,i.ZP)("one-of-us").style.display="none",(0,i.ZP)("premium-go-now").addEventListener("click",(async()=>{if(this.hasPlayBilling){await(0,l.V)(!1,null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"subscription",{bounceSource:"premiumbounce",bounceType:t,plan:"premium-monthly"})}),!0)):((0,i.ZP)("premium-auth").addEventListener("click",this.showAuth,!0),(0,i.ZP)("premium-go-now").addEventListener("click",this.showAuth,!0)),this.position()}}},840:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),n=s(6548),a=s(1030),r=s(7909),o=s(4820),h=s(6577),c=s(6854),l=s(2409);class d extends r.Z{constructor(e){super(!0),this.hasPlayBilling=!1,this.checkPlayBilling=async()=>{this.hasPlayBilling=await(0,l.Ev)(),this.hasPlayBilling&&((0,i.ZP)("gpay-info").style.display="block")},this.showAuth=async()=>{(0,i.ZP)("bounce-content").style.display="none",(0,i.ZP)("bounce-entry").style.display="flex",new c.k("login",{method:"embed",holder:(0,i.ZP)("bounce-entry")})},this.stage=e,(0,a.Z)("premium-bounce","template"),this.setContent(`\n            <div id="bounce-content" style="display:flex;width:50%;padding:30px;flex-direction:column;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div> \n\n                <h1 class="pad-40">${(0,n.Z)("premiumTemplate")}</h1>\n\n                <p class="pad-10">${(0,n.Z)("premiumTemplateSalesPitch")}</p>\n\n                <div style="display:flex;flex-direction:column;flex-grow:1;padding-bottom:10px;">\n                    <a id="premium-one-time" class="button big green w-100" style="margin-top:auto">${(0,n.Z)("premiumOneTime")} ${"USD"===o.ZP.user.currency?"$":"€"}1</a>\n                    <a id="premium-go-now" class="button big green outline pad-15 w-100">${(0,n.Z)("try30DayFreePremium")}</a>\n                    <div id="gpay-info" class="pad-10 center" style="display:none;font-size:12px;font-style:italic">\n                        *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                    </div>\n                    <p class="pad-30 center" id="one-of-us">${(0,n.Z)("alreadyMember")} <a id="premiumbounce-auth" class="link" style="cursor:pointer">${(0,n.Z)("logInNow")}</a></p>\n                </div>\n            </div>\n            <div id="bounce-entry" style="display:none;flex-direction:column;width:50%;"></div>\n            <div id="bounce-template-holder" class="left-panel">\n\n            </div>\n        `),(0,i.ZP)("bounce-template-holder").appendChild(this.stage.getOutputCanvas()),"guest"===o.ZP.user.name?((0,i.ZP)("premium-one-time").addEventListener("click",this.showAuth),(0,i.ZP)("premium-go-now").addEventListener("click",this.showAuth)):((0,i.ZP)("one-of-us").style.display="none",(0,i.ZP)("premium-one-time").addEventListener("click",(async()=>{var t,s,i;if(this.hasPlayBilling){await(0,l.V)(!0,null!==(i=null===(s=null===(t=this.stage.fresco)||void 0===t?void 0:t.templateMeta)||void 0===s?void 0:s.templateId)&&void 0!==i?i:null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"template",{bounceSource:"premiumtemplatebounce"})})),(0,i.ZP)("premium-go-now").addEventListener("click",(async()=>{if(this.hasPlayBilling){await(0,l.V)(!1,null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"subscription",{bounceSource:"premiumtemplatebounce"})}))),(0,i.ZP)("premiumbounce-auth").addEventListener("click",this.showAuth),this.checkPlayBilling(),this.position()}}},6995:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),n=s(6548),a=s(5934),r=s(1030),o=s(7909);class h extends o.Z{constructor(e,t){super(!0),this.loadTemplate=async()=>{this.cleanUp(),await a.$k(this.stage,this.template)},(0,r.Z)("template-preview",t.id),this.stage=e,this.template=t;let s="";this.template.keywords.forEach((e=>{s+='<a href="#template&keyword='+e+'" class="tag">'+e+"</a> "})),this.setContent(`\n            <div style="width:500px;height:550px;padding:20px;background: linear-gradient(43deg, #282828 0%, #424242 100%);background-color: #333333;" class="centercenter">\n                <img src="${this.template.preview}" style="max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);">\n            </div>\n            <div class="center" style="width:340px;display:flex;flex-direction:column;padding:20px;background-color:rgba(0,0,0,0.05);"> \n                <div style="flex-grow:2">\n                    <h2 class="pad-30">${this.template.name}</h2>\n                    <h3><a href="#template&category=${this.template.category}" style="color:#444;">${(0,n.Z)(this.template.category)}</a></h3>\n                    <h4>${this.template.ratio.width} x ${this.template.ratio.height} px</h4>\n                    <p class="pad-20">${s}</p>\n                </div>\n                <div id="load-template-preview" class="button big green pad-50">${(0,n.Z)("useTemplate")}</div>\n                <div class="pad-20"><a class="link" id="close-template-preview" style="font-weight:bold;"> ${(0,n.Z)("close")}</a></div>\n            </div>\n        `),t.premium?this.setContent('<div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>'):this.setContent('<div class="free-tag" title="free">'+(0,n.Z)("free")+"</div>"),(0,i.ZP)("load-template-preview").addEventListener("click",this.loadTemplate,!0),(0,i.ZP)("close-template-preview").addEventListener("click",this.cleanUp,!0),this.position()}}},8093:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3947),n=s(3655);class a{constructor(e){if(this.numSections=0,this.outerWidth=0,this.contentWidth=0,this.bind=n.d4(50,(()=>{if(this.outerWidth=this.outer.clientWidth,this.contentWidth=this.content.scrollWidth,this.contentWidth>this.outerWidth&&(this.forward.style.display="block"),this.numSections=Math.floor(this.contentWidth/this.outerWidth),this.indicator.innerHTML="",this.numSections>0)for(let e=0;e<=this.numSections;e++){const t=(0,i.T)("li");t.setAttribute("data",e.toString()),t.addEventListener("click",this.sectionClick),0===e&&t.classList.add("active"),this.indicator.append(t)}this.scoll()})),this.sectionClick=e=>{const t=Number(e.currentTarget.getAttribute("data"));this.outer.scrollTo(this.outerWidth*t,0)},this.forwardClick=()=>{this.outer.scrollBy(this.outerWidth,0)},this.backClick=()=>{this.outer.scrollBy(-this.outerWidth,0)},this.scoll=n.d4(50,(()=>{const e=Math.ceil(this.outer.scrollLeft/this.outerWidth);if(this.forward.style.display=e===this.numSections?"none":"block",this.back.style.display=this.outer.scrollLeft>0?"block":"none",this.numSections>0)for(let t=0;t<=this.numSections;t++)t===e?this.indicator.children[t].classList.add("active"):this.indicator.children[t].classList.remove("active")})),this.numItems=()=>this.content.children.length,this.addItem=e=>{this.content.appendChild(e)},this.clearItem=()=>{this.content.innerHTML=""},this.container=(0,i.ZP)(e),this.container.classList.add("carousel"),this.content=(0,i.T)("div",{id:e+"-content",className:"content"}),this.container.hasChildNodes())for(;this.container.firstChild;)this.content.appendChild(this.container.firstChild);this.outer=(0,i.T)("div",{id:e+"-outer",className:"outer"},this.content),this.indicator=(0,i.T)("ul",{id:e+"-indicator"}),this.back=(0,i.T)("div",{id:e+"-back",className:"back ic"}),this.forward=(0,i.T)("div",{id:e+"-forward",className:"forward ic"}),this.container.append(this.outer,this.indicator,this.back,this.forward),this.forward.addEventListener("click",this.forwardClick,!0),this.back.addEventListener("click",this.backClick,!0),this.outer.addEventListener("scroll",this.scoll,!0),this.forward.style.display="none",this.back.style.display="none",new ResizeObserver(this.bind).observe(this.content)}}},4211:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3947),n=s(8776),a=s(5181);class r{constructor(e,t,s,r){this.previewColor=e=>{this.setColor(e),this.preview&&this.preview(this.color)},this.callbackColor=e=>{this.setColor(e),this.callback&&this.callback(this.color)},this.setColor=e=>{e instanceof n.Z?this.color=e:this.color=n.Z.fromHEX(e),this.container.style.backgroundColor=this.color.toHEX()},this.getColor=()=>this.color,this.picker=()=>{new a.Z(this.color,this.callbackColor,this.previewColor)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.preview=r,this.callback=s,this.container=(0,i.ZP)(e),this.container.classList.add("color-pod"),this.container.addEventListener("click",this.picker,!1),this.setColor(t)}}},2397:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3655),n=s(3947),a=s(3673),r=s(8776);class o{constructor(e,t=["#ffffff","#eb7d46","#b4eb46","#46eb7d","#46b4eb","#7d46eb","#eb46b4"],s,o=!0,h=220,c=100,l=!1){var d;if(this.activeColorPick=e=>{if((0,n.ZP)("modal-color-select"))return;const t=document.createElement("div");t.classList.add("modal"),t.id="modal-color-select",t.style.cursor="crosshair",document.body.appendChild(t),this.preview=document.createElement("div"),this.preview.classList.add("color-selector-preview"),this.preview.style.display="none",t.appendChild(this.preview),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=i.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d"),t.addEventListener("click",this.removeColorPicker,!0),t.addEventListener("mousemove",this.pickerPreviewColor,!0)},this.pickerPreviewColor=e=>{let t=new a.Z(e.clientX,e.clientY);if(this.preview.style.top=t.y-60+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.preview.style.display="none");let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new r.Z(s[0],s[1],s[2]).toHEX()},this.removeColorPicker=e=>{(0,n.ZP)("modal-color-select").remove(),this.preview=null;let t=new a.Z(e.clientX,e.clientY);if(t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data,i=new r.Z(s[0],s[1],s[2]);this.setHex(i.toHEX(),!0),this.updateColor(!0)},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,{passive:!1}),document.addEventListener("touchend",this.satTouchEnd,{passive:!1});var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove),document.removeEventListener("touchend",this.satTouchEnd)},this.selectSat=(e,t)=>{e=i.uZ(e,0,this.width),t=i.uZ(t,0,this.height),this.hsb.s=e/this.width,this.hsb.b=1-t/this.height,this.setSat(),this.updateColor()},this.setSat=()=>{this.satKnob.style.left=this.hsb.s*this.width-9+"px",this.satKnob.style.top=(1-this.hsb.b)*this.height-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect(),s=e.pageX-t.left;this.selectHue(s)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect(),s=e.pageX-t.left;this.selectHue(s)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,{passive:!1}),document.addEventListener("touchend",this.hueTouchEnd,{passive:!1});var t=e.target.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left;this.selectHue(s)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left;this.selectHue(s)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove),document.removeEventListener("touchend",this.hueTouchEnd)},this.selectHue=e=>{e=i.uZ(e,0,this.width),this.hsb.h=Math.round(e/this.width*360),this.setHue(),this.updateColor()},this.setHue=()=>{this.hueKnob.style.left=this.hsb.h/360*this.width-2+"px";let e=this.satSlide.getContext("2d");e.fillStyle=r.Z.fromHSB(this.hsb.h,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=e.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=s,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.selectPod=e=>{var t;let s=e.currentTarget;if(s.classList.contains("selected")&&!this.extended)"block"==this.selector.style.display?this.selector.style.display="none":(this.selector.style.display="block",this.setHex(s.getAttribute("data")));else{if(null===(t=this.selected)||void 0===t||t.classList.remove("selected"),this.selected=s,this.selected.classList.add("selected"),this.selector.style.display="block","empty"===s.getAttribute("data"))return void(this.callback&&this.callback(void 0));this.setHex(s.getAttribute("data"),!0)}},this.updateColor=(e=!0,t=!0)=>{clearTimeout(this.setTimer),this.color=r.Z.fromHSB(this.hsb.h,this.hsb.s,this.hsb.b);const s=this.color.toHEX();this.hexInput.value=s,t&&this.selected&&(this.selected.classList.contains("empty")&&(this.selected.classList.remove("selected"),this.selected=this.selected.nextElementSibling,this.selected.classList.add("selected")),this.selected.setAttribute("data",s),this.selected.style.backgroundColor=s),this.setTimer=setTimeout((()=>{this.callback&&e&&this.callback(this.color)}),50)},this.hexInputInput=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setHex(this.hexInput.value,!1)},this.hexInputBlur=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)?this.setHex(this.hexInput.value,!0):this.hexInput.value=this.getHex()},this.setColor=(e,t=!1)=>{this.hsb=e.toHSB(),this.setHue(),this.setSat(),this.updateColor(t,!0)},this.setHex=(e,t=!1)=>this.setColor(r.Z.fromHEX(e),t),this.getHex=()=>this.color.toHEX(),this.getColor=()=>this.color,this.holder=e,this.callback=s,this.width=h,this.height=c,this.extended=l,this.holder.innerHTML="",this.presets=(0,n.T)("div",{className:"color-selector-presets",style:"width:"+this.width+"px"}),l){this.presets.classList.add("extended");let e=(0,n.T)("div",{className:"color-pod square empty"});e.addEventListener("click",this.selectPod,!1),e.setAttribute("data","empty"),void 0===t[0]&&(e.classList.add("selected"),this.selected=e),this.presets.appendChild(e)}for(let i=0;i<t.length;++i)if(void 0!==t[i]){let e=document.createElement("div");e.addEventListener("click",this.selectPod,!1),e.style.backgroundColor=t[i],e.setAttribute("data",t[i]),e.className=l?"color-pod square":"color-selector-pod",this.presets.appendChild(e),i+1===t.length&&e.classList.add("last"),0!==i||l||(this.selected=e,e.classList.add("selected"))}this.selector=(0,n.T)("div",{className:"color-selector-selector",style:"width:"+this.width+"px"}),l?(this.selector.style.display="block",this.presets.classList.add("pad-10"),this.holder.append(this.selector,(0,n.T)("div",{className:"splitter pad-10"}),this.presets)):(this.selector.classList.add("pad-16"),this.holder.append(this.presets,this.selector));let u=document.createElement("div");u.classList.add("color-selector-sat"),u.style.width=this.width+"px",u.style.height=this.height+"px",this.selector.appendChild(u),this.satSlide=i.vL(this.width,this.height),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.satSlide.classList.add("color-selector-sat-slide"),u.appendChild(this.satSlide),this.satKnob=document.createElement("div"),this.satKnob.classList.add("color-selector-sat-knob","ic"),u.appendChild(this.satKnob);let p=document.createElement("div");if(p.classList.add("color-selector-hue"),p.style.width=this.width+"px",this.selector.appendChild(p),this.hueSlide=document.createElement("div"),this.hueSlide.style.width=this.width+"px",this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hueSlide.classList.add("color-selector-hue-slide"),p.appendChild(this.hueSlide),this.hueKnob=document.createElement("div"),this.hueKnob.classList.add("color-selector-hue-knob","ic"),p.appendChild(this.hueKnob),this.hexInput=document.createElement("input"),this.hexInput.type="text",this.hexInput.spellcheck=!1,this.hexInput.maxLength=7,this.hexInput.addEventListener("input",this.hexInputInput,!1),this.hexInput.addEventListener("blur",this.hexInputBlur,!1),this.hexInput.classList.add("color-selector-input"),this.selector.appendChild(this.hexInput),o){let e=document.createElement("a");e.classList.add("color-selector-pick"),e.classList.add("button","outline"),e.innerHTML='<img src="/img/tool/thick/picker.svg" class="ic" width="16" height="16" loading="lazy"/>',e.addEventListener("click",this.activeColorPick,!1),this.selector.appendChild(e)}this.hsb=r.Z.fromHEX(null!==(d=t[0])&&void 0!==d?d:"#ffffff").toHSB(),this.setHue(),this.setSat(),this.updateColor(!1,!!t[0])}}},9924:(e,t,s)=>{s.d(t,{C:()=>a,Z:()=>n});var i=s(3947);class n{constructor(e,t,s,i,n){this.name=e,this.callback=t,this.short=s,this.icon=i,this.sub=n}}class a{constructor(e,t,s=!1){this.addItem=(e,t)=>{if(e.name)if(e.sub){const s=(0,i.T)("ul"),n=(0,i.T)("li",{className:"more"},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,s);for(const t of e.sub)this.addItem(t,s);t.append(n)}else e.callback?t.appendChild((0,i.T)("li",{onclick:()=>{e.callback(),this.cleanUp()}},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,e.short?(0,i.T)("span",{},e.short):"")):t.appendChild((0,i.T)("li",{className:"disabled"},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,e.short?(0,i.T)("span",{},e.short):""));else t.appendChild((0,i.T)("li",{className:"split"}))},this.cleanUp=()=>{this.holder.removeEventListener("mouseleave",this.cleanUp),this.holder.remove(),this.holder=void 0,this.id=void 0},this.id=Math.round(99999999999999*Math.random()).toString(),this.holder=(0,i.T)("div",{id:this.id,className:"overflow-menu-holder"}),this.holder.addEventListener("contextmenu",(e=>(e.stopPropagation(),e.preventDefault(),!1))),this.holder.style.display="block",this.holder.style.left=s?e.x-235+"px":e.x-5+"px",this.list=(0,i.T)("ul",{className:"overflow-menu"}),this.holder.appendChild(this.list);for(const i of t)this.addItem(i,this.list);this.holder.addEventListener("mouseleave",this.cleanUp);const n="block"===(0,i.ZP)("workspace").style.display?(0,i.ZP)("workspace"):(0,i.ZP)("home");n.appendChild(this.holder),e.y+this.holder.clientHeight>n.scrollHeight?this.holder.style.top=e.y+5-this.holder.clientHeight+"px":this.holder.style.top=e.y-5+"px"}}},9868:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3947),n=s(6548),a=s(3868);class r extends a.Z{constructor(){super((0,n.Z)("dialogChoiceTitle"),!0),this.init=()=>new Promise(((e,t)=>{const s=this.content.querySelector("#open-as-new"),i=this.content.querySelector("#open-in-current");this.cancel=()=>{this.cleanUp(),e("close")},s.onclick=()=>{this.cleanUp(),e("create")},i.onclick=()=>{this.cleanUp(),e("layer")}})),this.setContent(`    \n            ${(0,n.Z)("dialogChoiceHeadline")}\n            <ul class="push-buttons pad-20" style="text-align: center">\n                <li id="open-as-new">\n                    <img src="/img/icon/document-new.svg" class="ic" />\n                    <span>${(0,n.Z)("createNew")}</span>\n                </li>\n                <li id="open-in-current">\n                    <img src="/img/icon/document-add.svg" class="ic" />\n                    <span>${(0,n.Z)("addCurrent")}</span>\n                </li>\n            </ul>\n        `),(0,i.ZP)("dialog-buttons"+this.mid).style.display="none"}}},5181:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(6548),n=s(3655),a=s(3947),r=s(3868),o=s(8776),h=s(3673),c=s(4820);class l extends r.Z{constructor(e,t,s){var r;super((0,i.Z)("titleColorPicker"),!1),this.hue=0,this.sat=0,this.bri=1,this.setHistory=e=>{let t=o.Z.fromRGB(e.currentTarget.style.backgroundColor);this.setColor(t)},this.pickerPreviewColor=e=>{let t=new h.Z(e.clientX,e.clientY);if(this.colorPreview.style.top=t.y-50+"px",this.colorPreview.style.left=t.x+10+"px",this.colorPreview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.colorPreview.style.display="none");let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.colorPreview.style.backgroundColor=new o.Z(s[0],s[1],s[2]).toHEX()},this.pickerPreviewLeave=()=>{this.colorPreview.style.display="none"},this.pickerSetColor=e=>{let t=new h.Z(e.clientX-this.stageC.offsetLeft,e.clientY-this.stageC.offsetTop);if(e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.setColor(new o.Z(s[0],s[1],s[2]))},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,!0),document.addEventListener("touchend",this.satTouchEnd,!0);var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove,!0),document.removeEventListener("touchend",this.satTouchEnd,!0)},this.selectSat=(e,t)=>{e=n.uZ(e,0,256),t=n.uZ(t,0,256),this.sat=e/256,this.bri=1-t/256,this.setSatKnob(),this.calculateColor()},this.setSatKnob=()=>{this.satKnob.style.left=256*this.sat-9+"px",this.satKnob.style.top=256*(1-this.bri)-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,!0),document.addEventListener("touchend",this.hueTouchEnd,!0);var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove,!0),document.removeEventListener("touchend",this.hueTouchEnd,!0)},this.selectHue=e=>{e=n.uZ(e,0,256),this.hue=Math.round(359-e/256*359),this.setHueKnob(),this.calculateColor()},this.setHueKnob=()=>{this.hueKnob.style.top=252-this.hue/359*254+"px";let e=this.satSlide.getContext("2d");e.fillStyle=o.Z.fromHSB(this.hue,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=e.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=s,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.calculateColor=()=>{this.color=o.Z.fromHSB(this.hue,this.sat,this.bri);var e=document.activeElement;this.hexInput.value=this.color.toHEX(),e!==this.hueInput&&(this.hueInput.value=Math.round(this.hue).toString()),e!==this.satInput&&(this.satInput.value=Math.round(100*this.sat).toString()),e!==this.briInput&&(this.briInput.value=Math.round(100*this.bri).toString()),e!==this.redInput&&(this.redInput.value=this.color.r.toString()),e!==this.greenInput&&(this.greenInput.value=this.color.g.toString()),e!==this.blueInput&&(this.blueInput.value=this.color.b.toString()),this.selected.style.backgroundColor=this.color.toRGBA(),this.preview&&n.Ds("preview",50,(()=>{this.preview(this.color)}))},this.hexInputChange=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setColor(o.Z.fromHEX(this.hexInput.value))},this.hueInputChange=e=>{this.hue=n.uZ(parseInt(this.hueInput.value),0,359),this.setHueKnob(),this.calculateColor()},this.satInputChange=e=>{this.sat=n.uZ(parseInt(this.satInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.briInputChange=e=>{this.bri=n.uZ(parseInt(this.briInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.redInputChange=e=>{this.color.r=n.uZ(parseInt(this.redInput.value),0,255),this.setColor(this.color)},this.greenInputChange=e=>{this.color.g=n.uZ(parseInt(this.greenInput.value),0,255),this.setColor(this.color)},this.blueInputChange=e=>{this.color.b=n.uZ(parseInt(this.blueInput.value),0,255),this.setColor(this.color)},this.setColor=e=>{this.color=e;let t=Math.min(e.r,e.g,e.b),s=Math.max(e.r,e.g,e.b);this.bri=s/255;var i=s-t;i?(this.sat=i/s,e.r==s?this.hue=(e.g-e.b)/i*60:e.g==s?this.hue=60*(2+(e.b-e.r)/i):this.hue=60*(4+(e.r-e.g)/i),this.hue>360?this.hue-=360:this.hue<0&&(this.hue+=360),360===this.hue&&(this.hue=0)):this.hue=this.sat=0,this.setHueKnob(),this.setSatKnob(),this.calculateColor()},this.getColor=()=>this.color,this.getHex=()=>this.color.toHEX(),this.cancel=()=>{this.preview&&this.preview(this.current),this.cleanUp()},this.apply=()=>{this.callback&&(this.preview&&this.preview(this.current),(0,c.nS)(this.color),this.callback(this.color)),this.cleanUp()},this.cleanUp=()=>{document.dispatchEvent(new CustomEvent("viewport-render")),(0,a.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.removeEventListener("click",this.setHistory))),this.satSlide.removeEventListener("mousedown",this.satMouseDown,!1),this.satSlide.removeEventListener("touchstart",this.satTouchStart),this.hueSlide.removeEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.removeEventListener("touchstart",this.hueTouchStart),this.hexInput.removeEventListener("input",this.hexInputChange,!1),this.hueInput.removeEventListener("input",this.hueInputChange,!1),this.satInput.removeEventListener("input",this.satInputChange,!1),this.briInput.removeEventListener("input",this.briInputChange,!1),this.redInput.removeEventListener("input",this.redInputChange,!1),this.greenInput.removeEventListener("input",this.greenInputChange,!1),this.blueInput.removeEventListener("input",this.blueInputChange,!1),this.modal.removeEventListener("mousedown",this.pickerSetColor,!0),this.modal.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.removeEventListener("mouseleave",this.pickerPreviewLeave,!0),document.removeEventListener("keydown",this.keyDown,!1),this.stageCanvasCTX=void 0,this.stageCanvas=void 0,this.stageC=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.preview=s,this.callback=t,this.dialog.style.width="500px",this.content.style.paddingBottom="10px",(0,a.ZP)("dialog-apply"+this.mid).innerText="ok",this.setContent('\n            <div id="color-picker-selector">\n                <div id="color-picker-sat">\n                    <canvas id="color-picker-sat-slide"></canvas>\n                    <div id="color-picker-sat-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-hue">\n                    <div id="color-picker-hue-slide"></div>\n                    <div id="color-picker-hue-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-etc">\n                    <div id="color-picker-new"></div>\n                    <div id="color-picker-current"></div>\n\n                    <div id="color-picker-inputs">\n                        <div>\n                            <div>H:<input type="number"id="picker-input-hue"></div>\n                            <div>S:<input type="number"id="picker-input-sat"></div>\n                            <div>B:<input type="number"id="picker-input-bri"></div>\n                        </div>\n                        <div>\n                            <div>R:<input type="number"id="picker-input-red"></div>\n                            <div>G:<input type="number"id="picker-input-green"></div>\n                            <div>B:<input type="number"id="picker-input-blue"></div>\n                        </div>\n                    </div>\n                    <div id="color-picker-hex">\n                        HEX:<input type="text" spellcheck="false" maxlength="7" id="picker-input-hex">\n                    </div>\n                 </div>\n            </div>\n        ');let l=(0,a.T)("div",{id:"color-picker-history",className:"color-pod-list"});(0,a.ZP)("dialog-buttons"+this.mid).append(l),c.ZP.oldColor.forEach((e=>{let t=(0,a.T)("div",{className:"color-pod small"});t.style.backgroundColor=e,l.append(t)})),(0,a.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.addEventListener("click",this.setHistory))),this.selected=(0,a.ZP)("color-picker-new"),this.selector=(0,a.ZP)("color-picker-selector"),this.satSlide=(0,a.ZP)("color-picker-sat-slide"),this.satKnob=(0,a.ZP)("color-picker-sat-knob"),this.hueSlide=(0,a.ZP)("color-picker-hue-slide"),this.hueKnob=(0,a.ZP)("color-picker-hue-knob"),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hexInput=(0,a.ZP)("picker-input-hex"),this.hexInput.addEventListener("input",this.hexInputChange,!1),this.hueInput=(0,a.ZP)("picker-input-hue"),this.hueInput.addEventListener("input",this.hueInputChange,!1),this.satInput=(0,a.ZP)("picker-input-sat"),this.satInput.addEventListener("input",this.satInputChange,!1),this.briInput=(0,a.ZP)("picker-input-bri"),this.briInput.addEventListener("input",this.briInputChange,!1),this.redInput=(0,a.ZP)("picker-input-red"),this.redInput.addEventListener("input",this.redInputChange,!1),this.greenInput=(0,a.ZP)("picker-input-green"),this.greenInput.addEventListener("input",this.greenInputChange,!1),this.blueInput=(0,a.ZP)("picker-input-blue"),this.blueInput.addEventListener("input",this.blueInputChange,!1),"block"===(null===(r=(0,a.ZP)("workspace"))||void 0===r?void 0:r.style.display)&&(this.modal.style.cursor="crosshair",this.colorPreview=document.createElement("div"),this.colorPreview.id="color-picker-preview",this.colorPreview.style.display="none",this.modal.appendChild(this.colorPreview),this.modal.addEventListener("mousedown",this.pickerSetColor,!0),this.modal.addEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.addEventListener("mouseleave",this.pickerPreviewLeave,!0),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=n.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d")),(0,a.ZP)("color-picker-current").style.backgroundColor=e.toHEX(),this.current=e,this.setColor(e)}}},7976:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3868),n=s(3947);class a extends i.Z{constructor(e,t,s,i,a){super(e,!0),this.init=()=>new Promise(((e,t)=>{this.cancel=()=>{this.cleanUp(),e(!1)},this.condition=()=>{this.cleanUp(),e(void 0)},this.apply=()=>{this.cleanUp(),e(!0)}})),this.setContent((0,n.T)("p",t)),s&&((0,n.ZP)("dialog-apply"+this.mid).innerText=s),i&&((0,n.ZP)("dialog-cancel"+this.mid).innerText=i),a&&(0,n.ZP)("dialog-cancel"+this.mid).before((0,n.T)("a",{id:"dialog-condition"+this.mid,className:"button negative",style:"position:absolute;left:10px;",onclick:()=>this.condition()},a))}}},3868:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),n=s(3655),a=s(3673),r=s(4820),o=s(3947);class h{constructor(e,t=!0,s=!1){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.disableApply=()=>{const e=(0,o.ZP)("dialog-apply"+this.mid);e.classList.add("disabled"),e.onclick=void 0},this.enableApply=()=>{const e=(0,o.ZP)("dialog-apply"+this.mid);e.classList.remove("disabled"),e.onclick=()=>this.apply()},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2+r.ZP.dialogPos.x)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2+r.ZP.dialogPos.y)+"px";let e=this.dialog.getBoundingClientRect(),t=this.modal.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.dragStart=e=>{this.p=e,this.d=new a.Z(this.dialog.offsetLeft,this.dialog.offsetTop)},this.dragMove=e=>{this.dialog.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.dialog.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{r.ZP.dialogPos.x=Math.round(this.dialog.offsetLeft-(this.modal.offsetWidth-this.dialog.offsetWidth)/2),r.ZP.dialogPos.y=Math.round(this.dialog.offsetTop-(this.modal.offsetHeight-this.dialog.offsetHeight)/2)},this.resizeStart=e=>{this.d=new a.Z(this.dialog.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.dialog.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{27!=e.keyCode||"none"===(0,o.ZP)("dialog-cancel"+this.mid).style.display?13!=e.keyCode||"none"===(0,o.ZP)("dialog-apply"+this.mid).style.display||this.apply():this.cancel()},this.condition=()=>{this.cleanUp()},this.cancel=()=>{this.cleanUp()},this.apply=()=>{this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=n.Zd(),this.modal=(0,o.T)("div",{id:"modal-"+this.mid,className:"modal"}),t&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,o.T)("div",{className:"dialog"}),this.modal.appendChild(this.dialog),this.content=(0,o.T)("div",{className:"content"});const h=(0,o.T)("div",{id:"dialog-title",className:"title"},e);if((0,o.Rg)(h,this.dragStart,this.dragMove,this.dragEnd),this.dialog.append(h,(0,o.T)("img",{id:"dialog-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cancel()}),(0,o.T)("div",{id:"dialog-splitter"+this.mid,className:"splitter"}),this.content,(0,o.T)("div",{className:"buttons",id:"dialog-buttons"+this.mid},(0,o.T)("a",{id:"dialog-apply"+this.mid,className:"button positive",onclick:()=>this.apply()},(0,i.Z)("apply")),(0,o.T)("a",{id:"dialog-cancel"+this.mid,className:"button negative",onclick:()=>this.cancel()},(0,i.Z)("cancel")))),s){const e=(0,o.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Rg)(e,this.resizeStart,this.resizeMove),this.dialog.append(e)}document.addEventListener("keydown",this.keyDown,!1)}}},5772:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),n=s(3868),a=s(3947);class r extends n.Z{constructor(e,t){super((0,i.Z)("name"),!0),this.init=()=>new Promise(((e,t)=>{this.apply=()=>{e((0,a.ZP)("file-name").value),this.cleanUp()}})),this.setContent(`\n            <label>${(0,i.Z)("name")}</label>\n            <div style="display:flex">\n                <input type="text" id="file-name" style="width:280px" value='${e}' />\n                <div style="padding-left:10px;line-height:32px;">.${t}</div>\n            </div>\n        `),(0,a.ZP)("dialog-cancel"+this.mid).style.display="none"}}},4375:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(1030),n=s(3868),a=s(5574),r=s(3947),o=s(6548);class h extends n.Z{constructor(e,t={}){super((0,o.Z)("dialogLoadTitle")),this.load=async e=>{(0,i.Z)("load-url");const t=(0,r.ZP)("load-message");try{this.cancel=()=>{throw h.CANCEL};const s=this.settings.title||(0,o.Z)("image"),i=this.settings.referrer||(0,o.Z)("source");t.innerText=(0,o.Z)("dialogLoadLoadingFrom",s.toLowerCase(),i.toLowerCase());const n=await(0,a.c6)(e,(e=>{const t=(0,r.ZP)("load-progress");-1==e?t.removeAttribute("value"):t.value=e})),c=new File([n],this.settings.title||e.substring(e.lastIndexOf("/")+1),{type:n.type});return this.cleanUp(),c}catch(s){if(console.log(s),s===h.CANCEL)return void this.cleanUp();(0,r.ZP)("load-progress")&&(t.innerText=(0,o.Z)("dialogLoadError"),(0,r.ZP)("load-progress").style.display="none",this.cancel=()=>{this.cleanUp()})}},this.stage=e,this.settings=t,this.setContent('\n            <p id="load-message"></p><br />\n\n            <progress id="load-progress" value="0" max="100" style="width: 100%;"></progress>\n            <br><br>\n        '),(0,r.ZP)("dialog-apply"+this.mid).style.display="none";(0,r.ZP)("load-message").innerText=(0,o.Z)("dialogLoadPrepare")}}h.CANCEL=new Error("CANCEL")},6969:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(6548),n=s(3868),a=s(3947),r=s(4820),o=s(4178),h=s(2397);class c extends n.Z{constructor(e){super((0,i.Z)("createNew"),!0,!0),this.selectType=e=>{let t=e.currentTarget;this.setType(t.id.replace("tab-",""))},this.setType=e=>{switch(this.type&&(this.holder.innerHTML="",(0,a.ZP)("tab-"+this.type).classList.remove("selected")),(0,a.ZP)("tab-"+e).classList.add("selected"),this.type=e,this.type){case"recommended":if(this.stage.clipboardSize){let e=this.stage.clipboardSize;this.addBox((0,i.Z)("clipboard"),e.width,e.height,"/img/icon/new-cutout.svg")}this.addBox((0,i.Z)("social-media-post"),1080,1080,"/img/icon/category/social.svg"),this.addBox((0,i.Z)("social-media-story"),1080,1920,"/img/icon/category/social.svg"),this.addBox("Web med",1600,900,"/img/icon/category/web.svg"),this.addBox("Thumb 720p",1280,720,"/img/icon/category/video.svg"),this.addBox("Wide 1080p",1920,1080,"/img/icon/category/video.svg"),this.addBox("Art grid",1e3,1e3,"/img/icon/category/art.svg"),this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg");break;case"photo":this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg"),this.addBox("Landscape 3x2 in",900,600,"/img/icon/category/landscape.svg"),this.addBox("Landscape 6x4 in",1800,1200,"/img/icon/category/landscape.svg"),this.addBox("Landscape 7x5 in",2100,1500,"/img/icon/category/landscape.svg"),this.addBox("Landscape 10x8 in",3e3,2400,"/img/icon/category/landscape.svg"),this.addBox("Portrait 2x3 in",600,900,"/img/icon/category/portrait.svg"),this.addBox("Portrait 4x6 in",1200,1800,"/img/icon/category/portrait.svg"),this.addBox("Portrait 5x7 in",1500,2100,"/img/icon/category/portrait.svg"),this.addBox("Portrait 8x10 in",2400,3e3,"/img/icon/category/portrait.svg");break;case"social":this.addBox((0,i.Z)("instagram-square"),1080,1080,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("instagram-post"),1080,1350,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("instagram-story"),1080,1920,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("facebook-post"),1200,630,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-story"),1080,1920,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-cover"),851,315,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-profile"),850,850,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("twitter-post"),1600,900,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("twitter-cover"),1500,500,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("twitter-profile"),400,400,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("youtube-profile"),800,800,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("youtube-thumbnail"),1280,720,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("youtube-channel-art"),2048,1152,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("pinterest-pin"),1e3,1500,"/img/icon/category/pinterest.svg"),this.addBox((0,i.Z)("pinterest-square-pin"),1e3,1e3,"/img/icon/category/pinterest.svg"),this.addBox((0,i.Z)("pinterest-long-pin"),1e3,2100,"/img/icon/category/pinterest.svg");break;case"print":this.addBox("Letter 8 x 11 in",2400,3300,"/img/icon/category/paper.svg"),this.addBox("Legal 8 x 14 in",2400,4200,"/img/icon/category/paper.svg",!0),this.addBox("Tabloid 11 x 17 in",3300,5100,"/img/icon/category/paper.svg",!0),this.addBox("A3 297 x 420 mm",3508,4961,"/img/icon/category/paper.svg",!0),this.addBox("A4 210 x 297 mm",2480,3508,"/img/icon/category/paper.svg"),this.addBox("A5 148 x 210 mm",1748,2480,"/img/icon/category/paper.svg"),this.addBox("A6 105 x 148 mm",1240,1748,"/img/icon/category/paper.svg"),this.addBox((0,i.Z)("business-card"),1050,600,"/img/icon/category/business-card.svg"),this.addBox((0,i.Z)("flyer")+" 4.25 x 5.5 in",1275,1650,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("flyer")+" 5.5 x 8.5 in",1650,2550,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("flyer")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("brochure")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("brochure")+" 8.5 x 14 in",2550,4200,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.Z)("brochure")+" 11 x 17 in",3300,5100,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.Z)("invitation")+" 4 x 6 in",384,576,"/img/icon/category/invitation.svg"),this.addBox((0,i.Z)("invitation")+" 5 x 7 in",480,672,"/img/icon/category/invitation.svg");break;case"web":this.addBox("Web 1994",800,600,"/img/icon/category/web.svg"),this.addBox("Web 2004",1280,720,"/img/icon/category/web.svg"),this.addBox("Web 2012",1366,768,"/img/icon/category/web.svg"),this.addBox("Web 2016",1440,900,"/img/icon/category/web.svg"),this.addBox("Web 2020",1920,1200,"/img/icon/category/web.svg"),this.addBox("Icon 16",16,16,"/img/icon/category/icon.svg"),this.addBox("Icon 32",32,32,"/img/icon/category/icon.svg"),this.addBox("Icon 64",64,64,"/img/icon/category/icon.svg"),this.addBox("Icon 512",512,512,"/img/icon/category/icon.svg"),this.addBox("Icon 1024",1024,1024,"/img/icon/category/icon.svg");break;case"video":this.addBox("360p",640,360,"/img/icon/category/video.svg"),this.addBox("480p",854,480,"/img/icon/category/video.svg"),this.addBox("720p",1280,720,"/img/icon/category/video.svg"),this.addBox("1080p HD",1920,1080,"/img/icon/category/video.svg"),this.addBox("1440p 2K",2560,1440,"/img/icon/category/video.svg"),this.addBox("4K UHD",3840,2160,"/img/icon/category/video.svg")}},this.presetChange=e=>{let t=e.currentTarget,s=(0,a.ZP)("ceate-new-outer").getElementsByClassName("new-box");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected");let n=t.getAttribute("data").split(":");(0,a.ZP)("new-canvas-width").value=n[0],(0,a.ZP)("new-canvas-height").value=n[1]},this.addBox=(e,t,s,i,n=!1)=>{let r=(0,a.T)("div",{className:"new-box",style:"width:"+this.boxSize+"px"},(0,a.T)("div",{className:"holder"},(0,a.T)("img",{src:i})),(0,a.T)("span",{},e),(0,a.T)("small",{},t+"x"+s+" px"));n&&r.classList.add("premium"),r.addEventListener("click",this.presetChange,!1),r.setAttribute("data",t+":"+s),this.holder.appendChild(r)},this.apply=async()=>{let e=(0,a.ZP)("new-canvas-width").value,t=(0,a.ZP)("new-canvas-height").value,s=NaN!=Number(e)?Number(e):600,i=NaN!=Number(t)?Number(t):600,n=r.ZP.user.subscription?8192:4096;s>n&&(s=n),i>n&&(i=n);let o=(0,a.ZP)("new-canvas-name").value,h=!(0,a.ZP)("new-canvas-background").checked;this.stage.createNew(o,s,i,h?void 0:this.backgroundColor.getHex()),this.cleanUp()},this.stage=e,(0,a.ZP)("dialog-apply"+this.mid).innerText=(0,i.Z)("create"),(0,a.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.dialog.style.width="90%",this.dialog.style.maxWidth="1200px",this.dialog.style.height=document.body.offsetHeight-300+"px",this.content.style.padding="0",this.content.style.height="1vh",this.content.style.display="flex",this.content.style.position="relative",this.content.style.flexDirection="column",this.setContent(`\n\n            <ul id="preset-type" class="tab-list pad-10" style="flex: 0 1 auto;padding-left:20px; margin-left:20px;margin-right:20px;margin-bottom:10px">\n                <li id="tab-recommended">${(0,i.Z)("recommended")}</li>\n                <li id="tab-photo">${(0,i.Z)("photo")}</li>\n                <li id="tab-social">${(0,i.Z)("social")}</li>\n                <li id="tab-web">${(0,i.Z)("web")}</li>\n                <li id="tab-print">${(0,i.Z)("print")}</li>\n                <li id="tab-video">${(0,i.Z)("video")}</li>\n            </ul>\n            <div class="flex" style="position:relative;height:calc(100% - 58px);margin:0px 20px;">\n\n                <div id="ceate-new-outer" style="flex-grow:2">\n                    <div id="create-new-content" class="new-holder">\n\n                    </div>\n                </div>\n                <div style="flex: 0 0 auto;flex-basis:220px;width:220px;min-width:220px;margin-left:10px;overflow:hidden;">\n                    <label for="new-canvas-name">${(0,i.Z)("name")}</label>\n                    <input type="text" style="width: 100%;" id="new-canvas-name" value="${(0,i.Z)("untitled")}" />\n\n                    <label class="split pad-20">${(0,i.Z)("width")} <input type="number" id="new-canvas-width" value="1920"/></label>\n                    <label class="split">${(0,i.Z)("height")} <input type="number" id="new-canvas-height" value="1080"/></label>\n                    <label class="pad-10" style="text-align:right;font-size:10px;float:none;clear: both;">${(0,i.Z)("max")}<span id="new-max-size">4096 x 4096 px</span></label>\n\n                    <input type="checkbox" class="toggle-check" id="new-canvas-background" />\n                    <label class="switch subline pad-20" for="new-canvas-background">${(0,i.Z)("background")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <div id="new-canvas-background-color-picker" class="color-picker pad-0"></div>\n                    </div>\n                </div>\n            <div>\n            \n        `),this.holder=(0,a.ZP)("create-new-content"),r.ZP.user.subscription&&((0,a.ZP)("new-max-size").innerText="8192 x 8192 px"),this.backgroundColor=new h.Z((0,a.ZP)("new-canvas-background-color-picker"),void 0,void 0,!1);let t=(0,a.ZP)("preset-type").getElementsByTagName("li");for(var s=0;s<t.length;s++)t[s].addEventListener("click",this.selectType,!1);let n=this.holder.clientWidth,c=Math.floor(n/125);this.boxSize=Math.floor(125+(n-125*c)/c),new o.Z((0,a.ZP)("ceate-new-outer")),this.setType("recommended"),this.position()}}},3747:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),n=s(6548),a=s(4375),r=s(3868),o=s(5934);class h extends r.Z{constructor(e,t=!0){super((0,n.Z)("dialogOpenURLTitle")),this.apply=async()=>{let e=(0,i.ZP)("image-url").value;if(this.cleanUp(),""!==e){const t=e.substring(e.lastIndexOf("/")+1);e="https://pixlr.com/proxy/?url="+encodeURIComponent(e);const s=new a.Z(this.stage,{title:t});let i=await s.load(e);o.ZB(this.stage,i,this.askToAdd)}},this.stage=e,this.askToAdd=t,this.setContent(`\n            <label>${(0,n.Z)("dialogOpenURLHeadline")}</label>\n            <input type="url" id="image-url" style="width: 100%" placeholder='https://example.com/this-image.jpg' />\n        `),(0,i.ZP)("dialog-apply"+this.mid).innerText=(0,n.Z)("load"),setTimeout((()=>{(0,i.ZP)("image-url").focus()}),300)}}},6584:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(3947),n=s(6548),a=s(3655),r=s(3868),o=s(9872),h=s(4820);class c extends r.Z{constructor(e,t){if(super((0,n.Z)("dialogPreResizeTitle")),this.rotation=0,this.size=1920,this.init=()=>new Promise(((e,t)=>{this.apply=()=>{(0,i.ZP)("preresize-never-ask-again").checked&&(0,h.Lt)("askToPreResize",!1);const t=new o.Z(Number((0,i.ZP)("pre-resize-width").value),Number((0,i.ZP)("pre-resize-height").value)),s=(0,i.ZP)("pre-resize-auto-rotate").checked?this.rotation:0;this.cleanUp(),e([t,s])},this.cancel=()=>{this.cleanUp(),e([void 0,void 0])}})),this.presetChange=e=>{let t=e.currentTarget,s=(0,i.ZP)("pre-resize-preset").getElementsByTagName("li");for(var n=0;n<s.length;n++)s[n].classList.remove("selected");t.classList.add("selected"),this.size=Number(t.getAttribute("data")),this.setSize()},this.imageSizeInputChange=e=>{let t,s,n=e.currentTarget;"pre-resize-width"===n.id?(t=a.uZ(Number(n.value),1,this.width),s=Math.round(t/this.width*this.height)):(s=a.uZ(Number(n.value),1,this.height),t=Math.round(s/this.height*this.width)),(0,i.ZP)("pre-resize-height").value=s.toString(),(0,i.ZP)("pre-resize-width").value=t.toString()},this.setSize=()=>{let e=(0,i.ZP)("pre-resize-width"),t=(0,i.ZP)("pre-resize-height");this.width>this.height?(e.value=this.size.toString(),t.value=Math.round(this.size/this.width*this.height).toString()):(t.value=this.size.toString(),e.value=Math.round(this.size/this.height*this.width).toString())},h.ZP.user.subscription?this.dialog.style.width="560px":this.dialog.style.width="480px",this.image=e,90===t||-90===t?(this.height=e.width,this.width=e.height):(this.width=e.width,this.height=e.height),this.rotation=t,this.setContent(`\n            <span style="display: block;">${(0,n.Z)("dialogPreResizeInfo1")} (<span id="pre-resize-start"></span>) ${(0,n.Z)("dialogPreResizeInfo2")}</span>\n\n            <input type="checkbox" id="preresize-never-ask-again" />\n            <label class="switch pad-10" for="preresize-never-ask-again">${(0,n.Z)("neverAskMeAgain")}<span></span></label>\n\n            <span id="pre-resize-auto-rotate-setting" style="display:none;">\n                <input type="checkbox" checked id="pre-resize-auto-rotate" />\n                <label class="switch pad-20" for="pre-resize-auto-rotate">${(0,n.Z)("dialogPreResizeExif")}<span></span></label>\n            </span>\n        \n            <ul id="pre-resize-preset" class="push-buttons pad-20">\n                <li id="pre-resize-original" data="4096"><img src="/img/icon/layer-image.svg" class="ic"><span>${(0,n.Z)("original")}<br /><small id="pre-resize-uhd-size">Max 3840 px</small></span></li>\n                <li id="pre-resize-uhd" data="3840"><img src="/img/icon/size-uhd.svg" class="ic"><span>${(0,n.Z)("sizeUltraHD")}<br /><small>Max 3840 px</small></span></li>\n                <li id="pre-resize-fhd" data="1920" class="selected"><img src="/img/icon/size-fhd.svg" class="ic"><span>${(0,n.Z)("sizeFullHD")}<br /><small>Max 1920 px</small></span></li>\n                <li id="pre-resize-uhd" data="1280"><img src="/img/icon/size-web.svg" class="ic"><span>${(0,n.Z)("sizeWeb")}<br /><small>Max 1280 px</small></span></li>\n            </ul>\n\n            <div class="pad-20" style="text-align:right;line-height:32px;">${(0,n.Z)("newSize")}<input type="number" style="text-align:center;margin-left:16px" id="pre-resize-width"/> x <input type="number" style="text-align:center" id="pre-resize-height"/></div>\n        `),this.maxSize=h.ZP.user.subscription?8192:4096,h.ZP.user.subscription?(this.width<3840&&this.height<3840&&((0,i.ZP)("pre-resize-uhd").style.display="none"),(0,i.ZP)("pre-resize-original").setAttribute("data",Math.min(Math.max(this.width,this.height),this.maxSize).toString()),(0,i.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.min(Math.max(this.width,this.height),this.maxSize))):this.width<3840&&this.height<3840?((0,i.ZP)("pre-resize-uhd").style.display="none",(0,i.ZP)("pre-resize-original").setAttribute("data",Math.max(this.width,this.height).toString()),(0,i.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.max(this.width,this.height))):(0,i.ZP)("pre-resize-original").style.display="none",0!==t){let e=(0,i.ZP)("pre-resize-auto-rotate-setting");e.style.display="block",e.addEventListener("change",(()=>{let e=(0,i.ZP)("pre-resize-width"),t=(0,i.ZP)("pre-resize-height");const s=e.value;e.value=t.value,t.value=s}),!1)}(0,i.ZP)("pre-resize-start").innerText=this.width.toString()+" x "+this.height.toString();let s=(0,i.ZP)("pre-resize-preset").getElementsByTagName("li");for(var r=0;r<s.length;r++)s[r].addEventListener("click",this.presetChange,!1);this.setSize(),(0,i.ZP)("pre-resize-width").addEventListener("change",this.imageSizeInputChange,!1),(0,i.ZP)("pre-resize-height").addEventListener("change",this.imageSizeInputChange,!1)}}},9091:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>f});var n=s(6548),a=s(3868),r=s(4188),o=s(3947),h=s(5772),c=s(5700),l=s(3655),d=s(1030),u=s(4820),p=s(3409),g=s(8132),m=s(7630),v=e([g]);g=(v.then?(await v)():v)[0];class f extends a.Z{constructor(e){if(super((0,n.Z)("dialogSaveTitle"),!0),this.setTab=e=>{const t=e.currentTarget.getAttribute("data");this.changeTab(t)},this.changeTab=e=>{this.tab&&(0,o.ZP)("tab-"+this.tab).classList.remove("selected"),(0,o.ZP)("tab-"+e).classList.add("selected"),this.tab=e,(0,o.ZP)("type-jpg").style.display="image"===this.tab?"flex":"none",(0,o.ZP)("type-png").style.display="image"===this.tab?"flex":"none",(0,o.ZP)("type-webp").style.display="image"===this.tab&&this.hasWebP?"flex":"none",(0,o.ZP)("type-gif").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-mp4").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-zip").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-pdf").style.display="document"===this.tab?"flex":"none",this.changeType(this.type,!0)},this.setType=e=>{const t=e.currentTarget.getAttribute("data");this.changeType(t)},this.changeType=(e,t=!1)=>{if(!t&&this.type===e)return;let s;switch(e){case"gif":s=Number(document.querySelector('input[name="gif-scale"]:checked').value);break;case"mp4":s=Number(document.querySelector('input[name="mp4-scale"]:checked').value);break;case"zip":s=Number(document.querySelector('input[name="zip-scale"]:checked').value);break;default:s=1}if("jpg"===e){s=Number((0,o.ZP)("jpg-width").value)/this.stage.fresco.width}this.type&&(0,o.ZP)("type-"+this.type).classList.remove("active"),(0,o.ZP)("type-"+e).classList.add("active"),this.type=e,this.canvas.remove();let i="jpg"===this.type||"pdf"===this.type||"png"===this.type&&!(0,o.ZP)("png-transparent").checked||"webp"===this.type&&!(0,o.ZP)("webp-transparent").checked;this.canvas=this.stage.getOutputCanvas(s,i?"#ffffff":void 0),(0,o.ZP)("save-file-prop").innerHTML=this.canvas.width+" x "+this.canvas.height+"px",(0,o.ZP)("save-preview").prepend(this.canvas),this.renderBlob()},this.jpgSizeChange=e=>{let t=e.currentTarget;if(""!==t.value){if("jpg-width"===t.id){const e=l.uZ(Number(t.value),1,this.canvas.width),s=Math.round(e/this.stage.fresco.width*this.stage.fresco.height);(0,o.ZP)("jpg-height").value=s.toString()}else{const e=l.uZ(Number(t.value),1,this.canvas.width),s=Math.round(e/this.stage.fresco.height*this.stage.fresco.width);(0,o.ZP)("jpg-width").value=s.toString()}l.Ds("save",500,(()=>this.changeType("jpg",!0)))}},this.renderBlob=async()=>{if((0,o.ZP)("save-file-size").innerText=(0,n.Z)("dialogSaveCalculate"),"pxz"===this.type||"gif"===this.type||"mp4"===this.type||"zip"===this.type)return this.blob=void 0,void((0,o.ZP)("save-file-size").innerText=`Format: ${this.type}`);if("pdf"===this.type)return void this.canvas.toBlob((e=>{this.blob=e,(0,o.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${l.jb(e.size+1024)}`}),"image/jpeg",.9);const e="image/"+this.type.replace("jpg","jpeg"),t="jpg"===this.type?this.jpgquality.getValue():"webp"===this.type?this.webpquality.getValue():1;this.canvas.toBlob((e=>{this.blob=e,(0,o.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${l.jb(e.size)}`}),e,t)},this.applyAPi=()=>{let e=this;setTimeout((()=>{(0,d.Z)("save-dropbox");var t=new FormData;t.append("imageFile",this.blob,this.name+"."+this.type);let s=new XMLHttpRequest;s.onerror=function(t){e.setMessage("Error","Failed to save to dropbox, please try again.")},s.onreadystatechange=()=>{if(1===s.readyState)e.setMessage("Saving","uploading image to dropbox, please wait...");else if(4===s.readyState)if(200===s.status&&1==s.response.status){let t='<p>The image was saved on dropbox</p> <div class="buttons center"><a class="button positive xlarge"  href="'+s.response.data.view_file_url+'">view on dropbox</a></div>';e.setMessage("Save completed",t),(0,o.ZP)("dialog-close"+this.mid).style.display="none"}else e.setMessage("Error","Failed to save to dropbox, please try again.")},s.open("post","/x/dropbox/upload_file?upload_key="+u.ZP.uploadkey),s.responseType="json",s.send(t)}),200)},this.apply=async()=>{const e=this.type;let t;if((0,d.Z)("save-file",e),this.stage.fresco.savedTimesCounterForUserEase>0&&(this.name+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++,(0,m.Zp)()){let s="image/jpeg",i="Jpg image";switch(e){case"mp4":s="video/mp4",i="Mp4 video";break;case"zip":s="application/zip",i="Zip achive";break;case"pxz":s="application/pxz",i="Pixlr document";break;case"pdf":s="application/pdf",i="PDF document";break;case"png":s="image/png",i="PNG image";break;case"gif":s="image/gif",i="GIF image";break;case"webp":s="image/webp",i="WebP image"}if(t=await(0,m.f1)(this.name,e,i,s),!1===t)return}if("gif"===e){this.setWorking();try{let e=(0,o.ZP)("save-gif-repeat").checked,t=(0,o.ZP)("save-gif-inclusive").checked,s=Number(document.querySelector('input[name="gif-speed"]:checked').value),i=Number(document.querySelector('input[name="gif-scale"]:checked').value);const n=(0,m.DD)(this.stage,6,i,s,e,t,(e=>{(0,o.ZP)("save-progress").style.width=100*e+"%"}));(0,o.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>n.cancel())),this.blob=await n}catch(s){return void(s instanceof l.Mk||(console.error(s),this.setMessage("Error when creating GIF file")))}}if("zip"===e){this.setWorking();try{let e=(0,o.ZP)("save-zip-inclusive").checked,t=Number(document.querySelector('input[name="zip-scale"]:checked').value),s=Number(document.querySelector('input[name="zip-fps"]:checked').value),i=new p.Z(this.stage,s,t,e),n=await i.requestFrame();const a=new Array;let r=0;for(;n;){(0,o.ZP)("save-progress").style.width=i.currentFrame/i.totalFrames*100+"%";const e=await new Promise((e=>n.toBlob(e,"image/png",1)));a.push(new File([e],"frame-"+r+".png")),n=await i.requestFrame(),r++}let h=new g.ZipWriter;for(let o=0;o<a.length;o++){const e=a[o];let t=await e.arrayBuffer(),s=new Uint8Array(t);h.writeFile(e.name,s,!1)}const c=h.finish();this.blob=new Blob([c.buffer])}catch(s){return console.error(s),void this.setMessage("Error when creating GIF file")}}if("mp4"===e){this.setWorking();try{let e=(0,o.ZP)("save-mp4-inclusive").checked,t=Number(document.querySelector('input[name="mp4-scale"]:checked').value),s=Number(document.querySelector('input[name="mp4-fps"]:checked').value),i=(0,m.sj)(this.stage,s,t,e,(e=>{(0,o.ZP)("save-progress").style.width=100*e+"%"}));(0,o.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>i.cancel())),this.blob=await i}catch(s){return void(s instanceof l.Mk||(console.error(s),this.setMessage("Error when creating mp4 file")))}}if("pxz"===e){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.iM)(this.stage,{id:this.stage.fresco.id,name:this.name,quality:"100",nonDestructive:(0,o.ZP)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(s){return console.error(s),void this.setMessage("Error when creating PXZ file")}}if("pdf"===e){this.setMessage("Creating your PDF file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.b4)(this.stage,this.blob)}catch(s){return console.error(s),void this.setMessage("Error when creating PDF file")}}if(!this.blob)return;if(t){await(0,m.BI)(t,new File([this.blob],this.name+"."+this.type))||(0,m.vV)(new File([this.blob],this.name+"."+this.type),this.name,this.type)}else{const t=await new h.Z(this.name,e).init();(0,m.vV)(new File([this.blob],""!==t?t:this.name+"."+e),t,e)}document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")})),this.cleanUp(),"localhost"===location.hostname||u.ZP.user.subscription||new c.Z(this.stage)},this.setWorking=()=>{(0,o.ZP)("dialog-apply"+this.mid).style.display="none",(0,o.ZP)("dialog-api-apply")&&((0,o.ZP)("dialog-api-apply").style.display="none"),(0,o.ZP)("save-settings").style.display="none",(0,o.ZP)("save-working").style.display="block"},this.setMessage=(e,t="")=>{(0,o.ZP)("dialog-apply"+this.mid).style.display="none",(0,o.ZP)("dialog-api-apply")&&((0,o.ZP)("dialog-api-apply").style.display="none"),(0,o.ZP)("save-working").style.display="none",(0,o.ZP)("save-settings").style.display="none",(0,o.ZP)("save-message").style.display="block",(0,o.ZP)("save-message-title").innerText=e,(0,o.ZP)("save-message-body").innerHTML=t,(0,o.ZP)("dialog-cancel"+this.mid).innerText=(0,n.Z)("close")},e.fresco.block)return void this.cleanUp();this.stage=e,this.dialog.style.width="700px",this.dialog.style.minHeight="440px",this.content.classList.add("flex"),(0,o.ZP)("dialog-apply"+this.mid).innerText=(0,n.Z)("saveAs"),(0,o.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.setContent(`\n        <section id="save-preview">\n            <div id="save-file-size" class="pad-10"></div>\n            <div id="save-file-prop"></div>\n        </section>\n        <section id="save-section">\n            <div id="save-message" style="display:none;">\n                <h2 id="save-message-title"></h2>\n                <p id="save-message-body"></p>\n            </div>\n            <div id="save-working" style="display:none;">\n                <h2>${(0,n.Z)("working")}...</h2>\n                \n                <div class="progress-bar pad-20">\n                    <span id="save-progress" class="inner"></span>\n                </div>\n            </div>\n\n            <div id="save-settings">\n\n                <ul class="tab-list" style="flex: 0 1 auto;margin-bottom:15px;margin-top:-5px">\n                <li data="animation" id="tab-animation">${(0,n.Z)("animation")}</li>\n                    <li data="image" id="tab-image">${(0,n.Z)("image")}</li>\n                    <li data="document" id="tab-document">${(0,n.Z)("document")}</li>\n                </ul>\n\n                <div id="type-jpg" data="jpg" class="option-task">\n                    <img src="/img/icon/file-jpg.svg" class="type ic">\n                    <div class="name">JPG <span>${(0,n.Z)("smallFilesPerfect")}</span></div>\n                    <div class="settings">\n                        <div id="jpg-quality"></div>\n\n                        <div id="jpg-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="jpg-quality-low" name="jpg-quality-preset" value="50"/><label for="jpg-quality-low">${(0,n.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="jpg-quality-med" name="jpg-quality-preset" value="70" /><label for="jpg-quality-med">${(0,n.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="jpg-quality-high" name="jpg-quality-preset" value="90" checked /><label for="jpg-quality-high">${(0,n.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <label class="split pad-20">${(0,n.Z)("width")} <input type="number" id="jpg-width" value="${e.fresco.width}"/></label>\n                        <label class="split">${(0,n.Z)("height")} <input type="number" id="jpg-height" value="${e.fresco.height}"/></label>\n                    </div>\n                </div>\n\n                <div id="type-png" data="png" class="option-task">\n                    <img src="/img/icon/file-png.svg" class="type ic">\n                    <div class="name">PNG<span>${(0,n.Z)("largeAndLossless")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="png-transparent" checked>\n                        <label class="switch" for="png-transparent">${(0,n.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-webp" data="webp" class="option-task">\n                    <img src="/img/icon/file-webp.svg" class="type ic">\n                    <div class="name">WebP<span>${(0,n.Z)("modrenFormatSuitable")}</span></div>\n                    <div class="settings">\n                        <div id="webp-quality"></div>\n\n                        <div id="webp-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="webp-quality-low" name="webp-quality-preset" value="50"/><label for="webp-quality-low">${(0,n.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="webp-quality-med" name="webp-quality-preset" value="70" /><label for="webp-quality-med">${(0,n.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="webp-quality-high" name="webp-quality-preset" value="90" checked /><label for="webp-quality-high">${(0,n.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <input type="checkbox" id="webp-transparent" checked>\n                        <label class="switch pad-20" for="webp-transparent">${(0,n.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-mp4" data="mp4" class="option-task">\n                    <img src="/img/icon/file-mp4.svg" class="type ic">\n                    <div class="name">MP4 <span>${(0,n.Z)("popularHighQuality")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-mp4-inclusive" />\n                        <label class="switch" for="save-mp4-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,n.Z)("fps")}</label>\n                        <div id="mp4-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-fps-24" name="mp4-fps" value="24" checked/><label for="mp4-fps-24">24</label>\n                            <input type="radio" id="mp4-fps-30" name="mp4-fps" value="30" /><label for="mp4-fps-30">30</label>\n                            <input type="radio" id="mp4-fps-48" name="mp4-fps" value="48" /><label for="mp4-fps-48">48</label>\n                            <input type="radio" id="mp4-fps-60" name="mp4-fps" value="60" /><label for="mp4-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="mp4-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-scale-full" name="mp4-scale" value="1" checked/><label for="mp4-scale-full">1x</label>\n                            <input type="radio" id="mp4-scale-half" name="mp4-scale" value="0.5" /><label for="mp4-scale-half">0.5x</label>\n                            <input type="radio" id="mp4-scale-quart" name="mp4-scale" value="0.25" /><label for="mp4-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-gif" data="gif" class="option-task">\n                    <img src="/img/icon/file-gif.svg" class="type ic">\n                    <div class="name">GIF <span>%${(0,n.Z)("funAndSimpleAnimated")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-gif-inclusive" />\n                        <label class="switch" for="save-gif-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <input type="checkbox" id="save-gif-repeat" />\n                        <label class="switch pad-10" for="save-gif-repeat">${(0,n.Z)("loopAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,n.Z)("speed")}</label>\n                        <div id="gif-speed-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-speed-normal" name="gif-speed" value="1" checked/><label for="gif-speed-normal">1x</label>\n                            <input type="radio" id="gif-speed-double" name="gif-speed" value="2" /><label for="gif-speed-double">2x</label>\n                            <input type="radio" id="gif-speed-triple" name="gif-speed" value="3" /><label for="gif-speed-triple">3x</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="gif-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-scale-full" name="gif-scale" value="1"/><label for="gif-scale-full">1x</label>\n                            <input type="radio" id="gif-scale-half" name="gif-scale" value="0.5" checked/><label for="gif-scale-half">0.5x</label>\n                            <input type="radio" id="gif-scale-quart" name="gif-scale" value="0.25" /><label for="gif-scale-quart">0.25x</label>\n                        </div>\n                    </div>\n                </div>\n\n                <div id="type-pdf" data="pdf" class="option-task">\n                    <img src="/img/icon/file-pdf.svg" class="type ic">\n                    <div class="name">PDF <span>${(0,n.Z)("bestForFlyersAndMarketing")}.</span></div>\n                </div>\n\n                <div id="type-zip" data="zip" class="option-task">\n                    <img src="/img/icon/file-zip.svg" class="type ic">\n                    <div class="name">ZIP <span>${(0,n.Z)("aZipOfAllTheIndividual")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-zip-inclusive" />\n                        <label class="switch" for="save-zip-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,n.Z)("fps")}</label>\n                        <div id="zip-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-fps-2" name="zip-fps" value="2" checked/><label for="zip-fps-2">2</label>\n                            <input type="radio" id="zip-fps-6" name="zip-fps" value="6" /><label for="zip-fps-6">6</label>\n                            <input type="radio" id="zip-fps-24" name="zip-fps" value="24" /><label for="zip-fps-24">24</label>\n                            <input type="radio" id="zip-fps-60" name="zip-fps" value="60" /><label for="zip-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="zip-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-scale-full" name="zip-scale" value="1" checked/><label for="zip-scale-full">1x</label>\n                            <input type="radio" id="zip-scale-half" name="zip-scale" value="0.5" /><label for="zip-scale-half">0.5x</label>\n                            <input type="radio" id="zip-scale-quart" name="zip-scale" value="0.25" /><label for="zip-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-pxz" data="pxz" class="option-task">\n                    <img src="/img/icon/file-pxz.svg" class="type ic">\n                    <div class="name">PXZ <span>${(0,n.Z)("completePixlrDocument")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="save-pxz-ndestuctive" />\n                        <label class="switch pad-10" for="save-pxz-ndestuctive">${(0,n.Z)("dialogSaveNonDestructive")}<span></span></label>\n                        <p>${(0,n.Z)("dialogSavePXZDescription")}</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n        `),this.canvas=this.stage.getOutputCanvas(),this.hasWebP=-1!==l.vL(5,5).toDataURL("image/webp").indexOf("webp"),this.stage.fresco.hasAnimation()?((0,o.ZP)("tab-animation").style.display="block",this.tab="animation",this.type="mp4"):((0,o.ZP)("tab-animation").style.display="none",this.type=l.EL(this.canvas)?"png":"jpg",this.tab="image"),(0,o.ZP)("type-"+this.type).append((0,o.T)("div",{className:"reko"},(0,n.Z)("recommend"))),(0,o.ZP)("tab-image").addEventListener("click",this.setTab),(0,o.ZP)("tab-animation").addEventListener("click",this.setTab),(0,o.ZP)("tab-document").addEventListener("click",this.setTab),(0,o.ZP)("type-jpg").addEventListener("click",this.setType),(0,o.ZP)("type-png").addEventListener("click",this.setType),(0,o.ZP)("type-webp").addEventListener("click",this.setType),(0,o.ZP)("type-pdf").addEventListener("click",this.setType),(0,o.ZP)("type-pxz").addEventListener("click",this.setType),(0,o.ZP)("type-mp4").addEventListener("click",this.setType),(0,o.ZP)("type-gif").addEventListener("click",this.setType),(0,o.ZP)("type-zip").addEventListener("click",this.setType),u.ZP.api&&"dropbox"===u.ZP.referrer&&(0,o.ZP)("dialog-apply"+this.mid).after((0,o.T)("a",{id:"dialog-api-apply",className:"button positive",onclick:()=>this.applyAPi()},(0,o.T)("img",{src:"/img/misc/dropbox-icon.svg"})," save"));let t=this.stage.fresco.name.lastIndexOf(".");this.name=-1!==t?this.stage.fresco.name.substring(0,t):this.stage.fresco.name,this.jpgquality=new r.Z("jpg-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,n.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,o.ZP)("jpg-quality-low").checked=!0:e<.8?(0,o.ZP)("jpg-quality-med").checked=!0:(0,o.ZP)("jpg-quality-high").checked=!0,this.renderBlob()}});let s=(0,o.ZP)("jpg-quality-switch").getElementsByTagName("input");for(var i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{let t=e.currentTarget;this.jpgquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);let a=(0,o.ZP)("jpg-width");a.addEventListener("change",this.jpgSizeChange,!1),a.addEventListener("input",this.jpgSizeChange,!1);let v=(0,o.ZP)("jpg-height");v.addEventListener("change",this.jpgSizeChange,!1),v.addEventListener("input",this.jpgSizeChange,!1),this.webpquality=new r.Z("webp-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,n.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,o.ZP)("webp-quality-low").checked=!0:e<.8?(0,o.ZP)("webp-quality-med").checked=!0:(0,o.ZP)("webp-quality-high").checked=!0,this.renderBlob()}}),s=(0,o.ZP)("webp-quality-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{let t=e.currentTarget;this.webpquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);(0,o.ZP)("webp-transparent").addEventListener("change",(()=>this.changeType("webp",!0))),(0,o.ZP)("png-transparent").addEventListener("change",(()=>this.changeType("png",!0))),s=(0,o.ZP)("gif-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);s=(0,o.ZP)("gif-speed-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);s=(0,o.ZP)("mp4-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("mp4",!0)}),!1);s=(0,o.ZP)("zip-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("zip",!0)}),!1);u.ZP.api&&u.ZP.locktarget&&"dropbox"===u.ZP.referrer&&((0,o.ZP)("dialog-apply"+this.mid).style.display="none"),u.ZP.api&&"dropbox"===u.ZP.referrer&&((0,o.ZP)("dialog-api-apply").style.display="inline-block"),this.changeTab(this.tab)}}i()}catch(f){i(f)}}))},4178:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947);class n{constructor(e){for(this.scrollTop=()=>{this.content.scrollTo(0,0)},this.moveBar=e=>{let t=this.content.scrollHeight,s=this.content.clientHeight;if(this.scrollRatio=s/t,this.scrollRatio>=1)this.bar.classList.add("ss-hidden");else{this.bar.classList.remove("ss-hidden");const e=Math.max(this.scrollRatio*s,20),i=this.content.scrollTop/(t-s)*(s-e);this.bar.style.cssText="height:"+e+"px; top:"+i+"px"}},e.classList.add("ss-wrapper"),this.content=(0,i.T)("div",{id:e.id+"-ss-content",className:"ss-content"});e.firstChild;)this.content.appendChild(e.firstChild);e.appendChild(this.content),this.bar=(0,i.T)("div",{className:"ss-scroll"}),e.append(this.bar);let t=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=e.pageY-this.lastPageY;this.lastPageY=e.pageY,this.content.scrollTop+=t/this.scrollRatio},s=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",s,!0)};this.bar.addEventListener("mousedown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.lastPageY=e.pageY,document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",s,!0)}),!0),this.moveBar(null),window.addEventListener("resize",this.moveBar),this.content.addEventListener("click",this.moveBar),this.content.addEventListener("scroll",this.moveBar),this.content.addEventListener("mouseenter",this.moveBar)}}},4188:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),n=s(3655),a=s(3947);const r={step:[.01],range:[0,1],stops:[0,1],compact:!1,force:!1,defaultValue:0,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10)};class o{constructor(e,t={}){if(this.findElements=()=>{this.outlet=this.container.querySelector("input"),this.slider=this.container.querySelector(".slider"),this.knob=this.container.querySelector(".slider .knob"),this.diff=this.container.querySelector(".slider .diff"),this.bounds=this.container.querySelector(".slider .bounds"),this.label=this.container.querySelector(".info label"),this.hold=this.container.querySelector(".slider-holder")},this.buildElements=()=>{this.container.classList.add("range-box"),this.label=document.createElement("label"),this.label.innerText=(this.options.label||this.name)+" ",this.outlet=document.createElement("input"),this.outlet.type="text",this.outlet.autocomplete="off",this.outlet.value=this.options.labelFormat(this.options.defaultValue);const e=document.createElement("div");e.className="info",e.appendChild(this.label),e.appendChild(this.outlet),this.knob=document.createElement("div"),this.knob.innerHTML="<div></div>",this.knob.className="knob",this.bounds=(0,a.T)("div",{className:"bounds"},this.knob),this.diff=(0,a.T)("div",{className:"diff"},this.bounds),this.slider=(0,a.T)("div",{className:"slider"},this.diff),this.hold=(0,a.T)("div",{className:"slider-holder"},this.slider),this.container.appendChild(e),this.container.appendChild(this.hold)},this.labelOver=()=>{this.value!==this.options.defaultValue&&(this.label.innerText=(0,i.Z)("reset")+" ")},this.labelOut=()=>{this.label.innerText=(this.options.label||this.name)+" "},this.labelClick=()=>{if(this.value===this.options.defaultValue)return;const e=this.value;this.options.onStart&&this.options.onStart(this.value,this.name),this.reset(),this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,e,this.name)},this.sliderMouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.knobDown(e),this.move(e.clientX)},this.knobDown=e=>{document.addEventListener("mousemove",this.knobMouseMove,!1),document.addEventListener("touchmove",this.knobTouchMove,{passive:!1}),document.addEventListener("mouseup",this.knobUp,!0),document.addEventListener("touchend",this.knobUp,{passive:!1}),this.knob.classList.add("grabbed"),e.preventDefault(),e.stopPropagation(),this.downValue=this.value,this.options.onStart&&setTimeout((()=>this.options.onStart(this.downValue,this.name)),0)},this.move=e=>{const t=this.bounds.getBoundingClientRect();if(e<=t.left)return void this.setAmount(0);if(e>=t.right)return void this.setAmount(1);const s=(e-t.left)/t.width;this.setAmount(s)},this.knobMouseMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.clientX)},this.knobTouchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX)},this.knobUp=()=>{if(document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.classList.remove("grabbed"),this.options.onEnd&&(this.options.force||this.downValue!==this.value)){const e=this.downValue;this.downValue=this.value,setTimeout((()=>this.options.onEnd(this.value,e,this.name)),0)}},this.outletKeyUp=e=>{const t=this.options.labelParse(this.outlet.value);if(isNaN(t))return;const s=this.options.range[0],i=this.options.range[this.options.range.length-1],n=Math.max(Math.min(t,i),s);this.value=n,this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.diff.style.backgroundImage=this.generateDiff(this.options.defaultValue,this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),this.options.onChange&&void 0!==e&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.outletFocus=e=>{if(this.options.onStart&&(this.downValue=this.value,this.options.onStart(this.value,this.name)),this.options.compact){this.hold.style.display="block";const e=n.HS(this.container);this.hold.style.left=e.x+this.container.offsetWidth-this.hold.offsetWidth+10+"px",this.hold.style.top=e.y+34+"px"}},this.outletBlur=e=>{this.options.compact&&(this.hold.style.display="none");const t=this.options.labelParse(this.outlet.value);isNaN(t)||(this.outlet.value=this.options.labelFormat(this.value),this.options.onEnd&&(this.options.force||this.downValue!==this.value)&&void 0!==e&&this.options.onEnd(this.value,this.downValue,this.name))},this.calculateAmount=e=>{for(let t=1;t<this.options.range.length;t++){const s=this.options.range[t-1],i=this.options.range[t];if(e>=s&&e<=i){const n=this.options.stops[t-1];return n+(e-s)/(i-s)*(this.options.stops[t]-n)}}if(e==this.options.defaultValue)throw new Error("Cant recurse on default value with calculateAmount, this is a bug");return this.calculateAmount(this.options.defaultValue)},this.setKnob=e=>{const t=100*this.calculateAmount(this.options.defaultValue),s=this.generateDiff(t,e);requestAnimationFrame((()=>{this.knob.style.marginLeft=`${e}%`,this.diff.style.backgroundImage=s}))},this.roundToStep=(e,t,s,i)=>{const n=e%t;return 0===n||e===s||e===i?e:e-n},this.generateDiff=(e,t)=>{if(e===t)return"none";const s="var(--accent-color)",i=this.knob.clientWidth-3;return(t*=this.bounds.clientWidth/this.diff.clientWidth)>e?`linear-gradient(to right, transparent 0%, transparent ${e}%, ${s} ${e}%, ${s} calc(${t}%), transparent calc(${t}%), transparent 100%)`:`linear-gradient(to right, transparent 0%, transparent calc(${t}% + ${i}px), ${s} calc(${t}% + ${i}px), ${s} ${e}%, transparent ${e}%, transparent 100%)`},this.setAmount=(e,t=!1)=>{const[s,i]=this.bucket(e),n=this.options.range[s],a=this.options.range[s+1],r=this.options.step[s];this.setKnob(100*e),this.value=this.roundToStep(i*(a-n)+n,r,n,a),this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.outlet.value=this.options.labelFormat(this.value),this.options.onChange&&!t&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.bucket=e=>{for(let t=1;t<this.options.stops.length;t++){const s=this.options.stops[t-1],i=this.options.stops[t];if(e>=s&&e<=i)return[t-1,(e-s)/(i-s)]}throw new Error(`Could not assign ${e} to a bucket, this is a bug`)},this.setValue=(e,t=!1)=>{const s=this.value;void 0===e&&(e=this.options.defaultValue);const i=this.options.range[0],n=this.options.range[this.options.range.length-1];this.value=Math.max(Math.min(e,n),i),this.slider.classList.toggle("changed",this.isChanged()),this.outlet.value=this.options.labelFormat(this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),(this.options.onChange||this.options.onEnd)&&t&&setTimeout((()=>{this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,s,this.name)}),0)},this.isChanged=()=>this.value!==this.options.defaultValue,this.getValue=()=>{var e;return null!==(e=this.value)&&void 0!==e?e:0},this.reset=()=>{this.value=this.options.defaultValue,this.setKnob(100*this.calculateAmount(this.value)),this.slider.classList.remove("changed"),this.outlet.value=this.options.labelFormat(this.value),this.label.innerText=(this.options.label||this.name)+" "},this.cleanUp=()=>{document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.removeEventListener("mousedown",this.knobDown,!1),this.knob.removeEventListener("touchstart",this.knobDown),this.slider.removeEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.removeEventListener("focus",this.outletFocus,!1),this.outlet.removeEventListener("keyup",this.outletKeyUp,!1),this.outlet.removeEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.removeEventListener("mouseover",this.labelOver,!1),this.label.removeEventListener("mouseleave",this.labelOut,!1),this.label.removeEventListener("click",this.labelClick,!1))},this.name=e,this.container=(0,a.ZP)(e),this.options=Object.assign(Object.assign({},r),t),this.value=this.options.defaultValue,Array.isArray(this.options.step)||(this.options=Object.assign(Object.assign({},this.options),{step:[this.options.step]})),this.options.stops.length<2)throw new Error("Slider need to have atleast two stops, default is [0,1]");if(this.options.range.length!=this.options.stops.length)throw new Error("Slider range option and slide stops option, needs to be the same length");if(this.options.step.length!=this.options.stops.length-1)throw new Error("Step array must be the same length as the number of ranges (slider options range - 1)");this.options.compact&&this.container.classList.add("compact");!!this.container.querySelector(".slider")?this.findElements():this.buildElements(),this.knob.addEventListener("mousedown",this.knobDown,!1),this.knob.addEventListener("touchstart",this.knobDown,{passive:!1}),this.slider.addEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.addEventListener("focus",this.outletFocus,!1),this.outlet.addEventListener("keyup",this.outletKeyUp,!1),this.outlet.addEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.addEventListener("mouseover",this.labelOver,!1),this.label.addEventListener("mouseleave",this.labelOut,!1),this.label.addEventListener("click",this.labelClick,!1)),this.outlet.value!==this.options.labelFormat(this.options.defaultValue)?(this.outletKeyUp(void 0),this.outletBlur(void 0)):this.reset()}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}disable(){this.container.style.pointerEvents="none",this.container.style.opacity="0.4"}enable(){this.container.style.pointerEvents="auto",this.container.style.opacity="1.0"}}},7549:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3947),n=s(3673);class a{constructor(e){this.verticalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientY-this.downPoint.y)/this.spaceHeightRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new n.Z(0,t))),this.stage.updateViewport()},this.verticalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.verticalDrag,!0),document.removeEventListener("pointerup",this.verticalStop,!0)},this.horizontalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientX-this.downPoint.x)/this.spaceWidthRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new n.Z(t,0))),this.stage.updateViewport()},this.horizontalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.horizontalDrag,!0),document.removeEventListener("pointerup",this.horizontalStop,!0)},this.resize=()=>{this.verticalHolder.style.top=this.stage.raster.offsetTop+"px",this.verticalHolder.style.left=this.stage.raster.offsetLeft+this.stage.raster.offsetWidth-16+"px",this.verticalHolder.style.height=this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.top=this.stage.raster.offsetTop+this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.left=this.stage.raster.offsetLeft+"px",this.horizontalHolder.style.width=this.stage.raster.offsetWidth+"px",this.spaceHeight=this.stage.raster.offsetHeight-20,this.spaceWidth=this.stage.raster.offsetWidth-181,this.render()},this.render=()=>{if(!this.stage.fresco)return;this.imageInfo.innerText=this.stage.fresco?this.stage.fresco.width+" x "+this.stage.fresco.height+" px @ "+Math.round(100*this.stage.zoom)+"%":"";let e=this.stage.fresco.width*this.stage.zoom,t=this.stage.fresco.height*this.stage.zoom;this.horizontalSlider.style.display=this.stage.raster.width<=e?"block":"none",this.verticalSlider.style.display=this.stage.raster.height<=t?"block":"none",this.spaceHeightRatio=this.spaceHeight/(t+500),this.spaceWidthRatio=this.spaceWidth/(e+500);const s=Math.round(this.spaceWidth*(this.stage.raster.width/(e+500))),i=Math.round(this.spaceHeight*(this.stage.raster.height/(t+500))),n=-1*(this.stage.offset.x-250)/(e+500),a=-1*(this.stage.offset.y-250)/(t+500),r=Math.round((this.spaceWidth-(s<30?30-s:0))*n),o=Math.round((this.spaceHeight-(i<30?30-i:0))*a);this.horizontalSlider.style.width=Math.max(s,30)+"px",this.horizontalSlider.style.left=162+r+"px",this.verticalSlider.style.height=Math.max(i,30)+"px",this.verticalSlider.style.top=2+o+"px"},this.stage=e,this.verticalSlider=(0,i.T)("div",{id:"vertical-scroll-slider"}),this.verticalHolder=(0,i.T)("div",{id:"vertical-scroll-holder"},this.verticalSlider),(0,i.ZP)("workspace").appendChild(this.verticalHolder),this.imageInfo=(0,i.T)("div",{id:"horizontal-image-info"}),this.horizontalSlider=(0,i.T)("div",{id:"horizontal-scroll-slider"}),this.horizontalHolder=(0,i.T)("div",{id:"horizontal-scroll-holder"},this.imageInfo,this.horizontalSlider),(0,i.ZP)("workspace").appendChild(this.horizontalHolder),document.addEventListener("viewport-update",this.render),this.verticalHolder.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.offsetY-2)/this.spaceHeightRatio/this.stage.zoom,s=this.stage.anchor.clone();s.y=t,this.stage.setAnchor(s),this.stage.updateViewport()}),!1),this.verticalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.verticalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new n.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.verticalDrag,!0),document.addEventListener("pointerup",this.verticalStop,!0)}),!0),this.horizontalHolder.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.offsetX-160>this.spaceWidth)this.stage.setZoom("fit");else if(e.offsetX>160){let t=(e.offsetX-160)/this.spaceWidthRatio/this.stage.zoom,s=this.stage.anchor.clone();s.x=t,this.stage.setAnchor(s),this.stage.updateViewport()}}),!1),this.horizontalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.horizontalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new n.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.horizontalDrag,!0),document.addEventListener("pointerup",this.horizontalStop,!0)}),!0)}}},3655:(e,t,s)=>{s.d(t,{$E:()=>Z,$n:()=>u,Ai:()=>C,Bs:()=>g,CE:()=>d,Dc:()=>Y,Ds:()=>W,EL:()=>V,HS:()=>ee,L5:()=>te,M8:()=>O,Mk:()=>se,PP:()=>J,ST:()=>A,Sy:()=>q,TA:()=>l,Td:()=>b,UF:()=>f,WL:()=>I,XE:()=>r,XI:()=>p,Xj:()=>R,ZE:()=>S,Zd:()=>U,_c:()=>k,aG:()=>y,d4:()=>X,dN:()=>_,eY:()=>L,fg:()=>M,fu:()=>$,gr:()=>j,iF:()=>K,jb:()=>B,k3:()=>ie,kD:()=>h,l:()=>z,lI:()=>E,lU:()=>x,ly:()=>Q,mS:()=>m,q7:()=>v,qT:()=>P,uZ:()=>H,vJ:()=>T,vL:()=>w,vO:()=>N,wf:()=>o,x2:()=>D,xZ:()=>c,zs:()=>F});var i=s(6548),n=s(6817),a=s(3673);const r="rgba(255,255,255, 0.7)",o="rgb(255,255,255)",h="rgb(32,209,139)",c="rgb(0,163,218)",l="rgb(209,72,14)",d="rgb(255,0,255)",u="rgb(67,201,143)",p="rgb(75,75,75)",g="rgb(148,148,148)";function m(e,t){if(void 0===t)return;if(t instanceof e)return t;const s=Object.create(e.prototype);return Object.assign(s,t)}function v(e,t,s,i){let n;return n=e/t>s/i?s/e:i/t,n>1?1:n}function f(e,t,s,i){return e/t<s/i?s/e:i/t}function y(e,t,s,i,n,a){return a>=t&&a<t+i&&n>=e&&n<e+s}function w(e,t){e<0&&(e=1),t<0&&(t=1);let s=document.createElement("canvas");return s.width=e,s.height=t,s}async function b(e){if(!e)return;const t=URL.createObjectURL(e),s=await x(t);return URL.revokeObjectURL(t),s}function x(e){if(void 0!==e)return new Promise(((t,s)=>{if(!e)return console.log("Invalid URL in dataURLToCanvas"),void t(void 0);const i=document.createElement("canvas"),n=i.getContext("2d"),a=new Image;a.onerror=e=>s(e),a.onload=()=>{i.width=a.width,i.height=a.height,n.drawImage(a,0,0),t(i)},a.src=e}))}function Z(e,t){if(!e)return;const s=t||new n.Z(0,0,e.width,e.height);return e.getContext("2d").getImageData(s.x,s.y,s.width,s.height)}function k(e,t){if(!e)return;const s=t||new n.Z(0,0,e.width,e.height),i=w(s.width,s.height);return i.getContext("2d").drawImage(e,-s.x,-s.y),new Promise(((e,t)=>i.toBlob(e)))}function E(e,t,s){if(!e||!t)return;let i=e.getContext("2d");i.save(),i.globalCompositeOperation="copy",i.drawImage(t,s.x,s.y),i.restore(),i=void 0}function P(e,t,s=0){let i=w(e.width,e.height),a=i.getContext("2d");if(a.drawImage(e,0,0,e.width,e.height),a=void 0,i.width>t||i.height>t){let s=n.Z.bestFit(e.width,e.height,t,t);i=C(i,s.width,s.height)}return 0!==s&&(i=R(i,s)),i}function S(e,t,s){if(!e)return;let i=w(t,s);var n=e.getContext("2d").getImageData(0,0,e.width,e.height),a=new Int32Array(n.data.buffer),r=e.width,o=e.height,h=i.width,c=i.height,l=i.getContext("2d").getImageData(0,0,i.width,i.height),d=new Int32Array(l.data.buffer);const u=h/r,p=c/o;for(let g=0;g<c;){const e=r*~~(g/p),t=h*g++;for(let s=0;s<h;)d[t+s++]=a[e+~~(s/u)]}return i.getContext("2d").putImageData(l,0,0),i}function C(e,t,s,i){var n;if(!e)return;if(t>e.width||s>e.width)return L(e,t,s);let a=null!==(n=i)&&void 0!==n?n:w(t,s);for(var r=e.getContext("2d").getImageData(0,0,e.width,e.height).data,o=e.width,h=e.height,c=a.width,l=a.height,d=a.getContext("2d").getImageData(0,0,a.width,a.height),u=d.data,p=o/c,g=h/l,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<l;f++)for(var y=0;y<c;y++){for(var b=4*(y+f*c),x=0,Z=0,k=0,E=0,P=0,S=0,C=(f+.5)*g,T=Math.floor(f*g);T<(f+1)*g;T++)for(var M=Math.abs(C-(T+.5))/v,A=(y+.5)*p,I=M*M,_=Math.floor(y*p);_<(y+1)*p;_++){var R=Math.abs(A-(_+.5))/m,F=Math.sqrt(I+R*R);F>=-1&&F<=1&&(x=2*F*F*F-3*F*F+1)>0&&(k+=x*r[R=4*(_+T*o)],E+=x*r[R+1],P+=x*r[R+2],S+=x*r[R+3],Z+=x)}u[b]=k/Z,u[b+1]=E/Z,u[b+2]=P/Z,u[b+3]=S/Z}return a.getContext("2d").putImageData(d,0,0),a}async function T(e,t,s,i){var n;if(!e)return;if(t>e.width||s>e.width)return L(e,t,s);let a=null!==(n=i)&&void 0!==n?n:w(t,s);var r=e.getContext("2d").getImageData(0,0,e.width,e.height).data,o=e.width,h=e.height,c=a.width,l=a.height;for(var d=a.getContext("2d").getImageData(0,0,a.width,a.height),u=d.data,p=o/c,g=h/l,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<l;f++)for(var y=0;y<c;y++){for(var b=4*(y+f*c),x=0,Z=0,k=0,E=0,P=0,S=0,C=(f+.5)*g,T=Math.floor(f*g);T<(f+1)*g;T++)for(var M=Math.abs(C-(T+.5))/v,A=(y+.5)*p,I=M*M,_=Math.floor(y*p);_<(y+1)*p;_++){var R=Math.abs(A-(_+.5))/m,F=Math.sqrt(I+R*R);F>=-1&&F<=1&&(x=2*F*F*F-3*F*F+1)>0&&(k+=x*r[R=4*(_+T*o)],E+=x*r[R+1],P+=x*r[R+2],S+=x*r[R+3],Z+=x)}u[b]=k/Z,u[b+1]=E/Z,u[b+2]=P/Z,u[b+3]=S/Z}return a.getContext("2d").putImageData(d,0,0),a}function L(e,t,s,i=!0,n){if(!e)return;t<1&&(t=1),s<1&&(s=1);let a=null!=n?n:w(t,s);var r=a.getContext("2d");return r.imageSmoothingQuality="high",r.imageSmoothingEnabled=i,r.drawImage(e,0,0,a.width,a.height),r=void 0,a}function M(e,t){let s=w(t.width,t.height),i=s.getContext("2d");return i.drawImage(e,-t.x,-t.y),i=void 0,s}function A(e,t,s){let i=w(s.width,s.height),n=i.getContext("2d");return n.imageSmoothingQuality="high",n.imageSmoothingEnabled=!0,n.drawImage(e,t.x-s.x,t.y-s.y,t.width,t.height),n=void 0,i}function I(e,t){if(e){var s=document.createElement("canvas"),i=s.getContext("2d");return s.width=t.width,s.height=t.height,i.drawImage(e,-t.x,-t.y),i=void 0,s}}function _(e){if(e){var t=document.createElement("canvas"),s=t.getContext("2d");return t.width=e.width,t.height=e.height,s.drawImage(e,0,0),s=void 0,t}}function R(e,t){if(e){var s=w(e.width,e.height),i=s.getContext("2d");return 180!==t&&(s.width=e.height,s.height=e.width),i.translate(s.width/2,s.height/2),i.rotate(t*Math.PI/180),i.drawImage(e,-e.width/2,-e.height/2),i.setTransform(1,0,0,1,0,0),i=void 0,s}}function F(e,t,s){let i=w(s.width,s.height),n=i.getContext("2d");return n.save(),n.translate(s.width/2,s.height/2),n.rotate(t*Math.PI/180),n.drawImage(e,-e.width/2,-e.height/2),n.restore(),n=null,i}function D(e,t){if(e){var s=w(e.width,e.height),i=s.getContext("2d");return i.save(),t?(i.scale(1,-1),i.drawImage(e,0,-e.height,e.width,e.height)):(i.scale(-1,1),i.drawImage(e,-e.width,0,e.width,e.height)),i.restore(),i=void 0,s}}function z(e){if(!e)return;const t=e.width,s=e.height;return N(e.getContext("2d").getImageData(0,0,t,s))}function N(e){if(!e)return;const t=e.width,s=e.height;let i,a,r=new Uint32Array(e.data.buffer),o=-1,h=-1,c=-1,l=-1;for(a=0;a<s;++a){for(i=0;i<t;++i)if(r[i+a*t]>0){h=a;break}if(-1!==h)break}if(-1!==h){for(a=s-1;a>=h;--a){for(i=0;i<t;++i)if(r[i+a*t]>0){l=a+1;break}if(-1!==l)break}for(i=0;i<t;++i){for(a=h;a<=l;++a)if(r[i+a*t]>0){o=i;break}if(-1!==o)break}for(i=t-1;i>=o;--i){for(a=h;a<=l;++a)if(r[i+a*t]>0){c=i+1;break}if(-1!==c)break}return new n.Z(o,h,c-o,l-h)}}function B(e){let t=e/1024;return t>1024?(t/1024).toFixed(1)+"mb":t>100?Math.round(t)+"kb":Math.round(10*t)/10+"kb"}function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function U(){return"xxxxyxxx4xxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function H(e,t,s){return isNaN(e)?t:Math.min(Math.max(e,t),s)}function q(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function V(e){let t=!1,s=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(var i=0;i<s.length;i+=4)if(s[i+3]<255){t=!0;break}return t}function j(e){let t=new a.Z(0,255);var s=Array(256);s.fill(0);var i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(let a=0;a<i.length;a+=4)s[i[a]]+=1,s[i[a+1]]+=1,s[i[a+2]]+=1;var n=Math.round(e.width*e.height/1e3);let r;for(r=0;r<256;++r)if(s[r]>n){t.x=r;break}for(r=255;r>=0;--r)if(s[r]>n){t.y=r;break}return t.x>100&&(t.x=100),t.y<155&&(t.y=155),t}function $(e){let t=1,s=1,i=e.width<500&&e.height<500?e:L(e,500,500);const n=i.width,a=i.height;let r,o,h,c,l,d,u,p,g,m=i.getContext("2d").getImageData(0,0,n,a).data;for(l=a;l--;)for(c=n;c--;)d=4*(l*n+c),r=m[d],o=m[d+1],h=m[d+2],u=Math.min(r,o,h),p=Math.max(r,o,h),s+=p/255,g=p-u,g&&(t+=g/p);return t=(t+s)/(i.width*i.height*2),t}const G={};function W(e,t,s){window.clearTimeout(G[e]),G[e]=window.setTimeout((()=>{delete G[e],s()}),t)}const X=(e,t)=>{let s;return(...i)=>{clearTimeout(s),s=window.setTimeout((()=>t(...i)),e)}};function Y(e){return new Promise(((t,s)=>{setTimeout((()=>t()),e)}))}function K(){return new Promise(((e,t)=>{window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{e()}))}))}))}function Q(e){const t=((new Date).getTime()-e.getTime())/1e3;if(t<0)return"It's the future man";const s=Math.floor(t/86400);if(s>=1)return s>1?(0,i.Z)("sinceDays",s):(0,i.Z)("sinceDay");const n=Math.floor(t/3600);if(n>=1)return n>1?(0,i.Z)("sinceHours",n):(0,i.Z)("sinceHour");const a=Math.floor(t/60);return a>=1?a>1?(0,i.Z)("sinceMinutes",a):(0,i.Z)("sinceMinute"):(0,i.Z)("sinceNow")}function J(e){if(!e)return!1;if("TEXTAREA"===e.nodeName)return!0;if("INPUT"===e.nodeName){const t=e,s=t.type.toLowerCase();return"text"===s||"number"===s||"url"===s||!!t.contentEditable}return!1}function ee(e){let t=new a.Z(e.offsetLeft,e.offsetTop);for(;e.offsetParent&&(t.x=t.x+e.offsetParent.offsetLeft,t.y=t.y+e.offsetParent.offsetTop,e!=document.getElementsByTagName("body")[0]);)e=e.offsetParent;return t}class te{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}}Symbol.toStringTag;class se extends Error{constructor(){super("Promise canceled")}}class ie extends te{constructor(e,t){super(),this.canceled=!1,this.isCanceled=()=>this.canceled,this.cancel=()=>{this.canceled||(this.canceled=!0,this.cancelCallback(),this.reject(new se))},this.cancelCallback=t,(async()=>{try{this.resolve(await e())}catch(t){this.reject(t)}})()}}},5182:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>k});var n=s(6548),a=s(3607),r=s(3947),o=s(3655),h=s(4375),c=s(9091),l=s(9872),d=s(6817),u=s(1030),p=s(3673),g=s(6792),m=s(4820),v=s(7163),f=s(7758),y=s(5934),w=s(840),b=s(7630),x=e([a,c]);[a,c]=x.then?(await x)():x;var Z=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=e[s]&&function(t){return new Promise((function(i,n){(function(e,t,s,i){Promise.resolve(i).then((function(t){e({value:t,done:s})}),t)})(i,n,(t=e[s](t)).done,t.value)}))}}};class k{constructor(){let e;if(this.optimizeForPWA=()=>{if((0,r.ZP)("language")&&((0,r.ZP)("language").style.display="none"),(0,r.ZP)("app-selector")){const e=(0,r.ZP)("app-selector").getElementsByTagName("a");for(let t=0;t<e.length;t++)e[t].setAttribute("target","_blank")}(0,r.ZP)("logo")&&(0,r.ZP)("logo").setAttribute("target","_blank")},this.navigateBack=e=>{e.preventDefault(),e.stopPropagation();let t=location.hash?location.hash.replace("#",""):void 0;"editor"!==t||this.stage.fresco||(t="home"),this.navigate(null==t?void 0:t.split("&")[0],!1),e.returnValue=void 0},this.navigate=(e,t=!0)=>{if(!e||this.section!==e){if("editor"===e){if(this.section=e,(0,r.ZP)("home").style.display="none",(0,r.ZP)("workspace").style.display="block","e"===m.ZP.product||"x"===m.ZP.product)if("localhost"!==location.hostname&&!m.ZP.user.subscription&&!(0,r.ZP)("right-space")&&document.body.clientWidth>1024){const e=(0,r.T)("div",{id:"right-space"});document.body.appendChild(e);try{document.body.clientWidth>1600?((0,u.Z)("ads","cut"),e.style.width="300px",(0,r.ZP)("workspace").style.right="304px",e.appendChild((0,r.T)("iframe",{id:"iasriiigh",src:"/dad/cut/",frameBorder:"0",scrolling:"no",style:"width:300px;height:100%;overflow:hidden;"}))):((0,u.Z)("ads","slot"),e.style.width="160px",(0,r.ZP)("workspace").style.right="164px",e.appendChild((0,r.T)("iframe",{id:"iasriiigh",src:"/dad/slot/",frameBorder:"0",scrolling:"no",style:"width:160px;height:100%;overflow:hidden;"})))}catch(s){console.log(s)}const t=()=>{(0,r.ZP)("iasriiigh").src=(0,r.ZP)("iasriiigh").src};window.setInterval(t,18e4)}else(0,r.ZP)("right-space")&&((0,r.ZP)("right-space").style.display="block");document.dispatchEvent(new CustomEvent("resize"))}else(0,r.ZP)("home").style.display="block",(0,r.ZP)("workspace").style.display="none",(0,r.ZP)("right-space")&&((0,r.ZP)("right-space").style.display="none"),this.section=e||(this.home.section?this.home.section:"home"),this.home.activate(this.section);t&&this.section&&history.pushState(null,null,"#"+this.section),"e"===m.ZP.product&&(0,r.ZP)("title-bar")&&((0,r.ZP)("title-bar").style.display=this.isHome()?"flex":"none"),this.home.showOrHideBackToEditor()}},this.selectTool=e=>{},this.i18nReplace=(e,...t)=>{const[s]=t;return(0,n.Z)(s)},this.CDNUrlReplace=(e,t)=>e.replace(t,`${m.ZP.cdnUrl}${t}`),this.isHome=()=>"none"===(0,r.ZP)("workspace").style.display,this.tabSelect=e=>{this.stage.select(e)},this.tabClose=e=>{this.stage.close(e),0===this.stage.tabs.length&&this.navigate()},this.center=e=>{const t=this.stage.canvas.getBoundingClientRect();return new p.Z(this.isHome()?Math.round(document.body.clientWidth/2-e.clientWidth/2):Math.round(t.width/2+t.left-e.clientWidth/2),this.isHome()?Math.round(document.body.clientHeight/2-e.clientHeight/2):Math.round(t.height/2+t.top-e.clientHeight/2))},this.notification=e=>{const t=(0,r.ZP)("notification");t&&(this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),requestAnimationFrame((()=>{t.style.display="block",t.innerHTML='<div class="message">'+e.detail+"</div>";const s=this.center(t);t.style.top=s.y+"px",t.style.left=s.x+"px"})),this.notiId=setTimeout((function(){t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none"}),800))},this.legend=e=>{const t=(0,r.ZP)("notification");if(!t)return;if("stop"===e.detail)return t.innerHTML="",t.style.top="-999px",t.style.left="-999px",void(t.style.display="none");t.style.display="block",""===t.innerHTML?t.innerHTML='<div id="legend" class="legend">'+e.detail+"</div>":(0,r.ZP)("legend")&&((0,r.ZP)("legend").innerText=e.detail);const s=this.center(t);t.style.top=Math.round(s.y/3)+"px",t.style.left=s.x+"px"},this.loading=e=>{const t=(0,r.ZP)("notification");if(!t)return;if("stop"===e.detail)return void(this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.display="none"));this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),this.notiId=setTimeout((()=>{this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none")}),400),t.style.display="block",t.innerHTML=`\n            <div class="spinner">\n                ${"start"===e.detail?"Loading":e.detail}<span>.</span><span>.</span><span>.</span>\n            </div>\n        `;const s=this.center(t);t.style.top=s.y+"px",t.style.left=s.x+"px",this.keepLoading=!0},this.loadView=(e,t,s)=>{const i=/§([a-zA-Z]{1}[a-zA-Z0-9]*)§/g,n=/<img src="([^'"]+.(?:svg|jpg))"/g;return new Promise(((a,o)=>{let h=new XMLHttpRequest;h.open("GET","/view/"+m.ZP.product+"/"+e+".html",!0),h.onreadystatechange=()=>{if(4!==h.readyState)return;if(200!==h.status)return void o("Non 200 status code");let c=h.responseText.replace(n,this.CDNUrlReplace);c=c.replace(i,this.i18nReplace);const l=document.createElement("section");l.id=e,l.innerHTML=c,s&&(l.className=s),(t?(0,r.ZP)(t):(0,r.ZP)("workspace")).appendChild(l),a(l)},h.send()}))},this.dragOver=e=>{if(e.preventDefault(),e.stopPropagation(),!(0,r.ZP)("modal-drop")){const e=document.createElement("div");e.id="modal-drop",e.classList.add("modal","dim","vertical-align"),e.innerHTML=`<div id="dim-message">${(0,n.Z)("dropFile")}</div>`,document.body.appendChild(e)}},this.dragOut=e=>{e.preventDefault(),e.stopPropagation(),e.clientX<=0&&(0,r.ZP)("modal-drop")&&(0,r.ZP)("modal-drop").remove()},this.drop=async e=>{e.stopPropagation(),e.preventDefault(),(0,r.ZP)("modal-drop")&&(0,r.ZP)("modal-drop").remove(),document.body.style.pointerEvents="auto";const t=e.dataTransfer.files;for(var s,i=0;s=t[i];i++)await(0,y.ZB)(this.stage,s,!0,"drop")},this.cut=async e=>{var t;if(this.isModal())return;if(o.PP(document.activeElement))return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let s=this.stage.cut();s instanceof HTMLCanvasElement?(this.writeClipboard(e,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("cut")}))):navigator.clipboard.writeText("")},this.copy=async e=>{var t;if(this.isModal())return;if(o.PP(document.activeElement))return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let s=this.stage.copy();s instanceof HTMLCanvasElement?(this.writeClipboard(e,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("copy")}))):navigator.clipboard.writeText("")},this.clear=async()=>{this.stage.clear()&&document.dispatchEvent(new CustomEvent("notification",{detail:"clear"}))},this.writeClipboard=async(e,t)=>{const s=await o._c(t);if(s){this.stage.clipboard=t,this.stage.clipboardSize=new l.Z(t.width,t.height);try{const e={name:"clipboard-write"};await navigator.permissions.query(e)}catch(i){console.log(i)}try{const e=new ClipboardItem({"image/png":s});await navigator.clipboard.write([e]),this.stage.clipboard=void 0}catch(i){console.log(i);try{let e=new DataTransfer;e.items.add("image/png",t.toDataURL()),await navigator.clipboard.write(e),this.stage.clipboard=void 0}catch(n){console.log(n);try{e.clipboardData.setData("image/png",t.toDataURL()),this.stage.clipboard=void 0}catch(a){console.log(a)}}}}},this.pasteActivatedFromMenu=async()=>{try{const e={name:"clipboard-read"};await navigator.permissions.query(e)}catch(e){console.log(e)}try{const e=await navigator.clipboard.read(),t=await e[0].getType("image/png");if(t)(0,y.ZB)(this.stage,new File([t],"clipboard"),!1,"paste"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}));else{if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("noPaste")}))}}catch(e){if(console.log(e),this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("emptyPaste")}))}},this.paste=async e=>{if(this.isModal())return;const t=document.activeElement;if(!o.PP(t)){if(e.clipboardData.items.length>0){const t=e.clipboardData.items;let a;for(var s,i=0;s=t[i];i++)if("file"===s.kind){a=s;break}if(a||(a=t[0]),"string"===a.kind)return void a.getAsString((async t=>{if(o.PP(document.activeElement))return;e.preventDefault(),e.stopPropagation();let s=/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/gi.exec(t);if(s&&s.length>1){let e=await new h.Z(this.stage).load(s[1]);return(0,y.ZB)(this.stage,e,this.isHome()),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}if(this.stage.fresco){t.length>200&&(t=t.substring(0,200));let e=Math.max(16,Math.round(this.stage.fresco.height/20)),s=Math.round(this.stage.fresco.width/1.5),i=Math.round(this.stage.fresco.height/2.5),a=Math.round((this.stage.fresco.width-s)/2),r=new f.Z("verdana",e);this.stage.addText(t,new d.Z(a,i,s,e),r,"paste"),this.navigate("editor"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}}));if("file"===a.kind){if(-1==a.type.indexOf("image"))return;e.preventDefault(),e.stopPropagation();const t=a.getAsFile();return(0,y.ZB)(this.stage,t,this.isHome(),"paste"),this.stage.selectionDeselect(),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}}else if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("emptyPasteGlobal")}))}},this.pasteLocal=()=>{Array.isArray(this.stage.clipboard)?this.stage.pasteLayer():this.stage.clipboard instanceof HTMLCanvasElement&&(this.stage.addImage(o.dN(this.stage.clipboard),(this.stage.fresco,this.stage.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")})),this.stage.selectionDeselect())},this.isModal=()=>document.getElementsByClassName("modal").length>0,this.quickExport=async(e=!1)=>{var t,s,i,a;if(this.stage.fresco.block)return;let r,o,h;if(e){if(o=null===(s=null===(t=this.stage.fresco)||void 0===t?void 0:t.getSelected())||void 0===s?void 0:s.canvas,!o)return;r=null===(a=null===(i=this.stage.fresco)||void 0===i?void 0:i.getSelected())||void 0===a?void 0:a.settings.name}else o=this.stage.getOutputCanvas(),r=this.stage.fresco.name,this.stage.fresco.savedTimesCounterForUserEase>0&&(r+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++;r=r.replace(".png",""),(0,b.Zp)()&&(h=await(0,b.f1)(r,"png","PNG image","image/png"),!1===h)||(o.toBlob((async e=>{const t=new File([e],r+".png",{type:"image/png"});h?(await(0,b.BI)(h,t),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")}))):(0,b.vV)(t,r,"png")}),"image/png","100"),(0,u.Z)("quick-export",e?"layer":"page"))},this.closeClick=()=>{(0,u.Z)("close"),this.selectTool(),this.tabClose()},this.saveClick=()=>{(0,u.Z)("save"),this.selectTool(),this.stage.fresco.block?new w.Z(this.stage):new c.Z(this.stage)},document.documentElement.classList.add(m.ZP.workspace,m.ZP.accent),(window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))&&(document.documentElement.classList.add("standalone"),this.optimizeForPWA()),document.addEventListener("cut",this.cut,!0),document.addEventListener("copy",this.copy,!0),document.addEventListener("paste",this.paste,!0),document.addEventListener("dragover",this.dragOver,!0),document.addEventListener("dragleave",this.dragOut,!0),document.addEventListener("drop",this.drop,!0),document.addEventListener("legend",(e=>this.legend(e)),!0),document.addEventListener("loading",(e=>this.loading(e)),!0),document.addEventListener("notification",(e=>this.notification(e)),!0),window.addEventListener("popstate",(e=>this.navigateBack(e))),document.addEventListener("navigate",(e=>this.navigate(e.detail,!0))),this.stage=new g.Z((0,r.ZP)("workspace")),location.hash&&(e=location.hash.replace("#",""),"editor"===e&&(history.replaceState(null,null," "),e=void 0)),"m"!==m.ZP.product&&(this.home=new a.Z(this,null==e?void 0:e.split("&")[0])),m.ZP.template&&(0,y.Hi)(this.stage,m.ZP.template),m.ZP.image){const e="https://pixlr.com/proxy/?url=";new h.Z(this.stage,{title:m.ZP.title,referrer:m.ZP.referrer}).load(e+encodeURIComponent(m.ZP.image)).then((e=>{(0,y.ZB)(this.stage,e)}))}!async function(){var e,t;const s=await v.Z.loadSaved();try{for(var i,n=Z(s);!(i=await n.next()).done;){const e=i.value;v.Z.fontList.unshift(e)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&await t.call(n)}finally{if(e)throw e.error}}}()}}i()}catch(k){i(k)}}))},7282:(e,t,s)=>{s.d(t,{$p:()=>n,Bm:()=>a,Y3:()=>r});class i{constructor(e){this.internal=e}send(e,t){this.internal.postMessage(e,t)}async receive(){return await new Promise(((e,t)=>{this.internal.onmessage=t=>{this.internal.onerror=void 0,this.internal.onmessage=void 0,e(t.data)},this.internal.onerror=t}))}terminate(){var e;null===(e=this.internal)||void 0===e||e.terminate(),this.internal=null}}class n extends i{constructor(){super(new Worker(new URL(s.p+s.u(346),s.b)))}}class a extends i{constructor(){super(new Worker(new URL(s.p+s.u(200),s.b)))}}class r extends i{constructor(){super(new Worker(new URL(s.p+s.u(155),s.b)))}}},6670:(e,t,s)=>{s.d(t,{CF:()=>l,Ef:()=>h,Zn:()=>r,qC:()=>c,te:()=>o});var i=s(3947),n=s(6548);const a={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},r=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"],o=()=>({I:{},COUNTRY:"US",COUNTRIES:a,COUNTRIES_EU:r}),h=async()=>{try{const e=await fetch("/api/geoip/"),t=await e.json();return t.registered_country.iso_code}catch(e){return"US"}},c=async(e,t={},s="POST",n=!1)=>{try{const a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${(0,i.pR)("__pat","")}`);const r=await fetch(e,{method:s,headers:a,body:JSON.stringify(t)});return await r.json()}catch(a){return console.log(a),{status:!1}}},l=(e="success",t="common-ServerError",s=3,i={})=>{const a=document.createElement("div");let r=t?(0,n.Z)(t):"danger"==e?(0,n.Z)("common-ServerError"):(0,n.Z)("common-success");i.email&&(r=r.replace("{email}",i.email)),a.id="dialog-box",a.classList.add("toast",e),a.innerHTML=`\n        <span><img src="/images/icon/${e}_alert.png" /></span>\n        <span class="toast-text">${r}</span>\n        <span class="toast-close ${e}" onclick="this.parentElement.style.display = 'none'">&times;</span>\n    `,document.body.append(a),setTimeout((()=>document.getElementById("dialog-box").remove()),1e3*s)}},6854:(e,t,s)=>{s.d(t,{k:()=>h});var i=s(6548),n=s(3947),a=s(3655),r=s(1281),o=s(6670);(0,o.te)();class h{constructor(e="register",t={method:"popup"}){this.setContent=async(e,t)=>{var s;let i="";switch(e){case"register":i=await this.Form.register();break;case"login":i=this.Form.login();break;case"forgotPassword":i=this.Form.forgotPassword();break;case"setPassword":this.loadCaptcha(),i=this.Form.resetPassword(!0),this.renderCaptcha();break;case"resetPassword":this.loadCaptcha(),i=this.Form.resetPassword(),this.renderCaptcha();break;case"verification":i=this.Form.verification(null!==(s=t.verify)&&void 0!==s?s:"verification");break;case"agreements":i=await this.Form.agreements();break;case"socialAgreements":i=await this.Form.agreements(!0);break;case"changePassword":i=this.Form.changePassword();break;case"changeEmail":i=this.Form.changeEmail();break;case"changeUsername":i=this.Form.changeUsername((0,n.ZP)("change-name").dataset.name);break;case"deleteAccount":const e=(0,n.ZP)("delete-account").dataset.name||"User";i=this.Form.deleteAccount(e);break;case"deleteAccountConfirmation":i=this.Form.deleteAccountConfirmation(t.reason)}this.content.innerHTML=i,this.setFooter(e)},this.setFooter=e=>{switch(this.footer.style.display="block",e){case"login":this.footer.innerHTML=`${(0,i.Z)("common-notMember")} &nbsp; <a class="anchor" id="load-register">${(0,i.Z)("common-signUpNow")}</a>`;break;case"register":this.footer.innerHTML=`${(0,i.Z)("common-alreadyMember")} &nbsp; <a class="anchor" id="load-login">${(0,i.Z)("common-loginHere")}</a>`;break;case"forgotPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,i.Z)("common-back")}</a>`,(0,n.ZP)("entry-back").onclick=()=>this.loadForm("login");break;case"resetPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,i.Z)("common-back")}</a>`,(0,n.ZP)("entry-back").onclick=()=>this.loadForm("forgotPassword");break;default:return this.footer.innerHTML="",void(this.footer.style.display="none")}},this.position=()=>{this.dialog.style.left=Math.round((this.holder.offsetWidth-this.dialog.offsetWidth)/2)+"px",this.dialog.style.top=Math.round((this.holder.offsetHeight-this.dialog.offsetHeight)/2)+"px";let e=this.dialog.getBoundingClientRect(),t=this.holder.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{var e,t;document.removeEventListener("keydown",this.keyDown,!1),null===(e=this.holder)||void 0===e||e.remove(),this.holder=null,null===(t=this.dialog)||void 0===t||t.remove(),this.dialog=null},this.loadForm=async(e,t={})=>{var s,i,a,r,o,h,c,l,d,u,p,g;if(this.form=e,await this.setContent(e,t),"agreements"!==e&&"socialAgreements"!==e||"popup"!==this.options.method?this.dialog.classList.remove("agreements"):this.dialog.classList.add("agreements"),"popup"===this.options.method&&this.position(),null===(s=(0,n.ZP)("entry-form"))||void 0===s||s.addEventListener("submit",(e=>{this.submitForm((0,n.ZP)("entry-form").dataset.entry,e)})),"register"!==this.form&&"resetPassword"!==this.form||(null===(i=(0,n.ZP)("entry-password"))||void 0===i||i.addEventListener("focus",(()=>{this.passwordMeter("show",(0,n.ZP)("entry-password"))})),null===(a=(0,n.ZP)("entry-password"))||void 0===a||a.addEventListener("input",(()=>{this.updatePasswordMeter((0,n.ZP)("entry-password"))}))),"setPassword"===this.form&&(t.email=(0,n.ZP)("set-password").dataset.email),"resetPassword"!==this.form&&"setPassword"!==this.form||((0,n.ZP)("entry-email").value=t.email),"agreements"===this.form&&this.agreementsRenderer(),(0,n.ZP)("entry-to-email")){const e=(0,n.ZP)("entry-to-email").dataset.text.replace("[EMAIL]",t.email);(0,n.ZP)("entry-to-email").innerHTML=e}(0,n.ZP)("verification-email")&&((0,n.ZP)("verification-email").value=t.email),(0,n.ZP)("entry-resend")&&(clearTimeout(this.resendCodeTimeouts),this.resendCodeTimeouts=setTimeout((()=>{(0,n.ZP)("entry-resend").classList.remove("hide")}),3e4),null===(r=(0,n.ZP)("entry-resend"))||void 0===r||r.addEventListener("click",(()=>this.resendCode(t.email)))),[(0,n.ZP)("entry-readAgreements"),(0,n.ZP)("entry-above16")].forEach((e=>{null==e||e.addEventListener("change",(()=>this.verifyAgreements()))})),null===(o=(0,n.ZP)("entry-email"))||void 0===o||o.addEventListener("keyup",(()=>{this.validateInputTimer("email")})),null===(h=(0,n.ZP)("entry-email"))||void 0===h||h.addEventListener("blur",(()=>{this.validateInput((0,n.ZP)("entry-email"),"","email")})),null===(c=(0,n.ZP)("entry-cancel"))||void 0===c||c.addEventListener("click",(()=>this.cleanUp())),null===(l=(0,n.ZP)("load-register"))||void 0===l||l.addEventListener("click",(()=>this.loadForm("register"))),null===(d=(0,n.ZP)("load-login"))||void 0===d||d.addEventListener("click",(()=>this.loadForm("login"))),null===(u=(0,n.ZP)("load-forgotPassword"))||void 0===u||u.addEventListener("click",(()=>this.loadForm("forgotPassword"))),null===(p=(0,n.ZP)("toggle-password"))||void 0===p||p.addEventListener("click",(()=>this.togglePassword())),null===(g=(0,n.ZP)("toggle-password-2"))||void 0===g||g.addEventListener("click",(()=>this.togglePassword("toggle-password-2","entry-password-new"))),Array.from(document.getElementsByClassName("social-button")).forEach((e=>{e.addEventListener("click",(()=>{this.loadSocialLogin(e.dataset.social)}))}))},this.loadSocialLogin=async e=>{if("apple"===e){const e=await new Promise(((e,t)=>{let s=document.createElement("script");s.type="text/javascript",s.crossOrigin="anonymous",s.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",document.body.appendChild(s),s.onload=function(){e(AppleID?AppleID.auth:null)},s.onerror=function(){t("Failed to load apple auth script")}}));e&&(e.init({clientId:"com.pixlr.web",scope:"name email",redirectURI:new URL(location.href).origin+"/auth/apple/callback",state:location.href,nonce:"",usePopup:!1}),e.signIn())}else{const t=window.location.origin;window.location.href=`${t}/auth/${e}?callbackUrl=${window.location.href}`}},this.togglePassword=(e="toggle-password",t="entry-password")=>{const s=(0,n.ZP)(e),i=(0,n.ZP)(t);"text"===i.type?(i.type="password",s.src="/img/icon/eye-hide.svg"):(i.type="text",s.src="/img/icon/eye-show.svg")},this.passwordMeter=(e="show",t)=>{if("show"==e&&t){const e=(0,n.ZP)(t.id),s=(0,n.ZP)(t.id).nextElementSibling;e.classList.remove("invalid"),s.style.display="none"}(0,n.ZP)("password-meter").style.display="show"==e?"flex":"none"},this.updatePasswordMeter=e=>{let t=(0,n.ZP)("password-meter"),s=(0,n.ZP)("password-meter").classList.value.replace(" ",","),i=0;switch(e.value.match(/[a-z]/)&&i++,e.value.match(/[A-Z]/)&&i++,e.value.match(/\d/)&&i++,e.value.match(/[!@#$%&*?'"~_./+\-|()^`:;<>,]/)&&i++,e.value.length<8&&0!==i&&(i=0),i){case 0:t.classList.replace(s,"none");break;case 1:t.classList.replace(s,"weak");break;case 2:t.classList.replace(s,"soso");break;case 3:t.classList.replace(s,"good");break;case 4:t.classList.replace(s,"great")}},this.validateInput=(e,t,s)=>{let n=!1;if(t||(t=e.value),"email"===s)t.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)?(e.classList.remove("invalid"),e.nextElementSibling.style.display="none"):(n=!0,e.classList.add("invalid"),e.nextElementSibling.style.display="block");else if("password"===s){const s=e.nextElementSibling;t.length<8||t.length>50?(n=!0,e.classList.add("invalid"),s.style.display="block",t.length<8?s.innerHTML=(0,i.Z)("common-MinPassword"):t.length>50&&(s.innerHTML=(0,i.Z)("common-MaxPassword"))):(e.classList.remove("invalid"),s.style.display="none")}else if("code"===s){const s=e.nextElementSibling;6!==t.length?(e.classList.add("invalid"),s.style.display="block",n=!0):(e.classList.remove("invalid"),s.style.display="none"),setTimeout((()=>{e.classList.remove("invalid"),s.style.display="none"}),3e3)}return!n},this.validateInputTimer=e=>{this.validationTimer[e]&&clearTimeout(this.validationTimer[e]),this.validationTimer[e]=setTimeout((()=>this.validateInput((0,n.ZP)(`entry-${e}`),"",e)),1e3)},this.verifyAgreements=()=>{const e=(0,n.ZP)("entry-readAgreements"),t=(0,n.ZP)("entry-above16");this.enableAgreementButton(!(!e.checked||!t.checked))},this.enableAgreementButton=e=>{const t=(0,n.ZP)("entry-submit");e?(t.disabled=!1,t.classList.remove("disable")):(t.disabled=!0,t.classList.add("disable"))},this.agreementsRenderer=()=>{"CA"===this.registerData.country&&((0,n.ZP)("entry-newsletter").checked=!1),o.Zn.some((e=>e===this.registerData.country))&&((0,n.ZP)("entry-above16").parentElement.classList.remove("hide"),(0,n.ZP)("entry-recommendations").parentElement.classList.add("hide"),(0,n.ZP)("entry-readAgreements").parentElement.classList.remove("hide"),this.enableAgreementButton(!1))},this.loadCaptcha=()=>{let e=document.createElement("script");e.id="recaptcha-js-api",e.defer=!0,e.src="https://www.google.com/recaptcha/api.js",document.getElementsByTagName("head")[0].appendChild(e)},this.renderCaptcha=()=>{this.captcha=void 0;const e=window.location.href.includes("localhost")?"6LeBQzcaAAAAAPwVny3IG23_fY_FasFVKXvQG9qB":"6LcqBEsaAAAAAF-JcOUzRtVKASZt5b-EMITWxEJf";setTimeout((()=>{this.captcha=grecaptcha.render((0,n.ZP)("recaptcha"),{sitekey:e})}),500)},this.getFormInput=()=>{const e={},t=(0,n.ZP)("entry-form");return Array.from(t.getElementsByTagName("input")).map((t=>{"checkbox"==t.type?e[t.name]=t.checked:e[t.name]=t.value})),Array.from(t.getElementsByTagName("select")).map((t=>{e[t.name]=t.value})),e},this.submitForm=async(e,t)=>{switch(t.preventDefault(),e){case"login":this.loginHandler();break;case"register":this.registerHandler();break;case"agreements":this.agreementsHandler(t.submitter?t.submitter.dataset.option:t.target.dataset.option);break;case"socialAgreements":this.socialAgreementsHandler(t.submitter?t.submitter.dataset.option:t.target.dataset.option);break;case"verification":this.verificationHandler();break;case"forgotPassword":this.forgotPasswordHandler();break;case"setPassword":this.passwordResetHandler(!0);break;case"resetPassword":this.passwordResetHandler();break;case"changeEmail":this.changeEmailHandler();break;case"changeEmailVerification":this.changeEmailVerificationHandler();break;case"changePassword":this.changePasswordHandler();break;case"changeUsername":this.changeUsernameHandler();break;case"deleteAccount":this.deleteAccountHandler();break;case"deleteAccountConfirmation":this.deleteAccountConfirmationHandler()}},this.loginHandler=async()=>{const e=this.getFormInput(),t=this.validateInput((0,n.ZP)("entry-email"),e.email,"email"),s=this.validateInput((0,n.ZP)("entry-password"),e.password,"password");if(!t||!s)return;(0,n.ZP)("entry-submit").innerHTML='\n            <img src="/images/myaccount/loading.gif" alt="loading" style="margin-top:12px;">\n        ';const i=await(0,o.qC)("/auth/login",e);if(i.status)if((0,n.ZP)("entry-submit").innerHTML='<img src="/images/license/green_tick.svg" class="checkmark" alt="green tick icon">',this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload();else i.verify?(this.loadForm("verification",{email:e.email}),(0,o.CF)("danger",i.message,5)):((0,n.ZP)("entry-submit").innerText="Login",(0,o.CF)("danger",i.message,5))},this.registerHandler=async()=>{this.registerData=this.getFormInput();const e=this.validateInput((0,n.ZP)("entry-email"),this.registerData.email,"email"),t=this.validateInput((0,n.ZP)("entry-password"),this.registerData.password,"password");e&&t&&this.loadForm("agreements")},this.agreementsHandler=async e=>{if("refuse"===e)return this.cleanUp();const t=this.getFormInput();Object.assign(t,this.registerData);const s=await(0,o.qC)("/auth/register",t);if(!s.status)return(0,o.CF)("danger",s.message,5),void this.loadForm("register");this.loadForm("verification",{email:t.email})},this.socialAgreementsHandler=async e=>{if("refuse"===e)return this.cleanUp();const t=new URLSearchParams(window.location.search),s=t.get("social"),i=await(0,o.Ef)(),n=this.getFormInput();n.country=i;const a=await(0,o.qC)(`/auth/${s}/register`,n);a.status||(0,o.CF)("danger",a.message,5),t.has("redirectUrl")?window.location.href=t.get("redirectUrl"):window.location.href=window.location.pathname},this.verificationHandler=async()=>{const e=this.getFormInput(),t=await(0,o.qC)("/auth/verify",e);if(!t.status)return(0,o.CF)("danger",t.message,5);(0,o.CF)("success",t.message,5),this.cleanUp(),setTimeout((()=>{if(this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload()}),1e3)},this.forgotPasswordHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,n.ZP)("entry-email"),e.email,"email"))return;e.resend=!1;const t=await(0,o.qC)("/auth/request/code/",e);if(!t.status)return(0,o.CF)("danger",t.message,5);(0,o.CF)("success",t.message,5,{email:e.email}),this.loadForm("resetPassword",{email:e.email})},this.passwordResetHandler=async(e=!1)=>{const t=grecaptcha.getResponse(this.captcha);if(grecaptcha.reset(this.captcha),!t)return(0,o.CF)("danger","Please complete the CAPTCHA!",3);const s=this.getFormInput();s.token=t;const i=this.validateInput((0,n.ZP)("entry-email"),s.email,"email"),a=this.validateInput((0,n.ZP)("entry-password"),s.password,"password"),r=this.validateInput((0,n.ZP)("entry-code"),s.code,"code");if(!i||!a||!r)return;const h=await(0,o.qC)("/auth/reset",s);if(!h.status)return(0,o.CF)("danger",h.message,5);(0,o.CF)("success",h.message,5),this.cleanUp(),setTimeout((()=>{e?window.location.href="/logout":window.location.reload()}),1e3)},this.resendCode=async e=>{(0,n.ZP)("entry-resend").classList.add("hide"),this.resendCodeTimeouts=setTimeout((()=>{(0,n.ZP)("entry-resend").classList.remove("hide")}),3e4);const t=await(0,o.qC)("/auth/request/code/",{email:e,resend:!0});if(!t.status)return(0,o.CF)("danger",t.message,5);(0,o.CF)("success",t.message,5,{email:e})},this.changeEmailHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,n.ZP)("entry-email"),e.email,"email"))return;const t=await(0,o.qC)("/auth/changeemail/request",{newEmail:e.email});if(!t.status)return(0,o.CF)("danger",t.message);this.loadForm("verification",{email:e.email,verify:"changeEmailVerification"}),(0,o.CF)("success",t.message,5,{email:e.email})},this.changeEmailVerificationHandler=async()=>{const e=this.getFormInput();e.newEmail=e.email;if(!this.validateInput((0,n.ZP)("entry-code"),e.code,"code"))return;const t=await(0,o.qC)("/auth/changeemail/verify",e);if(!t.status)return(0,o.CF)("danger",t.message,5);(0,o.CF)("success",t.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),1e3)},this.changePasswordHandler=async()=>{const e=this.getFormInput(),t=this.validateInput((0,n.ZP)("entry-password"),e.password,"password"),s=this.validateInput((0,n.ZP)("entry-password-new"),e["new-password"],"password");if(!t||!s)return;const i=await(0,o.qC)("/auth/changepassword",{oldPassword:e.password,newPassword:e["new-password"]},"PUT");if(!i.status)return(0,o.CF)("danger",i.message,5);(0,o.CF)("success",i.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),2e3)},this.changeUsernameHandler=async()=>{const e=this.getFormInput(),t=await(0,o.qC)("/myaccount/api/profile",e,"PUT",!0);if(!t.status)return(0,o.CF)("danger",t.message);(0,o.CF)("success",t.message),setTimeout((()=>window.location.reload()),500)},this.deleteAccountHandler=async()=>{const e=this.getFormInput();"leavingReasonDefault"!==e.reason&&this.loadForm("deleteAccountConfirmation",{reason:e.reason})},this.deleteAccountConfirmationHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,n.ZP)("entry-password"),e.password,"password"))return;const t=await(0,o.qC)("/api/myaccount/profile",e,"DELETE",!0);if(!t.status)return(0,o.CF)("danger",t.message);window.location.href="/logout/"},this.Form=new r.Z,this.form=e,this.options=t,this.registerData={},this.validationTimer={},this.captcha={},t.callback&&(this.callbackUrl=t.callback),"popup"===this.options.method?(this.mid=(0,a.Zd)(),this.holder=(0,n.T)("div",{id:"entry-modal",className:"modal dim"}),document.body.appendChild(this.holder),this.dialog=(0,n.T)("div",{className:"entry pop"}),this.holder.appendChild(this.dialog),this.content=(0,n.T)("div",{className:"entry-content"}),this.footer=(0,n.T)("div",{id:"entry-footer"}),this.dialog.append((0,n.T)("img",{id:"popup-close"+this.mid,className:"close",src:"/img/icon/close-black.svg",onclick:()=>this.cleanUp()}),this.content,this.footer),document.addEventListener("keydown",this.keyDown,!1)):(this.dialog=this.options.holder,this.dialog.classList.add("entry"),this.content=(0,n.T)("div",{className:"entry-content"}),this.footer=(0,n.T)("div",{id:"entry-footer"}),this.dialog.append(this.content,this.footer)),"popup"===this.options.method&&this.position(),this.loadForm(e)}}},1281:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),n=s(6670);const a=(0,n.te)();class r{constructor(){this.login=()=>`\n            <h1>${(0,i.Z)("common-login")}</h1>\n\n            \n        <div class="column space-between top-30">\n            <div class="social-button" data-social="google">\n                <img src="/images/icon/google.svg" alt="google">\n            </div>\n            <div class="social-button" data-social="facebook">\n                <img src="/images/icon/facebook.svg" alt="facebook">\n            </div>\n            <div class="social-button" data-social="apple">\n                <img src="/images/icon/apple_gray.svg" alt="apple">\n            </div>\n        </div>\n    \n            <div class="separator">${(0,i.Z)("OR")}</div>\n\n            <form id="entry-form" data-entry="login">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="entry-submit">${(0,i.Z)("common-login")}</button>\n                <div class="input-group inline space-between">\n                    <div class="inline">\n                        <input type="checkbox" id="entry-rememberMe" name="rememberMe"/>\n                        <label for="entry-rememberMe" class="custom-checkbox">${(0,i.Z)("common-rememberMe")}</label>\n                    </div>\n                    <div>\n                        <a class="anchor" id="load-forgotPassword">${(0,i.Z)("common-forgotPass")}</a>\n                    </div>\n                </div>\n            </form>\n        `,this.register=async()=>{let e="",t=!1;const s=await(0,n.Ef)();for(let i in a.COUNTRIES)t||"US"!==i&&s!=i?e+=`<option value="${i}">${a.COUNTRIES[i]}</option>`:(e+=`<option value="${i}" selected>${a.COUNTRIES[i]}</option>`,t=!0);return`\n            <h1>${(0,i.Z)("common-signUp")}</h1>\n\n            \n        <div class="column space-between top-30">\n            <div class="social-button" data-social="google">\n                <img src="/images/icon/google.svg" alt="google">\n            </div>\n            <div class="social-button" data-social="facebook">\n                <img src="/images/icon/facebook.svg" alt="facebook">\n            </div>\n            <div class="social-button" data-social="apple">\n                <img src="/images/icon/apple_gray.svg" alt="apple">\n            </div>\n        </div>\n    \n            <div class="separator">${(0,i.Z)("OR")}</div>\n\n            <form id="entry-form" data-entry="register">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="country">${(0,i.Z)("common-country")}</label>\n                    <select name="country">\n                        ${e}\n                    </select>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" style="margin-bottom: 20px">${(0,i.Z)("common-signUp")}</button>\n            </form>\n        `},this.forgotPassword=()=>`\n            <h1>${(0,i.Z)("common-forgotPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="forgotPassword">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="email" name="email" id="entry-email"/>\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="load-verification">${(0,i.Z)("common-reqCode")}</button>\n            </form>\n        `,this.resetPassword=(e=!1)=>{const t=e?"setPassword":"resetPassword";return`\n            <h1>${e?(0,i.Z)("common-setPassword"):(0,i.Z)("common-resetPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="${t}">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="email" name="email" id="entry-email" readonly/>\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-newPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="entry-code">${(0,i.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidCode")}</p>                    \n                </div>\n                \n                ${e?`<p class="top-10 text-center"><a class="anchor" id="entry-resend">${(0,i.Z)("common-SendResetCode")}</a></p>`:""}\n\n                <div id="recaptcha" style="padding-top: 5px"></div>\n                <button class="button big positive full">${(0,i.Z)("common-updatePass")}</button>\n                ${e?"":`<p class="top-10 hide text-center" id="entry-resend">${(0,i.Z)("common-didNotReceiveCode")} <a class="anchor">${(0,i.Z)("common-resend")}</a></p>`}\n            </form>\n        `},this.verification=e=>`\n            <h1>${(0,i.Z)("common-verifyAcc")}</h1>\n            <p id="entry-to-email" data-text="${(0,i.Z)("common-sentCodeDesc")}">${(0,i.Z)("common-sentCodeDesc")}</p>\n\n            <form id="entry-form" data-entry="${e}">\n                <input id="verification-email" type="hidden" name="email" readonly/>\n                <div class="input-group">\n                    <label for="code">${(0,i.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidCode")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-20">${(0,i.Z)("common-verify")}</button>\n                <p class="top-20 hide text-center" id="entry-resend">${(0,i.Z)("common-didNotReceiveCode")} &nbsp; <a class="anchor">${(0,i.Z)("common-resend")}</a></p>\n            </form>\n        `,this.agreements=async(e=!1)=>{const t=await(async()=>{try{const e=await fetch("/api/agreement/");return await e.text()}catch(e){return""}})();return`\n            <h1 class="text-center">${(0,i.Z)("common-terms")}</h1>\n\n            <div class="agreements-wrapper">${t}</div>\n            <form id="entry-form" data-entry="${e?"socialAgreements":"agreements"}">\n                <div class="input-group checkbox-group inline">\n                    <input type="checkbox" id="entry-newsletter" name="newsletter" checked/>\n                    <label for="entry-newsletter" class="custom-checkbox">${(0,i.Z)("common-regNewsletter")}</label>\n                </div>\n                <div class="input-group checkbox-group inline">\n                    <input type="checkbox" id="entry-recommendations" name="recommendations" />\n                    <label for="entry-recommendations" class="custom-checkbox">${(0,i.Z)("common-regRecommendations")}</label>\n                </div>\n                <div class="input-group checkbox-group inline hide">\n                    <input type="checkbox" id="entry-above16" name="above16" />\n                    <label for="entry-above16" class="custom-checkbox">${(0,i.Z)("common-above16")}</label>\n                </div>\n                <div class="input-group checkbox-group inline hide">\n                    <input type="checkbox" id="entry-readAgreements" name="readAgreements" />\n                    <label for="entry-readAgreements" class="custom-checkbox">${(0,i.Z)("common-readAgreements")}</label>\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center top-20">\n                    <button type="submit" data-option="refuse" class="button transparent">${(0,i.Z)("common-refuse")}</button>\n                    <button type="submit" id="entry-submit" data-option="agree" class="button big positive">${(0,i.Z)("common-agree")}</button>\n                </div>\n            </form>\n        `},this.changePassword=()=>`\n            <h1>${(0,i.Z)("common-changePassword")}</h1>\n            <form id="entry-form" class="top-30" data-entry="changePassword">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-oldPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-newPass")}</label>\n                    <input type="password" name="new-password" id="entry-password-new">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password-2" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-changePassword")}</button>\n            </form>\n        `,this.changeEmail=()=>`\n            <h1>${(0,i.Z)("common-changeEmail")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeEmail">\n                <div class="input-group">\n                    <label for="email">${(0,i.Z)("common-newEmail")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-EnterValidEmail")}</p>\n                </div>\n            \n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-changeEmail")}</button>\n            </form>\n        `,this.changeUsername=(e="")=>`\n            <h1>${(0,i.Z)("changeUsername")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeUsername">\n                <div class="input-group">\n                    <label for="entry-username">${(0,i.Z)("newUsername")}</label>\n                    <input type="text" name="name" id="entry-username" value="${e}">\n                </div>\n\n                <button type="submit" class="button full top-20">${(0,i.Z)("update")}</button>\n            </form>\n        `,this.deleteAccount=e=>`\n            <h1>${(0,i.Z)("common-deleteMyAccount")}</h1>\n            <p class="top-20">Hey ${e},</p>\n            <p class="no-margin">${(0,i.Z)("common-sadToSeeYouGoWhyLeaving")}</p>\n\n            <form id="entry-form" data-entry="deleteAccount">\n                <div class="input-group">\n                    <label class="top-20 text-uppercase">${(0,i.Z)("common-leavingBecause")}</label>\n                    <select name="reason">\n                        <option value="leavingReasonDefault" disabled selected>${(0,i.Z)("common-leavingReasonDefault")}</option>\n                        <option value="leavingReasons1">${(0,i.Z)("common-leavingReasons1")}</option>\n                        <option value="leavingReasons2">${(0,i.Z)("common-leavingReasons2")}</option>\n                        <option value="leavingReasons3">${(0,i.Z)("common-leavingReasons3")}</option>\n                        <option value="leavingReasons4">${(0,i.Z)("common-leavingReasons4")}</option>\n                        <option value="leavingReasons5">${(0,i.Z)("common-leavingReasons5")}</option>\n                    <select>\n                </div>\n\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-deleteMyAccount")}</button>\n            </form>\n        `,this.deleteAccountConfirmation=(e="leavingReasonDefault")=>`\n            <h4 class="top-35 text-default">${(0,i.Z)("areYouSureYouWantToDelete")} </h4>\n            <p class="top-35">${(0,i.Z)("youCanStillChangeYourMind")} </p>\n\n            <form id="entry-form" data-entry="deleteAccountConfirmation">\n                <input type="hidden" name="reason" value="${e}">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center" style="margin-top: 30px">\n                    <button type="submit" class="button small transparent">${(0,i.Z)("deleteMyAccount")}</button>\n                    <button class="button small positive" id="entry-cancel">${(0,i.Z)("cancel")}</button>\n                </div>\n            </form>\n        `}}},4424:(e,t,s)=>{s.a(e,(async(e,t)=>{try{var i=s(4545),n=s(3947),a=s(4820),r=s(1030),o=e([i]);if(i=(o.then?(await o)():o)[0],"cGl4bHIuY29t"!==btoa(document.location.hostname.split(".").slice(-2).join(".")))throw new Error;"serviceWorker"in navigator&&window.addEventListener("load",(async()=>{try{const e=await navigator.serviceWorker.register("/service-worker-x.js",{scope:"/x"});console.log("SW registered: ",e)}catch(e){console.log("SW registration failed: ",e)}})),a.ZP.product="x",function(){var e=document.createElement("canvas").getContext("webgl");if(!(e instanceof WebGLRenderingContext&&"undefined"!=typeof Promise)){if(!("WebGLRenderingContext"in window)||"undefined"==typeof Promise)throw(0,n.ZP)("home-box").innerHTML='\n            <div id="old-browser">\n                <h1>Old browser!</h1> \n                To be able to use the photo editor you need a modern browser, \n                just download a fresh one, such as <a href="https://www.google.com/chrome/">Chrome</a>, \n                <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Edge</a>, \n                <a href="https://support.apple.com/downloads/safari">Safari</a> or \n                <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>!<br /><br/> \n                <small>(Error: Could not create webgl context or use promise)</small>\n            </div>',e||(0,r.Z)("no-gl","nonexistent"),"undefined"==typeof Promise&&(0,r.Z)("no-promise"),new Error("Browser not supported");if("WebGLRenderingContext"in window)throw(0,n.ZP)("home-box").innerHTML='\n            <div id="old-browser">\n                <h1>WebGL disabled</h1> \n                To be able to use the photo editor you need webgl. <br />\n                Your browser seems the support it but it\'s disabled for some reason, this can sometimes be due to old videocard drivers. <br />\n                Check the links below for browser support:<br />\n                <ul>\n                    <li><a href="https://support.mozilla.com/en-US/kb/how-do-i-upgrade-my-graphics-drivers">Firefox</a></li>\n                    <li><a href="https://support.google.com/chrome/?hl=en#topic=7438008">Chrome</a>\n                    <li><a href="http://www.opera.com/support/">Opera</a></li>                    \n                </ul>\n                <small>(Error: Could not create webgl context)</small>\n            </div>',(0,r.Z)("no-gl","disabled"),new Error("Browser not supported")}}();new i.Z;t()}catch(h){t(h)}}))},147:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(6548),n=s(3947),a=s(3655),r=s(1030),o=s(8203),h=s(4820),c=s(7664),l=s(5934),d=s(5574),u=s(1951);async function p(e){const t=await fetch(`https://pixlr.com/api/assets/${e}/download`),s=await t.json();if(!s.status)throw new Error(s.message);return s.data.url}class g extends o.Z{constructor(e){super("add-element",e),this.SERVER_URL="https://pixlr.com/api/assets/collections/",this.searchTag=e=>{const t=e.target.innerText.toLowerCase();(0,n.ZP)("element-search").value=t,"overlay"===t?this.get("overlay"):this.search(t)},this.searchInput=e=>{if("Enter"===e.key){const e=(0,n.ZP)("element-search").value.toLowerCase();this.search(e)}},this.get=async(e,t=1)=>{1===t&&(this.oneholder.style.display="none",this.twoholder.style.display="none",this.oneholder.innerHTML=""),(0,n.ZP)("element-loading").style.display="block";try{const s=await fetch(this.SERVER_URL+"?category="+e+"&page="+t),i=await s.json();if(!i.status)throw new Error("server_error");let n=i.data;this.result={name:e,total:n.total,page:n.page,pages:n.pages},this.renderSearchResult(n.collections)}catch(s){(0,n.ZP)("element-loading").style.display="none",console.log(s)}},this.search=async e=>{if("overlay"!==e){this.result=void 0,this.oneholder.innerHTML="",this.oneholder.style.display="none",this.twoholder.style.display="none",(0,n.ZP)("element-loading").style.display="block";try{const t=await fetch(this.SERVER_URL+"keyword/"+e+"/"),s=await t.json();if(!s.status)throw new Error("server_error");let i=s.data;this.renderSearchResult(i)}catch(t){(0,n.ZP)("element-loading").style.display="none",console.log(t)}}else this.get("overlay")},this.renderSearchResult=e=>{if(this.back(),(0,n.ZP)("element-loading").style.display="none",e.forEach((e=>{let t=(0,n.T)("div",{className:"element-title",onclick:()=>this.renderCollection(e.name,e.assets)},e.name.replace(/_/g," ")+" ("+e.assets.length+")",(0,n.T)("a",{className:"link"},(0,i.Z)("viewAll"))),s=(0,n.T)("div",{className:"element-group"});for(let i=0;i<e.assets.length&&i<6;i++){let t=(0,n.T)("div",{className:"wrap"},(0,n.T)("img",{src:e.assets[i].thumbnailSmall}));t.addEventListener("click",(s=>{var n,a,r,o;!e.assets[i].premium||h.ZP.user.subscription?(this.setLoading(t),this.addElement(e.assets[i].id,e.assets[i].id,p(e.assets[i].id),null===(a=null===(n=e.assets[i])||void 0===n?void 0:n.metaData)||void 0===a?void 0:a.blendmode,null===(o=null===(r=e.assets[i])||void 0===r?void 0:r.metaData)||void 0===o?void 0:o.scalemode)):new u.Z(this.stage,"ELEMENT")}),!1),e.assets[i].premium&&t.classList.add("premium"),s.append(t)}this.oneholder.append(t,s)})),this.result&&this.result.page!==this.result.pages){const e=(0,n.T)("div",{className:"button big positive"},(0,i.Z)("loadMore"));e.addEventListener("click",(()=>{this.get(this.result.name,this.result.page+1),e.remove()})),this.oneholder.append(e)}else this.result&&1!==this.result.page||(0,n.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.renderCollection=(e,t)=>{this.oneholder.style.display="none",this.twoholder.style.display="flex",this.twoholder.innerHTML="",(0,n.ZP)("element-back").style.display="inline-flex",t.forEach((e=>{let t=(0,n.T)("div",{id:e.id,className:"element-box"});t.addEventListener("click",(s=>{var i,n;!e.premium||h.ZP.user.subscription?(this.setLoading(t),this.addElement(t.id,e.id,p(e.id),null===(i=null==e?void 0:e.metaData)||void 0===i?void 0:i.blendmode,null===(n=null==e?void 0:e.metaData)||void 0===n?void 0:n.scalemode)):new u.Z(this.stage,"ELEMENT")}),!1);let s=(0,n.T)("div",{className:"wrap"},(0,n.T)("img",{src:e.thumbnailSmall}));e.premium&&s.classList.add("premium"),t.appendChild(s),this.twoholder.appendChild(t)})),(0,n.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.setLoading=e=>{this.over=(0,n.T)("div",{id:"element-over"},(0,n.T)("progress",{id:"element-progress",value:0,max:100}));let t=(0,n.T)("img",{id:"element-cancel-loading",className:"close",src:"/img/icon/close.svg"});t.addEventListener("click",this.cancelLoading),this.over.append(t),e.append(this.over)},this.back=()=>{this.oneholder.style.display="flex",this.twoholder.style.display="none",(0,n.ZP)("element-back").style.display="none"},this.cancelLoading=e=>{e.preventDefault(),e.stopPropagation(),this.canceled=!0,this.over.remove()},this.addElement=async(e,t,s,i="",r=c.Z.SCALE_METHOD_NONE)=>{this.canceled=!1,this.loading=!0;const o=(0,n.ZP)("element-progress");o.value=0;try{const e=await s,n=await(0,d.c6)(e,(e=>{this.canceled||(-1==e?o.removeAttribute("value"):o.value=e)}));if(this.canceled)return;const h=await(0,d.s4)(n);if(this.canceled)return;this.loading=!1,this.over.remove(),this.stage.addElement(a.qT(h,4096),t,e,i,r)}catch(h){console.log("Error",h),this.over.remove()}},this.addImage=e=>{let t=a.qT(e,h.ZP.user.subscription?8196:4096),s=e.name?e.name:e.src.replace(/^.*[\\\/]/,"");this.stage.addImage(t,s,"add")},this.browseClick=async e=>{(0,r.Z)("open-browse"),await(0,l.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,l.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.cleanUp=()=>{let e=(0,n.ZP)("element-tag-cloud").getElementsByTagName("a");for(var t=0;t<e.length;t++)e[t].removeEventListener("click",this.searchTag,!1);(0,n.ZP)("element-back").removeEventListener("click",this.back,!1),(0,n.ZP)("add-element-close").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("element-search").removeEventListener("keydown",this.searchInput,!1),(0,n.ZP)("element-browse").removeEventListener("click",this.browseClick,!1)},this.oneholder=(0,n.ZP)("one-element-list"),this.twoholder=(0,n.ZP)("two-element-list"),(0,n.ZP)("add-element-close").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("element-search").addEventListener("keydown",this.searchInput,!1),(0,n.ZP)("element-browse").addEventListener("click",this.browseClick,!1);let t=(0,n.ZP)("element-tag-cloud").getElementsByTagName("a");for(var s=0;s<t.length;s++)t[s].addEventListener("click",this.searchTag,!1);(0,n.ZP)("element-back").addEventListener("click",this.back,!1),this.get("element")}}},877:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(3947),n=s(1030),a=s(8203),r=s(4820),o=s(5934),h=s(1951);class c extends a.Z{constructor(e){super("add-text",e),this.SERVER_URL="/",this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.addText=()=>{this.stage.addText(),this.stage.reform.dblClick(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))},this.populatePresets=async()=>{const e=await fetch("/text/index.json"),t=await e.json(),s=(0,i.ZP)("add-text-presets");s.innerHTML="",t.presets.forEach((e=>{const t="/text/"+e.id+"/thumbnail.webp",n=(0,i.T)("div",{id:e.id,className:"text-box"});n.setAttribute("loading","lazy"),e.premium&&n.classList.add("premium"),n.addEventListener("click",this.selectPreset,!0),n.style.backgroundImage="url("+t+")",s.append(n)}))},this.selectPreset=async e=>{if(this.working)return;if(e.currentTarget.classList.contains("premium")&&!r.ZP.user.subscription)return void new h.Z(this.stage,"FONT");this.working=!0;const t=e.currentTarget.getAttribute("id");await(0,o.d3)(this.stage,"/text/"+t+"/manifest.json"),this.working=!1,(0,n.Z)("text-preset",t),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))},this.cleanUp=()=>{(0,i.ZP)("add-text-presets").innerHTML="",(0,i.ZP)("add-text-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("add-text-button").removeEventListener("click",this.addText,!1)},(0,i.ZP)("add-text-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("add-text-button").addEventListener("click",this.addText,!1),this.populatePresets()}}},6557:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(3947),n=s(6548),a=s(3655),r=s(6817),o=s(8203),h=s(4820),c=s(4084),l=s(9389),d=s(1662),u=s(4256),p=s(2397),g=s(4188);class m extends o.Z{constructor(e){super("adjust",e),this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.toggle=!1,this.toggleClick=()=>{this.toggle=!this.toggle,(0,i.ZP)("color").checked=this.toggle,(0,i.ZP)("light").checked=this.toggle,(0,i.ZP)("details").checked=this.toggle,(0,i.ZP)("scene").checked=this.toggle,(0,i.ZP)("toning").checked=this.toggle,(0,i.ZP)("fill").checked=this.toggle},this.compareDown=()=>{this.scratch.canvas=this.cached,window.requestAnimationFrame((()=>this.stage.render()))},this.compareUp=()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))},this.layerSelect=async()=>{const e=this.selected===this.stage.fresco.getSelected();if(this.selected&&!e&&this.apply(),!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,i.ZP)("adjust-layer-locked").style.display="block",(0,i.ZP)("adjust-settings").style.display="none",void(this.selected=null);(0,i.ZP)("adjust-layer-locked").style.display="none",(0,i.ZP)("adjust-settings").style.display="block",e?setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0):(this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached)),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.setValues(this.shaders.chain),this.checkStateChanges()},this.setValues=e=>{this.reset(),e&&e.forEach((e=>{switch(e.type){case"levels":this.levelSet=e.value,255!=this.levelSet.maxout?this.sliders.white.setValue(Math.round(this.levelSet.maxout-255)):255!=this.levelSet.maxin&&this.sliders.white.setValue(Math.round(255-this.levelSet.maxin)),0!=this.levelSet.minout?this.sliders.black.setValue(Math.round(-this.levelSet.minout)):0!=this.levelSet.minin&&this.sliders.black.setValue(Math.round(this.levelSet.minin));break;case"toning":this.toningSet=e.value,this.toningColorHighlight.setHex(this.toningSet.highlight.toHEX(),!1),this.toningColorShadows.setHex(this.toningSet.shadow.toHEX(),!1),this.sliders["toning-amount"].setValue(this.toningSet.amount);break;case"fill":this.fillSet=e.value,this.fillColor.setHex(this.fillSet.color.toHEX(),!1),this.sliders["fill-amount"].setValue(this.fillSet.amount),(0,i.ZP)("fill-blend").value=this.fillSet.blend;break;default:this.sliders[e.type]&&this.sliders[e.type].setValue(e.value)}}))},this.reset=()=>{for(const e in this.sliders)this.sliders[e].reset()},this.resetClick=()=>{const e=this.shaders.cloneChain();0!==e.length&&(this.reset(),this.shaders.reset(),this.stage.history.add({type:"adjust",layer:this.selected,kind:"reset",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("reset")})))},this.autoFix=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset();let t=a.gr(this.selected.canvas);this.blackOrWhiteChange(Math.round(255-t.y),Math.round(t.x)),this.sliders.white.setValue(Math.round(255-t.y)),this.sliders.black.setValue(Math.round(t.x));let s=a.fu(this.selected.canvas);if(s<.7){const e=.7-s;this.sliders.vibrance.setValue(e),this.adjust("vibrance",e,!1)}this.stage.history.add({type:"adjust",layer:this.selected,kind:"auto",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"auto fix"}))},this.autoBW=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset(),this.sliders.saturation.setValue(-1),this.adjust("saturation",-1,!1),this.sliders.contrast.setValue(.2),this.adjust("contrast",.25,!1),this.sliders.exposure.setValue(.1),this.adjust("exposure",.2,!1),this.sliders.clarity.setValue(.1),this.adjust("clarity",.2,!1),this.stage.history.add({type:"adjust",layer:this.selected,kind:"bw",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"black & white"}))},this.autoPop=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset(),this.sliders.highlights.setValue(.5),this.adjust("highlights",.5,!1),this.sliders.shadows.setValue(-.5),this.adjust("shadows",-.5,!1),this.sliders.vibrance.setValue(.5),this.adjust("vibrance",.5,!1),this.sliders.saturation.setValue(.2),this.adjust("saturation",.2,!1),this.sliders.exposure.setValue(.2),this.adjust("exposure",.2,!1),this.sliders.clarity.setValue(.2),this.adjust("clarity",.2,!1),this.stage.history.add({type:"adjust",layer:this.selected,kind:"pop",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"auto pop"}))},this.adjust=(e,t,s=!0)=>{this.selected&&(this.shaders.addShader(e,t),s&&this.execute())},this.execute=()=>{setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.checkStateChanges=()=>{(0,i.ZP)("adjust-color").classList.toggle("changed",this.isGroupChanged(["vibrance","saturation","temperature","tint","hue"])),(0,i.ZP)("adjust-light").classList.toggle("changed",this.isGroupChanged(["brightness","exposure","contrast","black","white","highlights","shadows"])),(0,i.ZP)("adjust-detail").classList.toggle("changed",this.isGroupChanged(["sharpen","smooth","grain","clarity"])),(0,i.ZP)("adjust-scene").classList.toggle("changed",this.isGroupChanged(["vignette","bloom","glamour","dehaze"])),(0,i.ZP)("adjust-toning").classList.toggle("changed",this.isGroupChanged(["toning-amount"])),(0,i.ZP)("adjust-fill").classList.toggle("changed",this.isGroupChanged(["fill-amount"]))},this.isGroupChanged=e=>{for(let t=0;t<e.length;t++)if(this.sliders[e[t]].isChanged())return!0;return!1},this.printPreset=e=>{if(!this.shaders||!this.shaders.chain)return;let t='"your-preset-name": [\n';this.shaders.chain.forEach((e=>{switch(e.type){case"levels":this.levelSet=e.value,t+='\tnew Setting("'+e.type+'", new ChannelMap(',t+=this.levelSet.minin+","+this.levelSet.maxin+","+this.levelSet.minout+","+this.levelSet.maxout,t+=")),\n";break;case"toning":this.toningSet=e.value;let s=this.toningSet.highlight,i=this.toningSet.shadow;t+='\tnew Setting("'+e.type+'", new ToningSet(',t+="new Color("+s.r+","+s.g+","+s.b+"),",t+="new Color("+i.r+","+i.g+","+i.b+"),",t+=this.toningSet.amount+")",t+="),\n";break;case"fill":this.fillSet=e.value;let n=this.fillSet.color;t+='\tnew Setting("'+e.type+'", new FillSet(',t+="new Color("+n.r+","+n.g+","+n.b+"),",t+='"'+this.fillSet.blend+'",',t+=this.fillSet.amount+")",t+="),\n";break;default:t+='\tnew Setting("'+e.type+'",'+e.value+"),\n"}})),t=t.slice(0,-2),t+="\n],",console.log(t)},this.blackOrWhiteChange=(e,t,s=!0)=>{this.levelSet=new d.Z(t>0?t:void 0,e>0?255-e:void 0,t<0?-1*t:void 0,e<0?e+255:void 0),this.adjust("levels",this.levelSet,s)},this.fillHistoryChange=()=>{const e=this.shaders.cloneChain();this.fillChange(),this.stage.history.add({type:"adjust",layer:this.selected,kind:"fill",shaders:this.shaders,chain:e})},this.fillChange=()=>{const e=this.sliders["fill-amount"].getValue(),t=(0,i.ZP)("fill-blend").value;this.fillSet=new c.Z(this.fillColor.getColor(),t,e),this.adjust("fill",this.fillSet),this.execute()},this.toningHistoryChange=()=>{const e=this.shaders.cloneChain();this.toningChange(),this.stage.history.add({type:"adjust",layer:this.selected,kind:"toning",shaders:this.shaders,chain:e})},this.toningChange=()=>{const e=this.sliders["toning-amount"].getValue();this.toningSet=new l.Z(this.toningColorHighlight.getColor(),this.toningColorShadows.getColor(),e),this.adjust("toning",this.toningSet),this.execute()},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected)||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"adjust",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),(0,i.ZP)("auto-fix").removeEventListener("click",this.autoFix,!1),(0,i.ZP)("auto-bw").removeEventListener("click",this.autoBW,!1),(0,i.ZP)("auto-pop").removeEventListener("click",this.autoPop,!1),(0,i.ZP)("preset-print").removeEventListener("click",this.printPreset,!1),(0,i.ZP)("fill-blend").removeEventListener("change",this.fillHistoryChange,!1);for(const t in this.sliders)this.sliders[t].cleanUp();(0,i.ZP)("adjust-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("adjust-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("adjust-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("adjust-toggle-all").removeEventListener("click",this.toggleClick,!1),(0,i.ZP)("adjust-compare").removeEventListener("mousedown",this.compareDown,!1),(0,i.ZP)("adjust-compare").removeEventListener("mouseup",this.compareUp,!1),(0,i.ZP)("adjust-reset").removeEventListener("mouseup",this.resetClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("history-update",this.checkStateChanges,!1),this.stage.render()},this.shaders=new u.Z,h.ZP.debug&&((0,i.ZP)("adjust-debug").style.display="block",(0,i.ZP)("preset-print").addEventListener("click",this.printPreset,!1));const t={range:[-1,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:(e,t)=>this.adjust(t,e),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.stage.history.add({type:"adjust",layer:this.selected,kind:s,shaders:this.shaders,chain:this.cacheChain})}},s=Object.assign(Object.assign({},t),{range:[0,1]}),o=Object.assign(Object.assign({},t),{range:[-100,100],step:2,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onChange:()=>{const e=this.sliders.white.getValue(),t=this.sliders.black.getValue();this.blackOrWhiteChange(e,t)}}),m=Object.assign(Object.assign({},t),{range:[-180,180],step:1,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10)});this.sliders={vibrance:new g.Z("vibrance",Object.assign(Object.assign({},t),{label:(0,n.Z)("vibrance")})),saturation:new g.Z("saturation",Object.assign(Object.assign({},t),{label:(0,n.Z)("saturation")})),temperature:new g.Z("temperature",Object.assign(Object.assign({},t),{label:(0,n.Z)("temperature")})),tint:new g.Z("tint",Object.assign(Object.assign({},t),{label:(0,n.Z)("tint")})),hue:new g.Z("hue",Object.assign(Object.assign({},m),{label:(0,n.Z)("hue")})),brightness:new g.Z("brightness",Object.assign(Object.assign({},t),{label:(0,n.Z)("brightness")})),exposure:new g.Z("exposure",Object.assign(Object.assign({},t),{label:(0,n.Z)("exposure")})),contrast:new g.Z("contrast",Object.assign(Object.assign({},t),{label:(0,n.Z)("contrast")})),black:new g.Z("black",Object.assign(Object.assign({},o),{label:(0,n.Z)("black")})),white:new g.Z("white",Object.assign(Object.assign({},o),{label:(0,n.Z)("white")})),highlights:new g.Z("highlights",Object.assign(Object.assign({},t),{label:(0,n.Z)("highlights")})),shadows:new g.Z("shadows",Object.assign(Object.assign({},t),{label:(0,n.Z)("shadows")})),sharpen:new g.Z("sharpen",Object.assign(Object.assign({},s),{label:(0,n.Z)("sharpen")})),smooth:new g.Z("smooth",Object.assign(Object.assign({},s),{label:(0,n.Z)("smooth")})),grain:new g.Z("grain",Object.assign(Object.assign({},s),{label:(0,n.Z)("grain")})),clarity:new g.Z("clarity",Object.assign(Object.assign({},t),{label:(0,n.Z)("clarity")})),blur:new g.Z("blur",Object.assign(Object.assign({},s),{label:(0,n.Z)("blur")})),vignette:new g.Z("vignette",Object.assign(Object.assign({},t),{label:(0,n.Z)("vignette")})),bloom:new g.Z("bloom",Object.assign(Object.assign({},s),{label:(0,n.Z)("bloom")})),glamour:new g.Z("glamour",Object.assign(Object.assign({},s),{label:(0,n.Z)("glamour")})),dehaze:new g.Z("dehaze",Object.assign(Object.assign({},s),{label:(0,n.Z)("dehaze")})),"toning-amount":new g.Z("toning-amount",Object.assign(Object.assign({},s),{label:(0,n.Z)("amount"),onChange:()=>this.toningChange(),onEnd:(e,t,s)=>{this.stage.history.add({type:"adjust",layer:this.selected,kind:"toning",shaders:this.shaders,chain:this.cacheChain})}})),"fill-amount":new g.Z("fill-amount",Object.assign(Object.assign({},s),{label:(0,n.Z)("amount"),onChange:()=>this.fillChange(),onEnd:(e,t,s)=>{this.stage.history.add({type:"adjust",layer:this.selected,kind:"fill",shaders:this.shaders,chain:this.cacheChain})}}))},(0,i.ZP)("adjust-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("adjust-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("adjust-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("adjust-toggle-all").addEventListener("click",this.toggleClick,!1),(0,i.ZP)("adjust-compare").addEventListener("mousedown",this.compareDown,!1),(0,i.ZP)("adjust-compare").addEventListener("mouseup",this.compareUp,!1),(0,i.ZP)("adjust-reset").addEventListener("mouseup",this.resetClick,!1),(0,i.ZP)("auto-fix").addEventListener("click",this.autoFix,!1),(0,i.ZP)("auto-bw").addEventListener("click",this.autoBW,!1),(0,i.ZP)("auto-pop").addEventListener("click",this.autoPop,!1),(0,i.ZP)("fill-blend").addEventListener("change",this.fillHistoryChange,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("history-update",this.checkStateChanges,!1),this.toningColorHighlight=new p.Z((0,i.ZP)("toning-highlights"),["#ff9999","#ffd899","#ddff99","#99ffbb","#99ddff","#bb99ff","#ff99dd"],this.toningHistoryChange),this.toningColorShadows=new p.Z((0,i.ZP)("toning-shadows"),["#4d0000","#4d2f00","#334d00","#004d19","#00344d","#1a004d","#4d0033"],this.toningHistoryChange),this.fillColor=new p.Z((0,i.ZP)("fill-color"),["#ff9999","#ffd899","#ddff99","#99ffbb","#99ddff","#bb99ff","#ff99dd"],this.fillHistoryChange),this.layerSelect()}}},6246:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(3947),n=s(8203),a=s(1030),r=s(4820),o=s(7339),h=s(1951),c=s(1750);class l{constructor(e,t,s=1,i=0,n=0,a=!1,r=c.Z.EASE_LINEAR,o=l.DIRECTION_FORWARD,h="center",d="all"){this.method=e,this.value=t,this.iterations=s,this.duration=i,this.delay=n,this.fill=a,this.easing=r,this.direction=o,this.manner=h,this.filter=d}}l.INFINITE=0,l.DIRECTION_FORWARD=1,l.DIRECTION_REVERSE=2,l.DIRECTION_ALTERNATE=3,l.DIRECTION_ALTERNATE_REVERSE=4;var d=s(7318),u=s(3990);class p{static getOption(e,t,s){return void 0===e||void 0===e[t]?s:e[t]}static flipOption(e){switch(e){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left"}return e}static getLayerAnimation(e,t){switch(e){case"fade-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,c.Z.EASE_LINEAR)])};case"grow-in":{const s=p.getOption(t,"anchor","center");return{enter:new u.Z(e,[new l("opacity",{from:0},1,1e3,0,!0,c.Z.EASE_LINEAR),new l("scale",{from:.5},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{anchor:s})}}case"shrink-in":{const s=p.getOption(t,"anchor","center");return{enter:new u.Z(e,[new l("opacity",{from:0},1,1e3,0,!0,c.Z.EASE_LINEAR),new l("scale",{from:1.2},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{anchor:s})}}case"rise-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,c.Z.EASE_LINEAR),new l("offset-y",{from:.2},1,750,0,!0,c.Z.EASE_OUT_CIRC)])};case"sink-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,c.Z.EASE_LINEAR),new l("offset-y",{from:-.2},1,750,0,!0,c.Z.EASE_OUT_CIRC)])};case"vertical-in":return{enter:new u.Z(e,[new l("scale-height",{from:0},1,500,0,!0,c.Z.EASE_OUT_BACK)])};case"horizontal-in":return{enter:new u.Z(e,[new l("scale-width",{from:0},1,500,0,!0,c.Z.EASE_OUT_BACK)])};case"flicker-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,50,0,!0),new l("opacity",{to:0},1,100,100),new l("opacity",{to:1},1,50,200),new l("opacity",{to:0},1,100,300),new l("opacity",{to:1},1,50,400),new l("opacity",{to:0},1,100,600),new l("opacity",{to:1},1,50,800)])};case"tumble-in":{let s,i=p.getOption(t,"fourway","left");switch(i){case"right":s=new l("offset-x",{from:-1},1,400,0,!0,c.Z.EASE_LINEAR);break;case"left":s=new l("offset-x",{from:2},1,400,0,!0,c.Z.EASE_LINEAR);break;case"up":s=new l("offset-y",{from:2},1,400,0,!0,c.Z.EASE_LINEAR);break;case"down":s=new l("offset-y",{from:-1},1,400,0,!0,c.Z.EASE_LINEAR)}return{enter:new u.Z(e,[new l("rotate",{from:.2},1,380,0,!0,c.Z.EASE_LINEAR),s,new l("rotate",{to:.01},2,300,380,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)],{fourway:i})}}case"8-bit-in":{let s=p.getOption(t,"eightway","upleft");const i={enter:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,c.Z.EASE_FIVE_LADDER),new l("rotate",{from:-.1,to:.1},1,500,500,!1,c.Z.EASE_FIVE_LADDER),new l("rotate",{set:0},1,0,1e3,!1)],{eightway:s})};switch(s){case"up":i.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"down":i.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"left":i.enter.motions.push(new l("offset-x",{from:.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"right":i.enter.motions.push(new l("offset-x",{from:-.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"upleft":i.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{from:.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"upright":i.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{from:-.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"downleft":i.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{from:.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"downright":i.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{from:-.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER))}return i}case"whoa-in":return{enter:new u.Z(e,[new l("scale",{from:.5},1,500,0,!0,c.Z.EASE_LINEAR),new l("opacity",{from:0},1,750,0,!0,c.Z.EASE_LINEAR),new l("rotate",{to:-.075},2,750,0,!0,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)])};case"drop-in":return{enter:new u.Z(e,[new l("offset-y",{from:-1,to:0},1,750,0,!0,c.Z.EASE_OUT_BOUNCE)])};case"action-in":{let s=p.getOption(t,"twoway","right");return{enter:new u.Z(e,[new l("offset-x","right"===s?{from:-1,to:-.2}:{from:1,to:.2},1,350,0,!0,c.Z.EASE_LINEAR),new l("offset-x",{to:0},1,2e3,350,!1,c.Z.EASE_LINEAR)],{twoway:s})}}case"pop-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,300,0,!0,c.Z.EASE_LINEAR),new l("scale",{from:0},1,750,0,!0,c.Z.EASE_OUT_ELASTIC)])};case"stomp-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,300,0,!0,c.Z.EASE_LINEAR),new l("scale",{from:4},1,800,0,!0,c.Z.EASE_OUT_BOUNCE)])};case"spring-in":return{enter:new u.Z(e,[new l("self-x",{set:-1},0,1,0,!0,c.Z.EASE_LINEAR),new l("scale-width",{to:2},1,300,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"left"),new l("self-x",{set:0},0,1,300,!1,c.Z.EASE_LINEAR),new l("scale-width",{to:1},1,200,300,!1,c.Z.EASE_IN_OUT_ELASTIC,l.DIRECTION_FORWARD,"right")])};case"backdown-in":return{enter:new u.Z(e,[new l("scale",{set:.6},1,1,0,!0),new l("offset-y",{from:-1},1,500,0,!0,c.Z.EASE_OUT_CUBIC),new l("scale",{to:1},1,200,400,!1,c.Z.EASE_OUT_BACK)])};case"backup-in":return{enter:new u.Z(e,[new l("scale",{set:.6},1,1,0,!0),new l("offset-y",{from:2},1,500,0,!0,c.Z.EASE_OUT_CUBIC),new l("scale",{to:1},1,200,400,!1,c.Z.EASE_OUT_BACK)])};case"pixelate-in":return{enter:new u.Z(e,[new l("pixelate",{from:1,to:0},1,1500,0,!0,c.Z.EASE_IN_CIRC)])};case"mosaic-in":return{enter:new u.Z(e,[new l("mosaic",{from:1,to:0},1,1500,0,!0,c.Z.EASE_IN_CIRC)])};case"fringe-in":return{enter:new u.Z(e,[new l("opacity",{from:0,to:1},1,500,0,!0,c.Z.EASE_LINEAR),new l("fringe",{from:1,to:0},1,500,0,!0,c.Z.EASE_IN_OUT_BOUNCE)])};case"melt-in":{let s=p.getOption(t,"fiveway","center");return{enter:new u.Z(e,[new l("melt",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{fiveway:s})}}case"gooey-in":return{enter:new u.Z(e,[new l("gooey",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR)])};case"block-in":return{enter:new u.Z(e,[new l("block",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR)])};case"curtain-in":{let s=p.getOption(t,"plane","horizontal");return{enter:new u.Z(e,[new l("curtain",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_OUT_QUART,l.DIRECTION_FORWARD,s)],{plane:s})}}case"blinds-in":{let s=p.getOption(t,"fourway","right");return{enter:new u.Z(e,[new l("blinds",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{fourway:s})}}case"wipe-in":{let s=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("wipe",{from:1,to:0},1,800,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{fourway:s})}}case"slot-in":{let s=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("slot",{from:1,to:0},1,800,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{fourway:s})}}case"split-in":{let s=p.getOption(t,"plane","vertical");return{enter:new u.Z(e,[new l("split",{from:1,to:0},1,500,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{plane:s})}}case"line-in":{let s=p.getOption(t,"plane","vertical");return{enter:new u.Z(e,[new l("line",{from:1,to:0},1,500,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{plane:s})}}case"circular-in":return{enter:new u.Z(e,[new l("circular",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR)])};case"ripple-in":return{enter:new u.Z(e,[new l("ripple",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR)])};case"warp-in":{let s=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("warp",{from:1,to:0},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{fourway:s})}}case"rotate":{let s=p.getOption(t,"rotation","right");return{scene:new u.Z(e,[new l("rotate","right"===s?{from:0,to:1}:{from:1,to:0},1,2e3,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{rotation:s})}}case"jiggle":return{scene:new u.Z(e,[new l("rotate",{from:-.05,to:.05},12,2e3,0,!1,c.Z.EASE_LINEAR)])};case"wave":{let s=p.getOption(t,"anchor","bottom");return{scene:new u.Z(e,[new l("rotate",{to:-.075},1,500,0,!1,c.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,s),new l("rotate",{from:-.075,to:.075},1,1e3,500,!1,c.Z.EASE_IN_OUT_CUBIC,l.DIRECTION_ALTERNATE,s),new l("rotate",{to:0},1,500,1500,!1,c.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,s)],{anchor:s})}}case"floating":return{scene:new u.Z(e,[new l("self-y",{to:-.2},1,400,0,!1,c.Z.EASE_OUT_CUBIC),new l("self-y",{from:-.2,to:.2},1,800,400,!1,c.Z.EASE_IN_OUT_CUBIC,l.DIRECTION_ALTERNATE),new l("self-y",{to:0},1,400,1200,!1,c.Z.EASE_IN_CUBIC)])};case"flip":{const s=p.getOption(t,"plane","vertical");return"vertical"===s?{scene:new u.Z(e,[new l("scale-height",{from:1,to:0},1,200,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-height",{from:0,to:-1},1,200,200,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-height",{from:-1,to:1},1,400,400,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{plane:s})}:{scene:new u.Z(e,[new l("scale-width",{from:1,to:0},1,200,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-width",{from:0,to:-1},1,200,200,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-width",{from:-1,to:1},1,400,400,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{plane:s})}}case"drift":return{scene:new u.Z(e,[new l("offset-x",{to:.2},1,2e3,0,!1,c.Z.EASE_LINEAR),new l("offset-x",{to:-.2},1,4e3,2e3,!1,c.Z.EASE_LINEAR),new l("offset-x",{to:0},1,2e3,6e3,!1,c.Z.EASE_LINEAR)])};case"gelatine":return{scene:new u.Z(e,[new l("scale-width",{to:.9},1,100,0),new l("scale-width",{to:1.1},1,100,100),new l("scale-width",{to:.95},1,100,200),new l("scale-width",{to:1},1,100,300),new l("scale-height",{to:1.1},1,100,0),new l("scale-height",{to:.9},1,100,100),new l("scale-height",{to:1.05},1,100,200),new l("scale-height",{to:1},1,100,300)])};case"bounce":return{scene:new u.Z(e,[new l("scale-width",{to:1.1},1,100,0),new l("scale-height",{to:.9},1,100,0),new l("self-y",{to:.1},1,100,0),new l("scale-width",{to:.9},1,300,100),new l("scale-height",{to:1.1},1,300,100),new l("self-y",{to:-1.5},1,300,100,!1,c.Z.EASE_OUT_CUBIC),new l("scale-width",{to:1},1,300,410),new l("scale-height",{to:1},1,300,410),new l("self-y",{to:0},1,500,410,!1,c.Z.EASE_OUT_BOUNCE)])};case"vibrate":return{scene:new u.Z(e,[new l("self-x",{to:-.01},1,30,0,!1,c.Z.EASE_LINEAR),new l("self-y",{to:.01},1,30,0,!1,c.Z.EASE_LINEAR),new l("self-y",{to:-.01},1,30,30,!1,c.Z.EASE_LINEAR),new l("self-x",{to:.01},1,50,60,!1,c.Z.EASE_LINEAR),new l("self-y",{to:.01},1,50,60,!1,c.Z.EASE_LINEAR),new l("self-x",{to:0},1,30,110,!1,c.Z.EASE_LINEAR),new l("self-y",{to:0},1,30,120,!1,c.Z.EASE_LINEAR),new l("self-x",{to:-.01},1,30,120,!1,c.Z.EASE_LINEAR),new l("self-y",{to:.01},1,30,120,!1,c.Z.EASE_LINEAR),new l("self-y",{to:-.01},1,30,150,!1,c.Z.EASE_LINEAR),new l("self-x",{to:.01},1,50,180,!1,c.Z.EASE_LINEAR),new l("self-y",{to:.01},1,50,180,!1,c.Z.EASE_LINEAR),new l("self-x",{to:0},1,30,230,!1,c.Z.EASE_LINEAR),new l("self-y",{to:0},1,30,250,!1,c.Z.EASE_LINEAR)])};case"flicker":return{scene:new u.Z(e,[new l("opacity",{to:0},1,30,500),new l("opacity",{to:1},1,30,550),new l("opacity",{to:0},1,30,650),new l("opacity",{to:1},1,50,690),new l("opacity",{to:0},1,30,1300),new l("opacity",{to:1},1,30,1350),new l("opacity",{to:0},1,30,1700),new l("opacity",{to:1},1,30,1750),new l("opacity",{to:0},1,30,1900),new l("opacity",{to:1},1,50,1950)])};case"beat":return{scene:new u.Z(e,[new l("scale",{to:.91},1,150,0,!1,c.Z.EASE_OUT_QUAD),new l("scale",{to:.98},1,150,150,!1,c.Z.EASE_OUT_QUAD),new l("scale",{to:.91},1,150,400,!1,c.Z.EASE_OUT_QUAD),new l("scale",{to:1},1,200,600,!1,c.Z.EASE_OUT_QUAD)])};case"fade-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,c.Z.EASE_LINEAR)])};case"grow-out":{const s=p.getOption(t,"anchor","center");return{exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,c.Z.EASE_LINEAR),new l("scale",{to:1.2},1,1e3,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{anchor:s})}}case"shrink-out":{const s=p.getOption(t,"anchor","center");return{exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,c.Z.EASE_LINEAR),new l("scale",{to:.5},1,1e3,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{anchor:s})}}case"rise-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,c.Z.EASE_LINEAR),new l("offset-y",{to:-.2},1,750,0,!1,c.Z.EASE_IN_CIRC)])};case"sink-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,c.Z.EASE_LINEAR),new l("offset-y",{to:.2},1,750,0,!1,c.Z.EASE_IN_CIRC)])};case"vertical-out":return{exit:new u.Z(e,[new l("scale-height",{to:0},1,500,0,!1,c.Z.EASE_IN_BACK)])};case"horizontal-out":return{exit:new u.Z(e,[new l("scale-width",{to:0},1,500,0,!1,c.Z.EASE_IN_BACK)])};case"flicker-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,50,0,!1),new l("opacity",{to:1},1,100,100),new l("opacity",{to:0},1,50,200),new l("opacity",{to:1},1,100,300),new l("opacity",{to:0},1,50,400),new l("opacity",{to:1},1,100,600),new l("opacity",{to:0},1,50,700)])};case"tumble-out":{let s,i=p.getOption(t,"fourway","right");switch(i){case"right":s=new l("offset-x",{to:1.5},1,400,300,!1,c.Z.EASE_LINEAR);break;case"left":s=new l("offset-x",{to:-1.5},1,400,300,!1,c.Z.EASE_LINEAR);break;case"up":s=new l("offset-y",{to:-1.5},1,400,300,!1,c.Z.EASE_LINEAR);break;case"down":s=new l("offset-y",{to:1.5},1,400,300,!1,c.Z.EASE_LINEAR)}return{exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE),new l("rotate",{to:.2},2,500,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE),s],{fourway:i})}}case"8-bit-out":{let s=p.getOption(t,"eightway","upleft");const i={exit:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,c.Z.EASE_FIVE_LADDER),new l("rotate",{from:-.1,to:.1},1,500,500,!1,c.Z.EASE_FIVE_LADDER),new l("rotate",{set:0},1,0,1e3,!1)],{eightway:s})};switch(s){case"up":i.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"down":i.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"left":i.exit.motions.push(new l("offset-x",{to:-1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"right":i.exit.motions.push(new l("offset-x",{to:1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"upleft":i.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{to:-.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"upright":i.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{to:.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"downleft":i.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{to:-.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER));break;case"downright":i.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER),new l("offset-x",{to:.4},1,1e3,0,!0,c.Z.EASE_FIVE_LADDER))}return i}case"whoa-out":return{exit:new u.Z(e,[new l("scale",{to:1.5},1,500,0,!1,c.Z.EASE_LINEAR),new l("opacity",{to:0},1,750,0,!1,c.Z.EASE_LINEAR),new l("rotate",{to:-.075},2,750,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)])};case"drop-out":return{exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE),new l("offset-y",{to:1},1,750,250,!1,c.Z.EASE_OUT_BOUNCE)])};case"action-out":{let s=p.getOption(t,"twoway","right");return{exit:new u.Z(e,[new l("offset-x","right"===s?{to:.1}:{to:-.1},1,1e3,0,!1,c.Z.EASE_LINEAR),new l("offset-x","right"===s?{to:1.5}:{to:-1.5},1,350,1e3,!1,c.Z.EASE_LINEAR)],{twoway:s})}}case"spring-out":return{exit:new u.Z(e,[new l("scale-width",{to:2},1,300,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"right"),new l("scale-width",{to:1},1,200,300,!1,c.Z.EASE_IN_OUT_ELASTIC,l.DIRECTION_FORWARD,"left"),new l("self-x",{set:1},0,1,300,!1,c.Z.EASE_LINEAR)])};case"backup-out":return{exit:new u.Z(e,[new l("scale",{to:.6},1,200,0,!1,c.Z.EASE_IN_BACK),new l("offset-y",{to:-1},1,500,150,!1,c.Z.EASE_IN_CUBIC)])};case"backdown-out":return{exit:new u.Z(e,[new l("scale",{to:.6},1,200,0,!1,c.Z.EASE_IN_BACK),new l("offset-y",{to:1},1,500,150,!1,c.Z.EASE_IN_CUBIC)])};case"pixelate-out":return{exit:new u.Z(e,[new l("pixelate",{from:0,to:1},1,1500,0,!1,c.Z.EASE_OUT_CIRC)])};case"mosaic-out":return{exit:new u.Z(e,[new l("mosaic",{from:0,to:1},1,1500,0,!1,c.Z.EASE_OUT_CIRC)])};case"fringe-out":return{exit:new u.Z(e,[new l("opacity",{from:1,to:0},1,500,0,!0,c.Z.EASE_LINEAR),new l("fringe",{from:0,to:1},1,500,0,!0,c.Z.EASE_IN_OUT_BOUNCE)])};case"melt-out":{let s=p.getOption(t,"fiveway","center");return{exit:new u.Z(e,[new l("melt",{from:0,to:1},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(s))],{fiveway:s})}}case"gooey-out":return{exit:new u.Z(e,[new l("gooey",{from:0,to:1},1,1e3,0,!1,c.Z.EASE_LINEAR)])};case"block-out":return{exit:new u.Z(e,[new l("block",{from:0,to:1},1,1e3,0,!1,c.Z.EASE_LINEAR)])};case"curtain-out":{let s=p.getOption(t,"plane","horizontal");return{exit:new u.Z(e,[new l("curtain",{from:0,to:1},1,1e3,0,!0,c.Z.EASE_IN_QUART,l.DIRECTION_FORWARD,s)],{plane:s})}}case"blinds-out":let s=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("blinds",{from:0,to:1},1,1e3,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(s))],{fourway:s})};case"wipe-out":{let s=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("wipe",{from:0,to:1},1,800,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(s))],{fourway:s})}}case"slot-out":{let s=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("slot",{from:0,to:1},1,800,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(s))],{fourway:s})}}case"split-out":{let s=p.getOption(t,"plane","vertical");return{exit:new u.Z(e,[new l("split",{from:0,to:1},1,500,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{plane:s})}}case"line-out":{let s=p.getOption(t,"plane","vertical");return{exit:new u.Z(e,[new l("line",{from:0,to:1},1,500,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,s)],{plane:s})}}case"circular-out":return{exit:new u.Z(e,[new l("circular",{from:0,to:1},1,1e3,0,!1,c.Z.EASE_LINEAR)])};case"ripple-out":return{exit:new u.Z(e,[new l("ripple",{from:0,to:1},1,1e3,0,!1,c.Z.EASE_LINEAR)])};case"warp-out":{let s=p.getOption(t,"fourway","left");return{exit:new u.Z(e,[new l("warp",{from:0,to:1},1,1e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(s))],{fourway:s})}}}console.log("No such layer animation preset")}static getPageAnimation(e){switch(e){case"fade":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("scale",{set:1.05},1,0,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-y",{from:0,to:1},1,7e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("opacity",{from:0},1,750,0,!0,c.Z.EASE_LINEAR)],void 0,750),scene:new u.Z(e,void 0,void 0,5e3),exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,c.Z.EASE_LINEAR)])};case"rise":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("opacity",{from:0},1,800,0,!0,c.Z.EASE_LINEAR),new l("offset-y",{from:.3},1,800,0,!0,c.Z.EASE_LINEAR)]),scene:new u.Z(e,void 0,void 0,5e3),exit:new u.Z(e,[new l("opacity",{to:0},1,800,0,!1,c.Z.EASE_LINEAR),new l("offset-y",{to:-.3},1,800,0,!1,c.Z.EASE_LINEAR)])};case"tumble":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("rotate",{from:.2},1,380,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"bottom","odd"),new l("offset-x",{from:2},1,400,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","odd"),new l("rotate",{to:.01},2,300,380,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"bottom","odd"),new l("rotate",{from:-.2},1,380,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"top","even"),new l("offset-x",{from:-2},1,400,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","even"),new l("rotate",{to:-.01},2,300,380,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"top","even")]),scene:new u.Z(e,void 0,void 0,3e3),exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:.2},2,500,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("offset-x",{to:1.5},1,400,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","odd"),new l("rotate",{to:-.01},2,300,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:-.2},2,500,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("offset-x",{to:-1.5},1,400,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","even")])};case"soothe":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("scale",{set:1.05},1,0,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-x",{from:0,to:1},1,8e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-y",{from:0,to:1},1,8e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("opacity",{from:0},1,2e3,0,!0,c.Z.EASE_LINEAR),new l("scale",{from:.9},1,2e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","large"),new l("scale",{from:.9},1,2e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","medium"),new l("scale",{from:.7},1,2e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small")],void 0,2e3),scene:new u.Z(e,void 0,void 0,4e3),exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,c.Z.EASE_LINEAR)])};case"action":return{stagger:new d.Z(2e3,"top"),enter:new u.Z(e,[new l("viewport-x",{from:-1,to:.4},1,350,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")]),scene:new u.Z(e,[new l("viewport-x",{from:.4,to:.6},1,3e3,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")]),exit:new u.Z(e,[new l("viewport-x",{from:.6,to:2},1,350,0,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")])};case"parallax":return{enter:new u.Z(e,[new l("scale",{to:1.1},1,6e3,0,!0,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("self-x",{from:.5,to:0},1,2e3,0,!0,c.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,"center","odd"),new l("self-x",{from:-.5,to:0},1,2e3,0,!0,c.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,"center","even")],void 0,2e3),scene:new u.Z(e,void 0,void 0,2e3),exit:new u.Z(e,[new l("self-x",{to:-.8},1,2e3,0,!1,c.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","odd"),new l("self-x",{to:.8},1,2e3,0,!1,c.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","even")])};case"stomp":return{enter:new u.Z(e,[new l("scale",{from:4,to:1},1,300,0,!1,c.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","foreground"),new l("scale",{to:1.05},4,400,300,!1,c.Z.EASE_OUT_CUBIC,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:.01},1,100,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{from:.01,to:-.01},1,200,400,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:0},1,100,600,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("scale",{to:1.05},4,400,300,!1,c.Z.EASE_OUT_CUBIC,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:-.01},1,100,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{from:-.01,to:.01},1,200,400,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:0},1,100,600,!1,c.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even")]),scene:new u.Z(e,void 0,void 0,4e3),exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,c.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","foreground"),new l("offset-y",{to:1},1,750,250,!1,c.Z.EASE_OUT_BOUNCE,l.DIRECTION_FORWARD,"center","foreground")])};case"neon":return{stagger:new d.Z(1e3,"top"),enter:new u.Z(e,[new l("opacity",{to:1},1,50,200,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:0},1,100,300,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:1},1,50,400,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:0},1,100,600,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:1},1,50,800,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all")]),scene:new u.Z(e,[new l("opacity",{to:0},1,30,500,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","foreground"),new l("opacity",{to:1},1,30,550,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","foreground"),new l("opacity",{to:0},1,30,650,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:1},1,50,690,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:0},1,30,1300,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:1},1,30,1350,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:0},1,30,1700,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:1},1,30,1750,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:0},1,30,1900,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:1},1,50,1950,!1,c.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")],void 0,void 0,2e3),exit:new u.Z(e,[new l("opacity",{to:0},1,50,0),new l("opacity",{to:1},1,100,100),new l("opacity",{to:0},1,50,200),new l("opacity",{to:1},1,100,300),new l("opacity",{to:0},1,50,400),new l("opacity",{to:1},1,100,600)],void 0,void 0,1e3)}}console.log("No such page animation preset")}}p.layerEnterAnimations=[["fade-in",!1],["grow-in",!1,!0],["shrink-in",!1,!0],["rise-in",!1],["sink-in",!1],["vertical-in",!1],["horizontal-in",!1],["flicker-in",!0],["tumble-in",!0,!0],["8-bit-in",!0,!0],["whoa-in",!0],["drop-in",!0],["action-in",!0,!0],["pop-in",!0],["stomp-in",!0],["spring-in",!0],["backdown-in",!0],["backup-in",!0],["pixelate-in",!1],["mosaic-in",!0],["fringe-in",!0],["melt-in",!0,!0],["gooey-in",!0],["block-in",!0],["curtain-in",!0,!0],["blinds-in",!0,!0],["wipe-in",!1,!0],["slot-in",!1,!0],["split-in",!0,!0],["line-in",!0,!0],["circular-in",!0],["ripple-in",!0],["warp-in",!0,!0]],p.layerSceneAnimations=[["rotate",!1,!0],["jiggle",!1],["wave",!1,!0],["flip",!1,!0],["floating",!0],["drift",!0],["gelatine",!0],["bounce",!0],["vibrate",!0],["flicker",!0],["beat",!0]],p.layerExitAnimations=[["fade-out",!1],["grow-out",!1,!0],["shrink-out",!1,!0],["rise-out",!1],["sink-out",!1],["vertical-out",!1],["horizontal-out",!1],["flicker-out",!0],["tumble-out",!0,!0],["8-bit-out",!0,!0],["whoa-out",!0],["drop-out",!0],["action-out",!0,!0],["spring-out",!0],["backdown-out",!0],["backup-out",!0],["pixelate-out",!1],["mosaic-out",!0],["fringe-out",!0],["melt-out",!0,!0],["gooey-out",!0],["block-out",!0],["curtain-out",!0,!0],["blinds-out",!0,!0],["wipe-out",!1,!0],["slot-out",!1,!0],["split-out",!0,!0],["line-out",!0,!0],["circular-out",!0],["ripple-out",!0],["warp-out",!0,!0]],p.pageFullAnimations=[["none",!1],["fade",!1],["rise",!1],["tumble",!1],["soothe",!1],["action",!1],["parallax",!0],["stomp",!0],["neon",!0]];var g=s(2396);class m extends n.Z{constructor(e){super("animation",e),this.enter=e=>{this.stage.stopAnimation();const t=e.currentTarget.id;if("none"===t)return;const s=p.getPageAnimation(t),i=this.prepareAnimators(s,!1);this.stage.playAnimation(24,i)},this.leave=e=>{this.stage.stopAnimation()},this.prepareAnimators=(e,t=!0)=>{const s=new Array,i=g.Z.fromInjection(e);for(const n of this.stage.fresco.layers)if(n.animation)n.animation.block||s.push(new o.Z(n,o.Z.createLayerTransitions(n.animation)));else{const e=o.Z.createPageTransitions(n,this.stage.fresco,i);e.length>0&&s.push(new o.Z(n,e))}return s},this.selectPreset=e=>{this.stage.stopAnimation();let t=e.currentTarget;if(!r.ZP.user.subscription&&t.classList.contains("premium"))return void new h.Z(this.stage,"animation");t.classList.add("selected");let s=(0,i.ZP)("animation-presets").getElementsByClassName("apreset-page");for(var n=0;n<s.length;n++)s[n].classList.remove("selected");t.classList.add("selected");const o=t.id,c=this.stage.fresco.animation;this.stage.fresco.animation="none"===o?void 0:g.Z.fromInjection(p.getPageAnimation(o)),(0,a.Z)("page-animation",o),this.stage.history.add({type:"pageAnimation",kind:o,animation:c})},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.cleanUp=()=>{(0,i.ZP)("animation-presets").innerHTML="",(0,i.ZP)("animation-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("animation-cancel").removeEventListener("click",this.cancelClick,!1)},(0,i.ZP)("animation-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("animation-cancel").addEventListener("click",this.cancelClick,!1);let t="none",s=p.pageFullAnimations,n=(0,i.ZP)("animation-presets");t=this.stage.fresco.animation&&this.stage.fresco.animation.enter?this.stage.fresco.animation.enter.name:"none";for(const[a,r]of s){const e=(0,i.T)("div",{id:a,className:"apreset-page"});r&&e.classList.add("premium"),"none"!==a&&(e.addEventListener("pointerenter",this.enter,!1),e.addEventListener("pointerleave",this.leave,!1)),e.addEventListener("click",this.selectPreset,!1),t===a&&e.classList.add("selected"),e.append((0,i.T)("img",{src:"/img/icon/animation/"+a+".svg",className:"ic"}),(0,i.T)("span",{},a.replace("-"," "))),n.appendChild(e)}}}},4028:(e,t,s)=>{s.d(t,{Z:()=>B});var i=s(3947),n=s(6548),a=s(6817),r=s(8203),o=s(4188),h=s(8685),c=s(1294),l=s(7108),d=s(7664),u=s(9591),p=s(3655),g=s(8776);class m{constructor(e){this.cleanUp=()=>{},this.stage=e}}var v=s(7359),f=s(9067),y=s(3673),w=s(4820);var b=s(4211),x=s(4178);class Z{constructor(e,t,s,a=!1){this.populatePresets=()=>{let e=[new v.Rt([w.ZP.mainColor+"FF",w.ZP.altColor+"FF"],[0,1]),new v.Rt(["#000000FF","#FFFFFFFF"],[0,1]),new v.Rt(["#999999FF","#03205AFF","#000000FF"],[0,.5,1]),new v.Rt(["#000000FF","#00000000"],[0,1]),new v.Rt(["#FFFFFFFF","#FFFFFF00"],[0,1]),new v.Rt(["#00A8DFFF","#323496FF","#CA1688FF","#EB2E2EFF","#FDE92DFF","#009E54FF"],[0,.2,.4,.6,.8,1]),new v.Rt(["#0B01B8FF","#DE9E31FF","#0B01B8FF"],[.25,.5,.75]),new v.Rt(["#000000FF","#FF0000FF"],[0,1]),new v.Rt(["#FFFFFFFF","#FF0000FF"],[0,1]),new v.Rt(["#FFFFFFFF","#00FF00FF"],[0,1]),new v.Rt(["#FFFFFFFF","#0000FFFF"],[0,1]),new v.Rt(["#00FFFFFF","#FF8000FF"],[0,1]),new v.Rt(["#c2e59cff","#64b3f4ff"],[0,1]),new v.Rt(["#8E0E00FF","#1F1C18FF"],[0,1]),new v.Rt(["#f46b45FF","#eea849FF"],[0,1]),new v.Rt(["#fc00ffff","#00dbdeff"],[0,1]),new v.Rt(["#CCCCB2ff","#757519ff"],[0,1]),new v.Rt(["#F1F2B5FF","#135058FF"],[0,1]),new v.Rt(["#7b4397FF","#dc2430FF"],[0,1]),new v.Rt(["#8e9eabFF","#eef2f3FF"],[0,1]),new v.Rt(["#00bf8fFF","#001510FF"],[0,1]),new v.Rt(["#ff0084FF","#33001bFF"],[0,1]),new v.Rt(["#833ab4FF","#fd1d1dFF","#fcb045FF"],[0,.5,1]),new v.Rt(["#FEAC5EFF","#C779D0FF","#fcb045FF"],[0,.5,1]),new v.Rt(["#6441A5FF","#2a0845FF"],[0,1]),new v.Rt(["#43cea2FF","#185a9dFF"],[0,1]),new v.Rt(["#FFA17FFF","#00223EFF"],[0,1]),new v.Rt(["#360033FF","#0b8793FF"],[0,1]),new v.Rt(["#948E99FF","#2E1437FF"],[0,1]),new v.Rt(["#1e130cFF","#9a8478FF"],[0,1]),new v.Rt(["#D38312FF","#A83279FF"],[0,1]),new v.Rt(["#70e1f5FF","#ffd194FF"],[0,1]),new v.Rt(["#556270FF","#ff6b6bFF"],[0,1]),new v.Rt(["#000000FF","#e74c3cFF"],[0,1]),new v.Rt(["#f0c27bff","#4b1248ff"],[0,1]),new v.Rt(["#fbd3e9ff","#bb377dff"],[0,1]),new v.Rt(["#649173ff","#dbd5a4ff"],[0,1]),new v.Rt(["#b993d6ff","#8ca6dbff"],[0,1]),new v.Rt(["#d3959bff","#bfe6baff"],[0,1]),new v.Rt(["#dad299ff","#b0dab9ff"],[0,1]),new v.Rt(["#f2709cff","#ff9472ff"],[0,1]),new v.Rt(["#5d4157ff","#a8cabaff"],[0,1]),new v.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new v.Rt(["#fc354cff","#0abfbcff"],[0,1]),new v.Rt(["#414d0bff","#727a17ff"],[0,1]),new v.Rt(["#134e5eff","#71b280ff"],[0,1]),new v.Rt(["#2bc0e4ff","#eaecc6ff"],[0,1]),new v.Rt(["#603813ff","#b29f94ff"],[0,1]),new v.Rt(["#bbd2c5FF","#536976FF","#292e49FF"],[0,.5,1]),new v.Rt(["#1e9600FF","#fff200FF","#ff0000FF"],[0,.5,1]),new v.Rt(["#06beb6ff","#48b1bfff"],[0,1]),new v.Rt(["#eb3349ff","#f45c43ff"],[0,1]),new v.Rt(["#56ab2fff","#a8e063ff"],[0,1]),new v.Rt(["#614385ff","#516395ff"],[0,1]),new v.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new v.Rt(["#3a1c71FF","#d76d77FF","#ffaf7bFF"],[0,.5,1]),new v.Rt(["#4ca1afff","#c4e0e5ff"],[0,1]),new v.Rt(["#dbdcd7ff","#b8235aff","#801357ff","#3d1635ff","#1c1a27ff"],[0,.59,.71,.84,1]),new v.Rt(["#f83600ff","#f9d423ff"],[0,1]),new v.Rt(["#71a192ff","#b7bb81ff","#f5b752ff","#db6549ff","#7b4163ff"],[0,.25,.5,.8,1]),new v.Rt(["#00737AFF","#DE5159FF","#7F3038ff","#150C14FF"],[0,.5,.75,1]),new v.Rt(["#8FB9A8FF","#FEFAD4FF","#FCD0BAff","#F1828DFF","#765D69FF"],[0,.4,.5,.75,1]),new v.Rt(["#F26627FF","#F9A26CFF","#EFEEEEff","#98D7D1FF","#325D79FF"],[0,.3,.5,.75,1]),new v.Rt(["#F18C8EFF","#F0B7A4FF","#F1D1B5ff","#568EA6FF","#305F72FF"],[0,.3,.5,.75,1]),new v.Rt(["#FCBB6DFF","#D8737FFF","#AB6CB2FF","#685D79FF","#475C7AFF"],[0,.3,.5,.75,1]),new v.Rt(["#CC2A49FF","#F99E4CFF","#F36F38FF","#EF4648FF","#582841FF"],[0,.3,.5,.75,1]),new v.Rt(["#092B38FF","#9C5773FF","##CDCDC5FF"],[0,.5,1]),new v.Rt(["#009e00FF","#ffff96FF"],[0,1]),new v.Rt(["#fcce78FF","#7e2d02FF"],[0,1]),new v.Rt(["#ffdb01FF","#0e197dFF"],[0,1]),new v.Rt(["#B4C6CCFF","#FE4929FF"],[0,1]),new v.Rt(["#B71970FF","#01416DFF"],[0,1]),new v.Rt(["#471B0DFF","#F0E867FF"],[0,1]),new v.Rt(["#1A2713FF","#E2EAB1FF"],[0,1]),new v.Rt(["#B03F2AFF","#FFEBB0FF"],[0,1])];const t=(0,i.ZP)("grad-selector-presets-ss-content");if(this.extended){const e=(0,i.T)("div",{className:"grad-pod square empty"});e.setAttribute("data","empty"),e.addEventListener("click",this.selectPreset,!0),t.append(e)}e.forEach((e=>{const s=(0,i.T)("div",{className:"grad-pod square",style:"background:"+e.toCSS()});s.setAttribute("data",JSON.stringify(e)),s.addEventListener("click",this.selectPreset,!0),t.append(s)}))},this.selectPreset=e=>{this.removeHandlers(),this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected"),"empty"!==this.marked.getAttribute("data")?(this.grad=v.ZP.fromPreset(p.mS(v.Rt,JSON.parse(this.marked.getAttribute("data")))),this.extended&&(this.grad.direction=this.direction.getValue(),this.grad.type=(0,i.ZP)("grad-type-linear").checked?"linear":"radial"),this.populateStops(),this.updatePreview()):this.callback&&this.callback(void 0)},this.setGrad=e=>{this.grad=e,this.extended&&((0,i.ZP)("grad-type-linear").checked="linear"===this.grad.type,(0,i.ZP)("grad-type-radial").checked="radial"===this.grad.type,this.direction.setValue(this.grad.direction)),this.removeHandlers(),this.populateStops(),this.updatePreview(!1)},this.directionChange=()=>{this.grad.direction=this.direction.getValue(),this.updatePreview()},this.typeChange=e=>{let t=e.target;this.grad.type="linear"===t.value?"linear":"radial",(0,i.ZP)("grad-direction").style.display="linear"===this.grad.type?"flex":"none",this.updatePreview()},this.updatePreview=(e=!0)=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&e&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let e=0;e<this.grad.stops.length;++e){const t=Math.round(300*this.grad.stops[e].position);this.stoplist.append((0,i.T)("div",{id:this.grad.stops[e].id,className:"knob",style:"left:"+t+"px"},(0,i.T)("div",{className:"bg ic"}),(0,i.T)("div",{className:"color",id:this.grad.stops[e].id+"-color",style:"background:"+this.grad.stops[e].color.toHEX()})))}this.setHandlers()},this.addStop=e=>{e.stopPropagation(),e.preventDefault();const t=this.grad.addStop(this.colorpod.getColor().clone(),Math.round(e.offsetX)/300),s=Math.round(300*t.position),n=(0,i.T)("div",{id:t.id,className:"knob",style:"left:"+s+"px"},(0,i.T)("div",{className:"bg ic"}),(0,i.T)("div",{className:"color",id:t.id+"-color",style:"background:"+t.color.toHEX()}));n.addEventListener("mousedown",this.mouseDown,!0),n.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(n),this.selectStop(t.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,i.ZP)(this.selected.id)&&(0,i.ZP)(this.selected.id).remove();const e=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(e),this.updatePreview()}},this.selectStop=e=>{this.selected&&this.selected.id===e||(this.selected&&(0,i.ZP)(this.selected.id)&&(0,i.ZP)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(e),(0,i.ZP)(this.selected.id).classList.add("selected"),this.colorpod.setColor(this.selected.color),this.opacity.setValue(this.selected.color.a/255),(0,i.ZP)("grad-selector-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(e,t,s)=>{this.selectStop(s.id),this.downX=e,this.target=s,this.start=s.offsetLeft+6},this.move=(e,t,s=!0)=>{let i=p.uZ(this.start+(e-this.downX),0,300);this.target.style.left=i+"px",this.selected.position=i/300,this.grad.sort(),this.updatePreview(s)},this.setHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",this.mouseDown,!0),e[t].addEventListener("touchstart",this.touchStart,{passive:!0}),0===t&&this.selectStop(e[t].id)},this.removeHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].removeEventListener("mousedown",this.mouseDown,!0),e[t].removeEventListener("touchstart",this.touchStart)},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY,e.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!0),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY,!1)},this.mouseUp=e=>{e.stopPropagation(),e.preventDefault(),this.move(e.clientX,e.clientY,!0),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.resizeStart=e=>{this.d=new y.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<320?320:t)+"px"},this.cleanUp=()=>{var e;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,i.ZP)("grad-selector-remove").removeEventListener("click",this.removeStop,!0),this.container.remove(),null===(e=this.modal)||void 0===e||e.remove()},this.extended=a,this.gradpod=e,this.grad=e?e.grad:v.ZP.fromColors(g.Z.fromHEX(w.ZP.mainColor),g.Z.fromHEX(w.ZP.altColor)),this.callback=s,this.asControl=!e,this.asControl||(this.modal=(0,i.ZP)("workspace").appendChild((0,i.T)("div",{id:"grad-selector-modal",className:"modal"})));let r=(0,i.T)("div",{style:"position:relative"}),h=(0,i.T)("div",{className:"option",style:"display:flex;justify-content: space-between"}),c=(0,i.T)("div",{id:"grad-selector-presets",className:"pad-10"});if(this.container=(0,i.T)("div",{id:"grad-selector"},r,h),t?t.appendChild(this.container):(this.container.classList.add("grad-selector-float"),(0,i.ZP)("workspace").appendChild(this.container)),this.preview=(0,i.T)("div",{id:"grad-selector-preview"}),this.stoplist=(0,i.T)("div",{id:"grad-selector-stoplist"}),this.addlist=(0,i.T)("div",{id:"grad-selector-addlist"}),r.append((0,i.T)("div",{id:"grad-selector-preview-holder"},this.preview),this.stoplist,this.addlist),h.append((0,i.T)("div",{id:"grad-selector-opacity"}),(0,i.T)("label",{className:"tab-30",style:"width:unset"},(0,n.Z)("color")+":"),(0,i.T)("div",{id:"grad-selector-color",className:"tab-5"}),(0,i.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,i.T)("li",{id:"grad-selector-remove"},(0,i.T)("img",{src:"/img/icon/delete.svg",className:"ic"})))),this.container.append((0,i.T)("div",{className:"splitter pad-8"})),a){let e=(0,i.T)("div",{className:"option pad-10",style:"display:flex;justify-content: space-between"});e.innerHTML+=`\n                    <div id="gradient-type" class="switch-field">\n                        <input type="radio" id="grad-type-linear" name="grad-type" value="linear" checked/><label for="grad-type-linear">${(0,n.Z)("linear")}</label>\n                        <input type="radio" id="grad-type-radial" name="grad-type" value="radial" /><label for="grad-type-radial">${(0,n.Z)("radial")}</label>\n                    </div>\n                    <div id="grad-direction"></div>\n                    `,this.container.append(e),(0,i.ZP)("grad-type-linear").addEventListener("click",this.typeChange,!0),(0,i.ZP)("grad-type-radial").addEventListener("click",this.typeChange,!0),this.direction=new o.Z("grad-direction",{label:(0,n.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange})}this.container.append(c);const l=(0,i.ZP)("grad-selector-remove");if(l.setAttribute("tooltip",(0,n.Z)("removeStop")),l.setAttribute("flow","down"),l.addEventListener("click",this.removeStop,!0),this.asControl)(0,i.ZP)("grad-selector-presets").style.height="180px";else{let e=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1),this.container.style.top=e.bottom+5+"px",this.container.style.left=e.left-~~(this.container.offsetWidth/2)+40+"px",this.container.style.display="flex",this.container.style.height="360px";const t=(0,i.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,i.Rg)(t,this.resizeStart,this.resizeMove),this.container.append(t)}this.preview=(0,i.ZP)("grad-selector-preview"),this.opacity=new o.Z("grad-selector-opacity",{label:(0,n.Z)("opacity")+":",compact:!0,defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.color.a=Math.round(255*e),this.updatePreview()}}),this.colorpod=new b.Z("grad-selector-color",new g.Z,(e=>{e.a=this.selected.color.a,this.selected.color=e,(0,i.ZP)(this.selected.id+"-color").style.background=e.toHEX(),this.updatePreview()})),this.addlist.addEventListener("click",this.addStop,!1),this.populateStops(),this.setHandlers(),this.updatePreview(!1),new x.Z((0,i.ZP)("grad-selector-presets")),this.populatePresets()}}var k=s(2397),E=s(5574),P=s(5181);class S{constructor(e,t){this.populatePresets=async()=>{const e=await fetch("/pattern/index.json"),t=await e.json(),s=(0,i.ZP)("pattern-selector-presets-ss-content"),n=(0,i.T)("div",{className:"pattern-pod empty"});n.setAttribute("data","empty"),n.addEventListener("click",this.selectPreset,!0),s.append(n),t.packs.forEach((e=>{e.assets.forEach((t=>{const n="/pattern/"+e.name+"/"+t,a=(0,i.T)("div",{className:"pattern-pod"});a.setAttribute("data",n),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+n+")",s.append(a)}))}))},this.populatePack=()=>{},this.selectPreset=async e=>{this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected");let t=this.marked.getAttribute("data");if("empty"===t)this.pattern=void 0;else{if(!this.pattern){let e=this.scale.getValue();this.pattern=new f.Z(void 0,e<0?1+e/12.5:1+e,this.direction.getValue())}this.pattern.svg=await fetch(t+"?ref").then((e=>e.text()));let e=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,E.s4)(e),this.extractColors()}this.updatePreview()},this.changeColor=e=>{this.colorPod=e.currentTarget,new P.Z(g.Z.fromHEX(this.colorPod.title),this.setColor)},this.extractColors=()=>{let e=[];this.pattern.svg.replace(/fill:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,s){return e.push(s),t})),this.pattern.svg.replace(/stroke:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,s){return e.push(s),t}));e=e.filter(((e,t,s)=>s.indexOf(e)===t)).slice(0,10);let t=(0,i.ZP)("pattern-color-list");t.innerHTML="",e.forEach((e=>{t.appendChild((0,i.T)("div",{onclick:this.changeColor,className:"color-pod small",title:e,style:"border:none;border-radius:3px;display:inline-block;margin:5px 5px 5px 0px;background-color:"+e}))}))},this.setColor=async e=>{let t=this.colorPod.title,s=e.toHEX();this.colorPod.title=s,this.colorPod.style.backgroundColor=s;var i=new RegExp(t,"g");this.pattern.svg=this.pattern.svg.replace(i,s);let n=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,E.s4)(n),this.updatePreview()},this.setPattern=e=>{this.pattern=e;let t=this.pattern.scale;this.scale.setValue(t<1?-12.5*(1-t):t-1),this.direction.setValue(this.pattern.direction),this.extractColors(),this.updatePreview()},this.scaleChange=e=>{this.pattern&&(e=e<0?1+e/12.5:1+e,this.pattern.scale=e,this.updatePreview(!1))},this.directionChange=e=>{this.pattern&&(this.pattern.direction=e,this.updatePreview(!1))},this.updatePreview=(e=!0)=>{this.pattern?(this.ctx.save(),this.ctx.fillStyle=this.pattern.createCanvasPattern(this.ctx),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.callback&&e&&this.callback(this.pattern)},this.callback=t,this.canvas=p.vL(300,120),this.canvas.classList.add("transparent"),this.canvas.style.borderRadius="2px",this.ctx=this.canvas.getContext("2d");let s=(0,i.T)("div",{className:"option",style:"display:flex;"},(0,i.T)("div",{id:"pattern-scale"}),(0,i.T)("div",{id:"pattern-direction",className:"tab-20"})),a=(0,i.T)("div",{id:"pattern-color-list",style:"display:block;"}),r=(0,i.T)("div",{id:"pattern-selector-top"},this.canvas,a,s),h=(0,i.T)("div",{id:"pattern-selector-presets",className:"pad-10"});this.container=(0,i.T)("div",{id:"pattern-selector"},r,(0,i.T)("div",{className:"splitter pad-8"}),h),e.appendChild(this.container),new x.Z((0,i.ZP)("pattern-selector-presets")),this.scale=new o.Z("pattern-scale",{label:(0,n.Z)("scale")+":",compact:!0,range:[-10,10],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.scaleChange,onEnd:()=>this.updatePreview()}),this.direction=new o.Z("pattern-direction",{label:(0,n.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange,onEnd:()=>this.updatePreview()}),this.populatePresets()}}class C extends class{constructor(e,t,s=!1){this.docked=!1,this.setTitle=(e,t=40)=>{e=e.length>t?`${e.substring(0,5)}...`:e,(0,i.ZP)("float-title-"+this.mid).innerHTML=e},this.position=()=>{if(this.parent)if("x"===w.ZP.product)this.float.style.left="20px",this.float.style.top=Math.round(((0,i.ZP)("workspace").clientHeight-this.float.clientHeight)/2)+"px";else{let e=this.parent.getBoundingClientRect();this.float.style.left=~~(e.right-this.float.clientWidth/2-e.width/2)+"px",this.float.style.top=e.top+30+"px"}else{const e=(0,i.ZP)("workspace").getBoundingClientRect();this.docked?(this.float.style.left="unset",this.float.style.right="0",this.float.style.top="77px",this.float.style.height=e.height-77+"px"):(this.float.style.left=e.width-~~(this.float.offsetWidth/2)-400+"px",this.float.style.height="600px",this.float.style.top="120px"),this.float.classList.toggle("docked",this.docked)}},this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.dragStart=e=>{this.docked||(this.p=e,this.d=new y.Z(this.float.offsetLeft,this.float.offsetTop))},this.dragMove=e=>{this.docked||(this.float.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.float.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px")},this.dragEnd=e=>{if(this.docked)return;let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x)),n=this.float.offsetWidth;t<20&&(t=20),s<-n/2&&(s=0),s+n/2>(0,i.ZP)("workspace").offsetWidth&&(s=(0,i.ZP)("workspace").offsetWidth-n),this.float.style.left=s+"px",this.float.style.top=t+"px"},this.resizeStart=e=>{this.d=new y.Z(this.float.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.float.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{"Enter"!==e.key&&"Escape"!==e.key||this.cleanUp()},this.superClean=()=>{var e;document.removeEventListener("keydown",this.keyDown,!1),this.float.remove(),this.float=null,null===(e=this.modal)||void 0===e||e.remove(),this.modal=null},this.cleanUp=()=>{this.superClean()},this.parent=e,this.mid=p.Zd(),this.parent&&(document.addEventListener("keydown",this.keyDown,!1),this.modal=(0,i.T)("div",{id:"modal-"+this.mid,className:"modal"}),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.cleanUp()})),document.body.appendChild(this.modal)),this.float=(0,i.T)("div",{className:"float"}),this.modal?this.modal.appendChild(this.float):(0,i.ZP)("workspace").append(this.float),this.content=(0,i.T)("div",{className:"content"});const n=(0,i.T)("div",{id:"float-title-"+this.mid,className:"title"},t);if((0,i.Rg)(n,this.dragStart,this.dragMove,this.dragEnd),this.float.append(n,(0,i.T)("img",{id:"float-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),(0,i.T)("div",{className:"splitter small"}),this.content),s){const e=(0,i.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,i.Rg)(e,this.resizeStart,this.resizeMove),this.float.append(e)}this.position()}}{constructor(e,t,s,a){super(e,(0,n.Z)("fill"),!1),this.setSectionEvent=e=>{let t=e.target;this.setSection(t.value)},this.setSection=(e="color")=>{switch(this.holder.innerHTML="",this.patternselector=void 0,this.colorselector=void 0,this.gradselector=void 0,(0,i.ZP)("fill-type-"+e).checked=!0,e){case"color":this.colorselector=new k.Z(this.holder,[...w.ZP.oldColor.slice(),"#ffffff","#888888","#000000"],this.setFill,!0,300,120,!0);break;case"gradient":this.gradselector=new Z(void 0,this.holder,this.setFill,!0);break;case"pattern":this.patternselector=new S(this.holder,this.setFill)}this.fill&&(this.patternselector&&this.fill.value instanceof f.Z&&this.patternselector.setPattern(this.fill.value),this.colorselector&&this.fill.value instanceof g.Z&&this.colorselector.setColor(this.fill.value),this.gradselector&&this.fill.value instanceof v.ZP&&this.gradselector.setGrad(this.fill.value))},this.setFill=e=>{this.fill=new u.Z(e),this.preview&&this.preview(this.fill)},this.cleanUp=()=>{this.callback&&this.fill.value instanceof g.Z&&(0,w.nS)(this.fill.value),this.callback(this.fill),this.superClean()},this.fill=t,this.preview=a,this.callback=s,this.float.style.width="320px",this.content.style.padding="10px";let r=(0,i.T)("div",{style:"position:relative"});this.holder=(0,i.T)("div",{id:"fill-selector-presets",className:"pad-10"}),this.setContent(r,(0,i.T)("div",{className:"splitter pad-10"}),this.holder),r.innerHTML+=`\n        <div id="fill-type" class="switch-field" style="display:flex;margin:0;">\n            <input type="radio" id="fill-type-color" name="fill-type" value="color"/><label for="fill-type-color">${(0,n.Z)("color")}</label>\n            <input type="radio" id="fill-type-gradient" name="fill-type" value="gradient" /><label for="fill-type-gradient">${(0,n.Z)("gradient")}</label>\n            <input type="radio" id="fill-type-pattern" name="fill-type" value="pattern" /><label for="fill-type-pattern">${(0,n.Z)("pattern")}</label>\n        </div>\n        `,(0,i.ZP)("fill-type-color").addEventListener("change",this.setSectionEvent,!0),(0,i.ZP)("fill-type-gradient").addEventListener("change",this.setSectionEvent,!0),(0,i.ZP)("fill-type-pattern").addEventListener("change",this.setSectionEvent,!0),this.setSection(null==t?void 0:t.getType())}}class T{constructor(e,t,s,n){this.previewFill=e=>{this.setFill(e),this.preview&&this.preview(this.fill)},this.callbackFill=e=>{this.setFill(e),this.callback&&this.callback(this.fill)},this.setFill=e=>{this.fill=e,this.holder.classList.remove("empty"),this.holder.style.backgroundColor="unset",this.holder.style.backgroundImage="unset",this.fill&&this.fill.value?this.fill.value instanceof g.Z?this.holder.style.backgroundColor=this.fill.value.toHEX():(this.fill.value instanceof v.ZP||this.fill.value instanceof f.Z)&&(this.holder.style.backgroundImage=this.fill.value.toCSS()):this.holder.classList.add("empty")},this.getFill=()=>this.fill,this.picker=()=>{new C(this.container,this.fill,this.callbackFill,this.previewFill)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.fill=t,this.preview=n,this.callback=s,this.container=(0,i.ZP)(e),this.container.hasChildNodes()?this.holder=(0,i.ZP)(e+"-holder"):(this.holder=(0,i.T)("div",{id:e+"-holder"}),this.container.appendChild(this.holder)),this.container.classList.add("fill-pod"),this.container.addEventListener("click",this.picker,!1),this.setFill(t)}}var L=s(7163),M=s(5934),A=s(1951);class I{constructor(e,t,s,a){if(this.addLocalFont=()=>{(0,M.Q0)(!0).then((async e=>{for(var t,s=0;t=e[s];s++)await(0,M.ZB)(this.stage,t);this.removeEventHandlers(),this.showFontList()}))},this.showFontList=()=>{(0,i.ZP)("font-wrap").classList.add("show"),(0,i.ZP)("font-wrap").classList.add("modal"),this.populateFonts(),this.setEventHandlers(),this.selected&&this.setFont(this.selected)},this.hideFontList=(e=!0)=>{(0,i.ZP)("font-wrap").classList.remove("show"),(0,i.ZP)("font-wrap").classList.remove("modal"),e&&this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&this.loadFont(this.selected,!0),this.selected&&(0,i.ZP)("font:"+this.selected)&&(0,i.ZP)("font:"+this.selected).classList.remove("selected"),this.removeEventHandlers()},this.populateFonts=()=>{const e=(0,i.ZP)("font-list-holder-ss-content");e.childElementCount!==L.Z.fontList.length&&(e.innerHTML="",L.Z.fontList.forEach((t=>{let s=document.createElement("div");t.local?s.append((0,i.T)("img",{src:URL.createObjectURL(t.thumb),title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40}),(0,i.T)("img",{src:"/img/icon/close.svg",title:"Remove font",className:"close ic",onclick:e=>this.removeFont(e,"font:"+t.name)})):s.append((0,i.T)("img",{src:"/font/"+t.short+".png",title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40})),s.setAttribute("data",t.name),s.setAttribute("id","font:"+t.name),s.classList.add("font-pod"),t.premium&&s.classList.add("premium"),e.appendChild(s)})))},this.setEventHandlers=()=>{document.addEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.selectFont,!1),e[t].addEventListener("mouseenter",this.enterFont,!1)},this.removeEventHandlers=()=>{document.removeEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].removeEventListener("click",this.selectFont,!1),e[t].removeEventListener("mouseenter",this.enterFont,!1)},this.dragStart=e=>{e.stopPropagation(),this.p=new y.Z(e.clientX,e.clientY),this.d=new y.Z(this.fontList.offsetLeft,this.fontList.offsetTop),document.addEventListener("mousemove",this.dragMove,!0),document.addEventListener("mouseup",this.dragEnd,!0)},this.dragMove=e=>{e.stopPropagation(),this.fontList.style.left=Math.round(this.d.x+(e.clientX-this.p.x))+"px",this.fontList.style.top=Math.round(this.d.y+(e.clientY-this.p.y))+"px"},this.dragEnd=e=>{e.stopPropagation(),this.p=void 0,document.removeEventListener("mousemove",this.dragMove,!0),document.removeEventListener("mouseup",this.dragEnd,!0)},this.keyPress=e=>{var t;if(e.preventDefault(),e.stopPropagation(),null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}if("ArrowUp"===e.key){for(this.inFocus=this.inFocus.previousElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.previousElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[e.length-1]}}else if("ArrowDown"===e.key){for(this.inFocus=this.inFocus.nextElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.nextElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}}else{if("Escape"===e.key)return void this.hideFontList();if("Enter"===e.key)this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&((!this.inFocus.classList.contains("premium")||w.ZP.user.subscription||this.stage.fresco.block)&&(this.loadFont(this.inFocus.getAttribute("data")),this.hideFontList(!1)),this.hideFontList(!0));else{let t=(0,i.ZP)("font-search").value;if("Backspace"===e.key)t=t.substring(0,t.length-1);else if("Delete"===e.key)t="";else{if(e.key.length>1)return;t+=e.key}(0,i.ZP)("font-search").value=t;const s=document.querySelectorAll("#font-list-holder div.font-pod"),n=(0,i.ZP)("font-search").value;this.inFocus=void 0;for(let e=0;e<s.length;e++){s[e].getAttribute("data").toLowerCase().startsWith(n)?(s[e].style.display="block",this.inFocus||(this.inFocus=s[e])):s[e].style.display="none"}}}if(this.inFocus){this.inFocus.classList.add("focus");const e=this.inFocus.getAttribute("data");this.inFocus.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),p.Ds("preview",200,(()=>{this.loadFont(e,!0)}))}},this.lx=0,this.ly=0,this.enterFont=e=>{var t;if(e.clientX===this.lx&&e.clientY===this.ly)return;this.lx=e.clientX,this.ly=e.clientY,null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),this.inFocus=e.currentTarget,this.inFocus.classList.add("focus");const s=this.inFocus.getAttribute("data");p.Ds("preview",200,(()=>{this.loadFont(s,!0)}))},this.selectFont=e=>{var t;let s=e.currentTarget,i=s.classList.contains("premium"),n=s.getAttribute("data");!i||(null===(t=w.ZP.user)||void 0===t?void 0:t.subscription)||this.stage.fresco.block?(this.loadFont(n),this.hideFontList(!1)):new A.Z(this.stage,"FONT")},this.removeFont=(e,t)=>{e.preventDefault(),e.stopPropagation();let s=(0,i.ZP)(t);L.Z.removeLocalFontDesc(s.getAttribute("data")),s.remove()},this.loadFont=async(e,t=!1)=>{try{await L.Z.loadFont(e);if(t)this.preview(e);else{const t=this.selected;t!==e&&(this.setFont(e),this.callback(e,t))}}catch(s){console.error("Could not load font",e,s)}},this.cleanUp=()=>{this.removeEventHandlers(),this.holder.removeEventListener("click",this.showFontList,!1),this.hideFontList()},this.stage=e,this.holder=t,this.preview=a,this.callback=s,this.holder.addEventListener("click",this.showFontList,!1),this.selected=L.Z.fontList[0].name,!(0,i.ZP)("font-list")){let e=(0,i.T)("div",{id:"font-wrap",onmousedown:e=>{e.target===(0,i.ZP)("font-wrap")&&this.hideFontList()}},(0,i.T)("div",{id:"font-list"},(0,i.T)("img",{id:"font-close",className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.hideFontList()}),(0,i.T)("div",{id:"font-list-title",className:"title",onmousedown:e=>this.dragStart(e)},(0,n.Z)("font")),(0,i.T)("div",{className:"splitter"}),(0,i.T)("div",{style:"position:relative"},(0,i.T)("input",{id:"font-search",className:"font-search",type:"text",placeholder:(0,n.Z)("search")}),(0,i.T)("img",{id:"font-search-icon",className:"search-icon ic",src:"/img/tool/thick/zoom.svg"})),(0,i.T)("div",{id:"font-list-holder"}),(0,i.T)("div",{id:"font-list-add"},(0,i.T)("a",{className:"button positive",onclick:()=>this.addLocalFont()},(0,n.Z)("addLocalFont")))));(0,i.ZP)("workspace").appendChild(e),new x.Z((0,i.ZP)("font-list-holder"))}this.fontList=(0,i.ZP)("font-list")}setFont(e){this.selected&&(0,i.ZP)("font:"+this.selected)&&(0,i.ZP)("font:"+this.selected).classList.remove("selected");let t=(0,i.ZP)("font:"+e);if(t){t.classList.add("selected");let e=t.childNodes[0];this.holder.innerHTML='<img src="'+e.src+'" class="ic" title="'+e.title+'" />'}else{let t=L.Z.getFontDesc(e);t&&(t.local?this.holder.innerHTML='<img src="'+URL.createObjectURL(t.thumb)+'" class="ic" title="'+t.name+'" />':this.holder.innerHTML='<img src="/font/'+t.short+'.png" class="ic" title="'+t.name+'" />')}this.selected=e}}var _=s(7758);class R extends m{constructor(e){let t;super(e),this.setLayer=e=>{this.selected=e,this.updateInputs()},this.updateInputs=()=>{let e=(0,i.ZP)("text-input");e.value=this.selected.text,this.resizeTextInput(e),this.font.setFont(this.selected.textSettings.font),this.opacity.setValue(this.selected.settings.opacity),this.textSize.setValue(this.selected.textSettings.size),this.lineSpace.setValue(this.selected.textSettings.lineSpace),this.letterSpace.setValue(this.selected.textSettings.letterSpace),this.fill.setFill(this.selected.fill),(0,i.ZP)("text-background").checked=this.selected.textSettings.background,(0,i.ZP)("text-background-punch").checked=this.selected.textSettings.backgroundPunch,this.backgroundColor.setHex(this.selected.textSettings.backgroundColor),this.backgroundOffset.setValue(this.selected.textSettings.backgroundOffset),(0,i.ZP)("text-background-type-full").checked=this.selected.textSettings.backgroundType===_.Z.BACKGROUND_FULL,(0,i.ZP)("text-background-type-line").checked=this.selected.textSettings.backgroundType===_.Z.BACKGROUND_LINE,(0,i.ZP)("text-background-type-word").checked=this.selected.textSettings.backgroundType===_.Z.BACKGROUND_WORD,(0,i.ZP)("text-outline").checked=this.selected.textSettings.outline,(0,i.ZP)("text-outline-punch").checked=this.selected.textSettings.outlinePunch,this.outlineColor.setHex(this.selected.textSettings.outlineColor),this.outlineSize.setValue(this.selected.textSettings.outlineSize),this.outlineDistance.setValue(this.selected.textSettings.outlineDistance),this.outlineDirection.setValue(this.selected.textSettings.outlineDirection),(0,i.ZP)("text-shadow").checked=this.selected.textSettings.shadow,this.shadowColor.setHex(this.selected.textSettings.shadowColor),this.shadowBlur.setValue(this.selected.textSettings.shadowBlur),this.shadowAlpha.setValue(this.selected.textSettings.shadowAlpha),this.shadowDistance.setValue(this.selected.textSettings.shadowDistance),this.shadowDirection.setValue(this.selected.textSettings.shadowDirection),(0,i.ZP)("text-curve").checked=this.selected.textSettings.curve,this.curveAmount.setValue(this.selected.textSettings.curveAmount),(0,i.ZP)("text-curve-flip").checked=this.selected.textSettings.curveFlip,(0,i.ZP)("text-curve-spread").checked=this.selected.textSettings.curveSpread,(0,i.ZP)("text-curve-type-arc").checked="arc"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-type-circle").checked="circle"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-type-half").checked="half"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-amount").style.display="arc"!==this.selected.textSettings.curveType?"none":"block",(0,i.ZP)("text-curve-flip-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,i.ZP)("text-curve-spread-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,i.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),(0,i.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),(0,i.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),(0,i.ZP)("text-align-left").checked="left"===this.selected.textSettings.align,(0,i.ZP)("text-align-center").checked="center"===this.selected.textSettings.align,(0,i.ZP)("text-align-right").checked="right"===this.selected.textSettings.align},this.paste=e=>{e.preventDefault();var t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)},this.resizeTextInput=e=>{window.setTimeout((()=>{let t=e.cloneNode();t.style.visibility="false",e.parentNode.insertBefore(t,e),t.style.height="auto",t.value=e.value,e.style.height=t.scrollTop+t.scrollHeight+16+"px",e.parentNode.removeChild(t)}),0)},this.textActive=()=>{this.textBefore=this.selected.text},this.textBlur=()=>{void 0!==this.textBefore&&this.stage.history.add({type:"textChange",text:this.textBefore,layer:this.selected})},this.changeText=e=>{this.resizeTextInput((0,i.ZP)("text-input")),this.selected.setText((0,i.ZP)("text-input").value),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeAlign=e=>{const t=this.selected.textSettings.clone(),s=document.querySelector('input[name="text-align"]:checked').value;this.selected.setTextAlign(s),t.align!==this.selected.textSettings.align&&this.stage.history.add({type:"textSettings",kind:"align",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeUppercase=()=>{const e=this.selected.textSettings.clone();this.selected.setTextUpperCase(!this.selected.textSettings.uppercase),(0,i.ZP)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),this.stage.history.add({type:"textSettings",kind:"uppercase",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeItalic=()=>{const e=this.selected.textSettings.clone();this.selected.setTextItalic(!this.selected.textSettings.italic),(0,i.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),this.stage.history.add({type:"textSettings",kind:"italic",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBold=()=>{const e=this.selected.textSettings.clone();this.selected.setTextBold(!this.selected.textSettings.bold),(0,i.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),this.stage.history.add({type:"textSettings",kind:"bold",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLineSpace=e=>{this.selected.textSettings.lineSpace=e,p.Ds("text-change",50,(()=>{this.selected.setLineSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeLetterSpace=e=>{this.selected.textSettings.letterSpace=e,p.Ds("text-change",50,(()=>{this.selected.setLetterSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeSize=e=>{this.selected.textSettings.size=e,p.Ds("text-change",50,(()=>{this.selected.setTextSize(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.previewFill=e=>{this.selected.setTextFill(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeFill=e=>{console.log("here");const t=this.selected.textSettings.clone();this.selected.setTextFill(e),this.stage.history.add({type:"textSettings",kind:"fill",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFont=e=>{this.selected&&(this.selected.setTextFont(e,!0),document.dispatchEvent(new CustomEvent("viewport-render")))},this.changeFont=(e,t)=>{if(!this.selected)return;const s=this.selected.textSettings.clone();s.font=t,this.selected.setTextFont(e),this.stage.history.add({type:"textSettings",kind:"font",layer:this.selected,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBackground=e=>{const t=this.selected.textSettings.clone();let s=(0,i.ZP)("text-background").checked,n=(0,i.ZP)("text-background-punch").checked,a=this.backgroundOffset.getValue(),r=this.backgroundColor.getHex(),o="";o=(0,i.ZP)("text-background-type-full").checked?_.Z.BACKGROUND_FULL:(0,i.ZP)("text-background-type-line").checked?_.Z.BACKGROUND_LINE:_.Z.BACKGROUND_WORD,this.selected.setBackground(s,o,r,n,a),this.stage.history.add({type:"textSettings",kind:"background",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBackroundColor=e=>{this.changeBackground()},this.changeOutlineState=()=>{const e=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,i.ZP)("text-outline").checked,t=(0,i.ZP)("text-outline-punch").checked,s=this.outlineColor.getHex(),n=this.outlineSize.getValue(),a=this.outlineDistance.getValue(),r=this.outlineDirection.getValue();this.selected.setOutline(e,n,s,t,a,r),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeCurveState=()=>{const e=this.selected.textSettings.clone();this.changeCurve(),this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:e})},this.changeCurve=()=>{let e=this.curveAmount.getValue(),t=(0,i.ZP)("text-curve").checked,s=(0,i.ZP)("text-curve-flip").checked,n=(0,i.ZP)("text-curve-spread").checked,a=document.querySelector('input[name="curve-type"]:checked').value;(0,i.ZP)("text-curve-amount").style.display="arc"!==a?"none":"block",(0,i.ZP)("text-curve-flip-label").style.display="arc"!==a?"block":"none",(0,i.ZP)("text-curve-spread-label").style.display="arc"!==a?"block":"none",this.selected.setCurve(t,a,e,n,s),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowState=()=>{const e=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("text-shadow").checked,this.shadowBlur.getValue(),this.shadowAlpha.getValue(),this.shadowColor.getHex(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})},this.cleanUp=()=>{this.font.cleanUp(),this.font=null,this.fill.cleanUp(),this.fill=null,this.backgroundColor=null,this.backgroundOffset.cleanUp(),this.textSize.cleanUp(),this.lineSpace.cleanUp(),this.letterSpace.cleanUp(),this.curveAmount.cleanUp(),this.opacity.cleanUp(),this.outlineSize.cleanUp(),this.outlineDistance.cleanUp(),this.outlineDirection.cleanUp(),this.shadowBlur.cleanUp(),this.shadowAlpha.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("text-input").removeEventListener("paste",this.paste,!0),(0,i.ZP)("text-input").removeEventListener("input",this.changeText,!0),(0,i.ZP)("text-input").removeEventListener("active",this.textActive,!0),(0,i.ZP)("text-input").removeEventListener("blur",this.textBlur,!0),(0,i.ZP)("text-align-left").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-center").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-right").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-uppercase").removeEventListener("click",this.changeUppercase,!1),(0,i.ZP)("text-background").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-punch").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-full").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-line").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-word").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-outline-punch").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-shadow").removeEventListener("change",this.changeShadowState,!1),(0,i.ZP)("text-curve-flip").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-spread").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-arc").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-circle").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-half").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-italic").removeEventListener("click",this.changeItalic,!1),(0,i.ZP)("text-bold").removeEventListener("click",this.changeBold,!1)},this.fill=new T("text-fill",new u.Z(new g.Z(255,255,255)),this.changeFill,this.previewFill),this.backgroundColor=new k.Z((0,i.ZP)("text-background-color"),void 0,this.changeBackroundColor),this.outlineColor=new k.Z((0,i.ZP)("text-outline-color"),void 0,this.changeOutlineState),this.shadowColor=new k.Z((0,i.ZP)("text-shadow-color"),void 0,this.changeShadowColor),this.font=new I(this.stage,(0,i.ZP)("text-font"),this.changeFont,this.previewFont),(0,i.ZP)("text-input").addEventListener("paste",this.paste,!0),(0,i.ZP)("text-input").addEventListener("input",this.changeText,!0),(0,i.ZP)("text-input").addEventListener("focus",this.textActive,!0),(0,i.ZP)("text-input").addEventListener("blur",this.textBlur,!0);const s={onStart:()=>{t=this.selected.textSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100};this.textSize=new o.Z("text-size",Object.assign(Object.assign({},s),{label:(0,n.Z)("size"),range:[4,100,1e3],defaultValue:60,step:[2,5],stops:[0,.4,1],labelFormat:e=>e.toString(),labelParse:e=>parseInt(e),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"size",layer:this.selected,settings:t})},onChange:this.changeSize})),this.lineSpace=new o.Z("line-space",Object.assign(Object.assign({},s),{label:(0,n.Z)("lineSpacing"),range:[-1,1],onChange:this.changeLineSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"linespace",layer:this.selected,settings:t})}})),this.letterSpace=new o.Z("letter-space",Object.assign(Object.assign({},s),{label:(0,n.Z)("letterSpacing"),range:[-.2,1],onChange:this.changeLetterSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"letterspace",layer:this.selected,settings:t})}})),this.outlineSize=new o.Z("text-outline-size",Object.assign(Object.assign({},s),{label:(0,n.Z)("size"),range:[.01,1],defaultValue:.3,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.outlineDistance=new o.Z("text-outline-distance",Object.assign(Object.assign({},s),{label:(0,n.Z)("distance"),range:[0,1],onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.outlineDirection=new o.Z("text-outline-direction",Object.assign(Object.assign({},s),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.curveAmount=new o.Z("text-curve-amount",Object.assign(Object.assign({},s),{label:(0,n.Z)("amount"),range:[-1,1],onChange:()=>this.changeCurve(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:t})}}));const a=Object.assign(Object.assign({},s),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})}});this.opacity=new o.Z("text-opacity",{defaultValue:1,label:(0,n.Z)("opacity"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.settings.opacity=e,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(e,t)=>{this.stage.history.add({type:"layerSettings",kind:"opacity",layer:this.selected,settings:Object.assign(Object.assign({},this.selected.settings),{opacity:t})})}}),this.backgroundOffset=new o.Z("text-background-offset",Object.assign(Object.assign({},s),{label:(0,n.Z)("offset"),range:[-1,1],onEnd:()=>{this.changeBackground()}})),this.shadowBlur=new o.Z("text-shadow-blur",Object.assign(Object.assign({},a),{label:(0,n.Z)("blur")})),this.shadowAlpha=new o.Z("text-shadow-alpha",Object.assign(Object.assign({},a),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("text-shadow-distance",Object.assign(Object.assign({},a),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("text-shadow-direction",Object.assign(Object.assign({},a),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,i.ZP)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-uppercase").addEventListener("click",this.changeUppercase,!1),(0,i.ZP)("text-italic").addEventListener("click",this.changeItalic,!1),(0,i.ZP)("text-bold").addEventListener("click",this.changeBold,!1),(0,i.ZP)("text-background").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-punch").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-full").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-line").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-word").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-outline-punch").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-shadow").addEventListener("change",this.changeShadowState,!1),(0,i.ZP)("text-curve").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-flip").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-spread").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-arc").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-circle").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-half").addEventListener("change",this.changeCurveState,!1)}}class F{constructor(e,t,s,n){this.resizeStart=e=>{this.d=new y.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<200?200:t)+"px"},this.populatePresets=()=>{const e=(0,i.ZP)("shape-selector-presets-ss-content");e.style.paddingTop="6px",["M 0,0 H 100 V 100 H 0 Z","m3 0h94c1.66 0 3 1.34 3 3v94c0 1.66-1.34 3-3 3h-94c-1.66 0-3-1.34-3-3v-94c0-1.66 1.34-3 3-3z","m 6,0 h 88 c 3.324,0 6,2.676 6,6 v 88 c 0,3.324 -2.676,6 -6,6 H 6 C 2.676,100 0,97.324 0,94 V 6 C 0,2.676 2.676,0 6,0 Z","m 10,0 h 80 c 5.54,0 10,4.46 10,10 v 80 c 0,5.54 -4.46,10 -10,10 H 10 C 4.46,100 0,95.54 0,90 V 10 C 0,4.46 4.46,0 10,0 Z","m 20,0 h 60 c 11.08,0 20,8.92 20,20 v 60 c 0,11.08 -8.92,20 -20,20 H 20 C 8.92,100 0,91.08 0,80 V 20 C 0,8.92 8.92,0 20,0 Z","M 0,50 C 0,0 0,0 50,0 c 50,0 50,0 50,50 0,50 0,50 -50,50 C 0,100 0,100 0,50","m80 0c11.1 0 20 8.92 20 20v80h-80c-11.1 0-20-8.92-20-20v-80h80z","m80 100c11.1 0 20-8.92 20-20v-80h-80c-11.1 0-20 8.92-20 20v80h80z","m 100,50.000001 c 0,0 -3.52,6.8 -3.52,22.281 0,15.078 -5.18,18.578 -5.446,18.75 -0.144,0.228 -3.604,5.451 -18.753,5.451 C 56.8,96.482001 50,100 50,100 c 0,0 -6.801,-3.517999 -22.282,-3.517999 -15.131,0 -18.603,-5.217 -18.752,-5.45 -0.256,-0.164 -5.448,-3.65 -5.448,-18.751 C 3.518,56.8 0,50 0,50 0,50 3.518,43.200001 3.518,27.718001 3.518,12.594 8.729,9.118 8.968,8.966 8.971,8.961 8.975,8.955 8.982,8.945 9.293,8.48 12.96,3.518 27.719,3.518 43.199,3.518 50,0 50,0 c 0,0 6.828,3.518 22.309,3.518 14.756,0 18.425,4.962 18.736,5.427 v 0 0 c 0,0 5.435,3.892001 5.435,18.773 0,15.483 3.52,22.282 3.52,22.282001 z","m 11.538461,11.538461 c 15.384615,-15.3846148 61.538462,-15.3846148 76.923076,0 15.384613,15.384615 15.384613,61.538464 0,76.923079 -15.384614,15.38461 -61.538461,15.38461 -76.923076,0 -15.3846147,-15.384615 -15.3846147,-61.538464 0,-76.923079","M 0,50 C 0,14.5 14.500003,0 50,0 85.5,0 100,14.5 100,50 100,85.5 85.5,100 50,100 14.500003,100 0,85.5 0,50","m100 50a50 50 0 0 1-50 50 50 50 0 0 1-50-50 50 50 0 0 1 50-50 50 50 0 0 1 50 50z","m7.58 76.5 8.5-5.3c1.6 2.5 3.4 4.9 5.6 7.1 2.2 2.2 4.6 4.1 7.1 5.6l-5.3 8.5c16.2 10.1 36.8 10.1 53 0l-5.3-8.5c2.5-1.6 4.9-3.4 7.1-5.6 2.2-2.2 4.1-4.6 5.6-7.1l8.5 5.3c10.1-16.2 10.1-36.8 0-53l-8.5 5.3c-1.6-2.5-3.4-4.9-5.6-7.1-2.2-2.2-4.6-4.1-7.1-5.6l5.3-8.5c-16.2-10.1-36.8-10.1-53 0l5.3 8.5c-2.5 1.6-4.9 3.4-7.1 5.6-2.2 2.2-4.1 4.6-5.6 7.1l-8.5-5.3c-10.1 16.2-10.1 36.8 0 53z","m 80.100004,19.9 c -6.2,-6.2 -13.8,-9.9999998 -21.7,-11.5999998 L 50.000004,0 l -8.3,8.3000002 c -8,1.6 -15.6,5.4999998 -21.7,11.5999998 -6.1,6.1 -10.1,13.8 -11.7,21.8 L 0,50 8.300004,58.3 c 1.6,8 5.5,15.6 11.6,21.7 6.2,6.2 13.8,10 21.7,11.6 l 8.4,8.4 8.3,-8.3 c 8,-1.6 15.6,-5.5 21.7,-11.6 6.2,-6.2 10,-13.8 11.6,-21.7 L 100,50 91.700004,41.7 c -1.6,-8 -5.5,-15.6 -11.6,-21.8 z","M 31.278462,0.01959957 C 23.186769,-0.27097901 15.000275,2.6696037 8.8346993,8.8330525 -2.1173026,19.781307 -2.8922296,37.108219 6.5404597,48.953281 c 0.2422598,0.315753 0.3671413,0.681873 0.3705912,1.047372 -0.00343,0.3655 -0.1283314,0.73162 -0.3705912,1.047373 -9.4326893,11.845059 -8.6577623,29.171972 2.2942396,40.120231 10.9610277,10.957253 28.3079167,11.724463 40.1575537,2.269882 0.309131,-0.23713 0.666341,-0.332857 1.024148,-0.330053 0.366744,0.0034 0.734111,0.110187 1.051116,0.353625 11.847133,9.426729 29.131837,8.654389 40.083427,-2.293454 10.943446,-10.939723 11.751726,-28.273568 2.341393,-40.120231 -0.242377,-0.315753 -0.367656,-0.681856 -0.370591,-1.047373 0.0034,-0.365516 0.12816,-0.731619 0.370591,-1.047372 C 102.90267,37.106616 102.09439,19.772771 91.150944,8.8330525 80.199354,-2.1147875 62.91465,-2.8871348 51.067517,6.5395994 50.750512,6.7830358 50.383145,6.8897696 50.016401,6.8932183 49.658594,6.8966464 49.301384,6.8002786 48.992253,6.5631705 43.808027,2.4268049 37.571993,0.24560339 31.278462,0.01959957 Z","m87.074 36.937h-5.1102l3.6072-3.6036c5.1102-5.1051 5.1102-13.413 0-18.619-5.1102-5.2052-13.427-5.1051-18.637 0l-3.6072 3.6036v-5.1051c-0.1002-7.3073-5.9118-13.213-13.226-13.213s-13.126 5.9059-13.126 13.113v5.1051l-3.6072-3.6036c-5.1102-5.1051-13.427-5.1051-18.637 0-5.2104 5.1051-5.1102 13.413 0 18.619l3.6072 3.6036h-5.1102c-7.3146 0.1001-13.226 5.9059-13.226 13.213s5.9118 13.113 13.126 13.113h5.1102l-3.6072 3.6036c-5.1102 5.1051-5.1102 13.413 0 18.619 5.1102 5.1051 13.427 5.1051 18.637 0l3.6072-3.6036v5.1051c0 7.3073 5.9118 13.113 13.126 13.113 7.2144 0 13.126-5.9059 13.126-13.113v-5.1051l3.6072 3.6036c5.1102 5.1051 13.427 5.1051 18.637 0 5.1102-5.1051 5.1102-13.413 0-18.619l-3.6072-3.6036h5.1102c7.3146 0 13.126-5.9059 13.126-13.113s-5.7114-13.113-12.926-13.113z","m86.987 36.903h-0.4004c-1.7017 0-2.6026-2.1009-1.4014-3.3014 4.9049-4.9021 5.5055-12.806 1.1011-18.008-5.005-6.0026-14.014-6.3027-19.419-0.90039l-0.3003 0.30013c-1.2012 1.2005-3.3033 0.40017-3.3033-1.4006v-0.10004c0-6.8029-4.9049-12.706-11.712-13.406-7.9079-0.90039-14.615 5.3023-14.615 13.106v0.40017c0 1.7007-2.1021 2.6011-3.3033 1.4006-4.9049-4.9021-12.813-5.5024-18.018-1.1005-6.006 5.0022-6.3063 14.006-0.9009 19.408l0.3003 0.30013c1.2012 1.2005 0.4004 3.3014-1.4014 3.3014h-0.4004c-7.3073 0-13.213 5.8025-13.213 13.106s5.9059 13.106 13.113 13.106h0.4004c1.7017 0 2.6026 2.1009 1.4014 3.3014l-0.3003 0.30013c-5.4054 5.4023-5.1051 14.306 0.9009 19.408 5.3053 4.4019 13.213 3.8016 18.018-1.1005 1.2012-1.2005 3.3033-0.40017 3.3033 1.4006v0.40017c0 7.7033 6.7067 13.906 14.615 13.106 6.7067-0.7003 11.712-6.7029 11.712-13.406v-0.10004c0-1.7007 2.1021-2.6011 3.3033-1.4006l0.3003 0.30013c5.4054 5.4023 14.314 5.1022 19.419-0.90039 4.4044-5.3023 3.8038-13.206-1.1011-18.008-1.2012-1.2005-0.4004-3.3014 1.4014-3.3014h0.4004c7.3073 0 13.113-5.9026 13.113-13.106 0-7.2031-5.8058-13.106-13.013-13.106z","m 50.094148,0 c -2.77536,0 -5.553405,0.64778966 -8.038073,1.9436751 -4.969341,2.5917545 -8.12526,7.3889096 -8.12526,12.5724349 v 7.453361 c 0,0.578822 -0.337936,1.109289 -0.889248,1.398692 -0.551335,0.289419 -1.220173,0.289419 -1.771503,0 L 24.103777,19.55012 C 19.134436,16.958365 13.003954,16.956091 8.034594,19.546895 3.0652529,22.138666 0,26.935805 0,32.11933 c 0,5.183526 3.0652529,9.980681 8.034594,12.572435 l 7.372024,3.909398 c 0.551335,0.289402 0.889252,0.819867 0.889252,1.398693 0,0.578822 -0.34142,1.109269 -0.892736,1.398689 L 8.017166,55.27643 C 3.047806,57.868183 0,62.696853 0,67.88038 c 0,5.183523 3.0687318,9.980663 8.0380919,12.572433 4.9693411,2.591774 11.0963441,2.591757 16.0656851,0 l 7.270897,-3.821188 c 0.551331,-0.28942 1.223686,-0.28942 1.775002,0 0.551349,0.289402 0.781158,0.816711 0.781139,1.395533 v 7.4566 c 0,5.183527 3.159398,9.98068 8.128739,12.572437 2.464461,1.285337 5.187223,1.933208 7.940444,1.943659 2.798399,0.01131 5.627343,-0.637226 8.132242,-1.943659 4.969341,-2.591757 8.031091,-7.38891 8.031091,-12.572437 L 66.069191,78.0304 c -0.0071,-0.578792 0.233307,-1.109291 0.784623,-1.398693 0.55133,-0.28942 1.220187,-0.28942 1.771518,0 l 7.270897,3.814881 c 4.969341,2.59177 11.099823,2.59177 16.069183,0 C 96.934748,77.854835 100,73.057677 100,67.874155 c 0,-5.183527 -3.065252,-9.97752 -8.034593,-12.56929 l -7.372024,-3.909398 c -0.551335,-0.289403 -0.889252,-0.816712 -0.889252,-1.395533 0,-0.578822 0.34142,-1.109274 0.892736,-1.398689 L 91.986314,44.72336 C 96.955712,42.131607 100,37.302935 100,32.11941 c 0,-5.183526 -3.065252,-9.980665 -8.034593,-12.572436 -4.96936,-2.59177 -11.099842,-2.589496 -16.069183,0.0032 l -7.166287,3.818043 c -0.55133,0.289419 -1.220168,0.289419 -1.771504,0 -0.553971,-0.290258 -0.889247,-0.819951 -0.889247,-1.398772 v -7.45336 c 0,-5.1835253 -2.971084,-9.9806804 -7.940444,-12.5724349 C 55.644069,0.64778966 52.869527,0 50.094148,0 Z","m91.1 35c-5.89-2.87-9.49-9.71-8.79-16.8 1.4-14.2-13.1-23.5-23.5-15-5.2 4.19-12.3 4.19-17.6 0-10.4-8.39-25 0.883-23.6 15 0.699 7.06-2.9 13.9-8.79 16.8-11.8 5.74-11.8 24.3 0.0999 30 5.89 2.87 9.49 9.71 8.79 16.8-1.4 14.1 13.1 23.4 23.6 15 5.2-4.19 12.3-4.19 17.6 0 10.4 8.39 25-0.883 23.6-15-0.699-7.06 2.9-13.9 8.79-16.8 11.7-5.74 11.7-24.3-0.2-30z","m3.17 48.6 11.9 12.1c2.5 2.5 3.6 6.04 3 9.57l-2.8 17.1c-1.5 8.85 7.5 15.6 15.1 11.4l14.8-8.12c3-1.67 6.7-1.67 9.7 0l14.8 8.12c7.6 4.16 16.6-2.6 15.1-11.4l-2.8-17.1c-0.6-3.54 0.5-7.08 3-9.57l11.9-12.1c6.2-6.24 2.8-17.2-5.8-18.5l-16.5-2.5c-3.4-0.52-6.3-2.71-7.8-5.93l-7.4-15.6c-3.9-8.01-14.9-8.01-18.7 0l-7.4 15.6c-1.5 3.23-4.4 5.41-7.8 5.93l-16.6 2.5c-8.5 1.25-11.9 12.2-5.7 18.5z","m32 0v32h-32v36h32v32h36v-32h32v-36h-32v-32h-36z","m34 0v34h-34v32h34v34h32v-34h34v-32h-34v-34h-32z","m36 0v36h-36v28h36v36h28v-36h36v-28h-36v-36h-28z","m38 0v38h-38v24h38v38h24v-38h38v-24h-38v-38h-24z","m100 99.9-50-35.8-49.9 35.9 35.8-50-35.9-49.9 50 35.8 49.9-35.9-35.8 50z","m100 100-50-28.8-50 28.8 28.8-50-28.8-50 50 28.8 50-28.8-28.8 50z","M 49.999984,0 C 45.722878,0 41.617373,1.6978034 38.592988,4.7221408 35.56864,7.7464783 33.8708,11.851959 33.8708,16.129017 v 10.817782 c 0,0.536631 -0.264632,1.034533 -0.708796,1.335693 C 32.71784,28.583556 32.157866,28.64491 31.659343,28.4463 28.200473,27.227976 25.094977,26.165382 21.110455,24.796091 16.086103,23.159917 10.543614,24.078997 6.3094312,27.327976 1.7398721,30.834282 -0.61368155,36.514793 0.13813101,42.225271 0.88981729,47.934817 4.6342391,52.819843 9.9542542,55.02452 l 12.8340388,4.624495 c 0.454071,0.188081 0.796007,0.570582 0.932461,1.042725 0.136616,0.47213 0.05049,0.975225 -0.233116,1.376628 l -9.469586,11.983363 c -0.0016,0.0032 -0.0032,0.0064 -0.0064,0.0097 l -0.01292,0.01612 c -3.490018,4.566738 -4.2856042,10.656816 -2.085454,15.968359 2.204181,5.32135 7.082548,9.064235 12.793085,9.816024 5.700862,0.750526 11.377026,-1.594919 14.884848,-6.149189 0.0013,-0.0016 0.0016,-0.0048 0.0032,-0.0064 l 0.01612,-0.01612 9.110474,-11.532877 C 49.02707,81.758415 49.49722,81.527221 50,81.527253 c 0.50278,-3.2e-5 0.972926,0.231162 1.278995,0.630033 l 9.110471,11.532877 0.01612,0.01612 c 0.0016,0.0016 0.0016,0.0048 0.0032,0.0064 3.507825,4.55427 9.18399,6.899717 14.884849,6.149189 5.710536,-0.751789 10.588906,-4.494674 12.793088,-9.816024 2.20015,-5.311543 1.40456,-11.401621 -2.085454,-15.968359 l -0.01292,-0.01612 c -0.0032,-0.0032 -0.0048,-0.0064 -0.0064,-0.0097 L 76.51236,62.068368 c -0.283599,-0.401403 -0.369729,-0.904498 -0.233117,-1.376628 0.136454,-0.472143 0.478394,-0.854644 0.932462,-1.042725 L 90.045743,55.02452 c 5.320019,-2.204677 9.06444,-7.089703 9.816127,-12.799249 0.75181,-5.710478 -1.601741,-11.390989 -6.171301,-14.897295 -4.191331,-3.216093 -9.664607,-4.149222 -14.648313,-2.580787 -3.387709,1.174531 -7.124923,2.472013 -10.701602,3.699111 -0.498519,0.19861 -1.058493,0.137256 -1.502657,-0.163808 -0.4442,-0.30116 -0.708832,-0.799062 -0.708832,-1.335693 V 16.129017 c 0,-4.277058 -1.697837,-8.3825387 -4.722188,-11.4068762 C 58.382588,1.6978034 54.277082,0 49.999977,0 Z","m 95.097846,4.9018824 c -6.5362,-6.5358435 -17.184353,-6.5358426 -23.720548,-1.2e-6 L 50.028804,26.249213 c -0.425617,0.425594 -1.040135,0.586638 -1.621513,0.430837 L 21.08856,19.627522 c -5.785619,-1.55016 -11.9599597,0.09643 -16.1897377,4.310702 -2.1146391,2.107408 -3.5852443,4.695818 -4.33177648,7.481767 -0.74652914,2.785944 -0.76864986,5.766964 0.009252,8.649189 0.75867638,2.810944 2.22358978,5.323667 4.19641438,7.340366 2.0728318,2.11897 4.7064751,3.690254 7.6708358,4.484488 l 28.056935,6.416262 c 0.28639,0.0767 0.547033,0.231845 0.750533,0.435477 0.209661,0.209842 0.356755,0.473669 0.435495,0.769013 l 6.418482,28.038807 c 0.78666,2.935694 2.306363,5.484426 4.3105,7.49614 4.090458,4.10683 10.194583,5.980987 16.162376,4.38201 2.921791,-0.782839 5.455367,-2.303208 7.455498,-4.308661 4.086164,-4.097795 5.946157,-10.219785 4.339911,-16.214049 l -7.0571,-27.321448 c -0.155477,-0.581682 0.0075,-1.193522 0.433183,-1.619113 L 95.097852,28.621141 c 6.536198,-6.535842 6.536198,-17.183416 3e-6,-23.7192562 z","m 66.400001,0 -16.4,16.4 L 33.600001,0 0,33.6 16.400001,50 0,66.4 33.600001,100 l 16.4,-16.4 16.4,16.4 L 100,66.4 83.600001,50 100,33.6 Z","m 19.630485,54.1 -7.3903,7.8 v 0 L 0,75 30.715935,70.7 c 3.464203,-0.5 6.928406,1.2 8.083141,4.1 l 2.309469,5.2 1.847575,4.2 v 0 l 6.928406,15.8 6.928406,-15.8 v 0 l 1.847576,-4.2 2.309468,-5.2 c 1.270208,-2.9 4.618938,-4.6 8.083141,-4.1 L 99.999999,75 87.644341,61.9 v 0 l -7.3903,-7.8 c -2.193996,-2.4 -2.193996,-5.8 0,-8.1 l 5.889145,-6.3 1.385682,-1.5 v 0 L 99.999999,25 80.715935,27.7 v 0 L 69.168591,29.3 C 65.704387,29.8 62.240184,28.1 61.08545,25.2 L 58.775981,20 56.928406,15.8 v 0 L 50,0 43.071593,15.8 v 0 l -1.847575,4.2 -2.309469,5.2 c -1.270208,2.9 -4.618937,4.6 -8.083141,4.1 L 19.284064,27.7 v 0 L 0,25 12.355658,38.1 v 0 l 1.385681,1.5 5.889146,6.3 c 2.309469,2.4 2.309469,5.8 0,8.2 z","M 50,0 30.1,30.1 0,50 30.1,69.9 50,100.00001 69.9,69.9 100,50 69.9,30.1 Z","m73 64.6c-8.69 12.7-19.4 23.3-29.9 29.5-10.4 6.23-19.7 7.55-25.8 3.68-6.09-3.87-8.48-12.6-6.64-24.3 1.84-11.7 7.75-25.4 16.4-38.1 8.69-12.7 19.4-23.3 29.9-29.5 10.4-6.23 19.7-7.55 25.8-3.68 12.7 8.07 8.3 36-9.79 62.4z","M 33.606558,75.300005 50,100 66.393446,75.300005 H 100 L 83.255273,50 100,24.7 H 66.393446 L 50.000001,0 33.606558,24.7 H 0 L 16.744731,50 0,75.300005 Z","M 85.4,14.6 62.7,19.3 50,0 37.3,19.3 14.6,14.6 19.3,37.3 0,50 19.3,62.7 14.6,85.4 37.3,80.7 50,100 62.7,80.7 85.4,85.4 80.7,62.7 99.999999,50 80.7,37.3 Z","M 93.3,25 78.3,21.7 75,6.7 60.4,11.4 50,0 39.6,11.4 25,6.7 21.7,21.7 6.7,25 11.4,39.6 0,50 11.4,60.4 6.7,75 21.7,78.3 25,93.3 39.6,88.6 50,99.999997 60.4,88.6 75,93.3 78.3,78.3 93.3,75 88.6,60.4 100,50 88.6,39.6 Z","m 93.300004,25 -21.8,3.5 3.5,-21.8 -17.1,13.9 -7.9,-20.6 -7.9,20.6 L 25,6.7 28.5,28.5 6.7,25 20.6,42.1 0,50 20.6,57.9 6.7,75 28.5,71.5 25,93.3 42.100004,79.4 l 7.9,20.6 7.9,-20.6 17.1,13.9 -3.5,-21.8 21.8,3.5 -13.9,-17.1 L 100,50 79.400004,42.1 Z","m97.5 66.2-8.94 2.39 3.67 8.47-9.25 0.188 1.53 9.1-9.03-2.02-0.701 9.2-8.28-4.12-2.89 8.76-7.05-5.97-4.91 7.82-5.41-7.48-6.64 6.42-3.46-8.56-7.99 4.65-1.3-9.13-8.88 2.6 0.927-9.18-9.24 0.419 3.1-8.69-9.08-1.8 5.1-7.7-8.38-3.91 6.8-6.26-7.2-5.79 8.1-4.45-5.6-7.35 8.94-2.39-3.67-8.47 9.25-0.189-1.53-9.1 9.03 2.02 0.7-9.2 8.28 4.12 2.89-8.76 7.05 5.97 4.91-7.82 5.41 7.48 6.64-6.42 3.46 8.56 7.99-4.65 1.3 9.13 8.88-2.61-0.926 9.18 9.24-0.418-3.1 8.69 9.08 1.8-5.1 7.69 8.38 3.91-6.8 6.26 7.2 5.79-8.1 4.45z","m 0,43.5 v 0 C 0,67.5 22.413793,87 50.000001,87 v 13 C 77.586208,100 100,80.5 100,56.5 v 0 C 100,32.5 77.586208,13 50.000001,13 V 0 C 22.413793,0 0,19.5 0,43.5 Z","M 89.108383,36.593295 C 84.406622,31.890944 78.804523,28.789393 72.902312,27.088543 L 89.108383,10.88044 c -14.505434,-14.5072533 -38.01424,-14.5072533 -52.619712,0 v 0 c -4.701762,4.702351 -7.702886,10.305152 -9.403523,16.208103 L 10.879076,10.88044 c -14.5054345,14.507253 -14.5054345,38.019007 0,52.62631 v 0 c 4.701762,4.702351 10.30386,7.803902 16.206072,9.504752 L 10.879076,89.119555 c 14.505435,14.507255 38.014242,14.507255 52.619712,0 v 0 C 68.20055,84.417204 71.301712,78.814403 73.002349,72.911452 L 89.208421,89.119555 C 103.61382,74.612302 103.61382,51.100548 89.108383,36.593295 Z","m 86.783481,22.786394 c -1.602002,-1.6008 -3.30413,-3.101551 -5.106383,-4.402201 l 5.106383,-5.102552 c -17.722153,-17.7088548 -46.357948,-17.7088548 -63.979976,0 v 0 c -1.602002,1.600801 -3.10388,3.301651 -4.405507,5.102552 l -5.106383,-5.102552 c -17.7221533,17.708856 -17.7221533,46.323164 0,63.93197 v 0 c 1.602003,1.6008 3.30413,3.101551 5.106383,4.402201 l -5.106383,5.102552 c 17.722153,17.708856 46.357949,17.708856 63.979976,0 1.602003,-1.600801 3.10388,-3.301651 4.405507,-5.102552 l 5.106383,5.102552 c 17.622029,-17.608806 17.622029,-46.223114 0,-63.93197 z","m 80.419581,19.480519 4.895104,-4.895104 C 75.724276,5.0949053 61.838162,2.4975027 49.95005,6.8931071 V 0 C 36.463537,0 24.775225,7.9920082 19.480519,19.480519 L 14.585415,14.585415 C 5.0949051,24.175824 2.4975025,38.061938 6.8931069,49.95005 H 0 c 0,13.486513 7.992008,25.174825 19.480519,30.469531 l -4.895104,4.895104 c 9.590409,9.59041 23.376623,12.087912 35.364635,7.792208 V 100 c 13.486513,0 25.174825,-7.992008 30.469531,-19.480519 l 4.895104,4.895105 C 94.905099,75.824176 97.402601,62.037962 93.106897,50.04995 H 100 C 99.9001,36.463537 91.908096,24.775225 80.419581,19.480519 Z","m 50,83.6 16.4,16.4 H 100 V 66.4 L 83.600005,50 100.00001,33.6 V 0 H 66.400005 l -16.4,16.4 -16.4,-16.4 H 0 V 33.6 L 16.4,50 0,66.4 V 100 h 33.600005 z","m 84.915847,65.690376 c -23.436956,26.022959 -34.915933,34.30962 -34.915933,34.30962 0,0 -11.478977,-8.289949 -34.915929,-34.30962 C -8.3509667,39.671797 -2.4009791,6.9318151 18.693978,1.0456555 39.788935,-4.840504 49.999914,16.043854 49.999914,16.043854 c 0,0 10.210979,-20.884358 31.306936,-14.9981985 21.09296,5.8861596 27.04495,38.6261415 3.608997,64.6447205 z","M 100,61.688 C 100,82.848 77.615954,99.999996 50.000003,99.999996 22.385351,99.999996 0,82.848 0,61.687 0,40.526 50.000003,0 50.000003,0 50.000003,0 100,40.526 100,61.688 Z","m 100,25.001 v 50 L 50,100 0,75 V 25 L 50,0 Z","M 100,0 50,10.2 1e-5,0 10.2,50 0,100 50,90 100,100 90,50 Z","m0 100 50-100 50 100z","m0 100 100-100v100z","M 100,0 0,100 V 0 Z","m0 0 5 50-5 50h100l-5-50 5-50z","m0 0 10 50-10 50h100l-10-50 10-50z","m0 0 15 50-15 50h100l-15-50 15-50z","m0 0 20 50-20 50h100l-20-50 20-50z","m0 0v100h100l-20-50 20-50z","m0 0c23.7 41.8 16.7 58.2 0 100h100l-20-50 20-50z","m26.5 13.9c14.6-16 35-18.1 52.7-6.76 4.84 3.1 9 7.46 12.6 12.3 3.26 4.33 6.16 9.19 7.45 14.7 3.35 14.4-5.42 38.7-15.3 48.4-23.5 23-53.7 19.6-84 10.8 3.13-26.4 9.79-61.1 26.5-79.4","m3.19 53.1c-8.19-17-0.2-34.3 19.3-45.1 5.34-2.95 11.5-4.95 17.9-6.35 5.74-1.27 11.8-2.08 17.7-1.36 15.4 1.85 34.4 16.8 38.8 27.9 10.6 26.5-7.45 50-30.7 71.8-23.8-11-53.7-27.5-63-46.9","m0 100c4.57-4.05 6.77-9.47 8.71-14.7 5.19-14.1 9.48-28.4 16.3-42 6.85-13.6 16.5-26.6 30.6-35.8 8.59-5.6 20.3-9.73 30.5-6.23 7.58 2.62 12.4 9.11 13.6 15.8 1.15 6.64-0.866 13.4-3.84 19.6-7.45 15.6-20.9 29.1-37.1 39.5-16.2 10.4-35.1 17.7-54.6 23","m3.91 51.1c3.56-5.47 9.6-10.5 16-15.4 16.1-12.4 34.6-24 53.1-35.7 1.52 8.55 3.05 17.1 7.16 25.5 5.33 10.8 14.9 21.1 18.6 32.1 3.66 11 0.223 23.3-16.8 31-12.8 5.82-60.8 15-66.9 9.84-13.8-11.7-19.3-34.7-11-47.4","m94 10.3s-10.9-17.6-49.1-6.77c-38.2 10.9-44.8 57.2-44.8 57.2s-3.19 40.3 25.9 39.3c29.1-1.06 51.1 1.34 62-9.8 9.64-9.85 12.1-53 12-61.2-0.261-11.8-5.98-18.7-5.98-18.7z","m81.1 15.9c-8.87-9.29-9.11-15.9-34.4-15.9-17.6-0.034-31.7 4.09-40.8 22.7-3.29 6.69-8.52 26.1-4.19 36.8 3.17 7.83 15.3 6.46 17.9 14.4 3.78 11.4-4.65 26.3 6.27 25.9 29-1.06 56.6 3.72 67.5-7.4 9.62-9.83 5.88-47.2 6.37-55.5 0.684-11.8-9.7-11.7-18.6-21z","m40 0.0297c15.9-0.0929 60-0.797 60 15.4 0 17.3-22.3 21.8-21.9 34.5 0.344 12.7 21.8 8.37 21.7 30.3-0.134 22.1-40.2 19.6-59.7 19.7-19.5 0.0859-40.1-9.01-40-50 0.113-41 24.1-49.9 40-50z","m0 25c57.3 15.3 79.9 1.05 100-25v100h-99.9z","m0 25c29.5 13.7 38.7 2.17 48.5-5.79 16.2-13.2 20.5-17.7 51.5-19.2v100h-99.9z","m0 33c24.3 1.75 24.6-9.81 40.1-9.4 13 0.345 20.7-13.5 31.6-13.4 18.6 0.219 16.5-9.65 28.2-10.2v100h-99.9z","m0 21.4c24.3 1.75 25.5 20.3 33.9 20.3 6.34-1.17e-4 6.07-16.9 17-16.8 9.18 0.0074 13.4 12 25 5.09 8.44-5 19.1-29.7 24.1-29.9v100h-99.9z","m90 40v-10l-3.6-3.6v-12.8h-12.8l-3.6-3.6h-10l-10-10-10 10h-10l-3.6 3.6h-12.8v12.8l-3.6 3.6v10l-10 10 10 10v10l3.6 3.6v12.8h12.8l3.6 3.6h10l10 10 10-10h10l3.6-3.6h12.8v-12.8l3.6-3.6v-10l10-10z","M 80.8,12 100,32.6 79.9,85.1 H 74.2 L 50,100 25.8,85.1 H 20.1 L 0,32.6 19.2,12 V 5.2 L 50,0 80.8,5.2 Z","m0.425 69.8c-0.3-0.501-0.499-1-0.399-1.6l7.59-56.4c0.2-1.2 1.3-2.1 2.6-1.9 3.2 0.3 6.19 0.501 9.09 0.501 20 0 27.3-7.51 28.6-9.01 0.2-0.4 0.499-0.701 0.899-1 0.499-0.4 1.2-0.501 1.9-0.3s1.2 0.701 1.5 1.2c1.3 1.6 8.59 9.01 28.6 9.01 2.9 0 5.99-0.2 9.09-0.501 1.3-0.1 2.4 0.701 2.6 1.9l7.59 56.4c0.0998 0.601-0.0998 1.1-0.399 1.6-0.2 0.2-4.49 5.21-12.6 11.8-7.49 6.11-19.8 14.2-36 18.4-0.2 0.1-0.499 0.1-0.799 0.1h-0.0998c-0.3 0-0.599-0.1-0.899-0.2-16.2-4.2-28.6-12.3-35.9-18.4-8.29-6.51-12.6-11.4-12.8-11.6z","m100 50c0 7.08-2.1 13.6-5.6 18.7 0.2 0.674 0.4 1.46 0.6 2.13 0 0-15 15.7-45 29.2-30.1-13.5-45-29.2-45-29.2 0.2-0.674 0.4-1.46 0.6-2.13-3.5-5.06-5.6-11.6-5.6-18.7 0-9.21 3.5-17.3 9.1-22.8-1.1-6.07-2.9-10.4-4.3-13.3-1.1-2.25-0.2-4.94 2.1-5.96 16-7.08 35-7.98 43.1-7.98s27.1 0.899 43.2 8.09c2.3 1.01 3.2 3.71 2.1 5.96-1.4 2.81-3.2 7.19-4.3 13.3 5.5 5.39 9 13.5 9 22.7z","m100 50c-2.3 4.3-5.3 8.2-8.8 11.7 1.7 2.3 2.9 4.6 3.8 6.9-2.2 1-4.8 1.7-7.6 2.2 0.1 5-0.6 9.9-2 14.6-4.6 1.4-9.6 2.1-14.6 2-0.5 2.8-1.2 5.4-2.2 7.6-2.3-0.9-4.6-2.2-6.9-3.8-3.5 3.6-7.4 6.6-11.7 8.8-4.3-2.3-8.2-5.3-11.7-8.8-2.3 1.7-4.6 2.9-6.9 3.8-1-2.2-1.7-4.8-2.2-7.6-5 0.1-9.9-0.6-14.6-2-1.4-4.6-2.1-9.6-2-14.6-2.8-0.5-5.4-1.2-7.6-2.2 0.9-2.3 2.2-4.6 3.8-6.9-3.5-3.5-6.5-7.4-8.8-11.7 2.3-4.3 5.3-8.2 8.8-11.7-1.7-2.3-2.9-4.6-3.8-6.9 2.2-1 4.8-1.7 7.6-2.2-0.1-5 0.6-9.9 2-14.6 4.6-1.4 9.6-2.1 14.6-2 0.5-2.8 1.2-5.4 2.2-7.6 2.3 0.9 4.6 2.2 6.9 3.8 3.5-3.5 7.4-6.5 11.7-8.8 4.3 2.3 8.2 5.3 11.7 8.8 2.3-1.7 4.6-2.9 6.9-3.8 1 2.2 1.7 4.8 2.2 7.6 5-0.1 9.9 0.6 14.6 2 1.4 4.6 2.1 9.6 2 14.6 2.8 0.5 5.4 1.2 7.6 2.2-0.9 2.3-2.2 4.6-3.8 6.9 3.5 3.5 6.5 7.4 8.8 11.7z","m100 50c-0.1 6.4-3.8 11.4-8.2 13.8l0.1 18.9c0 6.5-5.1 6.9-5.1 6.9-24.5 0.1-36.8 10.4-36.8 10.4s-12.3-10.3-36.8-10.4c0 0-5.1-0.4-5.1-6.9l0.1-18.9c-4.4-2.4-8.1-7.4-8.2-13.8 0.1-6.4 3.8-11.4 8.2-13.8l-0.1-18.9c0-6.5 5.1-6.9 5.1-6.9 24.5-0.1 36.8-10.4 36.8-10.4s12.3 10.3 36.8 10.4c0 0 5.1 0.4 5.1 6.9l-0.1 18.9c4.4 2.4 8.1 7.4 8.2 13.8z","m100 50c-2.6 2.8-6.3 5.3-10.7 7.5l9.2 3.8c-2 0.2-3.9 0.7-5.7 1.5 1.5 2.2 2.6 4.3 3.5 6.4-2.1 0.9-4.4 1.6-7 2.1 0.7 1.8 1.7 3.5 3 5.1l-9.2-3.8c1.6 4.6 2.4 9 2.3 12.8-3.8 0.1-8.2-0.7-12.8-2.3l3.8 9.2c-1.6-1.3-3.3-2.3-5.1-3-0.5 2.6-1.2 4.9-2.1 7-2.1-0.8-4.3-2-6.4-3.5-0.8 1.8-1.3 3.7-1.5 5.7l-3.8-9.2c-2.2 4.4-4.7 8.1-7.5 10.7-2.8-2.6-5.3-6.3-7.5-10.7l-3.8 9.2c-0.2-2-0.7-3.9-1.5-5.7-2.2 1.5-4.3 2.6-6.4 3.5-0.9-2.1-1.6-4.4-2.1-7-1.8 0.7-3.5 1.7-5.1 3l3.8-9.2c-4.6 1.6-9 2.4-12.8 2.3-0.1-3.8 0.7-8.2 2.3-12.8l-9.2 3.8c1.3-1.6 2.3-3.3 3-5.1-2.6-0.5-4.9-1.2-7-2.1 0.8-2.1 2-4.3 3.5-6.4-1.8-0.8-3.7-1.3-5.7-1.5l9.2-3.8c-4.4-2.2-8.1-4.7-10.7-7.5 2.6-2.8 6.3-5.3 10.7-7.5l-9.2-3.8c2-0.2 3.9-0.7 5.7-1.5-1.5-2.2-2.6-4.3-3.5-6.4 2.1-0.9 4.4-1.6 7-2.1-0.7-1.8-1.7-3.5-3-5.1l9.2 3.8c-1.6-4.6-2.4-9-2.3-12.8 3.8-0.1 8.2 0.7 12.8 2.3l-3.8-9.2c1.6 1.3 3.3 2.3 5.1 3 0.5-2.6 1.2-4.9 2.1-7 2.1 0.8 4.3 2 6.4 3.5 0.8-1.8 1.3-3.7 1.5-5.7l3.8 9.2c2.2-4.4 4.7-8.1 7.5-10.7 2.8 2.6 5.3 6.3 7.5 10.7l3.8-9.2c0.2 2 0.7 3.9 1.5 5.7 2.2-1.5 4.3-2.6 6.4-3.5 0.9 2.1 1.6 4.4 2.1 7 1.8-0.7 3.5-1.7 5.1-3l-3.8 9.2c4.6-1.6 9-2.4 12.8-2.3 0.1 3.8-0.7 8.2-2.3 12.8l9.2-3.8c-1.3 1.6-2.3 3.3-3 5.1 2.6 0.5 4.9 1.2 7 2.1-0.8 2.1-2 4.3-3.5 6.4 1.8 0.8 3.7 1.3 5.7 1.5l-9.2 3.8c4.4 2.2 8.1 4.7 10.7 7.5z","m91.2 25.1c5.4 6.4 8.8 15.2 8.8 24.9s-3.4 18.5-8.8 24.9v5.1c0 4-3.6 7.2-8 7.2h0.8v2.2c0 4-4.1 4.2-4.1 4.2-20 0.1-30 6.4-30 6.4s-10-6.3-30-6.4c0 0-4.1-0.3-4.1-4.2v-2.2h0.8c-4.4 0-8-3.2-8-7.2v-5.1c-5.2-6.4-8.6-15.2-8.6-24.9s3.4-18.5 8.8-24.9v-5.1c0-4 3.6-7.2 8-7.2h-0.8v-2.2c0-4 4.1-4.2 4.1-4.2 19.9-0.1 29.9-6.4 29.9-6.4s10 6.3 30 6.4c0 0 4.1 0.3 4.1 4.2v2.2h-0.8c4.4 0 8 3.2 8 7.2v5.1z","m94.6 18.3c1.8 0.1 3.6 0.2 5.4 0.2v57.4c-3.5 0.8-15.3 4.2-15.9 15.3h-7.6c-2.3 1.3-5.4 2.4-9.1 3.3-0.9 0.2-1.9 0.4-2.9 0.6 0 0-2.2 0.5-3.3 0.8-3.6 0.9-8.9 2.5-11.2 4.1-2.2-1.6-7.6-3.2-11.2-4.1-1.1-0.3-3.3-0.8-3.3-0.8-1-0.2-1.9-0.4-2.9-0.6-3.7-0.9-6.8-2-9.1-3.3h-7.6c-0.6-11.1-12.4-14.5-15.9-15.3v-57.4c1.8 0 3.6-0.1 5.4-0.2 2.9-5.3 11.8-9.2 22.4-9.2h0.4c0.1-0.3 0.2-0.6 0.2-1 0.1-1.9 1.1-2.9 2.2-2.9h8.1c2-5.2 11.3-5.2 11.3-5.2s9.3 0 11.2 5.2h8.1c1.1 0 2.2 1 2.2 2.9 0 0.3 0.1 0.6 0.2 1h0.4c10.7 0 19.6 3.9 22.5 9.2z","m100 25.5v53.9s-0.3 3.7-4 4.8l-42.4 15s-2.6 0.8-3.6 0.8-3.6-0.8-3.6-0.8l-42.4-15c-3.6-1.1-4-4.8-4-4.8v-53.9c0-1.4 1.2-2.6 2.9-2.6h4.1v-5.2c10.3-0.4 12.2-8.8 12.2-8.8h4.5c0-2.2 1.3-3.3 2.7-3.3h9.9c2.4-5.6 13.7-5.6 13.7-5.6s11.3 0 13.7 5.5h9.9c1.4 0 2.7 1.1 2.7 3.3h4.5s1.9 8.5 12.2 8.8v5.2h4.1c1.7 0.1 2.9 1.3 2.9 2.7z","m93.3 30.5c2.3 0 4.61 0.3 6.71 1v41.8c-2.1 0.6-4.41 1-6.71 1v0.1c0 3-2.61 5.4-5.71 5.4h-3.31v0.2c0 3.7-3.91 6.6-8.72 6.6-1 0-2-0.2-2.91-0.4-2.2 2.9-5.51 5.4-9.72 7.2-0.802 0.4-1.7 0.7-2.61 1 0 0-2.1 0.9-3.11 1.4-2.1 1-5.01 2.6-7.21 4.2-2.3-1.7-5.11-3.2-7.21-4.2-1-0.5-3.11-1.4-3.11-1.4-0.902-0.3-1.8-0.6-2.61-1-4.21-1.8-7.62-4.3-9.72-7.2-0.902 0.2-1.9 0.4-2.91 0.4-4.81 0-8.72-3-8.72-6.6v-0.2h-3.31c-3.11 0-5.71-2.4-5.71-5.4v-0.1c-2.3 0-4.61-0.3-6.71-1v-41.8c2.1-0.6 4.41-1 6.71-1v-0.1c0-3 2.61-5.4 5.71-5.4 0.902-13.9 17.3-25 37.5-25 20.1 0 36.6 11.1 37.7 25 3.11 0 5.71 2.4 5.71 5.4z","m95.7 52c1.1 4.6 3.2 8.8 4.3 13.4-4.9 6-14.3 5.1-21.3 8.6-3.1 1.6-5.9 4.1-9.3 4.6-1.3 0.2-2.6 0-3.8 0.3-2.2 0.5-3.9 2.3-5.5 3.9-8.1 7.9-18.1 13.8-28.9 17.2v-7.7c-1.4 1.2-2.9 2.1-4.5 2.8-0.3-3 0.1-6.1 1-8.9 0.5-1.5 1.1-2.9 1.3-4.4 0.2-2.9-1.6-5.6-3.7-7.5s-4.7-3.4-6.8-5.3c-5.5-5-8-13.4-14.8-16.5 1.2-1.8 2.2-3.8 2.8-5.9-1.6 0.3-3.2 0.8-4.7 1.6 0.9-6.2 0.3-12.5-1.8-18.3 2.4-0.4 4.8-1.4 6.8-2.8l1.6-0.3c4.9-4.9 10.2-9.4 15.8-13.5 2.4-1.7 4.9-3.4 7.6-4.5 1.9-0.8 4-1.3 6-1.9 4.8-1.5 9.3-3.9 13.4-6.9 0.4 1.3 0.7 2.5 1.1 3.8 3.7-0.6 7.4 1.4 11.1 0.9 4.1-0.5 7.9-4 11.8-2.8 0.1 1.1 0.2 2.2 0.2 3.3 2-0.3 3 2.2 3.6 4.1 2.5 7.1 9.4 11.5 14.7 16.7 1.6 1.5 3.1 3.3 3.4 5.4 0.5 2.7-1.3 5.7-4 6.5 1.4 0.2 2.8 0.4 4.2 0.6-2.7 3.7-2.7 8.9-1.6 13.5z","m96.8 69.2c0.5 4.5 0.6 9.3 3.2 12.8-2.2 1.6-4.1 3.6-5.6 5.9-0.2-0.8-0.5-1.5-0.7-2.3-0.1 1.8-1.6 3.1-3.1 3.6-1.6 0.5-3.2 0.4-4.8 0.5-2.5 0.2-5 1-7.2 2.3-2 1.2-3.8 2.9-5.8 4-2 1.2-4.4 1.9-6.6 1.1 0.1-1.3 0.1-2.5 0.2-3.8-0.9 2-3.6 2.8-5.3 1.6-0.3 0.6-0.7 1.3-1 1.9-11.4 1.9-23.1 2.2-34.5 0.8 0.2-0.7 0.5-1.3 0.7-2-4.3 3.8-10.2 4.2-15.8 4.4 1.7-1.8 2.7-4.4 2.7-7 0-3.1-1.3-6-2.4-8.9-1.9-4.4-3.2-9.1-4.2-13.8-0.8-0.7-1.8-1-2.9-1 0.6-0.6 1.2-1.2 1.8-1.7-0.7-0.5-1.2-1.2-1.5-2 1.6-5 1.6-10.4 0-15.2-0.7-2.1-1.7-4.1-2.2-6.2-1.1-4.8 0.2-9.8 1.4-14.6 0.5 0 1 0.1 1.4 0.1-0.8-1.3-1.1-3-1.5-4.5-1-5.5-2-10.9-3.1-16.3 3.5 0.2 6.9-0.1 10.3-0.7 0.5 0.6 0.9 1.2 1.4 1.7l0.2-3.2c2.7-0.9 5.3-1.8 8-2.7 2.9-1 5.9-2 9-2.3 2.5-0.2 5.2 0 7.1-1.7 0 0.4-0.1 0.7-0.1 1.1 5-1.1 10.3-0.5 15.1 1.6 0 0.6 0.1 1.1 0.1 1.7 0.9-1.3 2.6-1.5 4-1.2 1.4 0.4 2.7 1.2 4 1.9 6.3 2.8 13.5 0.2 19.9-2.2 0.5-0.2 1.1-0.4 1.6-0.2s0.9 0.9 0.6 1.4c0.9-0.2 1.8-0.4 2.8-0.7-0.1 0.4-0.2 0.9-0.3 1.3 2.3 3.3 4.5 6.7 6.7 10.2 1.3 2 2.5 4.1 3.2 6.4 0.6 2 0.9 4.2 1.1 6.3l1.2 11.1c0.3 3 0.1 6.9-2.5 7.8 0.5 0.2 1.1 0.4 1.6 0.7-1.4 0.2-2.3 1.7-2.3 3.2-0.1 1.5 0.4 2.9 0.9 4.3 1.6 4.6 2.7 9.5 3.2 14.5z","m96.3 27.7c1.2 0.1 2.4 0.1 3.7 0.2-1.2 0.9-1.6 2.6-1.9 4.2-0.599 3.1-1.1 6.2-1.7 9.3-0.599 3.3-1.2 6.6-0.999 9.9 0.2 3 0.899 5.9 1.2 8.8 0.3 3 0 6.1-1.6 8.5 0.799 0.1 1.5 0.3 2.3 0.4-0.699 1.4-1.7 2.6-2.8 3.5 2.5 1.3 2.6 4.9 2.7 7.9 0.0999 5.2 1.1 10.5 2.8 15.4-1.7-0.1-3.1 1-4.7 1.6-1.3 0.5-3.2 0.5-4-0.6-2.1 0.7-4.1 2-6.29 1.8-1.4-0.1-2.7-0.8-4.1-1.2-1.9-0.7-4-0.9-5.99-0.6-1.4 0.2-2.9 0.6-4.3 0.2-1.4-0.4-2.5-2.1-1.9-3.5-0.599 0.7-0.899 1.7-0.699 2.6-3.4-0.4-6.89 0.2-9.99 1.9-0.2-0.8-0.3-1.6-0.5-2.4-0.4 0.7-0.799 1.3-1.2 2-0.699-1.2-1.4-2.4-2.1-3.6-0.2 1.1-0.4 2.1-0.599 3.2-4.3-1.8-8.89 1.7-13.6 2-2.7 0.2-5.39-0.7-8.09-0.7-2.5 0-4.9 0.9-7.39 1.3-2.5 0.4-5.19 0.2-7.19-1.5-0.3-0.9-0.599-1.7-0.899-2.6-0.999 0.7-1.8 1.7-2.3 2.8-3.7-0.3-7.39 0-11 0.8 0.4-6 0.4-12 0-18-0.2-2.5-0.5-5.2-2.2-6.9 1.1-0.2 2.2-1 2.7-2.1-1.2-0.1-2.4-0.1-3.7-0.2 1.2-0.9 1.6-2.6 1.9-4.2 0.599-3.1 1.1-6.2 1.7-9.3 0.599-3.3 1.2-6.6 0.999-9.9-0.2-3-0.899-5.9-1.2-8.8-0.3-3 0-6.1 1.6-8.5-0.799-0.1-1.5-0.3-2.3-0.4 0.699-1.4 1.7-2.6 2.8-3.5-2.5-1.3-2.6-4.9-2.7-7.9 0.0999-5.4-0.899-10.6-2.6-15.5 1.7 0.1 3.1-1 4.7-1.6 1.3-0.5 3.1-0.5 4 0.6 2.1-0.7 4.1-2 6.29-1.8 1.4 0.1 2.7 0.8 4.1 1.2 1.9 0.7 4 0.9 5.99 0.6 1.3-0.1 2.8-0.5 4.2-0.1 1.4 0.4 2.5 2.1 1.9 3.5 0.599-0.7 0.899-1.7 0.699-2.6 3.4 0.4 6.89-0.2 9.99-1.9 0.2 0.8 0.3 1.6 0.5 2.4 0.4-0.7 0.799-1.3 1.2-2 0.599 1.2 1.3 2.4 2 3.6 0.2-1.1 0.4-2.1 0.599-3.2 4.3 1.8 8.89-1.7 13.6-2 2.7-0.2 5.39 0.7 8.09 0.7 2.5 0 4.9-0.9 7.39-1.3 2.5-0.4 5.19-0.2 7.19 1.5 0.3 0.9 0.599 1.7 0.899 2.6 0.999-0.7 1.8-1.7 2.3-2.8 3.7 0.3 7.39 0 11-0.8-0.4 6-0.4 12 0 18.1 0.2 2.5 0.5 5.2 2.2 6.9-1.1 0.1-2.1 0.9-2.7 2z","m0.0122 12.5c-0.2-2.4 2.1-4.3 4.5-4.8 0.5 0 0.901-0.0999 1.4-0.0999v-1.1c2.7-0.999 5.4-2.1 8.11-3.3 0.6 0.699 1.1 1.5 1.7 2.2-0.1-0.899-0.2-1.8-0.3-2.7 3.7-0.899 7.51-1.8 11.2-2.7 0.5 0.799 1 1.7 1.5 2.5 0-1.6 2.4-1.8 4.1-1.6 8.51 1.1 17.1 0.999 25.5-0.3 0.701 0.799 1.2 1.7 1.5 2.7 1.7-2.8 6-2.8 9.51-2.5 9.71 0.899 19.3 1.8 28.9 2.7-0.6 5.49-0.5 11.2 0.4 16.8-1 0.4-1.9 0.899-2.9 1.3 0.801 0.3 1.6 0.699 2.4 0.999-0.6 7.09-1.1 14.1-1.7 21.2-0.1 0.999-0.1 2 0.2 2.9 0.2 0.599 0.6 1.1 0.801 1.7 0.2 0.599 0.2 1.3 0.1 1.9-0.1 2.3-0.2 4.5-0.4 6.79-0.701 0.799-1.3 1.7-2 2.5 0.901 0 1.6 0.999 1.7 1.9 0 0.899-0.3 1.7-0.5 2.5-0.2 0.999-0.1 2 0 2.9 0.3 4.3 0.701 8.49 1 12.8 0.2 2.9 0.701 6.19 3.2 7.99 0.2 2.3-2.1 4.2-4.5 4.7-0.5 0.0999-0.901 0.0999-1.4 0.0999v1.1c-2.7 0.999-5.4 2.1-8.11 3.3-0.6-0.699-1.1-1.5-1.7-2.2 0.1 0.899 0.2 1.8 0.3 2.7-3.7 0.899-7.51 1.8-11.2 2.7-0.5-0.799-1-1.7-1.5-2.5 0 1.6-2.4 1.8-4.1 1.6-8.51-1.1-17.1-0.999-25.5 0.3-0.701-0.799-1.2-1.7-1.5-2.7-1.7 2.8-6 2.8-9.51 2.5-9.61-0.899-19.2-1.7-28.8-2.6 0.6-5.49 0.5-11.2-0.4-16.8 1-0.4 1.9-0.899 2.9-1.3-0.801-0.3-1.6-0.699-2.4-0.999 0.5-7.09 1.1-14.2 1.7-21.2 0.1-0.999 0.1-2-0.2-2.9-0.2-0.599-0.6-1.1-0.801-1.7-0.2-0.599-0.2-1.3-0.1-1.9 0.1-2.3 0.2-4.5 0.4-6.79 0.701-0.799 1.3-1.7 2-2.5-0.901 0-1.6-0.999-1.7-1.9 0-0.899 0.3-1.7 0.5-2.5 0.2-0.999 0.1-2 0-2.9-0.3-4.3-0.701-8.49-1-12.8-0.3-3-0.801-6.29-3.3-7.99z","m0.0295 73.1c-0.3-5.51 1.7-11 5.5-15 0.8-0.801 1.6-1.6 2.1-2.5 0.5-0.901 0.6-2 0.7-3 0.4-4 0.7-8.11 1.1-12.1 0.1-0.601 0.1-1.2 0.5-1.6 0.4-0.4 1.2-0.4 1.4 0.1-0.6-0.801-0.2-2 0.2-3 3.5-7.61 7.7-14.8 12.4-21.7 0.3 0 0.7 0 1 0.1 3.3-3.9 5-9.21 4.5-14.3 4.2 2.6 9.2 4 14.2 3.9 1.5 0 3.4 0.2 3.7 1.6 3.1 0.4 6.3 0.4 9.3 1 10.2 1.9 18.6 8.71 26.6 15.2 1.1 0.901 2.3 2.2 1.7 3.5 0.4-0.4 1-0.5 1.5-0.2v3.3c4.7-0.1 9.4 1 13.6 3.2-8.1 9.61-12.3 22.4-11.6 34.9-2.1-0.4-4.3-0.801-6.4-1.2 1.3 1.4 2.6 2.8 3.9 4.2-3 1.8-3.5 5.91-4.2 9.31-0.7 3.4-2.9 7.51-6.4 7.21-0.1 0.701 0.3 1.5 0.9 1.8-0.6 0.2-1.2 0.5-1.8 0.701 0.5 1.1 1.1 2.2 1.6 3.3-3.1 1.9-5.4 4.8-6.6 8.21-4.2-4.4-10.2-7.01-16.3-7.11 0.2-0.801 0.4-1.6 0.6-2.4l-1.7 0.801c-4.9-1.5-10-2.5-15.1-3-0.1-0.601-0.2-1.2-0.4-1.8-1.2-0.3-2.1-1-3.2-1.6-4.3-2.4-9.8-1.9-14.1-4.4-0.1-0.4-0.1-0.801-0.2-1.2-0.4 0.3-0.8 0.701-1.2 1-0.7-1.7-2.9-1.9-4.7-2.4-2.3-0.701-4.2-2.3-6.3-3.5-2-1.3-4.5-2.2-6.8-1.3z","m1.43 45.4c-0.3-0.5-0.7-0.9-1.2-1 1.6-0.9 0.9-3.5 0.999-5.4 0-1.6 0.7-3.1 1.4-4.5 2.1-4.6 4.3-9.2 6.4-13.7 0-0.6-0.0999-1.1-0.0999-1.7 0.999 0.9 2.4-0.4 3.2-1.5 4.6-6.4 12.5-9.4 17.4-15.5 0.7 0.1 1.3 0.5 1.7 1.1 0.4-1.1 1.6-1.7 2.7-1.8 1.1 0 2.3 0.4 3.4 0.6 5.7 1.2 11.9-1.9 17.2 0.7 2.9-1.8 6.4-3.4 9.6-2.4 0.7 0.2 1.4 0.5 2 0.9 5 2.5 10.1 5 14 9.1 0.9 0.9 1.7 2.2 1.4 3.4 0 0.1-0.1 0.2-0.1 0.3 1.2 0.9 2.7 1.3 4.2 1.1 0.1 0.5 0.2 1 0.2 1.6l1.1-0.5s0.6 1.1 1.2 2.1c2.3 1.4 4.3 3.2 5.9 5.3-0.2 0.4-0.4 0.9-0.7 1.3 1.1-0.4 1.9 1 2.2 2.1 1.1 4.4 1.7 9 1.7 13.5 0 2-0.1 4.1 0.6 6 0.5 1.4 1.5 2.6 2 4.1 0.5 1.5 0.2 3.4-1.2 4 0.3 0.5 0.7 0.9 1.2 1-1.6 0.9-0.9 3.5-0.999 5.4 0 1.6-0.7 3.1-1.4 4.5-2.1 4.6-4.3 9.2-6.4 13.7 0 0.6 0.1 1.1 0.1 1.7-0.999-0.9-2.4 0.4-3.2 1.5-4.6 6.4-12.5 9.4-17.4 15.5-0.7-0.1-1.3-0.5-1.7-1.1-0.4 1.1-1.6 1.7-2.7 1.8-1.1 0-2.3-0.4-3.4-0.6-5.7-1.2-11.9 1.9-17.2-0.7-2.9 1.8-6.4 3.4-9.6 2.4-0.7-0.2-1.4-0.5-2-0.9-5-2.5-10.1-5-14-9.1-0.9-0.9-1.7-2.2-1.4-3.4 0-0.1 0.1-0.2 0.1-0.3-1.2-0.9-2.7-1.3-4.2-1.1-0.1-0.5-0.2-1-0.2-1.6l-1.1 0.5s-0.6-1.1-1.2-2.1c-2.3-1.4-4.3-3.2-5.9-5.3 0.2-0.4 0.4-0.9 0.7-1.3-1.1 0.4-1.9-1-2.2-2.1-1.1-4.4-1.7-9-1.7-13.5 0-2 0.0999-4.1-0.6-6-0.5-1.4-1.5-2.6-2-4.1-0.5-1.4-0.2-3.4 1.2-4z","m95.4 51c2.1 2.9 3.7 6.4 4.6 10-1 1.1-2 2.1-3 3.2 0.3 0.6 0.5 1.2 0.8 1.8-1.4 3-4.2 3.9-6.8 4.9-5.8 2.3-11 6.3-15.2 11.8l0.3-2.4c-7.5 4.1-15.3 7.4-23.4 9.8-0.1-0.7 0.1-1.3 0.4-1.7-4.1 1.5-8.2 3-12.2 4.5-3.7 1.4-7.6 2.9-10.3 6.2 0.4-0.8 0.6-2 0.4-3.2-2.1-0.2-4-3-5.5-5.7-3.3-6-5.9-12.6-8.4-19.1-1.1-2.8-2.1-5.6-3.2-8.4-1.8-4.8-3.7-9.6-4.7-14.5-0.7-4.2-1.5-9.5-4.5-11.6l0.9-4.2-1.7 2 0.3-2.2s-0.4-1-1.7-2.3c-1.3-1.4-2.5-3.3-2.5-3.3s5.2-2.7 7.9-3.8 4.5-3.5 4.5-3.5c4.7-3.5 9.4-6.9 14.1-10.4 0.4 0.9 0.8 1.8 1.2 2.8 1.6-1.9 4-2 6.3-2.3 6.3-0.9 12.1-3.7 16.9-8.3 1.6 2.5 3.9 1.1 5.3-0.5 0.2 0.6 0.5 1.2 0.7 1.8 4.9-0.8 9.7-1.6 14.6-2.4-1.4 0.3-2.5 1.7-2.8 3.6 2.1-1.6 4.7-2.5 7.4-2.6 1.3 2.7 2.4 5.7 3 8.7 0.8 0 1.5 0.1 2.3 0.1 0 2.4 0.8 5 1.6 7.4l1.5 4.5c1.6 4.7 3.1 9.4 5.3 13.7 1.6 3.2 3.7 6.6 3.8 10 0 0.9-0.1 1.8 0.1 2.8 0.4 1.1 1.1 2 1.7 2.8z","m99.9 48.4c0.1 1.6 0.2 3.1-0.1 4.7-0.3 1.4-1.1 2.8-1.5 4.2-0.4 1.4-0.5 3.1 0.5 4.2-1.1 0.699-2.2 1.4-3.3 2.1-0.3 0.2-0.7 0.4-0.9 0.799-0.3 0.5-0.2 0.999-0.2 1.5 0.1 1.4-0.2 2.8-0.8 4.1-1.1 2.6-2.3 5.19-3.4 7.79-0.2 0.5-0.6 1.1-1.2 1.1-0.3 0.999-0.7 2-1 3h-1.3c0.1 0.999-0.8 1.9-1.8 2.4-1 0.4-2.1 0.599-3.1 0.999-3.1 1.1-5 4.2-7.4 6.49-0.4 0.4-0.9 0.799-1.4 0.699-0.4 0-0.8-0.3-1.2-0.4-1-0.3-2 0.5-2.5 1.3-0.5 0.899-0.7 1.9-1.2 2.7-2.3 3.4-8.2 1.5-11.6 3.9-0.4-0.4-0.9-0.899-1.3-1.3-2.1 0.799-4.4 1.3-6.7 1.4-0.9 0-2.3-0.4-2.1-1.3-5.1 0-10.2 0.0999-15.2 0.599-0.8 0.0999-1.6 0.0999-2.2-0.3-0.5-0.3-0.8-0.799-1.3-1.2-1.1-0.799-2.8-0.3-3.9-1.1-1-0.699-1.2-2.2-2.3-2.6-1.4-0.4-3.1 1.3-4.1 0.3-0.1-0.5-0.2-0.999-0.3-1.5-2.2-2.8-4.4-5.49-6.5-8.29-1.2-1.5-2.3-3-3.3-4.6-1.2-2.1-2-4.4-3.3-6.39-0.6-0.999-1.4-2-1.8-3.1s-0.2-2.5 0.7-3.3c-0.6-0.0999-1.2-0.3-1.5-0.799-0.2-0.3-0.2-0.599-0.2-0.899-0.2-2-0.3-4-0.5-5.99-0.1-0.899-0.1-1.7-0.2-2.6-0.1-1.8-0.3-3.7-0.4-5.49-0.1-1.4-0.2-3 0.1-4.5 0.3-1.4 1.1-2.8 1.5-4.2 0.4-1.4 0.5-3.1-0.5-4.2 1.1-0.699 2.2-1.4 3.3-2.1 0.3-0.2 0.7-0.4 0.9-0.799 0.3-0.5 0.2-0.999 0.2-1.5-0.1-1.4 0.2-2.8 0.8-4.1 1.1-2.6 2.3-5.19 3.4-7.79 0.2-0.5 0.6-1.1 1.2-1.1 0.3-0.999 0.7-2 1-3h1.3c-0.1-0.999 0.8-1.9 1.8-2.4 1-0.4 2.1-0.599 3.1-0.999 3.1-1.1 5-4.2 7.4-6.49 0.4-0.4 0.9-0.799 1.4-0.699 0.4 0 0.8 0.3 1.2 0.4 1 0.3 2-0.5 2.5-1.3 0.5-0.899 0.7-1.9 1.2-2.7 2.3-3.4 8.2-1.5 11.6-3.9l1.3 1.3c2.2-0.799 4.4-1.3 6.7-1.4 0.9 0 2.3 0.4 2.1 1.3 5.1 0 10.2-0.0999 15.2-0.599 0.8-0.0999 1.6-0.0999 2.2 0.3 0.5 0.3 0.8 0.799 1.3 1.2 1.1 0.799 2.8 0.3 3.9 1.1 1 0.699 1.2 2.2 2.3 2.6 1.4 0.4 3.1-1.3 4.1-0.3l0.3 1.5c2.2 2.8 4.4 5.49 6.5 8.29 1.2 1.5 2.3 3 3.3 4.6 1.2 2.1 2 4.4 3.3 6.39 0.6 0.999 1.4 2 1.8 3.1 0.4 1.1 0.2 2.5-0.7 3.3 0.6 0.0999 1.2 0.3 1.5 0.799 0.2 0.3 0.2 0.599 0.2 0.899 0.2 2 0.3 4 0.5 5.99 0.1 0.899 0.1 1.7 0.2 2.6 0.1 1.6 0.2 3.4 0.4 5.29z","m0.00116 75.7c0.794 0.0537 1.95-0.858 2.66 0.148 0.617 0.87 0.424 1.62 1.12 1.62 0.181 4.22 2.61-1.6 2.98 1.98 0.0294 0.286-0.998 2.08-1.07 2.24 0.239-0.53 1.7-0.122 2.03-0.13 0.695-0.0188 1.27 0.938 1.46 2.15 0.0106 0.0685 0.727 0.909 0.851 1.12 0.555 0.948-0.436 0.907 0.914 1.4 0.245-0.0013 0.491-0.0027 0.736-0.0027 0.0642-0.0362 0.0963-0.23 0.0966-0.58 1.86-0.46 3.67-0.393 5.4 0.58 2.51 1.41 4.86 2.46 7.33 4.1 6.07 4.04 12.2 4.33 18.7 5.85 3.57 0.834 8.17-0.4 12-1.11 4.13-0.76 8.34-3.88 12.5-2.25 3.08 1.2 6.23 3.67 9.46 4.56 3.03 0.84 6 4.31 9.1 1.7 0.714-0.6 1.55-1.83 2.24-2.3 0.449-0.303 1.13 0.205 1.56-0.608 0.456-0.852 0.654-2.3 1.07-3.53 0.34-1.01 1.14-0.795 1.36-1.74 0.372-1.62 0.0865-3.46 0.194-4.99-0.0355 0.503 0.221-3.28 0.191-2.69 0.061-1.2 0.481-1.82 0.412-3.21-0.112-2.27-2.02-3.95-1.85-6.65-0.22 0 0.752 0.248 0.602-0.98-0.24-1.96-1.63-2.75-2.1-3.11 0.088-2.07 0.393-0.599 0.756-1.4-0.782-3.91 2.58-2.79 2.91-2.69 0.167 0.0497 2.63-0.0752 2.55-0.957-0.0659-0.732-0.698-0.514-0.605-1.97 0.502 0 2.29 0.677 2.62-0.856-0.157-1.3-1.83-1.7-1.58-3.4 0.405-2.75 2.6 1.68 3.04-1.59 0.261-1.96-0.338-3.61-0.693-4.99-0.148-0.579-0.412-1.43-0.568-2.02-0.188-0.715-0.688-0.506-0.802-1.4 0.329-3.24 2.08 0.768 2.34-2.43-0.22-1.15-1.79-1.06-2.19-1.43-0.831-0.756-1.34-1.51-2.11-2.43-0.853-1-1.71-2.74-2.61-4.01-2.94-4.15-5.83-6.53-8.97-8.18-1.19-0.623-3.29-0.0564-4.26-4.09-0.52-2.17-0.603-5.55-1.23-7.51-0.556-1.76-1.19-2.3-1.78-3.06-2.06-2.66-4.28-2.91-6.46-3.37-2.25-0.474-4.36-1.86-6.45-2.39-5.64-1.42-10.6-4.15-16.3-4.15 0-2.92 0.419-2.48-0.315-4.09-0.344-0.756-0.747-0.444-1.18-0.584-0.465-0.15-0.624-0.474-1.12 0-0.332 0.314-0.611 0.468-0.952 0.584-0.438 0.149-0.843 0.768-1.46 0.591-0.691-0.197-1.14-0.0537-2.03-0.00537-2.05 0.11-3.94-0.699-6.17-0.585-1.36 0.0711-2.58 1.75-3.87 3.24-0.536 0.626-0.966 1.54-1.51 2.02-0.656 0.577-1.01 1.28-1.51 2.19-2.16 3.91-5.25 0.153-7.65 0.153-2.13 0-4.15 0.0738-6.17 1.17-1.44 0.777-2.75 1.93-4.13 3.21-0.51 0.471-1.11 0.98-1.58 2.05-0.12 0.274-0.503 0.129-0.591 0.881-0.324 2.74 0.255 1.98 0.562 2.93-2.86e-4 1.58-2 4.52-2.18 4.96-0.445 1.06-1.32 3.54-1.81 5.47 0.0436 1.82 1.06 0.149 1.37 0.76 0.614 1.2-0.197 2.12-0.113 2.81 0.113 0.929 0.445-0.132 0.606 0.66-0.434 2.04-1.49 1.28-1.72 3.36-0.0386 0.357 0.957 0.949 0.961 0.969 0.46 2.4-0.261 2.01-0.266 2.93-0.0151 2.49-0.298 1.17 0.405 1.17 0.353 0 3.5-1.66 3.68-0.0564 0.379 3.24-1.06 4.04-1.52 4.45-0.824 0.74-1.27 1.01-1.97 1.97-0.541 0.74-0.69 1.63-1.07 2.79-0.399 1.21-1.3 1.84-1.6 3.29-0.191 0.94 1.23-0.168 1.35-0.168 0 2.7-1.61 3.82-1.6 3.9 0.152 1.15 0.18 2.76-0.0223 4.6-0.384 3.48-0.785 1.83-1.47 3.78-0.915 2.6 0.0226 2.84-0.0274 5.46-0.0194 1.01-0.813 3.89-0.915 3.88 0.33 0.0215-0.0241-0.0013 0 0","m100 7.43c-0.651-5.63-2.08-5.19-3.24-5.89-2.07-1.25-4.59-1.75-6.56-1.01-2.2 0.822-5.24 1.38-7.41 0.999-3.69-0.639-7.04 1.32-10.9 1.38-3.25 0.0474-6.06-1.07-9.76-2.14-8.09-2.34-16.4 1.23-24.6 3.52-9.76 2.72-19.7 7.64-29.6 9.64-1.23 0.25-5.05-2.64-5.32 5.82-0.184 5.87 0.561 0.52 1.16 4.5 0.662 4.42-0.517 4.54-0.962 5.53-1.76 3.9 0.133 11.4-1.42 14.8-0.612 1.32-1.42 0.566-1.39 5.69 0.021 3.28 0.782 2.97 0.782 5.67-0.291-0.757-0.502-0.624-0.635 0.402 0.251 1.36 0.511 1.32 0.787 1.95 0.243 0.55 0.655 0.493 0.892 1.09 0.373 0.945 0.466 2.51 0.844 3.41 1.07 2.54 2.22 1.6 3.19 4.85 0.154 0.517 0.402 0.446 0.53 1.05 0.298 1.4 0.195 3.11 0.602 4.42 0.621 2 1.68-0.432 2.26 1.43 0.316 1.01 0.331 3.82 0.528 5.24 0.262 1.89 0.629 3.64 1.02 5.09 1.41 5.25 3.3 7.68 5.04 7.59 0.756-0.0395 1.9-0.139 2.68 1.36 0.384 0.74 0.793 1.99 1.23 2.74 1.85 3.17 3.87 3.46 6.01 3.46 1.94-0.0032 3.84-0.588 5.62-3.17 1.17-1.71 2.49-3.92 3.8-4.4 3.83-1.39 7.85-2.01 11.7-0.694 1.23 0.422 2.51-0.463 3.67 0.678 0.641 0.629 1.18 1.73 1.85 2.15 1.84 1.18 3.59 0.267 5.27-1.45 2.87-2.95 6.19-3.79 9.05-5.47 1.51-0.885 3.27 1.87 4.96 1.27 1.62-0.575 3.61-1.58 5.33-2.68 1.39-0.888 2.64-2.79 3.99-4.13 0.787-0.783 2.88-2.24 3.24-6.43-0.024 0.283-0.611-0.939-0.618-2.33-0.044 0.098 0.846-1.58 0.844-1.58 0.888-0.727 1.28-0.636 1.84-2.74 0.628-2.37 0.484-3.14 1.35-4.13 0.286-0.326 2.23-0.977 2.33-1.86 0.301-2.7-1.03-2.65-1.16-3.29 0.258-2.1 2.48-1.7 0.91-3.81-0.39-0.52-1.03-0.648-1.5-0.675-0.13-0.0079-1.17 1.37-1.3 0.667-0.629-3.22 0.665-3.06 0.774-4.13 0.323-3.15-0.292-4.5-0.0602-6.19 0.192-1.4 1.39-0.498 1.74-0.689 0.723-0.383 3.74 1.08 4.23-2.98 0.0784-0.65-2.48-1.74-2.78-1.84-1.32-0.446-2.83-0.953-4.11-2.06 0.0563-0.759 0.477-2.36 0.583-2.76 0.921-3.48 0.296-0.0237 1.16-0.715 0.218-0.174 0.645-1.27 0.865-1.48 0.0739-0.0711 0.637 0.0016 0.58 0.0427 0.664-0.47 1.25-0.688 1.45-3.33 0.192-2.56-0.386-4.71 0.318-6.92 0.197-0.62 0.795-0.413 0.875-0.683 0.226-0.771 0.311-2.67 0.445-3.19 0.434-1.68 0.948-4.87 1.61-5.76 1.06-1.42 5.42 1.08 5.42-5.81-0.0482-0.419 0 0.161 0 0","m99.8 53.3c-0.222-0.982-0.895-2-1.24-2.87-0.525-1.31-1.29-0.933-1.64-2.44 0.694-2.46 0.261-4.17-0.359-5.33-0.468-0.879-1.03-0.394-1.51-1.15-0.357-0.564-0.291-1.79-0.667-2.33-0.409-0.58-2.02-0.415-2.14-2.28-0.153-2.47 1.58-0.537 1.8-1.87 0.458-2.77-2.47-4.29-2.74-4.49-0.839-0.633-1.81-0.889-2.65-1.69-0.266-0.254-0.474-3.08-0.84-1.47 0.0506 0.58 0.521 1.49 0.0823 2.03-0.119 0.148-1.45-0.529-1.55-1.14-0.658-3.83 1.4-2.91 1.59-3.72-0.515-1.76-0.969-0.0568-1.32-0.542-0.525-0.727-1.07-2.89-1.6-3.8-1.33-2.31-2.82-2.93-4.34-4.73-1.07-1.26-2.92-3.32-4.08-3.61-0.178-0.0449-0.744 0.978-0.846 0.923-0.155-0.0872-0.399-1.6-0.502-1.69-0.91-0.842-1.98-0.533-2.74-0.57-3.36-0.165-7.59-3.2-10.8-4.7-1.4-0.645-2.38-2.73-3.94-2.74-0.945-0.00793-1.42-1.72-2.51-1.29 0.137-0.0529-0.391 0.595-0.261 0.576-0.581 0.0846-1.03-0.905-1.64-1.18-0.539-0.247-1.66-1.45-2.22-1.08-0.463 0.299-0.293 2.06-0.969 2.27-0.198 0.0608-0.0637-1.16-0.231-1.29-0.277-0.213-0.676-0.345-1.03-0.337-0.202 0.00529-1.18 0.0806-1.37 0.234-6e-3 0.00529-0.523 1.1-0.463 1.09-0.504 0.131-1.43-0.387-2.21 0.221-0.276 0.217-0.447 1.2-0.76 1.22-0.267 0.0172-0.371-1.42-1.11-1.14-0.446 0.173-1.61 0.597-2.02 1.15-0.53 0.708-0.251 1.85-0.845 2.3 0.163-0.124-1.07-1.08-1.11-1.08-1.11-0.156-2.29 1.98-3.45 1.94-3.43-0.13-7.31-1.43-11-1.43-3.81-0.00529-7.57-0.776-11.1 4.62-1.58 2.42-2.7 7.8-3.59 14.1-0.674 4.77-1.51 6.14-2.69 8.35-1.21 2.29-2.44 4.54-3.43 8.04-0.237 0.833-0.178 2.94-0.391 3.45-0.342 0.831-0.921-0.0753-1.25 1.19-0.9 3.49 0.334 4.96 0.334 8.6-1.23 0-2.06 4.43-2.35 8.95-0.348 5.51 0.0015 7.11 0.391 11.8 0.48 5.75 0.197 10.7 1.99 9.21 0.259-0.211 0.577-1.04 0.75-1.15 1.03-0.645 1.28 1.5 2.19 1.39 1.67-0.21 3.55 1.13 5.29 0.866 0.465-0.07 1.01-0.152 1.59-0.529 0.935-0.604 1.04-0.0476 1.95-0.0013 1.01 0.0502 2.05-0.703 3.12-1.15 0.525-0.219 0.377-1.12 1.07 1.85 0.312 1.35 0.795 4.22 1.13 4.95 1.28 2.83 3.7 0.615 4.95 0.601 2.27-0.0251 4.41-0.519 6.6-1.07 4.14-1.05 7.82 2.27 11.7 5.16 7.2 5.42 15.2 6.73 22.2 4.62 2.2-0.662 4.52-0.765 6.68-1.73 0.374-0.168 0.922 0.176 1.17-0.555 0.285-0.83 0.0248-2.91 0.483-3.36 0.237-0.234 0.38 2.55 0.34 2.49 0.289 0.386 0.559 0.531 0.906 0.843 0.439 0.395 1.52 0.533 1.82-0.575 0.295-1.07 0.0634-4.08 0.274-4.94 0.723-2.96 0.749 1.29 0.899 2.06 0.231 1.19-0.717 6.43 1.24 3.45-0.0542 0.0833 0.936-1 0.586-1-0.102 0.0013 0.0368-1.3 0.194-1.24 0.0703 0.0238 0.626 1.96 0.804 2.19 0.32 0.414 1.43 0.514 1.74-0.225 0.641-1.55 0.382-3.17-0.261-3.17 0-7 0.472 1.02 0.652-3.17 0.122-2.85-0.465-1.27-0.261-4.18 0.275-3.93 1.14-3.1 1.3 0.447 0.0431 0.956-0.688 8.19-0.315 9.78 0.245 1.05 2.91 0.379 3.2-0.806 0.519-2.11-0.047-4.61 0.434-6.15-0.191 0.608 0.924 1.41 0.952 1.4 0.323-0.141 0.514-1.34 0.855-1.83 0.163-0.233 0.644-0.233 0.863-0.406 0.0838-0.0661 0.111-1.22 0.201-1.39 0.328 1.31 1.56-0.0952 1.95-1.17 0.394-1.09 0.311-3.01 0.782-4.6 0.317-1.07 0.976-0.829 1.37-1.17 0.387-0.33 1.48-1.45 1.69-2.57 0.902-4.65-1.65-1.13-0.458-6.64 0.539-2.49 1.11-1.13 1.55-1.46 0.102-0.074 0.737-1.9 0.987-1.99 0.349-0.115 1.65 1.93 1.3-2.06-0.447-5.15-5.27-0.843-4.06-11.4 0.0844-0.732-0.581-1.11-0.626-1.24 0.0087-0.0793 0.53-2.4 0.518-2.37 1.12-2.61 0.42-0.43 0.782 1.77 0.223 1.36-0.268 2.09 0.391 2.31 0.0583 0.0198 0.622 0.141 0.759-1.05 0.0464-0.403-0.513-1.73-0.0634-3.17 0.0906-0.289 0.308 0.572 0.477 0.48 0.239-0.13 0.742 0.634 0.977 1.44 0.351 1.2 0.488 2.54 0.912 3.17 0.327 0.48 1.43 0.552 0.849-2.03","m100 70.7c-2.05 0-4.47 0.583-6.74 0.583 0-1.06 0.507-2.47 0.691-3.05 0.278-0.868 0.751-0.65 1.1-3.23 0.106-0.793-0.298-1.88 6.31e-4 -3.3 0.178-0.848 0.477-1.02 0.616-1.51 0.178-0.619 1.88-4.67 0.484-4.67 0.0935-2.19 1.85-1 1.79-3.05-0.0199-0.669-4.63-1.03-5.09-1.03 0-2.4 1.23 0.0067 1.38-1.17 0.198-1.55-1.84-1.14-2.06-1.95 0.197-2.48 0.21 0.257-0.149-2.51 1.22-4.87 2.85-2.24 4.26-5.72-0.437-1.63-1.96 0.699-2.52 0.844-1.01 0.263-3.25 1.45-3.93-1.45 0.341-1.51 2.38-0.835 2.45-1.67 0.173-1.94-2.49 0.438-2.59-2.13 0.214 0.276 0.347-1.78 0.195-2.33 0.187 0.677-1.11 0.0415-1.02-1.17 0.222 0.415 0.361 0.224 0.417-0.575 0.0032-1.22-1.49-1.76-1.65-1.76 0-3.02 3.1-4.72 3.56-4.96 0.847-0.457 1.96-1.24 2.76-1.46 0.385-0.103 0.961-0.513 1.24-0.583 0.507-0.129 0.96 0.197 1.39-0.462 0.238-0.363-0.0464-1.29-0.154-1.29 0-0.69 1.19-3.27 1.38-3.5 0.583-0.717 1.61 0.536 2.05-1.42-0.231-1.12-2.6-0.844-2.98-0.915-1.03-0.198-1.96-0.0737-2.9-0.584-1.78-0.958-3.47-1.18-5.24-2.33-2.94-1.91-5.92-4.57-9.01-5.84-3.49-1.43-7.1-2.5-10.6-3.36-3.93-0.955-8.13-2.83-12.2-3.06-5.69-0.319-11.1 0.304-16.6 0.581-3.54 0.18-7.63-0.19-11.1 1.75-6.74 3.72-13.8 3.03-20.6 8.16-1.03 0.785-6.54 6.35-4.41 12.3 0.323 0.894 0.957 0.67 1.18 1.46 0.164 0.592 0.653 4.39 0.622 5.54-0.0515 1.88 0.235 0.908-0.162 2.92-0.104 0.527-0.92-0.596-1.01 0-0.355 2.33 1.09 1.17 1.38 1.17 0 2.75-1.41 0.604-1.63 2.54-0.0281 0.253 3.11-1.18 2.81 2.48-0.174 2.15-1.44-1.28-1.71 1.01-0.042 0.351 1.37 1.12 1.49 0.974-0.0164 0.435-2.6 1.17-2.89 1.17-0.0591 0.839 0.425 1.5 0.553 1.95-0.0733 3.26-1.97-1.13-1.35 3.89 0.429 3.44 1.44 1.54 2.03 3.22-0.466 2.72-0.449 0.758-0.358 4.36 0.0426 1.68 0.826 0.379 0.131 2.93-0.331 1.21-1.79 1.21-2.32 1.16-0.837-0.0831-1.74-1.01-2.41 0.86-0.0983 0.275-0.437 1.73-0.478 2.06-0.0822 0.683-0.0551 4.04 0.136 4.66 0.265 0.87 0.81-0.186 1.03 0.583 0.541 1.88-0.039 3.51 0.213 5.25 0.131 0.906 0.861 3.81 1.02 4.67 0.125 0.651 0.453 1.91 0.626 2.97 0.238 1.46 0.149 2.49 0.453 3.64 0.538 2.03 1.36 2.26 1.95 4.22 0.445 1.48 0.55 2.45 1.08 4.05 0.662 2-0.197 2.02 1.07 2.53-6e-3 -0.0027 0.195-1.08 0.231-1.06 0.559 0.212 3.32 2.34 3.26 2.61 0.155 0.892 0.545 0.0603 0.545-0.868 0.676 0 1.29 1.43 1.99 1.75 0.307 0.142 0.547-0.367 0.973 0.591 0.194-0.938 1.37 0.549 1.71 0.573 0.666 0.0469 2.56 1.51 3.07-0.482-0.758 2.95 1.86 1.32 1.74 1.35 0.549-0.161 2.53-1.01 2.67 0.311 0.365-1.47 2.73-1.46 3.31-1.76 0.889-0.457 1.8-0.135 2.48-0.587 1.19-0.792 2.3 0.0335 3.3 0.583 0.626 0.346 2.18 0.36 2.63-0.683 0.648-1.48 0.0287-0.238 0.737 0.1 0.689 0.328 0.977 0.0188 1.55-0.106 1.88-0.407 4.11-0.421 5.81-0.478 2.13-0.071 4.71 0.647 6.88 0.584 1.07-0.0322 1.83-0.41 2.81 0 1.04 0.433 2.14-0.644 3.13-0.584 5.39 0.33 10.9 0.381 16.8-0.587 2.62-0.427 6.2-0.0094 8.72-0.0107 0.85 0 8.17 1.09 8.17 0.0147 0-0.486-1.84-1.2-1.95-1.17-0.326 0.0804-0.779 0.439-1.41 0.0871-0.554-0.312-1.19-0.411-1.74-0.382-0.263 0.0147-0.815 0.494-1.16 0.296-0.233-0.135-0.509-0.922-0.673-1.07-0.243-0.221-0.278 1.36-0.504 1.07 0.0322-0.528-0.0136-0.916-0.138-1.17 0.103-2.21 5.93-0.615 6.33-0.583 0.311 0.0241 0.637-0.506 1.01-0.513 0.649-0.0121 0.9-0.0027 1.6 0.21 1.37 0.417 2.85 0.0322 4.46-0.281 0.237-0.0456 4.69-4.83 3.85-7.59h-1.03c0-1.62 1.2-14.6 1.1-14.6","m99.8 27.2c-0.424-0.0797-0.901-1.76-1.28-1.76-0.0254-0.33 0.808-0.982 0.404-2.11-0.397-1.11-1.84-0.423-2.35-0.769-0.287-0.195-2.4-1.19-2.38-2.05 0.119-4.51 4.61 0.485 5.05-1.76-0.514-2.13-1.48-1.4-2.22-1.4 0-2.22-0.403-0.361-0.741-1.46 0.108-0.187 0.156-0.47 0.143-0.849-2.96 0-5.81-0.985-8.67-2.31-1.33-0.613-1.89-5.22-3.39-6.39-3.09-2.42-6.15-4.62-8.99-5.32-1.56-0.383-3.24-1.37-4.67-0.994-1.83 0.485-4.04 1.03-6.09 0.575-1.37-0.306-2.96 0.595-4.48 0.692-1.35 0.0849-3.17 0.0782-4.62 1.57-0.657-2.53-1.6-0.296-2.15-0.236-1.02 0.111-1.63-0.305-2.63 0.245-1.36 0.752-3.14-0.602-4.48 0.0265-2.85 1.33-5.73-0.886-8.82 0.172-0.96 0.327-2.28 1.17-3.65 1.57-0.969 0.286-1.54 0.786-2.34 1.18-0.906 0.448-1.86 0.774-2.76 1.42-6.35 4.57-12.9 0.22-19.3 2.04-1.44 0.407-2.84 0.504-4.23 1.13-0.909 0.408-2.44 0.445-3.27 2.03-1.68 3.19 0.00137 6.81 0.649 10.4-0.0999 0.356-0.431 1.02-0.45 1.5-0.127 3.19 0.348 0.693-0.247 2.84-0.813 2.94-1.29 0.578-0.799 6.14 0.057 0.644 0.623 4.2 0.568 5-0.0522 0.753-0.505 1.81-0.488 1.57-0.0302 0.448-0.346 0.577-0.379 0.847-0.221 1.82 0.364 2.24 0.443 3.53 0.163 2.64 0.143 2.63 0.304 4.58 0.0288 0.353 0.521 5.02 0.47 4.67 0.123 0.836 0.735 3.34 0.73 4.02-0.0203 2.57 0.0831 0.391-0.542 0.79-0.572 0.365-1.49-2.76-1.98-0.338-0.417 2.06 0.251 3.04 0.422 4.38 0.247 1.94 0.716 4.08 0.749 6.3 0.0079 0.501-0.509 3.08-0.445 4.13 0.113 1.86 0.653 2.33 0.957 3.38 1.27 4.37 2.27 6.22 3.94 7.01 0.985 0.467 2.03 0.865 2.98 1.8 0.335 0.33 0.0755 1.96 0.419 2.24 0.185 0.155 1.84 0.0529 1.96 0 0.973-0.473 1.68-0.429 3.02 0 0.721 0.23 1.76 1.53 2.52 1.74 1.07 0.286 2.79-0.28 4.1-0.0066 0.216 0.0451 0.91-0.214 1.09 0-0.0436-0.0528 0.766 1.35 0.56 1.45-0.232 0.112 1.25 0.115 0.593-0.831 0.443 0.642 0.0642-0.735 0.666 2.29 0.268-0.352 0.396-0.936 0.384-1.75 0.223-0.0663 0.658 2.37 1.01 2.31 0.663-0.111 1.17-6.31 2.14-2.55-0.36 1.22-0.833 1.77-0.453 3.71 0.117 0.601 1.43-0.676 1.64-0.576 1.24 0.585 1.59 5.08 1.72-0.383 0.0199-0.836-0.982-0.239-0.272-2.02 0.525-1.32 0.395-0.719 0.799 1.12 0.569 2.59 0.118 2.87 0.848 3.49 0.0663 0.057 0.949-0.649 1.25-0.472-0.0052-0.0025 0.26 2.24 0.413 2.31 0.188 0.0918 0.629-1.18 0.783-1.73 0.286-1.02-0.0464-4.08 0.449-2.6 0.0965 0.289-0.0481 2.58-0.125 2.22 0.0797 0.38 0.0563 2.5 0.125 2.69h0.965c0.232-1.6 0.458-1.5 0.678 0.298 0.405 0.108 0.552 1.13 1.05-0.559-0.147-1.06-0.854-3.78 0.148-3.78 0.136 2.1-0.369 1.94 0.338 4.04 0.393 1.17 0.889 2.45 1.37 0.66 0.498 1.41 0.217 1.33 0.801 0.727 0.142-0.147 0.75-2.14 0.931-1.97 0 4.1 2.17 2.04 2.54 2.01 0.249-0.0162 1.56 0.803 2.32 0.874 2.12 0.195 4.63-1.38 6.58-1.76 4.35-0.857 8.64-4.07 12.7-8.08 2.22-2.2 4.46-2.95 6.75-4.69 0.975-0.738 2.14-1.78 3.19-2.22 1.01-0.425 2.19-0.238 3.16-1.46 0.674-0.85 1.01-2.23 1.63-2.59 0.341-0.196 0.247-0.028 0.559-0.578 0.325-0.573 0.145 1.83 0.712 0.569 0.217-0.484-0.0793-2.04 0.186-2.38 1.11-1.43 2.27-2.56 3.33-3.39 1.89-1.47 3.37-1.6 4.87-3.95 0.511-0.795 1.15 0.0663 1.88-0.682 0.08-0.0807 0.778-1.77 0.794-1.83 0.236-0.955-0.325-1.44-0.19-2.05 0.323-1.46 0.823-1.7 1.16 0.121-0.147 0.336-0.196 0.819-0.146 1.45 1.8 0 0.349-0.581 0.475-1.54 0.399-3.04 1.5 2.23 0.921-3.07-0.0776-0.707-0.819 0.336-0.798-1.16 0.023-1.57 0.87-1.57 0.875-1.52-3.43e-4 -0.0016-0.379-0.86-0.426-0.789-0.0367 0.0554 0.6-0.859 0.748-1.15-0.0295 0.0597 0.538 0.578 0.509 0.578 0.531-1.15-0.379-1.15-0.359-1.15 0-5.03 0.0604-0.135 0.443-2.61-1.07-4.54 2.74-1.35 2.55-3.74 0.0384-0.735-1.46-1.12-1.58-1.17-0.464-0.222-1.29 0.0766-1.71-0.561-0.331-0.501-0.167-2.18-0.434-2.89-0.167-0.444-0.764-0.573-0.912-0.573-0.0494-0.639 3.26-3.61 3.74-6.35 0.528-3.01-0.161-1.63-0.0978-2.89 0.133-2.63 0.383-0.765 0.981-3.13-0.197-0.795-0.733 0.349-0.733-1.49 0.699 0 0.584-2.56 1.02-3.23 0.346-0.529 1.93 0.978 2.11 0.028-0.07-0.271-0.14-0.542-0.21-0.814-0.0488-0.0082 0.07 0.272 0 0","m56.2 0.033c-6.56 0.319-13 1.11-19.5 2.25-5.03 0.299-9.75 2.39-14.7 3.09-4.09 0.76-8.61 0.178-13 1.04-1.22-2.13-2.78-8.81-5.88-3.41-0.677 4.57-2.49 8.64-2.05 13.3-0.451 9.45-1.52 18.9-1.1 28.4 0.228 7.65 0.318 15.3 0.623 22.9 0.363 4.12 0.337 8.49 1.06 12.4-0.0369 4.8 0.938 9.31 1.75 13.9 0.288 2.65 2.83 8.99 4.56 3.44 2.76-1.65 1.7-5.79 4.37-7.23 0.56-4.09 3.84-0.429 6.06-2.14 2.53 2.05 2.02-5.08 3.28-0.435 2.17-1.26 5.36-3.26 7.12-3.59 1.78-0.77 1.23 0.454 1.6-0.802 0.711 1.66 3.54 1.4 3.93 3.88-0.111-6.19 3.06 3.77 6.73 0.248 3.28 3.78 3.05-3.14 3.7-2.48 3.85-1.51 1.84-6.81 4.16-8.85 0.721 2.38 3.3 3 4.14 0.157 0.731 6.1 3.22-5.43 4.25 0.361 1.78-0.333 2.99 3.12 4.79 0.705 1.9 2.58 5.1 0.637 6.91 2.42 0.591-2.83 0.996 2.83 1.58 0.163-0.0621 3.73 3.64 3.93 3.73-0.178 0.303 1.65 0.703 4.36 1.63 1.21 1.47 3.36 3.43-1.4 3.28 3 1.25 1.4 1.13 2.21 2.44 1.29 1.48 0.725 0.975 1.98 1.91 0.0674 0.336 0.999 0.806-1.03 1.94 0.968 1.41-1.29 1.98 0.987 3.4-1.59 1.13 1.5 2.08 3.72 2.1 2.14 2.22 2.55 2.52-4.81 3.06-6.76 2.32-2.21 0.624-5.66 0.466-8.57 0.17-1.77 1.25-3.32 1.08-5.19 0.619-0.635 1.08 1.06 1.04-1.83 0.513-1.47-0.667-3.65 1.21-5.57-0.537-2.93-0.601-7.87 0.796-7.23-0.682-1.42-1.9-2.1-0.372-3.44 0.642-1.35-0.373-3.97 1.42-3.17-0.289-4.17 0.257-7.83 0.167-12-0.456-4.06-0.163-7.74-0.734-12.1-0.691-3.19 2.33-8.31-1.81-10.1-2.59-1.64-7.45-4.76-8.93-4.68-4.01-0.18-9.63-4.07-12.9-2.21-2-3.23-7.51-1.74-10.9-3.1-2.82-0.278-5.66-0.531-8.49-0.64","m99.9 59.9c-0.429-4.47-0.0208-8.78-1.82-12.8-3.51-4.83 4.14-9.21 0.0086-14.4-2-3.02 3.77-5.44 0.34-7.9 0.494-0.405 0.665-4.2-1.1-3.48-0.446-2.97-4.58-1.1-3.65-5.85-0.691-3.24-2.44-6.98-4.15-7.98-2.1-1.3-2.98-0.0809-5.09 0.394-1.55 1.89-3.26 2.22-5.16 1.69-1.63-0.518-3.75 0.667-4.78 0.566-2.67-0.49-4.87-0.175-7.08 2.25-3.03-0.327-2.67-8.46-6.19-9.93-1.97-3.78-5.31-2.72-7.74-0.973-2.85 0.63-4.4 4.33-6.57 5.6 0.531 2.94-2.6 2.41-1.63 5.27-0.697 1.57-1.07 3.8-2.57 4.01-0.43 0.445-2.1 2.7-2.5 3.19-1.28 0.245-3.51 1.67-3.47 0.213 1.15-1.07-2.13-0.0342-1.28 0.685-1.64-2.25-2.77-3.92-3.85-4.75-0.204 1.99-3.21-1.12-2.73-3.03-0.394-2.08-1.98-0.629-2.93-2.09-1.85 0.617-2.35-2.39-4.13-2.2-2.29-2.49-0.997 2.36-2.6 0.848-3.69-1.58 3.2-0.901-0.826-1.9-1.39-0.0212-2.12-2.89-2.41-1.48 1.28 1.14 0.165 2 1.64 2.31 0.995 3.29-2.34-0.449-3.55-1.63-0.874-0.598 2.09-0.28-0.0556-1.22-2.17 0.249-5.21-2.49-6.77-1.79-0.53-0.149-1.73 2.25-2.9 2.83-1.8 0.753-2.27 4.57-2.74 6.74 1.07 0.208-2.14 2.69-0.139 3.32-1.68 0.0341-1.04 6.3-1.46 8.25 0.00219 2.17-0.114 4.42 0.225 6.19 0.677 2.54 1.3 3.07 2.59 5.42 1.55 3.05 5.97 1.74 8.6 2.5 0.0223-1.58-3.25-0.0475-4.74-2.5-0.0458-0.298 0.105-1.68-0.224-2.45 1.45 0.536 4.37 0.187 0.951-0.121-1.61-0.444 0.726-1.06 0.343-2.19 2.84 0.364-1.46-3.11 1.41-1.01 0.239-0.745 2.54 0.93 2.45-0.0821-1.93-3.05 2.42 2.4 1.49 0.0405 0.337-1.54 2.62-0.292 3.67-0.272 1.85 0.0829 2.43 0.202 3.98 0.76-0.0615 0.618 4.33 1.47 0.663 3.43-3.07 1.17-5.25 3.19-8.23 5.11-2.81 2.09-5.65 5.13-6.71 9.26-1.05 4.27-3.19 8.41-2.01 12.5-0.482 2.44 1.32 4.39-0.938 5.97-2.67 3.49 3.93 6.97 1.12 8.63-0.752-0.662-2.34 4.31-3.1 6.72-0.875 0.844-0.966 4.32-1.08 6.66-0.522 3.04 1.13 6.87 1.43 6.14-0.344 2.44 1.89 3.56 2.78 4.37 2.95 0.334 5.14-0.012 7.96-0.3 1.02-0.116 7.99-0.679 4.58-1.12-1.9 0.568-2.99 0.0635-5.06 0.801-1.98-0.0719-4.46 0.428-6.1-0.464-0.796 0.74-1.37-4.01-0.198-2.79 2.25 1.83-1.25-2.48 1.87-1.7 2.83-1.14 4.91 0.361 7.29-1.18 1.92-0.779 1.23 2.38 3.34 1.57 1.86-1.03 4.08-0.352 5.76-1.37 1.4 1.48-2.71 1.81-1.91 2.31-0.927 1.28 1.61-0.304 1.95-0.506 1.23-0.0631 3.46 0.0403 1.56 1.08-1.62-0.0129-2.25 0.632-3 1.03 2.68 0.946 7.52-1.75 10.8-3.01 2.65-1.18 5.1-3.02 7.15-5.06 2.36-5.25 5.56-0.448 8.86-0.121 1.37-1.21 2.66-1.1 4.4-1.55 0.0892-2.14 2.74-0.396 2.11-0.787-0.0946-1.83 0.691-1.11 1.92-1.52 2.09-0.0898 4.48 1.08 6.41 2.77 0.362-1.34 0.846 2.11 1.13-0.268 0.968 1.25 3.49 3.2 3.65 5.21 1.01-1.45 3.64 1.9 4.08-0.694-0.271-2.53 0.909-6.22 1.15-8.6-0.134-3.46-0.858-9.05-2.99-11.5 0.199-4.15-5.82-5.99-4.68-8.3 1.36 0.976 6.53 3.06 6.34 2.09-2.25-1.37 2.82 0.187 3.62-0.395 2.17 0.514 2.34-0.687 4.81 0.371 2.47-0.21 3.34 0.831 5.7-0.0719 1.08 0.698 2.23-0.448 3.18 1.26 3.06 0.249 2.31 4.17 5.36 0.16 1.82 0.597 1-1.72 2.12-2.56 0.35-0.647 1.28-2.82 1.43-2.46 0.562-0.194 0.836-1.5 0.614-2.24","m99.8 79.3c-1.23 1.28-2.8 1.6-2.71-2.33-0.874 2.34-1.77-2.61-0.384-1.35-0.913-2.54-2.97-0.585-1.54 1.35-0.496-1.88-4.34-1.08-1.8-3.3-0.392-2.5 2.06-5.51 0.458-7.36 2.23 0.0233-1.16-3.53 1.66-3.13 0.976-4.27 1.61-7.65 2.54-10.9-0.918-1.03 0.492-4.21-0.889-3.83 1.26-2.54-1.66-1.5-0.197-4.16-0.239-4.15-0.939-7.77-1.87-11.8-1.58-7.17-5.22-10.5-8.2-15.2-1.74-2.23-5.4-4.65-6.26-5.48-0.845-1.88-2.96-1.74-4.16-3.92-0.963-1.67 1.65 3.7-0.523 0.815-1.12-2.24-2.85 1.85-2.98-2.14-1.31-1.61-4.23-3.32-5.55-1.8-1.35-3.46-3.65-0.563-5.08-2.75-1.37 0.15-1.43 0.812-3.27 0.0912-0.8-0.479-3.38-4.46-3.03 0.259-1.56 0.0992-2.49-3.03-3.33 0.506-1.32-0.386-2.76-2.34-3.8-2.61 1.48-0.779-3.9 0.356-0.338 0.951-1.41 0.994-2.97-2.17-1.86 1.46-1.74 0.622-5.09-1.66-2.91-1.2-1.4-2.06-1.98 1.32-3.26-1.26-0.679-0.164 0.482 2.12-1.26-0.0521-0.111 2.63 3.46 2.95 1.05 3.72-0.366 2.68-2.17-7.37-2.62-1.92 3.35 5.38-5.4 2.82-0.71 2.85 1.03-0.871-0.364-0.422 0.205-1.98-1.71 1.42-3.3 1.78-3.02-0.928-0.314 0.993-2.58-0.631-3.25 1.06-1.36-1.31-3.83-0.359-4.09 1.87 0.109 2.08-4.2 1.16-1.38 1.87-0.768 3.09-2.3 0.448-2.59 1.81-0.0473-3.64-2.18-2.31-0.257-0.0301-0.4 2.61 0.264 4.08-1.29 1.17-1.11 1.41-3.49-1.06-3.28 2.56-1.32 0.226-2.8-2.86-3.12 2.33-0.132-5.07-1.49 0.898-3.15-1.67-1.97 1.34-0.959 5.64-2.79 3.3-1.45 1.59-2.56 2.9-0.0603 1.39 0.498 3.59 3.38-2.18 1.75 1.61-1.73 0.89-3.63-0.669-4.79-0.0128-0.534 1.76 0.746 0.52-1.52 2.29-1.55 2.33-0.801 3.98-2.57 5.16 1.49 2.66 0.664 1.18 1.96 0.066 0.434 2.2-0.976 5.15-0.955 2.48-3.51-4.16 1.35 4.45-2.06 2.94-0.618 1.66 1.58-0.0786 0.436 2.27-1.8 4.07-1.17 9.35-0.621 14 0.402 2.92-0.0393 3.11 0.497 3.64-0.331 2.66 0.431 3.91 0.22 6.05 0.719 0.111-1.02 2.41 0.871 4.3-0.0436 3.58 0.613 6.96 2.21 9.59 2.35 1.7 3.41 4.1 5.51 4.43 1.39 5.72 5.4 7.3 8.07 10.4 2.82 3.17 6.86 4.01 9.36 6.34 1.84 0.142 3.4 1.4 4.74 1.79 1.58 0.552 2.87-0.366 2.07 1.17 2.6-0.306 3.43 1.66 6.02 1.37 2.78 1.87 6.31 1.85 9.12 1.73 2.8 2.46 4.38-1.47 6.07 0.698 3.54-0.298 7.35-0.155 11-1.52 2.47-0.667 5.1-1.55 7.58-1.95 1.75-0.981 3.32-0.539 5.03-0.831 2.11-0.536 3.45-1.66 4.62-1.14 1.99-2.58 4.23-0.53 6.26-3.67 0.324 2.76 3.77-2.67 4.44-1.66 0.644-1.53 1.18-3.73 1.15-1.54 1.53 8.08e-4 -0.0866-2.07 2.03-2.28 0.463 1.49 3.36-3.95 2.43-5.98","m64.2 0.539c-3.04 1.13-4.28 1.48-7.29 2.16-2.93 0.926-5.25-0.384-6.34 3.44-0.19 2.45-1.8 3.55-3.03 6.32 0.108 3.53-5.56 3.56-2.35 1.79-2.19-2.65-6.04-3.21-9.46-3.61-3.18 0.962-5.72 1.02-7.97 2.44-2.01 1.05 1.32 1.78-1.55 2.46 0.234 4.66-4.92 2.17-7.55 4.76-2.35-0.93-5.47 1.08-4.9 1.17-1.32-0.158 1.23 3.18-1.62 2.75-1.76 1.03-4.26 2.49-2.67 3.79-2.22 1.65-3.12 5.44-4.02 9.36-1.42 3.27 0.484 7.57-1.55 9.1-0.778 3.13 0.0511 6.82-0.816 8.38 0.33 1.07-0.709 2.21-0.265 3.18-2.15 0.906 0.318 3.89-0.247 4.91-1.03 3.9-0.923 5.95-1.73 8.36 0.35 1.94 0.102 5.22-0.347 6.91-1.12 2.26 1.43 6.21-0.447 6.94 0.0358 3.06 2.24 1.14 1.15 3.73 1.52 2.36 2.73 3.76 5.62 6.23 0.927 0.525 4.32 4.39 7 4.89 1.62-1.38 3.94-3.44 5.19-6.32 2.59-0.889 5.01 2.84 6.32 1.6-0.752 1.86 3.63 0.13 4.68 2.69 0.384 0.0568 1.7-1.95 1.51-0.607-2.51 2.91 3.17 1.17 2.3 0.963-0.257 2.72 3-0.793 3.03 0.11 1.77-0.129 0.96-2.42 2.31-0.695-0.726-0.685 1.65-3.56 1.86-1.19-0.799-3.27 2.71-5.48 3.01-8.76-1.44-0.786-8.22 1.44-2.83-0.345 2.9-0.209 4.13-0.42 5-2.82 2.54 1.85 4.65 3.55 6.86 4.37 1.83-1.33 1.82 0.143 1.01 1.35 3.12-2.09-1.13 1.54 2.65 0.572 2.27 2.39 4.95 1.27 7.51 0.842 1.54-1.6 3.05-0.883 3.72-3.58-0.856-0.757 2.88 0.329 2.85-2.42 0.71-2.56 4.67-2.24 3.75-3.73 1.09-0.163 2.86-4 4.19-1.51-0.912 1.37-3.02-1.52-2.18 1.38 2.59 0.157 2.94-3.7 5.31-3.46 0.195-0.817 1.5 2.01 0.332-0.81-3.65 0.277-0.695-3.85 0.926-1.84 1.51-1.34-0.182-2.91-1.26-1.47-3.11-0.966 2.58-1.69 3.22-2.65 0.724-0.837-3.99-0.537-1.15-1.43 0.207-0.0239 2.33-2.25 0.396-2.21 1.75-1.03 0.404-2.77 3.06-1.65-2.13-1.35 4.25-1.89 0.951-3.16 2.05 0.115 0.407-1.17 1.51-2.55-1.23-1.97-0.913-2.48 0.164-3.68-3.58-1.14 3.32-3.83 0.162-0.809 1.43 1.04 2.96-3.68-0.242-2.09-0.637-0.992 4.45-0.246 0.689-1.5 2.7-2.59-2.1-0.753 0.177-3.6 1.07-1.15 2.59-1.79 2.61-3.95-0.219-1.26 0.806-4.08 0.025-4.69 1.09-0.882 1.92-1.99 2.06-3.32 0.889-0.326-0.453-2.78 1.45-1.56-1.42-2.04 0.433-2.61-0.0815-4.94 2.65-1.48-2.48-2.36 1.4-2.28 1.12-1.01 2.32-4.78 1.59-5.76 1.2-1.01-3.05-1.28-0.352-2.6-0.95-0.331-2.6-0.781-0.343-1.39-1.22-3.04-2.16 1.36-2.79-1.89 0.717-0.51-2.24 0.659-1.16-0.68-1.36 1.93-4.2-1.53-2.41 1.45-1.39-1.07-3.78 0.856-1.96-2.22-1 0.261-2.11 1.78-4.01 1.33-2.63 1.47-3.27 0.8-6.2 1.05-1.86-0.919-0.729 1.95-3.33 0.295-4.17 1.08-1.6-5.9-2.7-8.54 0.219-2.95-1.7-5.27-4.39-5.74 0.0318-1.12-0.108-0.55 0.847-2.61-0.53-2.2-3.05 2.19-4.21-0.651-0.985 1.5-1.5-1.46-2.61 0.229z","m97.3 57.2c-3.41 0-4.74-6.08-8.05-6.1-1.29-0.795-3.87-0.991-2.73-2.24-0.461 0.105 4.07-1.76 2.58-2.95-0.276 0.0469-1.66-4.4-1.88-1.47-1.36-0.391-1.07-2.36-1.27-1.62-1.62 0.0399 8.03-1.15 6.51-0.797-1.78 0.597-1.31-1.57-2.35-2.4-0.458 0.327-4.94-0.923-1.01-0.854-0.831-1.1-0.472-1.75 0.0586-4.04 0.533-1.89-2.5 0.207-0.825-1.39-0.89-1.75-1.09-0.904-1.57-3.06-1.16-0.951-1.78-1.03-2.84-1.14 2.11 0.151-0.32-2.08 1.08-1.45 0.421-0.661 8.25-3.23 7.96-4.94-1.57-1.95-1.71-0.0456-3.1-3.81 0.665 3.54-0.192 0.654-0.944-0.899-0.654-1.49-1.36-3.11-2.92-4.35-1.19-2.92-0.257 2.7-1.65-0.177-0.363-2.09-3.08 0.626-1.6-1.95 0.915-1.38 5.96-7.76 6.92-5.41-1.84-0.314 0.0411-0.555-1.4-2.01-2.65-0.62-0.587-2.27-2.83-1.94-0.891-1.13-0.313-0.513-0.368-1.36-1.07-1.02-1.2-1.36-1.13 0.396-1.83-0.483-2.44-0.812-3.45-0.308-2.32-0.0102-9.13-0.462-12-0.359-0.581 0.361-2.24 4.17-3.12 3.74-0.345 0.803-29-4.16-30.3-2.87 0.426-0.902-5.43-0.656-2.95-0.38-2.09 0.429-2.98 0.345-3.78 0.739-1.76 0.0938-2.27 3.72-3.7 3.74-0.875 1.71-1.59-0.443-2.57 0.925-1.59-0.0625-4.02-0.262-3.68-0.529-1.73 0.25-2.36-0.259-2.95-0.822-1.27 0.255-1.65-3.16-3.36-3.25-1.77-0.478-3.08 0.112-4.51-0.279-0.795-1.08-2.01-0.597-2.79-0.309-1.29 0.673-2.41-1.64-3.25-0.36 0.269 3.8-0.413 9.13-1.18 9.65-0.958 3.77 6.29 8.17 4.95 11.7 0.33 2.17-5.9 4.99-5.18 7.06-0.151 3 2.7 2.24 4.34 1.83 1.55 1.14 3.65-0.928 4.48 1.08 0.844 4.55-4.57 7.76-2.15 12.5 0.93 4.55 5.67 2.93 8.52 4.87 2.87 0.757 9.05 1.51 3.39 4.16-3.63 3.38-20 9.73-18.1 14.2 2.82 2.46 6.51 1.82 9.54 2.71 2.8 0.982 5.74 0.786 8.6 2.07 3.35 1.2-2.94 2.88-3.3 5.45-2.42 3.72-3.78 8.59-3.09 13.1-0.57 4.75 4.49 3.18 7.13 4.2 8.46 2.12 33.1 4.16 41.8 4.31 5.06 0.0968 10.1 0.248 15.2 0.179 2.56-1.15 5.94 0.664 9.04-0.886 3.42-0.389 7.19-1.46 10.3-3.45 2.26-1.65 5.26-6.01 3.7-9.75-1.99-2.48-3.9-6.12-4.74-8.06-1.1-2.55-3.59-3.99-5.43-5.01-1.16-0.584-3.28-0.481-4.21-0.804 1.7-2.1 14.6-5.56 14-9.31 0.303-2.06-0.0416-5.48-1.94-5.48z","m86.9 0.416c-2.65 0.408-5.71-0.589-8.11 0.475-3.02-1.44-6.37 0.199-9.03-0.782-1.92 1.65-4.94 0.317-7.17 0.0679-3.2 0.55-7-0.879-10.1 0.314-2.97-0.426-6.34-0.492-9.57 0.108-2.95 0.128-6.34-0.391-8.93 0.331-2.24 0.0952-4.71-0.758-6.98 0.496-3.21-0.616-6.48-0.693-9.53 0.357-2.98 0.795-5.03 3.75-7.08 7.64-2.73 2.45-6.1 3.3-7.82 8.86-0.445 0.677-3.29-2.09-2.51 1.37 3.26-1.21-0.803 8.33 2.38 10.4 0.42 6.11 3.88 6.35 6.25 6.63 2.29 1.75 5.76-1.33 7.03 3.1-1.79 2.08-4.22 2.77-6.05 4.95-3.39 4.3-4.2 11.5-2.08 17.9 1.85 5.04 0.776 12.6 2.91 17.4 1.53 2.54 3.71 2.13 5.02 3.42 3.52-1.88 2.62 7.15 5.18 8.6 2.6 2.27 5.67 1.43 8.43 2.78 2.92 0.673 5.36-0.13 8.13 0.67 2.73-0.475 5.51 1.53 8.19 0.136 2.71 1.99 5.7 0.76 8.48 1.13 1.47 0.551 3.01-0.468 4.52 0.174 2.15 1.32 4.49 0.423 6.78 0.366 2.48 1.8 5.74 1.69 8.46 1.47 2.86-1.03 5.56 1.22 8.36 0.503 2.47 1.6 5.08 0.104 7.27-0.656 0.0273-4.47 3.15-5.73 2.5-11.4 2.59-4.28 1.77-10.5 0.635-15.5-2.25-5.73-7.91-4.13-7.78-12.2-0.15-5.61 5.39-0.0295 7.76-2.7 2.57 1.77 5.55 0.341 6.09-4.8 3.49-3.55-0.732-9.66 0.471-13.6-1.53-2.77-3.79-5.59-6.39-4.86-1.83-0.569-3.35-0.944-2.87-5.04-3.26-3.66 2.44-4.1 2.02-8.61 3.91-6 0.769-13.5-2.16-17.9-0.935-0.187-1.76-1.25-2.72-1.66z","m0 97.2v-97.2h100s-1.64 4.67-2.14 7.16c-0.493 2.49 1.85e-4 0.623-1.07 2.18-1.07 1.56-1.97 2.18-2.47 4.05s-0.658 3.11-1.4 3.11c-0.74 0-1.32-0.622-2.14 2.18-0.822 2.8-0.904 3.43-1.81 4.36-0.905 0.934-1.07 3.43-1.64 5.3-0.576 1.87-1.07 2.18-1.97 4.05-0.904 1.87-2.38 3.12-3.04 4.98-0.658 1.87-1.48 4.67-1.73 6.54s-1.81 6.23-3.45 7.79c-1.64 1.56-3.37 2.49-4.03 4.05-0.658 1.56-1.07 3.43-2.06 3.74-0.987 0.312-6.09 9.35-7.98 9.03-1.89-0.311-4.19-0.312-4.44 2.18-0.247 2.49-1.89 2.18-3.95 0.623-2.06-1.56-3.37-0.623-5.51 2.8-2.14 3.43-2.88 0.311-3.62-0.623-0.74-0.934-4.11 1.25-5.35 2.49-1.23 1.25-2.06 1.56-3.37 1.56-1.32 0-3.21 5.3-4.19 5.61-0.37 0.117-0.821 0.102-1.27 0.0869-0.757-0.0243-1.52-0.0486-1.93 0.535-0.658 0.934-1.56 3.74-2.22 4.67-0.658 0.934-2.47 0.934-2.96 0.934-0.494 0-2.14-2.49-3.54 0-1.4 2.49-3.04 4.98-4.36 4.05-1.32-0.934-2.63-4.05-3.7-1.56-1.07 2.49-3.45 8.41-4.19 8.1-0.74-0.312-4.19-1.87-5.02-2.18-0.822-0.311-3.45-0.622-3.45-0.622","m0 100v-100s2.5 1.73 2.92 3.47c0.417 1.73 1.04 3.18 2.08 3.47 1.04 0.29 1.87 0.00176 2.81-0.288 0.937-0.29 1.98 2.02 3.02 2.6 1.04 0.577 3.44 1.15 4.17-0.29 0.729-1.44 1.46-1.16 2.29 0 0.833 1.16 2.19-0.867 4.48-1.73 2.29-0.867 3.54-4.34 4.69-2.6 1.15 1.73 2.71 4.62 3.33 5.2 0.625 0.577 0.729 1.73 2.08 4.05 1.35 2.31 3.75 1.16 4.9 0.867 1.15-0.288 3.65-0.867 4.06 0.867 0.417 1.73 3.54 11 5.83 11.3 1.15 0.146 1.98 0.0728 2.63 8.46e-4 0.65-0.072 1.12-0.145 1.54-8.46e-4 0.833 0.29 1.15 2.31 2.08 3.18 0.937 0.867 1.04 2.02 2.6 2.89 1.56 0.867 2.6-0.29 4.06-1.44 1.46-1.16 3.65-3.47 5.1-2.6 1.46 0.867 1.35-0.577 3.85 2.02 2.5 2.6 3.54 3.18 5.52 3.76 0.729 0.213 0.978 0.152 1.21 0.0902 0.397-0.106 0.743-0.211 3.37 1.07 4.17 2.02 4.9 0.867 6.77 0.867 1.88 0 6.04-0.867 7.4 0.29 1.35 1.15 3.96 1.16 4.9 0 0.937-1.16 2.29-1.73 2.29-1.73v43.9s-2.5-2.89-3.85-1.45c-1.35 1.45-2.81 2.89-3.75 3.76-0.937 0.867-2.71 2.02-4.17 2.02-1.46 0-2.08 2.02-4.06 2.02-1.98 0-4.58 0.869-5.83-0.577-1.25-1.44-2.19-1.44-3.85-2.6-1.67-1.16-2.92-1.15-3.85 0-0.938 1.16-5.21 2.89-6.25 4.34-1.04 1.44-3.02 2.02-3.85 2.02-0.834 0-3.85-2.6-4.48-2.02-0.625 0.577-4.58 2.89-6.04 5.49-1.46 2.6-3.33 2.89-4.9 2.89-1.56 0-3.13-0.29-5.1-1.16-1.98-0.867-7.71-3.18-8.33-2.89-0.625 0.29-1.77 2.89-3.85 4.62-2.08 1.73-4.17 2.6-5 2.6h-6.25c-0.312 0-2.92-0.577-4.06-1.16-1.15-0.577-1.77-2.31-2.71-2.89-0.937-0.579-0.938-2.31-2.6-1.16-1.67 1.16-1.56 0.867-3.33 2.31-1.77 1.45-3.85 4.62-3.85 4.62","m0 70.8v-70.8h100v97.9s-3.74-2.93-6.23 0c-2.49 2.93-2.74 2.56-5.24 0-2.49-2.57-4.24-1.83-7.23-2.57-2.99-0.732-6.98-1.46-7.48-3.66-0.498-2.2-2.24-2.93-3.74-2.2-1.5 0.733-6.73 0.366-8.23-0.733-1.5-1.1-1.5-3.66-5.24-5.49-2.08-1.02-2.69-0.34-3.49 0.339-0.64 0.543-1.4 1.09-3.11 0.76-3.87-0.733-5.36-3.3-7.11-3.3-1.75 0-4.24 2.56-7.48 0.733-3.24-1.83-2.49-3.16-7.23-3.41-1.67-0.0891-3.06 0.414-4.32 0.919-2.33 0.929-4.23 1.86-6.65-0.919-3.74-4.28-4.24-5.75-8.23-5.02-3.99 0.733-4.99 3.3-6.98 0.367l-2-2.93","m100 19.6v80.4h-100v-97.8s2.29-4.97 4.38 0c2.08 4.97 5.42 5.62 6.46 4.97 1.04-0.654 4.79-0.654 5.62-0.654 0.833 0 4.38 3.79 5 3.86 0.625 0.0667 1.88 0.585 3.54 0 1.67-0.586 3.96-1.38 4.58 0 0.625 1.37 2.08 3.99 3.13 4.64 1.04 0.654 1.67 0.654 3.54 0.654 1.88 0 4.58 1.99 6.04 3.94 1.46 1.95 1.25 0.64 3.75 5.87 2.5 5.23 1.46 11.1 3.96 8.82 2.5-2.29 2.71-0.327 5.21-4.25 2.5-3.92 2.29-3.92 4.79-5.88 2.5-1.96 5.83-6.51 6.56-4.56 0.729 1.95 3.65 2.6 5.31 3.25 1.67 0.654 1.67 3.27 3.96 1.31 2.29-1.96 1.04-4.55 4.79-4.56 1.26-0.0049 2.21 0.216 3.16 0.437 1.88 0.437 3.73 0.875 7.88-0.436 6.25-1.97 8.33 0 8.33 0","m0 0v100h100v-45.4s-4.66-9.87-7.4-4.61c-2.74 5.26-5.48 1.97-8.22 0-2.74-1.97-9.04-8.55-11.2-7.89-1.04 0.312-2.57-0.705-4.12-1.72-1.73-1.13-3.49-2.26-4.64-1.57-2.19 1.32-3.56 2.63-7.12 0-3.56-2.63-2.47-6.58-7.26-5.26-4.8 1.32-8.08 0-11.9-3.29-3.84-3.29-4.11-7.89-9.32-7.24-5.21 0.658-7.75 2.16-9.04-1.32-2.19-5.92-1.1-7.89-4.66-9.87-3.56-1.97-2.74-5.26-5.75-6.58-3.01-1.32-9.32-5.26-9.32-5.26","m100 0.435v98.2s-2.49 0.722-4.98 0c-1.01-0.293-2.02 0.175-2.98 0.643-1.41 0.684-2.71 1.37-3.77-0.323-1.78-2.85-1.78-3.57-5.69-3.57-3.91 0-6.4-0.361-7.46-1.08-1.07-0.722-3.55-3.25-5.33-3.25s-3.55-0.722-7.82 0c-4.26 0.721-11.4 2.89-14.9 1.44-3.55-1.44-6.4-3.25-8.17-3.25s-6.75 1.08-8.53-1.08c-1.78-2.17-0.711-4.33-4.62-4.33-3.91 0-3.2-0.361-7.11-0.722-3.91-0.361-7.46-2.53-8.88-3.61-1.42-1.08-3.91-2.17-6.4-3.61-2.49-1.44-4.26-3.61-2.84-5.41 1.42-1.81 2.13-5.05 2.84-6.86 0.711-1.8-1.07-7.51 0-8.08 1.07-0.58 2.13-4.62 2.13-5.3 0-0.69 0.711-6.1 0.711-6.1s1.42-4.69 1.42-6.32c0-1.62 1.07-3.79 1.78-6.32 0.711-2.53 0.355-2.89 1.07-6.14 0.71-3.25 1.07-6.14 2.13-9.02 1.07-2.89 0.711-4.33 2.13-6.86 1.42-2.53 3.2-2.37 6.4-2.63 1.24-0.101 2.64 0.078 3.97 0.257 2.11 0.283 4.04 0.566 4.91-0.257 1.42-1.34 9.59-2.79 11.4-3.51 1.78-0.722 5.54-0.722 8.63-0.361 3.1 0.361 7.36 0.722 9.49-0.361 2.13-1.08 4.97-3.61 7.46-2.17 2.49 1.44 7.11 1.81 9.95 1.81 2.84 0 8.17-0.361 9.59-0.361 1.42 0 13.5-1.44 13.5-1.44","m0 100h100v-98.1s-2.26 2.58-3.06 6.45c-0.799 3.87-1.86-3.87-2.53-6.45-0.666-2.58-2-2.58-2.66 0-0.666 2.58-2.93 5.16-3.59 10.3-0.666 5.16-2 1.29-3.33 5.16-1.33 3.87-2.8 3.87-3.6 5.16-0.799 1.29-1.86-1.29-2.53-3.87-0.666-2.58-0.932-9.03-1.86-7.74-0.359 0.498-0.835 0.0392-1.33-0.418-0.794-0.735-1.64-1.47-2.13 1.71-0.799 5.16-2.13 1.29-2.93 5.16-0.349 1.69-0.546 1.66-0.802 1.62-0.329-0.0434-0.754-0.0898-1.73 3.54-1.73 6.45-1.73 7.74-3.59 14.2-1.86 6.45-3.99 6.45-4.66 6.45-0.666 0-2.13-3.87-3.2-5.16-1.06-1.29-3.86-9.03-4.26-7.74-0.16 0.516-0.383 0.207-0.658-0.103-0.412-0.465-0.94-0.93-1.54 1.39-0.999 3.87-0.999 5.16-2.73 9.03-1.73 3.87-3.73 1.29-4.39 1.29-0.666 0-1.86-9.03-3.06-6.45-1.2 2.58-2 2.58-3.06 6.45-1.07 3.87-0.133-0.645-3.06 8.06-2.93 8.71-4.53 11.3-5.86 8.71-1.33-2.58-0.266-8.39-2.53-8.71-2.26-0.323-0.133-4.19-2.26-0.323-0.926 1.68-1.48 0.318-1.93-1.05-0.592-1.77-1.03-3.55-1.93 1.37-1.6 8.71-1.86 3.55-3.46 10-0.888 3.58-1.73 3.19-2.59 2.79-0.681-0.318-1.36-0.635-2.07 1.08-1.6 3.87-2.93 9.03-3.73 12.9-0.799 3.87-1.73 5.16-2.8 6.45-1.07 1.29-3.06 7.74-3.06 7.74l-1.46 9.03","m0.642 91.6c2.18-0.834 1.23 0.646 2.08 5.01 1.15 5.89 2.04-0.393 3.53-1.92 0.997-1.02 1.1-0.0486 1.34 0.919 0.167 0.677 0.401 1.35 1.05 1.35 0.673-0.0028 1.21-2.06 1.94-2.16 0.618-0.0861 1.53 1.26 2.16 1.6 0.978 0.537 2.32 1.11 3.25-0.214 1.12-1.6 1.06-5.87 1.91-7.36 0.49-0.854 1.61-0.912 2.23-1.08-0.0448 3.49 1.27 7.03 2.23 2.97-0.228 3.71 0.481 3.62 1.48 5.18 0.689 1.07 2.22 1.88 3.09 2.98 2.56 3.23 3.88-1.12 6.34-2.31 1.83-0.88 2.74-0.315 4.27 1.94 1.62 2.39 1.83 1.85 3.39-0.883 2.19-3.85 4.81-0.0486 6.84-5.73 1.17-3.28 0.699-3.87 2.54-4.2 0.763-0.135 2.62-0.893 3.33-0.516 1.6 0.843 1.1 5.2 2.63 6.59 0.307 0.282 0.625 0.0555 0.928-0.171 0.274-0.205 0.537-0.41 0.77-0.239 0.545 0.403 0.557 1.66 1.03 2.34 1.35 1.98 2.47 2.41 4.01 2.77 0.848 0.193 1.74-0.0541 2.63-0.301 1.06-0.296 2.12-0.591 3.09-0.132 0.718 0.339 1.3 2.06 2.05 1.66 0.934-0.498 1.31-4.57 1.87-6.2 0.859-2.48 1.25-4.16 3.04-3.21-0.524 6.14 3.33 4.11 4.71 3.39 0.848-0.446 1.36-0.7 2.04-2.01 0.888-1.71 1.56-7.51 2.84-7.75 1.02-0.192 4.02 7.53 5.11 9.04 1.52 2.12 2.79 3.41 4.23 0.0153 0.722-1.7 2.48-6.64 1.64-8.7 0.507-2.05 1.15-2.65 2.49-2.7 0.44-0.0167 0.848 0.0333 1.24 0.107v-81.6c-0.445 0.429-0.885 0.876-1.32 1.37-0.33 0.378-1.05 0.343-1.33 0.957-0.295 0.639-0.319 2.69-0.593 3.12-1.62 2.53-1.55 0.0208-3.15-1.53-0.362-0.351-0.409-1.3-0.906-1.61-0.242-0.149-0.558 0.107-0.892 0.362-0.337 0.257-0.691 0.515-1.01 0.358 0.0703-6.64-4.2 2.67-5.42 3.23-1.38 0.637-2.65-0.368-3.9-1.37-1.68-1.36-3.33-2.72-5.16-0.0236-2.46 3.62-3.81 10.4-7.44 10.5-0.598 0.0125-1.15-0.317-1.7-0.646-0.552-0.329-1.1-0.658-1.68-0.646-1.25 0.0264-2.54 2.7-3.82 1.58-1.11-0.979-1.29-4.91-2.23-5.75-0.609-0.541-1.21 0.146-1.81 0.832-0.576 0.659-1.16 1.32-1.76 0.894-1.14-0.802-1.5-4.69-2.45-6.31-1.24-2.12-2.71-1.89-4.11-1.23-1.89 0.883-3.13 3.74-4.83 5.04-0.567 0.432-1.31 0.0986-2.06-0.235-1.04-0.465-2.1-0.93-2.71 0.677-0.65 1.7 0.652 7.88-0.753 9.93-1.3 1.9-0.737-0.33-1.75-1.81-0.856-1.25-0.647 0.13-1.34-1.47 0.523-2.12 1.3-4.75 0.92-7.43-0.264-0.0514-0.611-0.018-0.991 0.0153-1.09 0.0944-2.45 0.189-2.96-1.65-0.319-1.14 0.104-5.07-0.0232-6.59-0.958 0.0236-10.5 11.6-9.23 1.89-0.96 4.56-3.26 9.14-5.33 7.57-0.658-0.497-1.2-2.3-1.84-2.73-0.614-0.419-1.21-0.204-1.82 0.0111-0.399 0.14-0.803 0.282-1.22 0.244-0.86-0.0764-1.94-1.51-2.72-1.16-1.38 0.628-2.42 4.97-3.89 5.08-2.16 0.172-2.31-5.77-4.01-7.49-0.809-0.822-1.8-0.18-2.79 0.99v86.8c0.206-0.0403 0.418-0.0958 0.642-0.18","m89.3 0h-89.3v94.5c0.542 1.3 1.03 2.47 1.34 2.65 1.24 0.722 1.8-3.48 2.81-4.09 1.45-0.875 0.831 1.28 2 2.99 1.64 2.4 2.1-1.09 3.84-1.12 0.421-0.0071 0.747 0.258 1.04 0.524 0.65 0.593 1.12 1.19 2.09-1.25-0.447-1.41-1.17-2.01-1.74-3.04 0.802-1.44 1.52-2.38 2.16-4.14 0.692-1.9 0.15-4.06 1.52-4.07 0.985 4.63-0.761 7.72 1.38 9.28 0.3 0.219 0.6 0.0435 0.906-0.131 0.334-0.191 0.674-0.382 1.03-0.059 0.792 0.725 1.15 4.18 1.89 4.91 1.78 1.76 6.06-6.96 4.09-12.7 1.24-2.15 2.73-3.02 3.98-5.06 0.969-1.58 1.69-4.6 2.79-5.47 0.38 5 1.7 8.26 3.69 10-0.615 1.29-1.16 2.77-1.36 4.72 0.938 2.73 2.26 0.706 3.42 0.376 2.77-0.789 1.47 2.79 3.45 4.97 0.963 1.06 1.94-0.59 2.96-2.24 1.11-1.79 2.26-3.58 3.49-1.91 0.604 0.819 0.825 3.53 1.52 4.56 0.557 0.829 0.962 0.787 1.41 0.746 0.269-0.0239 0.554-0.0492 0.897 0.118 0.897 0.437 1.79 1.55 2.72 1.91 0.591 0.223 1.14 0.0056 1.65-0.211 0.63-0.264 1.22-0.528 1.8 0.0014 0.474 0.434 0.482 2.86 1.25 3.21 0.891 0.416 1.58-2.12 2.33-2.78 1.33-1.17 2.89-0.27 3.82-3.51-0.602 0.574-1.3 0.93-1.9 0.949 0.283-3.84 1.86-5.23 3.06-6.95-0.181-1.04-0.013-2-0.12-2.98 0.539 1.01 1.17 1.33 1.77 0.697-0.922-4.21 0.292-5.18 1.53-7.87-0.427 2.09 0.193 5.48 0.213 7.66 0.0284 3.21-0.28 2.65 0.266 5.81 0.337 1.95 1.17 0.185 0.604 3.3 1.39 2.93 7.69 4.26 5.58-4.16 0.871-0.0885 1.21 1.17 1.56 2.43 0.444 1.63 0.89 3.26 2.49 1.96 0.744-0.6 1.44-3.09 2.16-3.37 1.76-0.671 1.24 3.23 2.81 3.75 1.31 0.438 2.66-4.45 3.85-5.48 0.512-0.442 0.951-0.358 1.44-0.274 0.267 0.0464 0.548 0.0927 0.864 0.052 2.22-0.284 3.09-4.96 1.35-9.59 1.11-1.21 1.7-2.88 2.47-4.96 1.5-4.03 0.88-3.53 2.82-0.896 1.06 1.44 2.01 3.27 3.03 0.126v-73.9h-10.7","m0 51.2c3.3-2.88 6.4-5.95 9.3-9.33-0.9-1.59-2.1-3.08-3.9-3.57-0.8-1.49 0.2-3.47 1.7-4.46 0.3-0.198 0.6-0.298 0.9-0.496-0.1-0.198-0.2-0.496-0.3-0.694 1.6-1.49 3.1-2.98 4.6-4.46 0.6 0.298 1.2 0.694 1.8 0.992-0.3-0.595-0.6-1.19-0.9-1.69 0.7-0.496 1.4-1.09 2.2-1.59-0.3-1.39-0.8-2.78-2.1-3.67-0.1-1.69 1.5-3.08 3.3-3.47 0.3-0.0992 0.7-0.0992 1-0.0992v-0.794l6-2.38c0.4 0.496 0.8 1.09 1.3 1.59-0.1-0.694-0.1-1.29-0.2-1.98 0.8-0.198 1.6-0.397 2.5-0.595 1.1-3.17 1.7-6.45 1.9-9.82 1.1 0.595 2.4 0.198 3.6 0.198 1.1 0 2.3 0.496 2.6 1.49 1.6 0.0992 3.4-0.198 4.8 0.496 0.8 0.397 1.5 1.09 2.2 1.79 2.3-2.58 4.3-5.46 5.8-8.63 0.8 0.893 2.1 1.09 3.3 1.59 0.7 0.694 1.7 1.69 1.6 2.68 1.4 0.694 3.2 1.09 4.2 2.28 0.5 0.496 0.8 1.19 1.1 1.88 3.6-1.09 7.3-2.28 10.9-3.37 1 3.37 2.4 6.55 4.1 9.62 3.9 0.397 7.8 0.694 11.8 1.09-0.4 3.17-0.4 6.35-0.1 9.52 0.3 0.298 0.6 0.694 0.8 1.09 0 0.694-0.1 1.39-0.1 2.08 0.9-0.198 1.7-0.694 2.4-1.19 2.4 1.29 5 2.08 7.7 2.58-1.6 3.27-3 6.55-4.3 10 0.4 0.595 0.6 1.29 0.6 1.98-0.3 0.595-0.6 1.19-0.9 1.88 0.9 0.0992 1.8 0 2.7-0.198 1.7 2.08 3.8 3.87 6.1 5.26-3.3 2.88-6.4 5.95-9.3 9.33 0.9 1.59 2.1 3.08 3.9 3.57 0.8 1.49-0.2 3.47-1.7 4.46-0.3 0.198-0.6 0.298-0.9 0.496 0.1 0.198 0.2 0.496 0.3 0.694-1.6 1.49-3.1 2.98-4.6 4.46-0.6-0.298-1.2-0.694-1.8-0.992 0.3 0.595 0.6 1.19 0.9 1.69-0.7 0.496-1.4 1.09-2.2 1.59 0.3 1.39 0.8 2.78 2.1 3.67 0.1 1.69-1.5 3.08-3.3 3.47-0.3 0.0992-0.7 0.0992-1 0.0992v0.794c-2 0.794-4 1.59-6 2.38-0.4-0.496-0.8-1.09-1.3-1.59 0.1 0.694 0.1 1.29 0.2 1.98-0.8 0.198-1.6 0.397-2.5 0.595-1.1 3.17-1.7 6.45-1.9 9.82-1.1-0.595-2.4-0.198-3.6-0.198-1.1 0-2.3-0.496-2.6-1.49-1.6-0.0992-3.4 0.198-4.8-0.496-0.8-0.397-1.5-1.09-2.2-1.79-2.3 2.58-4.3 5.46-5.8 8.63-0.8-0.893-2.1-1.09-3.3-1.59-0.7-0.893-1.7-1.88-1.6-2.88-1.4-0.694-3.2-1.09-4.2-2.28-0.5-0.496-0.8-1.19-1.1-1.88-3.6 1.09-7.3 2.28-10.9 3.37-1-3.37-2.4-6.55-4.1-9.62-3.9-0.397-7.8-0.694-11.8-1.09 0.4-3.17 0.4-6.35 0.1-9.52-0.3-0.298-0.6-0.694-0.8-1.09 0-0.694 0.1-1.39 0.1-2.08-0.9 0.198-1.7 0.694-2.4 1.19-2.4-1.29-5-2.08-7.7-2.58 1.6-3.27 3-6.55 4.3-10-0.4-0.595-0.6-1.29-0.6-1.98 0.3-0.595 0.6-1.19 0.9-1.88-0.9-0.0992-1.8 0-2.7 0.198-1.7-1.79-3.8-3.57-6.1-5.06z","m100 48.7c-3.3 2.89-6.49 6.08-9.39 9.36-1.2 1.39-2.4 2.99-2.4 4.78-0.699-0.498-1.6-0.598-2.5-0.299 0.599 0.697 1.2 1.29 1.8 1.99-1.1-0.199-2.2 0.498-3.2 1.2-0.0999 0.0996-0.3 0.199-0.4 0.299 0.2 1.99 0.3 3.98 0.5 5.88 0.2 2.09 0.5 4.48 2.3 5.88 0.0999 1.69-1.5 3.09-3.3 3.49-0.3 0.0996-0.699 0.0996-0.999 0.0996v0.797c-2 0.797-4 1.59-5.99 2.39-0.4-0.498-0.799-1.1-1.3-1.59 0.0999 0.697 0.0999 1.29 0.2 1.99-2.7 0.697-5.49 1.29-8.19 1.99-0.4-0.598-0.699-1.2-1.1-1.79 0 1.2-1.8 1.39-3 1.2-0.5-0.0996-1.1-0.0996-1.6-0.199-0.2 1.59-1.6 3.09-2.8 4.38-2.7 2.79-4.9 5.98-6.49 9.46-0.799-0.896-2.1-1.1-3.3-1.59-0.899-0.598-1.9-1.59-1.8-2.59-1.4-0.697-3.2-1.1-4.2-2.29-0.699-0.797-0.999-1.79-1.5-2.79-0.699-1.29-1.6-2.49-2.8-3.49-0.4-0.299-0.899-0.697-1.3-0.996-0.4 0-0.699 0-1.1-0.0996-6.99-0.598-14.1-1.2-21.1-1.89 0.5-4.08 0.4-8.27-0.3-12.4 0.699-0.299 1.4-0.598 2.1-0.996-0.599-0.199-1.2-0.498-1.8-0.697 0.0999-1.39 0.2-2.89 0.3-4.28-1.3-1.29-3-2.09-4.5-3.19-1.5-1.1-2.8-2.59-3-4.48 0.3-0.598 0.599-1.2 0.899-1.89-0.899-0.0996-1.8 0-2.7 0.199-1.7-2.09-3.8-3.88-6.09-5.28 3.3-2.89 6.49-6.08 9.39-9.36 1.2-1.39 2.4-2.99 2.4-4.78 0.699 0.498 1.6 0.598 2.5 0.299-0.599-0.697-1.2-1.29-1.8-1.99 1.1 0.199 2.2-0.498 3.2-1.2 0.0999-0.0996 0.3-0.199 0.4-0.299-0.2-1.99-0.3-3.98-0.5-5.88-0.2-2.09-0.5-4.48-2.3-5.88-0.0999-1.69 1.5-3.09 3.3-3.49 0.3-0.0996 0.699-0.0996 0.999-0.0996v-0.797c2-0.797 4-1.59 5.99-2.39 0.4 0.498 0.799 1.1 1.3 1.59-0.0999-0.697-0.0999-1.29-0.2-1.99 2.7-0.697 5.49-1.29 8.19-1.99 0.4 0.598 0.699 1.2 1.1 1.79 0-1.2 1.8-1.39 3-1.2 0.5 0.0996 1.1 0.0996 1.6 0.199 0.2-1.59 1.6-3.09 2.8-4.38 2.7-2.79 4.9-5.98 6.49-9.46 0.799 0.896 2.1 1.1 3.3 1.59 0.999 0.598 2 1.59 1.9 2.59 1.4 0.697 3.2 1.1 4.2 2.29 0.699 0.797 0.999 1.79 1.5 2.79 0.699 1.29 1.6 2.49 2.8 3.49 0.4 0.299 0.899 0.697 1.3 0.996 0.4 0 0.699 0 1.1 0.0996 7.09 0.598 14.1 1.29 21.2 1.89-0.5 4.08-0.4 8.27 0.3 12.4-0.699 0.299-1.4 0.598-2.1 0.996 0.599 0.199 1.2 0.498 1.8 0.697-0.0999 1.39-0.2 2.89-0.3 4.28 1.3 1.29 3 2.09 4.5 3.19 1.5 1.1 2.8 2.59 3 4.48-0.3 0.598-0.599 1.2-0.899 1.89 0.899 0.0996 1.8 0 2.7-0.199 1.5 1.99 3.6 3.78 5.89 5.28z","m100 61.9c0 10.9-8 19.9-18.4 21.1-1.9 9.7-10.3 17-20.3 17-4.2 0-8-1.3-11.3-3.4-3.2 2.1-7.1 3.4-11.3 3.4-10.1 0-18.5-7.3-20.4-17.1-10.3-1.2-18.3-10.2-18.3-21 0-10.4 7.3-19 16.9-20.8 0-0.8 0.1-1.6 0.2-2.4 0.6-4.2 3-7 3-7s0 3.5 1.7 2.7c2.1-1 1.5-5.1 3.4-8.8 4.3-8.1 11.6-11.1 11.6-11.1s-2.9 7.2 1.6 6.3c2.9-0.6 2.6-7.5 7.5-13 7.5-8.6 16.1-7.8 16.1-7.8s-6.6 5.7-7.2 12.5c-0.4 4 1.5 8.5 5 9.2 5.1 1 4.1-2.4 4.1-2.4s3.4-0.1 6.8 3.9c2.3 2.6 1.9 6.4 4.6 6.9 1.4 0.3 1.3-2.5 1.3-2.5s2.9 1.4 4.6 5.9c1 2.6 1.3 5.1 1.4 7.4 9.9 1.7 17.4 10.4 17.4 21z","m94.3 56.2c0.4 6 2 13 5.7 21.2 0 0-16.6 12.2-50 22.6-33.4-10.4-50-22.6-50-22.6 3.7-8.1 5.3-15.1 5.7-21.1-0.5-0.9-3.9-7.7-2.5-14.8 0.9-4.5 4.3-7.5 4.3-7.5s0 3.8 2.5 2.9c3-1.1 2.1-5.5 4.9-9.4 6.1-8.7 16.7-12 16.7-12s-4.1 7.8 2.3 6.7c4.2-0.7 3.8-8.1 10.8-14 10.7-9 23.1-8.2 23.1-8.2s-9.5 6.2-10.4 13.4c-0.6 4.3 2.2 9.2 7.3 9.9 7.4 1 5.9-2.6 5.9-2.6s4.9-0.1 9.8 4.2c3.3 2.8 2.8 6.9 6.7 7.5 2 0.3 1.9-2.7 1.9-2.7s4.2 1.6 6.6 6.4c4.7 9.7-0.3 18.6-1.3 20.1z","m100 56.2v0.1c0 24.1-22.4 43.7-50 43.7-27.6 0-50-19.6-50-43.7v-0.1c0-1.6 0.1-3.3 0.4-5.1 1-5.6 4.5-9.3 4.5-9.3s0 4.7 2.6 3.6c3.1-1.3 2.2-6.8 5.1-11.6 6.5-10.7 17.6-14.8 17.6-14.8s-4.4 9.6 2.4 8.3c4.4-0.8 4-9.9 11.4-17.2 11.5-11.1 24.6-10.1 24.6-10.1s-10 7.6-11 16.5c-0.6 5.4 2.3 11.3 7.7 12.2 7.8 1.3 6.3-3.2 6.3-3.2s5.1-0.1 10.3 5.1c3.5 3.5 2.9 8.4 7.1 9.2 2.1 0.4 2-3.3 2-3.3s4.4 1.9 7 7.9c1.6 4.2 2.1 8.3 2 11.8z","m100 41.1v34.5c-2 0-3.7 0.3-5.2 0.8v0.7c0 5-4.1 9.1-9.1 9.1h-0.1c-0.6 2-0.6 3.6-0.6 3.6-12.4 7-30 10.2-35 10.2s-22.6-3.2-35-10.2c0 0-0.1-1.6-0.7-3.7h-0.1c-5 0-9.1-4.1-9.1-9.1v-0.7c-1.4-0.4-3.1-0.7-5.1-0.7v-34.5c0-0.9 0.1-1.8 0.3-2.8 1-4.2 4.5-7 4.5-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.1-8.7 6.5-8 17.6-11.1 17.6-11.1s-4.4 7.2 2.4 6.2c4.5-0.6 4.1-7.4 11.5-12.8 11.5-8.4 24.6-7.6 24.6-7.6s-10 5.7-11 12.4c-0.6 4 2.3 8.5 7.7 9.2 7.8 1 6.3-2.4 6.3-2.4s5.1-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.1 6.9 2.1 0.3 2-2.5 2-2.5s4.4 1.4 7 5.9c1.4 2.8 2 5.4 2 7.8z","m91.7 37.2c2.6-0.4 5.4-1 8.3-1.7 0 0-5.2 44-50 64.5-44.8-20.5-50-64.5-50-64.5 2.9 0.7 5.6 1.3 8.3 1.7-0.1-1.3-0.1-2.7 0.2-4.1 0.8-3.6 3.8-6 3.8-6s0 3 2.2 2.3c2.6-0.9 1.9-4.4 4.3-7.5 5.4-6.9 14.7-9.6 14.7-9.6s-3.7 6.2 2 5.4c3.7-0.5 3.3-6.4 9.6-11.1 9.5-7.3 20.5-6.6 20.5-6.6s-8.4 4.9-9.2 10.7c-0.5 3.5 1.9 7.3 6.4 7.9 6.5 0.8 5.2-2 5.2-2s4.3-0.1 8.6 3.3c2.9 2.3 2.5 5.5 5.9 6 1.8 0.3 1.6-2.1 1.6-2.1s3.7 1.2 5.8 5.1c1.7 2.9 2.1 5.8 1.8 8.3z","m97.2 50.9v34.9s-0.3 2.6-3.8 3.3l-40.2 10.3s-2.5 0.6-3.4 0.6-3.4-0.6-3.4-0.6l-40.3-10.3c-3.4-0.8-3.8-3.3-3.8-3.3v-34.9c-1.2-2.3-3.2-7.3-2-12.5 0.999-4.2 4.49-7 4.49-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.09-8.7 6.49-8 17.6-11.1 17.6-11.1s-4.39 7.2 2.4 6.2c4.49-0.6 4.1-7.5 11.5-12.9 11.5-8.4 24.6-7.6 24.6-7.6s-9.99 5.7-11 12.4c-0.599 4 2.3 8.5 7.69 9.2 7.79 1 6.29-2.4 6.29-2.4s5.09-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.09 6.9 2.1 0.3 2-2.5 2-2.5s4.39 1.4 6.99 5.9c4.2 7.7 0.899 14.8-0.799 17.6z","m100 35.6v51.8h-10.4c-3.4 1.9-8 3.5-13.6 4.7-1.4 0.3-2.8 0.6-4.3 0.8 0 0-3.4 0.8-5 1.2-5.3 1.3-13.4 3.6-16.7 5.9-3.3-2.3-11.4-4.5-16.7-5.9-1.6-0.4-5-1.2-5-1.2-1.5-0.3-2.9-0.5-4.3-0.8-5.6-1.2-10.2-2.8-13.6-4.7h-10.4v-51.8c0-0.9 0.1-1.8 0.4-2.7 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.5 17.6-9.5s-4.4 6.2 2.4 5.3c4.4-0.5 4-6.3 11.4-11 11.5-7.2 24.6-6.5 24.6-6.5s-10 4.9-11 10.6c-0.6 3.4 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.2 2.9 5.4 7.1 5.9 2.1 0.2 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 6.9z","m100 35.9-4.1 42.7v0.2c0 4.1-5.2 7.5-11.7 7.5-1.4 0-2.6-0.2-3.9-0.5-2.9 3.3-7.4 6.1-13 8.1-1.1 0.4-2.3 0.8-3.5 1.1 0 0-3.3 0.7-4.6 1.3-2.9 1.2-5.8 2.6-9.2 3.7-3.4-1.1-6.3-2.5-9.2-3.7-1.3-0.6-4.6-1.3-4.6-1.3-1.2-0.3-2.4-0.7-3.5-1.1-5.7-2-10.1-4.8-13-8.1-1.2 0.3-2.5 0.5-3.9 0.5-6.5 0-11.7-3.4-11.7-7.5v-0.2l-4.1-42.7c0-0.9 0.1-1.8 0.4-2.8 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.6 17.6-9.6s-4.4 6.2 2.4 5.4c4.4-0.5 4-6.4 11.4-11.1 11.5-7.3 24.6-6.6 24.6-6.6s-10 4.9-11 10.7c-0.6 3.5 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.3 2.9 5.5 7.1 6 2.1 0.3 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 7z","m96.4 38.7c0.4 9.69 3.6 14.6 3.6 14.6s-3.6 5.39-3.7 16.2c0 0-0.1 2.2-2.4 2.2h-5.8v9.69c0 4.2-3.3 7.69-7.4 7.69h-6.6c0 3-0.9 5.39-2.6 6.79-1.2 0.999-2.7 1.4-4.5 1.3-1-0.0999-2.4-0.3-3.8-0.499-3.2-0.499-7.1-0.999-8.9-0.599-2.6 0.499-3.8 2.9-3.8 3l-0.5 0.999-0.5-0.999s-1.2-2.4-3.8-3c-1.8-0.4-5.8 0.2-8.9 0.599-1.4 0.2-2.8 0.4-3.8 0.499-1.8 0.0999-3.3-0.3-4.5-1.3-1.7-1.4-2.6-3.8-2.6-6.79h-6.6c-4.1 0-7.4-3.4-7.4-7.69v-9.69h-5.8c-2.3 0-2.4-2.2-2.4-2.2-0.1-10.7-3.7-16.1-3.7-16.1s3.3-4.89 3.6-14.6c0-0.999 0.1-2 0.3-3 0.9-3.9 4.2-6.49 4.2-6.49s0 3.3 2.4 2.5c2.9-0.899 2.1-4.79 4.8-8.09 6-7.49 16.3-10.3 16.3-10.3s-4.1 6.69 2.2 5.79c4.1-0.599 3.7-6.89 10.6-12 10.7-7.89 22.9-7.19 22.9-7.19s-9.3 5.29-10.2 11.6c-0.5 3.7 2.1 7.89 7.1 8.49 7.2 0.899 5.8-2.2 5.8-2.2s4.8-0.0999 9.6 3.6c3.2 2.4 2.7 5.89 6.5 6.39 2 0.3 1.8-2.3 1.8-2.3s4.1 1.3 6.5 5.49c1.5 2.7 2 5.29 2 7.59z","m100 65s-2.7 1.4-5.6 2.2c-1.2 2.5-2.1 5.1-2.8 7.9-0.4 1.8-2.6 3-5.4 3.1v2.5c0 2.9-1.4 5.6-3.9 7.6-5.4 4.4-16.8 11.7-32.3 11.7s-26.9-7.3-32.3-11.7c-2.4-2-3.9-4.7-3.9-7.6v-2.5c-2.8-0.1-5-1.3-5.4-3.1-0.7-2.8-1.6-5.4-2.8-7.9-2.9-0.9-5.6-2.2-5.6-2.2l4.3-5-3.2-9.2s2.6 1 5.5 1.8c1.7 0.5 4.9 1.1 7.3 1.5v-15.4c0-1 0.1-2 0.3-3 0.7-3.9 3.3-6.5 3.3-6.5s0 3.3 1.9 2.5c2.3-0.9 1.6-4.8 3.7-8.1 4.7-7.5 12.7-10.3 12.7-10.3s-3.2 6.7 1.8 5.8c3.2-0.6 2.9-6.9 8.3-12 8.1-7.8 17.6-7.1 17.6-7.1s-7.2 5.3-8 11.6c-0.4 3.7 1.6 7.9 5.6 8.5 5.6 0.9 4.5-2.2 4.5-2.2s3.7-0.1 7.5 3.6c2.5 2.4 2.1 5.9 5.1 6.4 1.5 0.3 1.4-2.3 1.4-2.3s3.2 1.3 5.1 5.5c1.2 2.7 1.6 5.3 1.5 7.6v15.4c2.4-0.4 5.6-1 7.3-1.5 2.8-0.9 5.5-1.8 5.5-1.8l-3.3 9.2z","m67.5-0.0611c-2.04-0.0186-4 0.25-5.85 0.688-7.3 1.73-18 6.14-22.2 8.41-8.72 4.7-22.6 1.06-32.2 0.194l2.92 23.1c-0.447 0.377-0.915 0.682-1.35 1.1-4.44 4.28-7.79 10.5-8.4 18.1-0.372 4.67 0.385 9.17 1.97 13.2 1.58 3.99 3.91 7.31 6.65 9.9 2.54 2.39 5.32 4.01 8.19 5.11-0.976 0.748-2.05 1.3-2.99 2.11l10.7 17.4c8.64-7.49 20-11.1 30.6-9.7 5.12 0.661 11.7 3.06 20 2.57 4.16-0.25 8.67-1.34 12.9-4.21 4.37-2.93 8.22-7.55 10.1-14 1.34-4.53 1.46-9.24 0.594-13.7-0.859-4.41-1.65-8.96-4.02-12.2-4.14-5.63-6.67-8.38-12.2-9.55 1.09-1.79 3.6-3.7 4.32-5.88 1.11-3.4 1.64-7.11 1.37-11-0.268-3.87-1.32-7.67-3.26-11.1-2.93-5.11-7.17-8.16-11.6-9.6-2.15-0.706-4.26-1.01-6.3-1.03z","m51.7 3.39s-7.76 0.243-9.75 0.416c-1.86 0.162-4.01 0.213-6.44 0.266-7.55 0.164-15.1 0.372-22.6 0.623-6.68 0.222-11.9 5.82-11.7 12.5 0.325 3.66 2.3 6.98 5.36 9.01-1 0.664-2 1.45-2.91 2.55-1.2 1.44-2.19 3.2-2.73 5.38-0.542 2.21-0.561 4.6 0.238 7.11 0.814 2.56 2.34 4.86 4.81 6.62 1.65 1.18 3.17 1.73 4.57 2.05-1.09 1.09-2.92 2.93-4.24 6.62-0.764 2.13-1.22 4.7-0.748 7.67 0.488 3.08 1.88 6.16 4.76 8.69 0.904 0.794 1.76 1.38 2.55 1.84-5.83 3.14-8.06 10.4-4.99 16.3 3.11 5.91 8.02 7.85 15.7 6.6 4.5-0.588 8.83-1.4 13.3-2.01 7.35 0.434 14-0.585 18.2-0.808 5.45-0.243 8.88-1.26 10.5-1.35 1.49-0.0776 4.49 0.386 9.04 0.439 2.28 0.027 5.83-1.53 8.46-2.8 2.77-1.35 6.19-2.06 9.15-4.48 1.96-1.6 3.81-3.67 5.18-6.37 1.02-2 2.24-5.05 1.69-9.26-0.205-1.55-0.793-3.16-1.62-4.75 0.928-2.51 1.45-5.39 0.799-8.69-0.553-2.81-2-5.19-3.88-7.28 0.927-1.06 1.81-2.26 2.51-3.82 0.998-2.25 1.55-4.87 1.18-7.85-0.348-2.77-1.46-5.95-4.54-8.68-0.251-0.222-0.499-0.356-0.75-0.551 0.483-0.438 0.981-0.809 1.44-1.34 1.69-1.96 2.98-4.4 3.47-7.37 0.502-3.03 0.128-6.19-1.51-9.26-1.96-3.66-4.77-5.52-7.19-6.6-2.29-1.02-4-1.25-4.9-1.39-8.02-1.28-14 0.0821-17.6-0.483zm-28.5 49.5c-0.38-0.0969-0.159-0.137 0.438 0.102-0.2-0.0513-0.231-0.0488-0.438-0.102z","m84.8 0.869c-5.02 0.251-10.1-0.442-15 0.896-5.22 0.146-10.4 1.2-15.6 1.48-4.05 0.815-8.31 0.0499-12.3 1.33 1.43-0.679-4.41 0.385-6.32 0.408-6.76 0.17-13.5 0.457-20.3 0.322-3.41 0.185-6.94-0.433-10.3 0.444-5.37 1.74-3.41 9.51 0.453 10.4-5.31 1.74-4.09 10.6 1.42 11-4.21 2.27-3.18 9.11 1.41 10.2-2.18 2.33-3.93 5.84-1.44 8.69 4.6 2.01-2.5 3.66-0.256 7.42 1.9 5.4 8.45 2.04 12.6 2.94 3.14 0.0137 3.8 1.32 0.371 1.76-4.1 1.73-8.77 3.41-11.6 6.95-3.14 4.08 3.82 6.8 0.532 9.93-0.47 2.53 1.56 4.79-2.37 4.05-5.74-0.1-7.69 8.76-2.68 11.3 4 1.75 7.9 2.31 10.3 6.04 3.21 1.25 6.69 0.132 10-0.203 6.22-1.23 12.5 0.58 18.8 0.443 11.7 0.511 23.5-0.0068 35-2.2 4.33-1.02 8.72-1.8 12.9-3.21 3.99-1.56 7.68-5.21 6.84-9.71-0.012-4.4-5.85-6.18-7.77-5.45-2.68 0.632-4.09-1.24-5.94-2.5 4.27-2.03 9.39-3.35 12.3-7.29 2.62-4.3-2.09-9.97-6.78-8.22-1.1 0.327-2.97 1.72-0.838 0.416-4.37 3.51-4.82-4.46-9.72-3.11 1.87-1.46 8.91-4.78 2.99-2.35-4.86 1.67 4.88-1.29 6.79-2.34 1.62-0.784-3.68-5.75 1.25-4.09 2.81 2.24 2.16-1.46 2.43-2.63 3.38-2.45 0.6-6.82-0.0624-8.94 2.44-1.51 1.21-4.08 1.14-6.33-0.477-4.67-5.18 4.82-4.53 1.09-0.0838-2.09 5.2-3.33 3.62-7.9-3.1-3.56 3.49-7.52-0.873-11.2-2.29-1.88 1.11-7.41-3.46-9.04-0.97-0.535-2.1-0.82-3.21-0.768zm5.24 9.12c0.0118-0.00178 0.0507 0.0433 0 0zm-1.22 40.2c-0.331 0.34-1.93 0.69 0 0zm-74.3 46.1c2.4 0.856 1.33 0.876 0 0z","m72.8 1.64c-5.3 0.108-12.7 0.345-15.7 0.501-14.9 0.773-29.5-0.736-41.1 0.0102-11.6 0.747-14.5 7.19-15.7 16.7-1.21 9.55 3.18 15.6 10.6 17.4 4.59 1.1 9.22 1.9 13.9 2.42l-5.24 1.78 0.604-0.188c-5.22 1.45-9.7 5.05-13 10.4-3.27 5.36-4.9 11.8-4.7 18.5 0.226 7.85 2.83 14.9 7.43 20.2 4.6 5.26 10.4 7.81 16.6 7.28l-2.05-0.0203c10.1 1.07 20.3 1.8 30.5 2.19 9.78 0.375 19.6 0.436 29.3 0.181 7.56-0.196 13.6-8.12 13.4-17.7-0.156-9.58-6.41-17.2-14-17-1.78 0.0465-3.57-0.0584-5.35-0.0339 4.95-3.39 9.51-7.67 13.4-12.9 1.75-2.31 3.9-5.39 5.68-9.8 1.83-4.54 2.47-7.45 1.81-14.2-0.785-7.99-4.04-14.1-8.21-18.4-4.04-4.15-8.5-6.1-12.6-6.88-2.02-0.384-3.91-0.515-5.68-0.479z","m16.4 0.00257a6.4 6.35 0 0 0-6.58 6.17 6.4 6.35 0 0 0 6.22 6.52c5.1 0.143 10.4 0.305 19.4 0.795-7.6 1.3-13.5 2.56-16.8 3.57-1.11 0.343-1.97 0.534-3.44 1.35-0.732 0.409-2.08 0.675-3.22 3.57-0.572 1.45-0.529 3.74 0.203 5.25 0.732 1.5 1.67 2.21 2.34 2.66 2.65 1.78 3.38 1.38 4.93 1.62 1.55 0.239 3.45 0.44 5.97 0.653 5.03 0.425 13.4 0.791 21.2 1.22-1.71 0.318-3.67 0.688-5.16 0.972-6.36 1.22-10.4 2.08-13 2.75-1.32 0.339-2.29 0.613-3.24 0.98-0.478 0.184-0.951 0.371-1.62 0.779-0.67 0.408-1.85 0.867-2.82 3.27-0.483 1.2-0.629 3.1-0.0735 4.61 0.555 1.51 1.5 2.43 2.19 2.95 1.38 1.05 2.09 1.1 2.64 1.24 1.12 0.276 1.72 0.286 2.43 0.327 1.42 0.0823 2.96 0.0728 4.6 0.0728h6.99c-0.382 0.111-1.17 0.293-1.52 0.398-2.22 0.668-3.57 1.05-5.24 1.91-0.416 0.216-0.872 0.454-1.53 0.996s-1.85 1.42-2.33 3.86c-0.481 2.44 1.16 5.38 2.35 6.33 1.19 0.95 1.93 1.11 2.49 1.27 1.8 0.528 2.79 0.52 3.96 0.52-9.64 2.52-18.7 4.99-24.4 6.58-4.53 1.27-6.68 1.76-8.81 2.63-0.533 0.217-1.05 0.279-2.32 1.38-0.633 0.55-1.72 1.54-2.14 3.66-0.421 2.12 0.675 4.63 1.64 5.66 1.94 2.05 2.69 1.77 3.26 1.93 0.571 0.166 0.958 0.239 1.35 0.315 2.75 0.527 8.63 1.11 18.6 1.55 0.0405 0.681 0.0582 1.39 0.286 1.93 0.643 1.54 1.51 2.25 2.09 2.68 1.15 0.866 1.66 0.932 2.09 1.07 0.866 0.281 1.35 0.344 1.98 0.443 1.26 0.198 2.85 0.364 5.17 0.559 9.29 0.78 29.8 1.87 50.5 2.98a6.4 6.35 0 0 0 6.74-6 6.4 6.35 0 0 0-0.584-2.82c0.36-0.184 0.751-0.398 1.46-1.05 0.861-0.794 2.37-3 1.98-5.6-0.391-2.6-1.95-3.79-2.71-4.31-1.53-1.04-1.88-0.893-2.23-0.974-1.39-0.324-1.36-0.204-1.75-0.234-1.58-0.123-4.34-0.277-15.8-0.425-7.69-0.0991-19.2-0.304-30-0.49 4.65-1.2 9.29-2.44 13.8-3.48 14.9-3.42 27.2-5.34 32.7-6.73 0.686-0.174 1.27-0.33 1.99-0.604 0.359-0.137 0.748-0.289 1.34-0.644 0.594-0.355 1.63-0.725 2.65-2.88 0.51-1.08 0.801-2.79 0.429-4.28s-1.21-2.55-1.86-3.16c-1.31-1.22-2.06-1.34-2.6-1.52-1.09-0.355-1.61-0.376-2.24-0.445-2.51-0.274-5.82-0.28-10.7-0.317-0.0931-7.01e-4 -0.236 6.87e-4 -0.33 0 0.21-0.0548 0.585-0.154 0.786-0.207 2.45-0.643 4.24-1.13 5.58-1.53 1.34-0.399 1.87-0.413 3.5-1.32 0.406-0.228 0.94-0.439 1.86-1.51 0.461-0.534 1.08-1.36 1.4-2.74 0.322-1.38 0.0653-3.29-0.639-4.55-1.41-2.52-2.88-2.73-3.58-2.98-0.702-0.245-1.08-0.29-1.39-0.337-0.341-0.0498-0.404-0.0151-0.649-0.0354 0.542-0.114 1.67-0.301 2.16-0.407 2.52-0.551 4.28-0.988 5.73-1.46 0.723-0.234 1.35-0.442 2.2-0.901 0.428-0.23 0.93-0.504 1.62-1.15 0.688-0.641 1.8-1.83 2.07-4.01 0.272-2.17-0.911-4.44-1.88-5.41-0.967-0.962-1.68-1.25-2.21-1.47-1.06-0.452-1.62-0.519-2.18-0.618-1.13-0.199-2.12-0.274-3.15-0.356-4.16-0.33-9.38-0.547-22-1.15-0.0481-0.0023-0.113-0.0076-0.161-0.0099 5.35-0.609 12-1.36 15.3-1.84 2.08-0.301 3.56-0.556 4.86-0.886 0.649-0.165 1.24-0.319 2.08-0.709 0.845-0.39 2.78-0.677 3.81-4.31 0.517-1.82-0.0388-4.13-0.822-5.32-0.783-1.19-1.52-1.67-2.05-2-1.06-0.672-1.6-0.794-2.11-0.955-1.03-0.32-1.82-0.464-2.64-0.626-3.3-0.65-7.81-1.36-17.1-2.16-9.24-0.804-23.3-1.72-33-2.26-9.71-0.537-15.1-0.687-20.3-0.834zm-7.83 76.3c0.0849 0.0247 0.264-0.0317 0.59 0.0807-0.0708-0.0128-0.349-0.0373-0.411-0.0492-0.23-0.0442-0.359-0.0841-0.179-0.0315z","m15 0.00104a6.81 8.11 0 0 0-6.91 7.98 6.81 8.11 0 0 0 6.7 8.23c3.08 0.0583 5.73 0.128 8.76 0.187-0.375 0.129-0.886 0.258-1.24 0.388-1.88 0.696-3.23 0.987-5.39 2.9-1.08 0.959-3.37 3.18-3.15 7.71 0.219 4.53 2.88 6.58 4.13 7.37 1.6 1.01 2.86 1.36 4.15 1.61-0.141 1.66-0.0734 3.37 0.453 4.62 0.889 2.1 1.89 2.8 2.5 3.26 2.45 1.82 2.42 1.15 2.89 1.24 0.473 0.0921 0.87 0.142 1.34 0.195 0.936 0.107 2.11 0.203 3.72 0.313 2.47 0.169 7.02 0.368 10.8 0.57-2.7 0.642-5.02 1.15-7.5 1.75-15.4 3.77-24.7 6.36-29.6 8.36-1.21 0.499-2.02 0.651-3.7 2.14-0.841 0.746-2.73 2.15-2.96 6.33-0.115 2.09 0.607 4.33 1.43 5.61 0.819 1.28 1.59 1.86 2.18 2.26 2.34 1.59 2.96 1.25 3.93 1.39 0.968 0.146 1.94 0.225 3 0.299 2.53 0.177 7.62 0.237 11.8 0.331-0.0236 0.0284-0.0312 0.0225-0.0552 0.0518-0.776 0.949-1.88 2.87-1.96 5.46-0.0726 2.58 1.01 4.78 1.82 5.83 1.63 2.11 2.4 2.06 2.96 2.29 1.71 0.718 2.52 0.777 3.49 0.855a6.81 8.11 0 0 0-0.821 2.9 6.81 8.11 0 0 0 7.25 7.55c18.1-1.45 36.3-2.91 45.2-3.65 4.47-0.373 6.19-0.461 7.94-0.787 0.219-0.0407 0.446-0.0803 0.851-0.203 0.405-0.123 0.782 0.275 2.74-1.63 0.977-0.954 2.88-3.94 2.43-7.51-0.29-2.28-1.06-3.49-1.81-4.35 0.426-0.121 0.962 0.242 2.9-2.09 0.996-1.2 2.44-4.65 1.76-7.77-0.68-3.12-2.16-4.22-2.9-4.79-0.201-0.156-0.252-0.147-0.415-0.259 2.91e-4 -0.0022 0.0086-0.0677 0.0086-0.0677-5.1e-5 -5.82e-4 -0.401-2.04-0.401-2.04-1.8e-4 -5.79e-4 -0.432-1.15-0.677-1.59-0.49-0.891-0.986-1.45-1.39-1.84-1.63-1.59-2.14-1.43-2.55-1.56-0.405-0.131-0.617-0.167-0.792-0.199-0.351-0.0646-0.527-0.078-0.699-0.0936-0.344-0.0313-0.615-0.0415-0.94-0.0538-0.65-0.0245-1.46-0.0395-2.47-0.0538-4.06-0.0573-11.4-0.0936-21.4-0.149-0.704-4e-3 -1.52-0.0138-2.25-0.0179 9.3-2.15 19.7-4.61 25.4-5.92 5.17-1.21 7.46-1.75 9.07-2.27 0.402-0.13 0.656-0.146 1.61-0.683 0.478-0.268 1.29 0.0431 2.94-3.09 0.824-1.56 1.39-5.17 0.431-7.69-0.962-2.52-2.28-3.35-3.01-3.82-2.93-1.86-2.63-0.956-2.99-0.986-0.361-0.0296-0.579-0.0305-0.776-0.0359-1.18-0.032-4.54-0.0306-8.24-0.0319 0.504-2.45 0.311-5.91-0.685-7.55-1.3-2.14-2.24-2.4-2.8-2.7-2.26-1.2-2.15-0.724-2.71-0.795-2.2-0.283-5.44-0.377-11.3-0.592-0.898-0.0328-2.36-0.103-3.36-0.139 0.966-0.213 2.26-0.514 3.15-0.707 9.85-2.16 14.1-3.04 16.6-3.52 0.638-0.119 1.2-0.218 1.71-0.317 0.511-0.0982 0.134 0.367 2.33-0.701 0.549-0.267 1.92 0.456 3.69-4.23 0.882-2.34 0.325-6.49-0.794-8.25-1.12-1.75-1.98-2.13-2.53-2.44-2.18-1.23-2.06-0.742-2.43-0.791-0.73-0.0972-1.25-0.114-2.08-0.153-3.34-0.158-10.7-0.339-17.8-0.562-7.12-0.223-14-0.485-22.4-0.709-8.4-0.224-18.3-0.411-28.1-0.598zm68.4 18.1c0.147 0.0109 0.537 0.038 0.477 0.0299-0.0416-0.0055-0.126 0.0615-0.477-0.0299zm-8.05 6.25c-0.0726 0.0123-0.115 0.0254-0.187 0.0359 0.092-0.0441 0.11-0.0186 0.187-0.0359zm16.6 26.6c0.0692 0.0015 0.482 2.94e-4 0.545 2e-3 0.155 0.0042 0.258 0.0128 0.15 4e-3 -0.0653-0.0053-0.187 0.129-0.696-6e-3z","m8.55 0c-3.58 0-6.49 3.34-6.49 7.47 0 4.12 2.9 7.47 6.49 7.47 6.65 0 11.1 0.0284 17.4 0.0331-3.94 1.03-8.41 2.2-10.6 2.79-0.819 0.227-1.51 0.402-2.44 0.766-0.465 0.182-0.882 0.156-2.23 1.3-0.672 0.573-2.07 1.59-2.59 4.7-0.519 3.1 1.3 6.39 2.4 7.38 0.545 0.494 0.751 0.517 1.11 0.755-0.851 0.793-1.7 2.04-1.92 4.9-0.182 2.34 0.842 4.76 1.76 5.9 0.918 1.14 1.65 1.54 2.21 1.84 0.944 0.509 1.56 0.69 2.17 0.838-1.84 0.486-3.3 0.907-4.29 1.22-0.573 0.181-1.06 0.264-2.19 0.815-0.564 0.276-1.61-0.521-3.49 3.62-0.943 2.07-0.548 6.47 0.701 8.25 1.25 1.79 2.16 2.06 2.75 2.33 2.35 1.09 2.65 0.734 3.96 0.84 1.3 0.106 2.99 0.184 5.33 0.249 0.967 0.0271 3.08 0.0164 4.25 0.0389-0.03 0.453 0.0463 0.927 0.098 1.4-2.79 0.294-7.31 0.716-8.76 0.912-0.7 0.0953-1.23 0.142-2.14 0.362-0.228 0.0549-0.477 0.109-0.958 0.298-0.481 0.188-1.27-0.522-3.31 2.84-1.02 1.68-1.39 5.87-0.314 8.03 0.158 0.316 0.293 0.383 0.448 0.63-0.508 0.0914-1.46 0.14-1.89 0.241-0.532 0.124-0.976 0.17-2.04 0.712-0.53 0.271-1.32 0.478-2.56 2.24-0.618 0.881-1.34 2.39-1.45 4.26s0.508 3.71 1.15 4.78c1.29 2.14 2.23 2.37 2.81 2.67 0.579 0.299 0.942 0.411 1.27 0.51 0.65 0.198 1.13 0.285 1.67 0.375 1.54 0.258 4.31 0.452 6.99 0.661 0.0178 0.111 0.098 0.609 0.098 0.609 1.18e-4 1.99e-4 1.89 2.09 1.89 2.09 2.8e-4 2.02e-4 0.772 0.486 1.02 0.601 0.245 0.114 0.421 0.179 0.566 0.229 0.29 0.101 0.458 0.142 0.591 0.173 1.07 0.25 0.834 0.133 0.97 0.144 1.08 0.0833 2.67 0.123 7.18 0.268 9.02 0.291 28.2 0.873 47.3 1.45 3.58 0.109 6.56-3.15 6.66-7.27-2e-3 -1.13-0.225-2.24-0.652-3.25 0.701-0.0264 2.38-0.0732 2.76-0.0953 0.271-0.0158 0.336 0.0035 0.939-0.0894 0.151-0.0232 0.305-0.0279 0.838-0.191 0.266-0.0814 0.597-0.129 1.45-0.665 0.214-0.134 0.77-0.57 0.77-0.57 3.18e-4 -2.72e-4 1.07-1.16 1.07-1.16 1.82e-4 -2.48e-4 0.923-1.85 1.08-2.17 1.29-0.0298 2.68-0.0594 3.47-0.0894 0.577-0.0219 1.03-0.0442 1.44-0.0739 0.41-0.0297 0.296 0.157 1.8-0.299 0.375-0.114 0.824 0.0351 2.36-1.34 0.384-0.343 0.855-0.825 1.34-1.62 0.242-0.398 0.484-0.879 0.686-1.44 0.202-0.566 0.437-1.91 0.438-1.91 8e-5 -7.61e-4 -0.0253-2.08-0.0253-2.08-1.04e-4 -7.63e-4 -0.259-1.29-0.459-1.82-0.4-1.06-0.901-1.77-1.32-2.26-1.67-1.96-2.22-1.73-2.63-1.88-0.408-0.156-0.616-0.203-0.792-0.245-0.704-0.168-0.9-0.164-1.25-0.204-0.693-0.0796-1.51-0.147-2.49-0.233-0.837-0.0735-2.51-0.187-3.65-0.28 0.199-0.404 0.481-1.07 0.481-1.07 2.07e-4 -5.98e-4 0.387-1.59 0.387-1.59 1.21e-4 -8.51e-4 -0.0995-1.5-0.167-2.52 0.137-0.0616 0.22-0.0839 0.427-0.202 0.205-0.117 0.453-0.269 0.782-0.527 0.329-0.258 1.25-1.29 1.26-1.29 4.23e-4 -5.67e-4 1.44-3.33 1.44-3.34 5.2e-5 -2.7e-4 0.0828-2.54 0.0828-2.54-2.6e-5 -2.64e-4 -0.616-2.32-0.617-2.32-2.17e-4 -5.13e-4 -1.79-2.54-1.79-2.54s-0.924-0.716-1.24-0.889c-1.26-0.692-1.52-0.587-1.79-0.636-1.09-0.198-0.941-0.0984-1.11-0.101-0.166-0.0027-0.293-2e-3 -0.414-2e-3 -0.963 0-2.41 0.0013-5.46-0.0525-0.439-0.0078-2.35-0.0252-2.88-0.035 0.639-0.112 3.1-0.579 3.52-0.648 0.421-0.0691 0.0365 0.255 1.99-0.453 0.244-0.0885 0.55-0.178 1.2-0.583 0.646-0.406 2.4-0.87 3.22-4.84 0.412-1.99-0.123-4.51-0.9-5.86-0.778-1.35-1.52-1.9-2.03-2.26-1.02-0.72-1.44-0.769-1.77-0.869-1.33-0.402-1.33-0.264-1.71-0.292-0.0603-0.0045-0.318-0.0055-0.382-0.0098 0.192-0.174 0.26-0.164 0.502-0.416 0.797-0.833 2.35-3 2.11-6.18-0.231-3.18-2-4.93-2.86-5.6-1.73-1.34-2.11-1.09-2.51-1.17-0.788-0.175-1.06-0.161-1.41-0.183-0.717-0.044-1.42-0.051-2.23-0.0603-1.68-0.0194-6.55-0.0346-9.66-0.0467 1.96-0.633 4.16-1.3 5.6-1.87 1.19-0.466 2.18-0.884 3.22-1.49 0.522-0.302 1.06-0.62 1.79-1.3 0.736-0.679 2.14-1.72 2.6-5.03 0.229-1.66-0.138-3.76-0.855-5.15-0.716-1.39-1.55-2.14-2.19-2.61-1.27-0.948-2-1.08-2.66-1.25-1.31-0.35-2.34-0.43-3.71-0.527-2.75-0.195-6.6-0.254-12.2-0.299-11.1-0.0915-29-0.0914-46.9-0.0914z","M 0,100 V 0 H 100 V 100 H 99 A 49,-98 0 0 0 50,2 49,-98 0 0 0 1,100 Z","M 0,0 V 100 H 100 V 0 H 99 A 49,98 0 0 1 50,98 49,98 0 0 1 1,0 Z","M 0,100 V 0 H 100 V 100 H 95 A 45,-90 0 0 0 50,10 45,-90 0 0 0 5,100 Z","m0 0v100h100v-100h-5a45 90 0 0 1-45 90 45 90 0 0 1-45-90z","M 0,100 V 0 H 100 V 100 H 90 A 40,-80 0 0 0 50,20 40,-80 0 0 0 10,100 Z","M 0,0 V 100 H 100 V 0 H 90 A 40,80 0 0 1 50,80 40,80 0 0 1 10,0 Z","m 0,0 v 100 h 10.035156 c 1.705045,-6.54927 3.941587,-12.742544 6.720703,-18.300782 l 20.09375,-40.1875 C 50.561077,14.088757 71.945169,12.702882 84.796875,38.40625 92.993332,54.799136 95.671807,78.132046 92.986328,100 H 100 V 0 Z","M 0,0 V 100 H 100 V 0 H 92.986328 C 91.461087,12.420096 88.21082,24.367414 83.244141,34.300782 L 63.150391,74.48828 C 49.438924,101.91124 28.054831,103.29712 15.203125,77.59375 4.9562739,57.10008 3.3279352,25.763198 10.035156,0 Z","M 100,0 C 98.542915,3.142831 97.022904,6.152491 95.425781,8.973086 L 62.601562,66.942421 C 40.203879,106.49781 13.008645,96.967171 1.625,45.571361 1.0225932,42.851581 0.48998452,40.055281 0,37.221491 V 100 h 100 z","M 0,0 V 10 C -1.5552177e-6,6.609576 0.10489712,3.277196 0.28515625,0 Z m 0,10 v 90 H 100 V 10 c 1e-5,44.31998 -15.860419,79.99998 -35.5625,80 H 35.5625 C 15.860418,90.00002 0,54.31999 0,10 Z m 100,0 V 0 H 99.714844 C 99.895106,3.277194 99.999998,6.609576 100,10 Z","M 0,0 V 99.999998 H 100 V 26.237487 A 61.723576,126.74566 7.430995 0 1 82.216797,52.190278 61.723576,126.74566 7.430995 0 1 1.3339844,8.692257 61.723576,126.74566 7.430995 0 1 0,0 Z"].forEach((t=>{const s=(0,i.T)("div",{className:"shape-setting-pod"});s.setAttribute("data",t),s.addEventListener("click",this.selectPreset,!0),s.appendChild(this.createPreview(t)),t===this.path&&(this.selected=s,this.selected.classList.add("active")),e.append(s)}));let t=e.querySelector(".active");t&&t.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})},this.createPreview=e=>{const t=p.vL(50,50),s=t.getContext("2d"),i=new Path2D;return i.addPath(new Path2D(e),(new DOMMatrix).scale(.48,.48)),s.translate(1,1),s.lineWidth=2,s.strokeStyle="rgba(255, 255, 255, .5)",s.fillStyle="rgba(0, 0, 0, 0.6)",s.fill(i),s.stroke(i),t},this.selectPreset=e=>{var t;null===(t=this.selected)||void 0===t||t.classList.remove("active"),this.selected=e.currentTarget,this.selected.classList.add("active"),this.path=this.selected.getAttribute("data"),this.preview&&this.preview(this.path),"x"===w.ZP.product&&this.cleanUp()},this.cleanUp=()=>{this.callback&&this.callback(this.path),this.container.remove(),this.modal.remove()},this.path=t,this.preview=n,this.callback=s,this.modal=(0,i.ZP)("workspace").appendChild((0,i.T)("div",{id:"shape-selector-modal",className:"modal"}));let a=(0,i.T)("div",{id:"shape-selector-presets"});this.container=(0,i.T)("div",{id:"shape-selector",className:"shape-float"},a),(0,i.ZP)("workspace").appendChild(this.container),this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1);let r=e.getBoundingClientRect();if("x"===w.ZP.product)this.container.style.width="260px",this.container.style.top=r.bottom-15+"px",this.container.style.left="46px",this.container.offsetTop+this.container.offsetHeight>(0,i.ZP)("workspace").offsetHeight&&(this.container.style.top=(0,i.ZP)("workspace").offsetHeight-this.container.offsetHeight+"px");else{this.container.style.top=r.bottom-5+"px",this.container.style.left=r.left-~~(this.container.offsetWidth/2)+40+"px";const e=(0,i.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,i.Rg)(e,this.resizeStart,this.resizeMove),this.container.append(e)}new x.Z((0,i.ZP)("shape-selector-presets")),this.populatePresets()}}class D{constructor(e,t,s){this.path="M 0,0 H 100 V 100 H 0 Z",this.previewPath=e=>{this.setPath(e),this.preview&&this.preview(this.path)},this.callbackPath=e=>{this.setPath(e),this.callback&&this.callback(this.path)},this.setPath=e=>{this.path=e;let t=this.thumbnail.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);const s=new Path2D;s.addPath(new Path2D(this.path),(new DOMMatrix).scale((t.canvas.width-2)/100,(t.canvas.height-2)/100)),t.save(),t.lineWidth=1,t.translate(1,1),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(s),t.stroke(s),t.restore()},this.getPath=()=>this.path,this.toggle=()=>{new F(this.container,this.path,this.callbackPath,this.previewPath)},this.cleanUp=()=>{this.container.setAttribute("data",this.path),this.container.removeEventListener("click",this.toggle,!1)},this.preview=s,this.callback=t,this.container=(0,i.ZP)(e),this.container.hasChildNodes()?(this.thumbnail=(0,i.ZP)(e+"-canvas"),this.container.hasAttribute("data")&&(this.path=this.container.getAttribute("data"))):(this.container.classList.add("shape-pod"),this.thumbnail=(0,i.T)("canvas",{id:e+"-canvas",width:30,height:30}),this.container.append(this.thumbnail)),this.container.addEventListener("click",this.toggle,!1),this.setPath(this.path)}}class z extends m{constructor(e){let t;super(e),this.stage=e,this.setType=()=>{let e=document.querySelector('input[name="shape-design-type"]:checked').value;(0,i.ZP)("shape-design-path").style.display="path"===e?"block":"none",(0,i.ZP)("shape-design-outline-radii").style.display="rounded"===e?"block":"none"},this.selectType=()=>{let e=document.querySelector('input[name="shape-design-type"]:checked').value;const t=this.selected.shapeSettings.clone();"path"===e?this.selected.setPath(this.shape.getPath()):this.selected.setVariant(e),this.stage.history.add({type:"shapeSettings",kind:"type",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render")),this.setType()},this.previewShape=e=>{this.selected.setPath(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectShape=e=>{const t=this.selected.shapeSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"shapeSettings",kind:"shape",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFill=e=>{this.selected.setFill(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectFill=e=>{const t=this.selected.shapeSettings.clone();this.selected.setFill(e),this.stage.history.add({type:"shapeSettings",kind:"fill",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineState=()=>{const e=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutline=()=>{let e=(0,i.ZP)("shape-design-outline").checked,t=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(e?s:0,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLine=()=>{const e=this.selected.shapeSettings.clone();this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewOutlineColor=e=>{this.selected.setOutline(this.outlineSize.getValue(),this.outlineColor.getColor().toHEX()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectOutlineRadii=()=>{const e=this.selected.shapeSettings.clone();this.selected.setRadii(this.outlineRadii.getValue()),this.stage.history.add({type:"shapeSettings",kind:"radii",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowState=()=>{const e=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("shape-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})},this.setLayer=e=>{if(this.selected=e,"svg"===this.selected.shapeSettings.variant)return void(this.selected=void 0);let t=this.selected.shapeSettings;"line"!==t.variant?((0,i.ZP)("shape-design-settings").style.display="block",(0,i.ZP)("shape-design-line-settings").style.display="none",(0,i.ZP)("shape-design-type-"+t.variant).checked=!0,this.setType(),(0,i.ZP)("shape-design-outline").checked=t.outlineSize>0,this.outlineRadii.setValue(t.radii),this.outlineSize.setValue(t.outlineSize),this.outlineColor.setHex(t.outlineColor),this.fill.setFill(this.selected.fill),"path"===t.variant&&this.shape.setPath(t.content)):(t.outlineSize=this.selected.rect.height,(0,i.ZP)("shape-design-settings").style.display="none",(0,i.ZP)("shape-design-line-settings").style.display="block",this.lineSize.setValue(t.outlineSize),this.lineColor.setHex(t.outlineColor)),(0,i.ZP)("shape-shadow").checked=this.selected.shapeSettings.shadow,this.shadowColor.setHex(this.selected.shapeSettings.shadowColor),this.shadowBlur.setValue(this.selected.shapeSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.shapeSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.shapeSettings.shadowDistance),this.shadowDirection.setValue(this.selected.shapeSettings.shadowDirection)},this.cleanUp=()=>{this.fill.cleanUp(),this.shape.cleanUp(),this.outlineSize.cleanUp(),this.outlineRadii.cleanUp(),this.lineSize.cleanUp(),this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("shape-shadow").removeEventListener("change",this.changeShadowState,!1),(0,i.ZP)("shape-design-outline").removeEventListener("change",this.changeOutlineState,!1),document.querySelectorAll('input[name="shape-design-type"]').forEach((e=>e.removeEventListener("change",this.selectType)))},document.querySelectorAll('input[name="shape-design-type"]').forEach((e=>e.addEventListener("change",this.selectType))),this.shape=new D("shape-design-shape",this.selectShape,this.previewShape),this.fill=new T("shape-design-fill",new u.Z(g.Z.fromHEX(w.ZP.mainColor)),this.selectFill,this.previewFill),this.outlineColor=new k.Z((0,i.ZP)("shape-design-outline-color"),void 0,this.changeOutlineState),this.shadowColor=new k.Z((0,i.ZP)("shape-shadow-color"),void 0,this.changeShadowColor),this.outlineSize=new o.Z("shape-design-outline-size",{onStart:()=>{t=this.selected.shapeSettings.clone()},label:(0,n.Z)("size"),defaultValue:4,range:[1,100],step:1,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:t})}}),this.outlineRadii=new o.Z("shape-design-outline-radii",{label:(0,n.Z)("radii"),defaultValue:5,range:[0,100],step:1,onEnd:this.selectOutlineRadii}),this.lineColor=new k.Z((0,i.ZP)("shape-design-line-color"),void 0,this.selectLine),this.lineSize=new o.Z("shape-design-line-size",{label:(0,n.Z)("size"),defaultValue:1,range:[1,100],step:1,onEnd:this.selectLine});const s={labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100,range:[0,1],onChange:()=>this.changeShadow(),onStart:()=>{t=this.selected.shapeSettings.clone()},onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})}};this.shadowBlur=new o.Z("shape-shadow-blur",Object.assign(Object.assign({},s),{label:(0,n.Z)("blur")})),this.shadowOpacity=new o.Z("shape-shadow-opacity",Object.assign(Object.assign({},s),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("shape-shadow-distance",Object.assign(Object.assign({},s),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("shape-shadow-direction",Object.assign(Object.assign({},s),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,i.ZP)("shape-shadow").addEventListener("change",this.changeShadowState,!1),(0,i.ZP)("shape-design-outline").addEventListener("change",this.changeOutlineState,!1)}}class N extends m{constructor(e){let t;super(e),this.stage=e,this.toggleMode=()=>{this.selected.editMode||this.selected.canvas?(this.selected.editMode=!this.selected.editMode,(0,i.ZP)("frame-position-title").innerText=this.selected.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))):this.stage.notify("frameNoContent")},this.selectShape=e=>{const t=this.selected.frameSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"frameSettings",kind:"shape",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))},this.changeOutlineState=()=>{const e=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,i.ZP)("frame-outline").checked,t=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(e,s,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=e=>{const t=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})},this.changeShadowState=()=>{const e=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("frame-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:t})},this.setLayer=e=>{this.selected=e,(0,i.ZP)("frame-position").style.display=this.selected.canvas?"block":"none",(0,i.ZP)("frame-position-title").innerText=this.selected.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),this.shapePod.setPath(this.selected.frameSettings.clip),(0,i.ZP)("frame-outline").checked=this.selected.frameSettings.outline,this.outlineColor.setHex(this.selected.frameSettings.outlineColor),this.outlineSize.setValue(this.selected.frameSettings.outlineSize),(0,i.ZP)("frame-shadow").checked=this.selected.frameSettings.shadow,this.shadowColor.setHex(this.selected.frameSettings.shadowColor),this.shadowBlur.setValue(this.selected.frameSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.frameSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.frameSettings.shadowDistance),this.shadowDirection.setValue(this.selected.frameSettings.shadowDirection)},this.cleanUp=()=>{this.shapePod.cleanUp(),this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("frame-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("frame-shadow").removeEventListener("change",this.changeShadowState,!1),(0,i.ZP)("frame-position").removeEventListener("click",this.toggleMode,!1),(0,i.ZP)("frame-image").removeEventListener("click",this.stage.browseFrameImage,!1)},(0,i.ZP)("frame-position").addEventListener("click",this.toggleMode,!1),(0,i.ZP)("frame-image").addEventListener("click",this.stage.browseFrameImage,!1),this.shapePod=new D("frame-shape",this.selectShape),this.outlineColor=new k.Z((0,i.ZP)("frame-outline-color"),void 0,this.changeOutlineState),this.shadowColor=new k.Z((0,i.ZP)("frame-shadow-color"),void 0,this.changeShadowColor);const s={onStart:()=>{t=this.selected.frameSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100};this.outlineSize=new o.Z("frame-outline-size",Object.assign(Object.assign({},s),{label:(0,n.Z)("size"),range:[.01,1],defaultValue:.3,step:.01,onChange:()=>this.changeOutline(),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100,onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})}}));const a=Object.assign(Object.assign({},s),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})}});this.shadowBlur=new o.Z("frame-shadow-blur",Object.assign(Object.assign({},a),{label:(0,n.Z)("blur")})),this.shadowOpacity=new o.Z("frame-shadow-opacity",Object.assign(Object.assign({},a),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("frame-shadow-distance",Object.assign(Object.assign({},a),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("frame-shadow-direction",Object.assign(Object.assign({},a),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,i.ZP)("frame-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("frame-shadow").addEventListener("change",this.changeShadowState,!1)}}class B extends r.Z{constructor(e){super("arrange",e),this.isShiftDown=!1,this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectTool=e=>{let t=e.currentTarget.getAttribute("data");document.dispatchEvent(new CustomEvent("select-tool",{detail:t}))},this.addShape=()=>{this.stage.addShape()},this.addFrame=()=>{this.stage.addFrame()},this.addText=()=>{this.stage.addText()},this.inputBegin=()=>{this.stage.reform.beginHistory()},this.inputEnd=e=>{let t=e.target.id;const s="arrange-width"===t||"arrange-height"===t?"resize":"move";this.stage.reform.commitHistory(s)},this.changeName=()=>{let e=this.stage.fresco.getLayerById(this.currentId),t=Object.assign({},e.settings);const s=(0,i.ZP)("arrange-name").value;e.settings.name!==s&&""!==s?(e.settings.name=s,this.stage.history.add({type:"layerSettings",kind:"name",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))):(0,i.ZP)("arrange-name").value=e.settings.name},this.changeContraint=e=>{this.stage.reform.constrain=!this.stage.reform.constrain,(0,i.ZP)("arrange-size-lock").style.display=this.stage.reform.constrain?"block":"none",(0,i.ZP)("arrange-size-vs").style.display=this.stage.reform.constrain?"none":"block"},this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.changeContraint())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.changeContraint())},this.layerSelect=()=>{if(!this.stage||!this.stage.fresco)return;let e=this.stage.fresco.getSelectedStackId();e!==this.currentId&&this.stage.history.commitTransaction(),this.currentId=e;let t=this.stage.fresco.getSelectedStack();if((0,i.ZP)("arrange-type-title").innerText=(0,n.Z)("viewArrangeTitle"),(0,i.ZP)("arrange-no-layer").style.display="none",(0,i.ZP)("arrange-has-layer").style.display="flex",(0,i.ZP)("arrange-text").style.display="none",(0,i.ZP)("arrange-shape").style.display="none",(0,i.ZP)("arrange-image").style.display="none",(0,i.ZP)("arrange-frame").style.display="none",(0,i.ZP)("arrange-transform").style.display="none",(0,i.ZP)("arrange-transform-locked").style.display="none",(0,i.ZP)("arrange-rotate").style.display="block",(0,i.ZP)("arrange-flip-horizontal").style.display="block",(0,i.ZP)("arrange-flip-vertical").style.display="block",(0,i.ZP)("arrange-duplicate").style.display="block",1===t.length&&t[0].rect&&t[0].rect.isSet()){let e=t[0];!e.settings.locked||e.editMode?(0,i.ZP)("arrange-transform").style.display="block":((0,i.ZP)("arrange-transform-locked").style.display="block",(0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none"),e instanceof h.Z?((0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none",(0,i.ZP)("arrange-text").style.display="block",this.textPanel||(this.textPanel=new R(this.stage)),this.textPanel.setLayer(e)):e instanceof c.Z?((0,i.ZP)("arrange-rotate").style.display=e.editMode?"none":"block",(0,i.ZP)("arrange-flip-horizontal").style.display=e.editMode?"block":"none",(0,i.ZP)("arrange-flip-vertical").style.display=e.editMode?"block":"none",(0,i.ZP)("arrange-duplicate").style.display=e.editMode?"none":"block",(0,i.ZP)("arrange-frame").style.display="block",this.framePanel||(this.framePanel=new N(this.stage)),this.framePanel.setLayer(e)):e instanceof l.Z?((0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none","svg"!==e.shapeSettings.variant&&(this.shapePanel||(this.shapePanel=new z(this.stage)),this.shapePanel.setLayer(e),(0,i.ZP)("arrange-shape").style.display="block")):e instanceof d.Z||((0,i.ZP)("arrange-image").style.display="block"),this.updateInputs()}else t.length>1?((0,i.ZP)("arrange-rotate").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none",(0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-transform").style.display="block",this.updateInputs()):((0,i.ZP)("arrange-has-layer").style.display="none",(0,i.ZP)("arrange-no-layer").style.display="block");this.updateSelectedInfo()},this.updateSelectedInfo=()=>{let e=this.stage.fresco.getSelectedStack();if(0===e.length)return;const t=a.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,50,50),s=t.width/this.stage.fresco.width;if(1===e.length){const r=e[0];(0,i.ZP)("arrange-name").value=r.settings.name,(0,i.ZP)("arrange-name").disabled=!1,r instanceof l.Z&&"svg"===r.shapeSettings.variant?((0,i.ZP)("arrange-type-title").innerText="SVG "+(0,n.Z)(r.type),(0,i.ZP)("arrange-type").innerText="SVG "+(0,n.Z)(r.type)):r instanceof c.Z&&r.editMode?((0,i.ZP)("arrange-type-title").innerText=(0,n.Z)(r.type)+" "+(0,n.Z)("content"),(0,i.ZP)("arrange-type").innerText=(0,n.Z)(r.type)+" "+(0,n.Z)("content")):((0,i.ZP)("arrange-type-title").innerText=(0,n.Z)(r.type),(0,i.ZP)("arrange-type").innerText=(0,n.Z)(r.type));const o=this.stage.fresco.width,h=this.stage.fresco.height;let d=(0,i.ZP)("arrange-thumb");d.width=t.width,d.height=t.height;let u=d.getContext("2d");if(u.clearRect(0,0,d.width,d.height),r.canvas)if(r.rect.width/o>.5||r.rect.height/h>.5)u.scale(s,s),this.stage.renderLayer(u,r,!0);else{u.translate(t.width/2,t.height/2),u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.rotate(r.rect.rotation*Math.PI/180);const e=a.Z.bestFit(r.rect.width,r.rect.height,t.width,t.height);u.drawImage(r.bect?r.baked:r.canvas,-e.width/2,-e.height/2,e.width,e.height)}u.setTransform(1,0,0,1,0,0)}else{(0,i.ZP)("arrange-name").value=(0,n.Z)("layerGroupOf",e.length.toString()),(0,i.ZP)("arrange-name").disabled=!0,(0,i.ZP)("arrange-type-title").innerText=(0,n.Z)("layerGroup"),(0,i.ZP)("arrange-type").innerText=(0,n.Z)("layerGroup");let a=(0,i.ZP)("arrange-thumb");a.width=t.width,a.height=t.height;let r=a.getContext("2d");r.clearRect(0,0,a.width,a.height),r.scale(s,s),e.forEach((e=>{e.canvas&&this.stage.renderLayer(r,e,!0)})),r.setTransform(1,0,0,1,0,0)}},this.unlock=()=>{let e=this.stage.fresco.getSelected();if(!e)return;const t=Object.assign(Object.assign({},e.settings),{rect:e.rect.clone()});e.settings.locked=!1,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.stage.history.add({type:"layerSettings",kind:"locked",layer:e,settings:t})},this.inputPosition=e=>{let t=Math.round(Number((0,i.ZP)("arrange-top").value)),s=Math.round(Number((0,i.ZP)("arrange-left").value));this.stage.reform.inputPosition(s,t)},this.inputSize=e=>{if("arrange-width"==e.currentTarget.id){let e=(0,i.ZP)("arrange-width").value,t=NaN!=Number(e)?Math.round(Number(e)):50,s=this.stage.reform.inputSize(t,void 0);(0,i.ZP)("arrange-height").value=Math.round(s.height).toString()}else{let e=(0,i.ZP)("arrange-height").value,t=NaN!=Number(e)?Math.round(Number(e)):50,s=this.stage.reform.inputSize(void 0,t);(0,i.ZP)("arrange-width").value=Math.round(s.width).toString()}},this.updateInputs=()=>{let e=this.stage.fresco.getSelectedStackBounds();if(!e)return;(0,i.ZP)("arrange-width").value=Math.round(e.width).toString(),(0,i.ZP)("arrange-height").value=Math.round(e.height).toString(),(0,i.ZP)("arrange-top").value=Math.round(e.y).toString(),(0,i.ZP)("arrange-left").value=Math.round(e.x).toString();let t=this.stage.fresco.getSelected();t&&(t instanceof h.Z&&this.textPanel&&this.textPanel.textSize.setValue(t.textSettings.size),this.rotate.setValue(t.rect.rotation>180?t.rect.rotation-360:t.rect.rotation))},this.flip=e=>{if(!this.stage.fresco.getSelected())return;const t=e.currentTarget.getAttribute("id");this.stage.flipSelected("arrange-flip-vertical"===t)},this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var e,t,s;null===(e=this.shapePanel)||void 0===e||e.cleanUp(),null===(t=this.framePanel)||void 0===t||t.cleanUp(),null===(s=this.textPanel)||void 0===s||s.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.updateInputs,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("arrange-constraint").removeEventListener("click",this.changeContraint,!1),(0,i.ZP)("arrange-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.ZP)("arrange-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("arrange-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("arrange-unlock").removeEventListener("click",this.unlock,!1),(0,i.ZP)("arrange-width").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-height").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-top").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-left").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-width").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-height").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-top").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-left").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-width").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-height").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-top").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-left").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-flip-vertical").removeEventListener("click",this.flip,!1),(0,i.ZP)("arrange-flip-horizontal").removeEventListener("click",this.flip,!1),(0,i.ZP)("arrange-add-shape").removeEventListener("click",this.addShape,!0),(0,i.ZP)("arrange-add-frame").removeEventListener("click",this.addFrame,!0),(0,i.ZP)("arrange-add-text").removeEventListener("click",this.addText,!0),(0,i.ZP)("image-effect").removeEventListener("click",this.selectTool,!0),(0,i.ZP)("image-adjust").removeEventListener("click",this.selectTool,!0),(0,i.ZP)("image-cutout").removeEventListener("click",this.selectTool,!0),(0,i.ZP)("image-retouch").removeEventListener("click",this.selectTool,!0),(0,i.ZP)("image-liquify").removeEventListener("click",this.selectTool,!0),(0,i.ZP)("image-paint").removeEventListener("click",this.selectTool,!0),this.rotate.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.updateInputs,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("arrange-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("arrange-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("arrange-unlock").addEventListener("click",this.unlock,!1),(0,i.ZP)("arrange-width").addEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-height").addEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-top").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-left").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-width").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-height").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-top").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-left").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-width").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-height").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-top").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-left").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-delete").addEventListener("click",this.deleteLayer,!1),(0,i.ZP)("arrange-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-constraint").addEventListener("click",this.changeContraint,!1),(0,i.ZP)("arrange-name").addEventListener("blur",this.changeName,!1),(0,i.ZP)("arrange-flip-vertical").addEventListener("click",this.flip,!1),(0,i.ZP)("arrange-flip-horizontal").addEventListener("click",this.flip,!1),(0,i.ZP)("arrange-size-lock").style.display=this.stage.reform.constrain?"block":"none",(0,i.ZP)("arrange-size-vs").style.display=this.stage.reform.constrain?"none":"block",this.rotate=new o.Z("arrange-rotate",{label:(0,n.Z)("rotate"),step:1,range:[-180,180],defaultValue:0,labelFormat:e=>e.toFixed(1)+"°",labelParse:e=>parseFloat(e),onStart:()=>{this.stage.reform.beginHistory()},onChange:e=>{this.stage.reform.inputRotation(e<0?360+e:e)},onEnd:e=>{this.stage.reform.commitHistory("rotate")}}),(0,i.ZP)("arrange-add-shape").addEventListener("click",this.addShape,!0),(0,i.ZP)("arrange-add-frame").addEventListener("click",this.addFrame,!0),(0,i.ZP)("arrange-add-text").addEventListener("click",this.addText,!0),(0,i.ZP)("image-effect").addEventListener("click",this.selectTool,!0),(0,i.ZP)("image-adjust").addEventListener("click",this.selectTool,!0),(0,i.ZP)("image-cutout").addEventListener("click",this.selectTool,!0),(0,i.ZP)("image-retouch").addEventListener("click",this.selectTool,!0),(0,i.ZP)("image-liquify").addEventListener("click",this.selectTool,!0),(0,i.ZP)("image-paint").addEventListener("click",this.selectTool,!0),this.layerSelect()}}},3515:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),n=s(6548),a=s(3655),r=s(6817),o=s(9872),h=s(3673),c=s(8203),l=s(4188);class d extends c.Z{constructor(e){super("crop",e),this.aspectX=0,this.aspectY=0,this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.rotateOrFlip=e=>{switch(e.currentTarget.getAttribute("id")){case"flip-vertical":this.stage.flip(!0);break;case"flip-horizontal":this.stage.flip(!1);break;case"rotate-left":this.stage.rotate(!0);break;case"rotate-right":this.stage.rotate(!1)}},this.inputBlur=e=>{(0,i.ZP)("crop-width").value=Math.round(this.crop.width).toString(),(0,i.ZP)("crop-height").value=Math.round(this.crop.height).toString()},this.updateCrop=e=>{var t;this.applying||(this.crop=new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.stage.fresco.lockedBackground()&&this.crop.equalTo(this.stage.fresco.layers[0].rect)?(this.stage.fresco.layers[0].rect.rotation=0,(0,i.ZP)("crop-straighten").style.display="block"):(0,i.ZP)("crop-straighten").style.display="none",(0,i.ZP)("crop-aspect").checked=!1,null===(t=this.straighten)||void 0===t||t.reset(),this.updateSizeInput(),this.render())},this.viewportChange=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.render()},this.markAspect=(e,t)=>{if((0,i.ZP)("crop-aspect").checked=0!=e||0!=t,0!==e){let e=(t,s)=>0==s?t:e(s,t%s),t=e(this.crop.width,this.crop.height);(0,i.ZP)("crop-aspect-width").value=(this.crop.width/t).toString(),(0,i.ZP)("crop-aspect-height").value=(this.crop.height/t).toString()}(0,i.ZP)("crop-aspect-size").checked=!1,(0,i.ZP)("crop-aspect-ratio").checked=!0,(0,i.ZP)("crop-aspect-preset").value="0:0"},this.aspectActivate=e=>{let t=["0","0"];(0,i.ZP)("crop-aspect").checked&&(t[0]=t[1]="1",(0,i.ZP)("crop-aspect-size-tip").style.display="none",(0,i.ZP)("crop-aspect-preset").value="1:1",(0,i.ZP)("crop-aspect-size").checked=!1,(0,i.ZP)("crop-aspect-ratio").checked=!0,(0,i.ZP)("crop-aspect-width").value="1",(0,i.ZP)("crop-aspect-height").value="1"),this.setAspect(Number(t[0]),Number(t[1]))},this.aspectModeChange=e=>{let t=e.currentTarget===(0,i.ZP)("crop-aspect-ratio")?"ratio":"size",s=Number((0,i.ZP)("crop-aspect-width").value),n=Number((0,i.ZP)("crop-aspect-height").value);if("ratio"===t){let e=(t,s)=>0==s?t:e(s,t%s),t=e(s,n);(0,i.ZP)("crop-aspect-width").value=(s/t).toString(),(0,i.ZP)("crop-aspect-height").value=(n/t).toString()}else(0,i.ZP)("crop-aspect-width").value=(0,i.ZP)("crop-width").value,(0,i.ZP)("crop-aspect-height").value=(0,i.ZP)("crop-height").value;s=Number((0,i.ZP)("crop-aspect-width").value),n=Number((0,i.ZP)("crop-aspect-height").value),this.setAspect(s,n),(0,i.ZP)("crop-aspect-size-tip").style.display="ratio"===t?"none":"block",(0,i.ZP)("crop-aspect-preset").value="0:0"},this.aspectPresetChange=e=>{let t=(0,i.ZP)("crop-aspect-preset").value.split(":");if("0"===t[0])return;if("x"===t[0]&&"y"===t[1]){let e=(t,s)=>0==s?t:e(s,t%s),s=e(this.stage.fresco.width,this.stage.fresco.height);t[0]=(this.stage.fresco.width/s).toString(),t[1]=(this.stage.fresco.height/s).toString()}let s=Number(t[0]),n=Number(t[1]);this.setAspect(s,n);let a="x"!==t[0]&&s>50;(0,i.ZP)("crop-aspect-size").checked=a,(0,i.ZP)("crop-aspect-ratio").checked=!a,(0,i.ZP)("crop-aspect-width").value=t[0],(0,i.ZP)("crop-aspect-height").value=t[1]},this.aspectWidthHeightInputChange=e=>{let t=(0,i.ZP)("crop-aspect-width").value,s=(0,i.ZP)("crop-aspect-height").value,n=NaN!=Number(t)?Number(t):1,a=NaN!=Number(s)?Number(s):1;this.setAspect(n,a)},this.setAspect=(e,t)=>{this.aspectX=e,this.aspectY=t,this.calculate(new h.Z(0,0),new h.Z(this.stage.fresco.width,this.stage.fresco.height)),this.crop.width<30&&(this.crop.width=30),this.crop.height<30&&(this.crop.height=30),this.crop.x+=Math.round((this.stage.fresco.width-this.crop.width)/2),this.crop.y+=Math.round((this.stage.fresco.height-this.crop.height)/2),this.updateSizeInput(),window.requestAnimationFrame(this.render)},this.widthHeightInputChange=e=>{let t=(0,i.ZP)("crop-width").value,s=(0,i.ZP)("crop-height").value,n=NaN!=Number(t)?Number(t):this.stage.fresco.width,a=NaN!=Number(s)?Number(s):this.stage.fresco.height,r=Math.round(30/this.stage.zoom);if(n<r?n=r:n>this.stage.fresco.width&&(n=this.stage.fresco.width),a<r?a=r:a>this.stage.fresco.height&&(a=this.stage.fresco.height),this.crop.width=n,this.crop.height=a,0!=this.aspectX){let t=e.currentTarget.getAttribute("id");"crop-width"==t?this.crop.height=this.stage.fresco.height:this.crop.width=this.stage.fresco.width,this.calculate(this.crop.topLeft(),this.crop.bottomRight()),this.updateSizeInput("crop-width"==t,"crop-height"==t)}this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height),window.requestAnimationFrame(this.render)},this.updateSizeInput=(e,t)=>{e||((0,i.ZP)("crop-width").value=this.crop.width.toString()),t||((0,i.ZP)("crop-height").value=this.crop.height.toString())},this.down=e=>{this.p=this.stage.translateRasterToFresco(e),this.setCursor(this.p),this.updateSizeInput(),this.downTopLeft=this.crop.topLeft(),this.downBottomRight=this.crop.bottomRight(),this.raster.addEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.move=e=>{e=this.stage.translateRasterToFresco(e),this.isDown?this.reform(this.p.x-e.x,this.p.y-e.y):this.setCursor(e)},this.up=e=>{this.raster.removeEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.setCursor=e=>{let t=this.crop.width/6,s=this.crop.height/6;e.x<=this.crop.x+t?e.y<this.crop.y+s?this.method="nw-resize":e.y<this.crop.y+this.crop.height-s?this.method="w-resize":this.method="sw-resize":e.x>this.crop.x+t&&e.x<this.crop.x+this.crop.width-t?e.y<this.crop.y+s?this.method="n-resize":e.y<this.crop.y+this.crop.height-s?this.method="move":this.method="s-resize":e.y<this.crop.y+s?this.method="ne-resize":e.y<this.crop.y+this.crop.height-s?this.method="e-resize":this.method="se-resize",this.raster.style.cursor=this.method},this.refit=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height);let e=Math.round(30/this.stage.zoom),t=new h.Z(this.crop.x,this.crop.y),s=new h.Z(this.crop.right(),this.crop.bottom());t.x<0&&(t.x=0),t.y<0&&(t.y=0),s.x>this.stage.fresco.width&&(s.x=this.stage.fresco.width),s.y>this.stage.fresco.height&&(s.y=this.stage.fresco.height),s.x<t.x+e&&(s.x=t.x+e),s.y<t.y+e&&(s.y=t.y+e),t.x>s.x-e&&(t.x=s.x-e),t.y>s.y-e&&(t.y=s.y-e),this.calculate(t,s),this.updateSizeInput(),this.render()},this.reform=(e,t)=>{if("move"==this.method)this.crop.x=this.downTopLeft.x-e,this.crop.y=this.downTopLeft.y-t,this.crop.x<0?this.crop.x=0:this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.y<0?this.crop.y=0:this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height);else{let s=this.downTopLeft.clone(),i=this.downBottomRight.clone();switch(this.method){case"w-resize":0!=this.aspectX&&(i.y=this.stage.fresco.height),s.x=this.downTopLeft.x-e;break;case"e-resize":0!=this.aspectX&&(i.y=this.stage.fresco.height),i.x=this.downBottomRight.x-e;break;case"n-resize":0!=this.aspectX&&(i.x=this.stage.fresco.width),s.y=this.downTopLeft.y-t;break;case"s-resize":0!=this.aspectX&&(i.x=this.stage.fresco.width),i.y=this.downBottomRight.y-t;break;case"nw-resize":s.x=this.downTopLeft.x-e,s.y=this.downTopLeft.y-t;break;case"ne-resize":s.y=this.downTopLeft.y-t,i.x=this.downBottomRight.x-e;break;case"sw-resize":s.x=this.downTopLeft.x-e,i.y=this.downBottomRight.y-t;break;case"se-resize":i.x=this.downBottomRight.x-e,i.y=this.downBottomRight.y-t}let n=Math.round(30/this.stage.zoom);s.x!=this.downTopLeft.x&&(s.x<0?s.x=0:s.x>i.x-n&&(s.x=i.x-n)),s.y!=this.downTopLeft.y&&(s.y<0?s.y=0:s.y>i.y-n&&(s.y=i.y-n)),i.x!=this.downBottomRight.x&&(i.x>this.stage.fresco.width?i.x=this.stage.fresco.width:i.x<s.x+n&&(i.x=s.x+n)),i.y!=this.downBottomRight.y&&(i.y>this.stage.fresco.height?i.y=this.stage.fresco.height:i.y<s.y+n&&(i.y=s.y+n)),this.calculate(s,i,this.downTopLeft),this.updateSizeInput()}window.requestAnimationFrame(this.render)},this.render=()=>{let e=this.crop.scale(this.stage.zoom);e.x+=this.viewport.x,e.y+=this.viewport.y;let t=e.width<200||e.height<200?15:30;if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.straightenIsDown){this.ctx.lineWidth=1,this.ctx.fillStyle=a.wf,this.ctx.translate(.5,.5),this.ctx.beginPath();let e=new h.Z(Math.round(this.raster.width/2),Math.round(this.raster.height/2));this.ctx.moveTo(this.viewport.x,e.y),this.ctx.lineTo(this.viewport.right()-1,e.y),this.ctx.moveTo(e.x,this.viewport.y),this.ctx.lineTo(e.x,this.viewport.bottom()-1),this.ctx.strokeStyle="rgba(255,255,255,.5)";let t=0,s=e.x;for(;s>this.viewport.x;)t%5==0?(this.ctx.moveTo(s,this.viewport.y),this.ctx.lineTo(s,this.viewport.bottom()-1),this.ctx.moveTo(e.x+e.x-s,this.viewport.y),this.ctx.lineTo(e.x+e.x-s,this.viewport.bottom()-1)):(this.ctx.moveTo(s,e.y-3),this.ctx.lineTo(s,e.y+3),this.ctx.moveTo(e.x+e.x-s,e.y-3),this.ctx.lineTo(e.x+e.x-s,e.y+3)),s-=30,t++;t=0;let i=e.y;for(;i>this.viewport.y;)t%5==0?(this.ctx.moveTo(this.viewport.x,i),this.ctx.lineTo(this.viewport.right()-1,i),this.ctx.moveTo(this.viewport.x,e.y+e.y-i),this.ctx.lineTo(this.viewport.right()-1,e.y+e.y-i)):(this.ctx.moveTo(e.x-3,i),this.ctx.lineTo(e.x+3,i),this.ctx.moveTo(e.x-3,e.y+e.y-i),this.ctx.lineTo(e.x+3,e.y+e.y-i)),i-=30,t++;this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,50,0,2*Math.PI),this.ctx.arc(e.x,e.y,300,0,2*Math.PI),this.ctx.stroke()}else{if(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(this.viewport.x<0?0:this.viewport.x,this.viewport.y<0?0:this.viewport.y,this.viewport.width,this.viewport.height),this.ctx.clearRect(e.x,e.y,e.width,e.height),this.ctx.lineWidth=1,this.ctx.fillStyle=a.wf,this.ctx.translate(.5,.5),this.ctx.strokeStyle="rgb(0,0,0)",this.ctx.strokeRect(e.x,e.y,e.width-1,e.height-1),this.ctx.strokeStyle=a.wf,this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.isDown){let t=Math.round(e.width/3),s=Math.round(e.height/3);this.ctx.strokeStyle="rgba(255,255,255,.5)",this.ctx.beginPath(),this.ctx.moveTo(e.x+t,e.y),this.ctx.lineTo(e.x+t,e.bottom()),this.ctx.moveTo(e.x+2*t,e.y),this.ctx.lineTo(e.x+2*t,e.bottom()),this.ctx.moveTo(e.x,e.y+s),this.ctx.lineTo(e.right(),e.y+s),this.ctx.moveTo(e.x,e.y+2*s),this.ctx.lineTo(e.right(),e.y+2*s),this.ctx.stroke()}this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillRect(e.x-3,e.y-3,t,3),this.ctx.fillRect(e.x-3,e.y,3,t-3),this.ctx.fillRect(e.x-3,e.y+e.height,t,3),this.ctx.fillRect(e.x-3,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y-3,t,3),this.ctx.fillRect(e.x+e.width,e.y,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y+e.height,t,3),this.ctx.fillRect(e.x+e.width,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y-3,2*t,3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y+e.height,2*t,3),this.ctx.fillRect(e.x-3,e.y+e.height/2-t,3,2*t),this.ctx.fillRect(e.x+e.width,e.y+e.height/2-t,3,2*t)}},this.dblClick=()=>{this.setAspect(this.aspectY,this.aspectX)},this.apply=()=>{this.applying=!0;const e=this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation;if(!this.crop.equalTo(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))||e){let t,s=new o.Z(this.stage.fresco.width,this.stage.fresco.height),i=new h.Z(-this.crop.x,-this.crop.y);if(e){const e=this.stage.fresco.layers[0];t=a.dN(e.canvas),s=new o.Z(e.canvas.width,e.canvas.height),i.x+=-e.rect.x,i.y+=-e.rect.y,e.applyStraighten(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))}this.stage.fresco.crop(this.crop),this.stage.history.add({type:"crop",offset:i,size:s,straighten:t})}if((0,i.ZP)("crop-aspect").checked&&(0,i.ZP)("crop-aspect-size").checked){const e=Number((0,i.ZP)("crop-aspect-width").value),t=Number((0,i.ZP)("crop-aspect-height").value),s=new o.Z(this.stage.fresco.width,this.stage.fresco.height);if(s.width!==e||s.height!==t){const i=this.stage.fresco.layers.map((e=>e.clone()));this.stage.fresco.resize(e,t,!0),this.stage.history.add({type:"pageResize",size:s,layers:i})}}},this.cancel=()=>{this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation&&this.stage.straighten(0)},this.cleanUp=()=>{var e;this.removeDownListeners(),document.removeEventListener("history-update",this.updateCrop,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),this.raster.removeEventListener("pointermove",this.pointerMove,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1);const t=(0,i.ZP)("crop-width");t.removeEventListener("input",this.widthHeightInputChange,!1),t.removeEventListener("blur",this.inputBlur,!1);const s=(0,i.ZP)("crop-height");s.removeEventListener("input",this.widthHeightInputChange,!1),s.removeEventListener("blur",this.inputBlur,!1);const n=(0,i.ZP)("crop-aspect-width");n.removeEventListener("input",this.aspectWidthHeightInputChange,!1),n.removeEventListener("blur",this.inputBlur,!1);const a=(0,i.ZP)("crop-aspect-height");a.removeEventListener("input",this.aspectWidthHeightInputChange,!1),a.removeEventListener("blur",this.inputBlur,!1),null===(e=this.straighten)||void 0===e||e.cleanUp(),(0,i.ZP)("crop-aspect").removeEventListener("change",this.aspectActivate,!1),(0,i.ZP)("crop-aspect-preset").removeEventListener("change",this.aspectPresetChange,!1),(0,i.ZP)("crop-aspect-size").removeEventListener("click",this.aspectModeChange,!1),(0,i.ZP)("crop-aspect-ratio").removeEventListener("click",this.aspectModeChange,!1),(0,i.ZP)("crop-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("crop-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("crop-cancel").removeEventListener("click",this.cancelClick,!1);let r=(0,i.ZP)("crop-rotate-flip").getElementsByTagName("li");for(var o=0;o<r.length;o++)r[o].removeEventListener("click",this.rotateOrFlip,!1);this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.viewport=null,this.ctx=null,this.stage.updateViewport()},this.raster=e.raster,this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,document.addEventListener("history-update",this.updateCrop,!1),document.addEventListener("viewport-render",this.viewportChange,!1),this.raster.addEventListener("pointermove",this.pointerMove,!1),this.raster.addEventListener("dblclick",this.dblClick,!1);const t=(0,i.ZP)("crop-width");t.addEventListener("input",this.widthHeightInputChange,!1),t.addEventListener("blur",this.inputBlur,!1);const s=(0,i.ZP)("crop-height");s.addEventListener("input",this.widthHeightInputChange,!1),s.addEventListener("blur",this.inputBlur,!1);const c=(0,i.ZP)("crop-aspect-width");c.addEventListener("input",this.aspectWidthHeightInputChange,!1),c.addEventListener("blur",this.inputBlur,!1);const d=(0,i.ZP)("crop-aspect-height");d.addEventListener("input",this.aspectWidthHeightInputChange,!1),d.addEventListener("blur",this.inputBlur,!1),this.straighten=new l.Z("crop-straighten",{range:[-25,25],step:.25,force:!0,label:(0,n.Z)("straighten"),labelFormat:e=>e.toFixed(1)+"°",labelParse:e=>parseFloat(e),onChange:e=>{this.stage.straighten(e),this.calculate(new h.Z(0,0),new h.Z(this.stage.fresco.width,this.stage.fresco.height)),this.refit()},onStart:()=>{this.straightenIsDown=!0,this.render()},onEnd:(e,t)=>{this.straightenIsDown=!1,this.refit(),this.render()}}),(0,i.ZP)("crop-aspect").addEventListener("change",this.aspectActivate,!1),(0,i.ZP)("crop-aspect-preset").addEventListener("change",this.aspectPresetChange,!1),(0,i.ZP)("crop-aspect-size").addEventListener("click",this.aspectModeChange,!1),(0,i.ZP)("crop-aspect-ratio").addEventListener("click",this.aspectModeChange,!1),(0,i.ZP)("crop-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("crop-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("crop-cancel").addEventListener("click",this.cancelClick,!1);let u=(0,i.ZP)("crop-rotate-flip").getElementsByTagName("li");for(var p=0;p<u.length;p++)u[p].addEventListener("click",this.rotateOrFlip,!1);this.addDownListeners(),this.updateCrop()}calculate(e,t,s){if(this.crop.x=Math.round(e.x<t.x?e.x:t.x),this.crop.y=Math.round(e.y<t.y?e.y:t.y),this.crop.width=Math.round(e.x<t.x?t.x-this.crop.x:e.x-this.crop.x),this.crop.height=Math.round(e.y<t.y?t.y-this.crop.y:e.y-this.crop.y),0!=this.aspectX&&0!=this.aspectY){let t=this.crop.height,i=this.crop.width;this.aspectY/this.aspectX*(this.crop.width/this.crop.height)<this.aspectX/this.aspectY*(this.crop.height/this.crop.width)?this.crop.height=Math.round(this.crop.width*(this.aspectY/this.aspectX)):this.crop.width=Math.round(this.crop.height*(this.aspectX/this.aspectY)),s&&(s.x!=e.x&&(this.crop.x+=Math.round(i-this.crop.width)),s.y!=e.y&&(this.crop.y+=Math.round(t-this.crop.height)))}}}},7846:(e,t,s)=>{s.d(t,{Z:()=>Z});var i=s(3947),n=s(6548),a=s(3655);class r{constructor(e,t,s){this.start=e,this.stop=t,this.row=s}}var o=s(8203),h=s(4188),c=s(8776),l=s(2257),d=s(4820),u=s(4256),p=s(7175),g=s(3868),m=s(6817),v=s(1030),f=s(5574);async function y(e,t){t.addShader("alpha-shift-mask",!0);const s=await async function(e){const t=await fetch("/api/auth/ai/remove-background/"),s=await t.json();if(!1===s.status)throw new Error(s.message);const i=new AbortController,{signal:n}=i,r="https://api.phosus.com/bgremove/v1",o=await new Promise(((t,s)=>{a.eY(e,640,640).toBlob(t,"image/jpeg",.8)})),h=new FormData;h.set("image_file",new File([o],"file.jpg"));const c=await fetch(r,{method:"POST",headers:{authorizationtoken:s.data,Accept:"application/json"},body:h,signal:n}),l=await c.json();if(!l.ok)throw new Error(l.error);return await(0,f.OA)("data:image/jpeg;base64,"+l.results.mask)}(e.canvas),i=a.qT(s,1080);e.addMask();e.mask.getContext("2d").drawImage(t.apply(i),0,0,e.mask.width,e.mask.height),e.render()}class w extends g.Z{constructor(e){super((0,n.Z)("dialogAiCutoutTitle")),this.run=async()=>{try{let e=this.stage.fresco.getSelected();const t=a.$E(e.mask);await y(e,this.shaders),this.stage.render(),this.stage.history.add({type:"mask",layer:e,rect:new m.Z(0,0,e.mask.width,e.mask.height),patch:t}),this.cleanUp()}catch(e){console.error(e),(0,i.ZP)("ai-icon").src="/img/icon/ai-err.svg",(0,i.ZP)("dialog-cancel"+this.mid).innerText=(0,n.Z)("close"),(0,i.ZP)("ai-load").style.display="none",(0,i.ZP)("ai-message").innerText=window.navigator.onLine?(0,n.Z)("genericError"):(0,n.Z)("genericOffline")}},this.stage=e,this.dialog.style.width="300px",this.dialog.style.maxWidth="300px",this.setContent('\n            <div class="premium-tag" tooltip="Premium" flow="down"><img src="/img/icon/premium.svg"></div>\n            <img src="/img/icon/ai.svg" id="ai-icon" class="ic">\n            <div id="ai-load" class="ai-load"><div class="dot-floating"></div></div> \n            <div id="ai-message" class="pad-20">Machines are doing their thing, please wait ..</div>\n        '),(0,i.ZP)("dialog-apply"+this.mid).style.display="none",this.shaders=new u.Z,this.shaders.addShader("alpha-shift-mask",!0),(0,v.Z)("run-ai-cutout"),this.run()}}var b=s(972),x=s(1951);class Z extends o.Z{constructor(e){super("cutout",e),this.type="",this.mode="remove",this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("cutout-no-layer").style.display="block",(0,i.ZP)("cutout-sub-tools").style.display="none",void(this.selected=null);(0,i.ZP)("cutout-sub-tools").style.display="block",(0,i.ZP)("cutout-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),"brush"===this.type&&this.updateBrush(),this.renderMask()},this.selectType=e=>{this.setType(e.currentTarget.value)},this.setType=e=>{e!==this.type&&(""!==this.type&&((0,i.ZP)("cutout-"+this.type+"-settings").style.display="none"),(0,i.ZP)("cutout-"+e+"-settings").style.display="block",this.type=e,this.selected&&!this.selected.hasMask()&&("shape"===this.type?this.setMode("keep"):this.setMode("remove")),this.selected?"brush"===this.type?this.updateBrush():(this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair"):this.stage.raster.style.cursor="auto")},this.toggleMode=()=>{this.setMode("keep"===this.mode?"remove":"keep")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("cutout-mode-remove")?"remove":"keep")},this.setMode=e=>{if(this.mode=e,(0,i.ZP)("cutout-mode-remove").checked="remove"===this.mode,(0,i.ZP)("cutout-mode-keep").checked="keep"===this.mode,"brush"===this.type)this.updateBrush()},this.zoomChange=()=>{if("brush"===this.type)this.updateBrush()},this.isKeyDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isKeyDown||(this.isKeyDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isKeyDown=!1,this.toggleMode())},this.down=e=>{if(this.selected)if(this.downPoint=e,"magic"!==this.type){switch(this.type){case"brush":this.downBrush(e);break;case"lasso":this.downLasso(e);break;case"shape":this.downShape(e)}this.addMoveListeners()}else this.applyMagic(e)},this.move=e=>{switch(this.type){case"shape":this.moveShape(e);break;case"brush":this.moveBrush(e);break;case"lasso":this.moveLasso(e)}},this.up=e=>{switch(this.removeMoveListeners(),this.type){case"shape":this.applyShape(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(e,this.selected.rect));break;case"brush":this.applyBrush();break;case"lasso":this.applyLasso()}},this.applyMagic=e=>{if((e=this.stage.translateRasterToFresco(e,this.selected.rect)).x<0||e.y<0||e.x>this.selected.canvas.width||e.y>this.selected.canvas.height)return;const t=this.prepareMask();let s=document.querySelector('input[name="cutout-magic-smooth"]:checked').value,n=this.selected.canvas.getContext("2d").getImageData(e.x,e.y,1,1).data,a=new c.Z(n[0],n[1],n[2],n[3]);if(0===a.a&&"remove"===this.mode&&"none"===s)return;let r=100*this.tolerance.getValue(),o=(this.selected.baked&&"remove"===this.mode?this.selected.baked:this.selected.canvas).getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);this.cpx=new Uint32Array(o.data.buffer);let h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.mpx=new Uint32Array(h.data.buffer),(0,i.ZP)("cutout-magic-contiguous").checked?this.floodFill(e,a,r,"none"!==s):this.allFill(a,r),this.scratch.ctx.putImageData(h,0,0),this.cpx=null,this.mpx=null,this.drawToMask(t,s)},this.updateBrush=()=>{this.brush||(this.brush=new l.Z(new b.Z)),this.brush.settings.size=this.size.getValue(),this.brush.settings.softness=this.softness.getValue(),this.brush.generate("keep"===this.mode?new c.Z(0,255,0,255):new c.Z(255,0,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,i.ZP)("cutout-brush-preview").innerHTML="",(0,i.ZP)("cutout-brush-preview").appendChild(this.brush.canvas)},this.downBrush=e=>{this.x=this.y=-1,this.scratch.settings.opacity=.4,this.moveBrush(e)},this.x=-1,this.y=-1,this.moveBrush=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.applyBrush=()=>{const e=this.prepareMask();this.drawToMask(e,"none")},this.downLasso=e=>{this.points=[]},this.moveLasso=e=>{this.rasterctx.save(),this.points.push(e),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.rasterctx.lineCap="round",this.rasterctx.setLineDash([6]),this.rasterctx.beginPath(),this.rasterctx.moveTo(this.points[0].x,this.points[0].y),this.points.forEach((e=>{this.rasterctx.lineTo(e.x,e.y)})),this.rasterctx.stroke(),this.rasterctx.restore()},this.applyLasso=()=>{if(this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.points.length<2)return;const e=this.points.map((e=>this.stage.translateRasterToFresco(e,this.selected.rect))),t=this.prepareMask();let s=document.querySelector('input[name="cutout-lasso-smooth"]:checked').value;this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>this.scratch.ctx.lineTo(e.x,e.y))),this.scratch.ctx.fill(),this.drawToMask(t,s)},this.downShape=e=>{this.shapeType=document.querySelector('input[name="cutout-shape-type"]:checked').value},this.moveShape=e=>{switch(this.rasterctx.save(),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.shapeType){case"square":this.rasterctx.setLineDash([6]),this.rasterctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y);break;case"circle":this.rasterctx.setLineDash([6]),p.Z.ellipse(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"triangle":this.rasterctx.setLineDash([6]),p.Z.triangle(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"star":this.rasterctx.setLineDash([6]),p.Z.star(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"heart":this.rasterctx.setLineDash([6]),p.Z.heart(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"line":this.rasterctx.lineWidth=4,p.Z.line(this.rasterctx,this.downPoint,e),this.rasterctx.stroke()}this.rasterctx.restore()},this.applyShape=(e,t)=>{if(e.x===t.x&&e.y===t.y)return;this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height);const s=this.prepareMask(),i=document.querySelector('input[name="cutout-shape-smooth"]:checked').value;switch(this.shapeType){case"square":this.scratch.ctx.fillRect(e.x,e.y,t.x-e.x,t.y-e.y);break;case"circle":p.Z.ellipse(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"triangle":p.Z.triangle(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"star":p.Z.star(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"heart":p.Z.heart(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"line":this.scratch.ctx.lineWidth=4/this.stage.zoom,p.Z.line(this.scratch.ctx,e,t),this.scratch.ctx.stroke()}this.drawToMask(s,i)},this.prepareMask=()=>{let e=!1;return this.selected.hasMask()||(this.selected.addMask("remove"===this.mode?"fill":"clear"),e=!0),e},this.renderMask=()=>{this.selected.hasMask()&&(this.selected.render(),(0,i.ZP)("cutout-show-ghost").checked&&this.renderGhost(),this.stage.render())},this.renderGhost=()=>{if(this.selected.hasMask()){var e=this.selected.baked.getContext("2d");e.save(),e.globalAlpha=.33,e.drawImage(this.selected.canvas,0,0),e.restore(),e=null}},this.auto=e=>{this.selected&&(d.ZP.user.subscription?new w(this.stage):new x.Z(this.stage,"CUTOUT"))},this.delete=()=>{this.stage.maskDelete()},this.bake=()=>{this.stage.maskApply()},this.invert=()=>{this.stage.maskInvert()},this.allFill=(e,t)=>{for(var s=0;s<this.mpx.length;++s)this.tolerate(s,e,t)&&(this.mpx[s]=4294967295)},this.floodFill=(e,t,s,i)=>{let n=this.selected.canvas.width,a=this.selected.canvas.height,r=new Array,o=new Array(n*a);for(this.linearFill(e.x,e.y,t,s,i,r,o);r.length>0;)for(var h=r.shift(),c=h.start;c<=h.stop;++c)h.row>0&&!o[(h.row-1)*n+c]&&this.linearFill(c,h.row-1,t,s,i,r,o),h.row<a-1&&!o[(h.row+1)*n+c]&&this.linearFill(c,h.row+1,t,s,i,r,o)},this.linearFill=(e,t,s,i,n,a,o)=>{var h=this.selected.canvas.width;if(o[h*t+e]=!0,this.tolerate(h*t+e,s,i)){this.mpx[h*t+e]=4294967295;for(var c=e-1,l=e+1;c>=0&&!o[h*t+c];){if(o[h*t+c]=!0,!this.tolerate(h*t+c,s,i)){n&&(this.mpx[h*t+c]=4294967295);break}this.mpx[h*t+c]=4294967295,--c}for(;l<h&&!o[h*t+l];){if(o[h*t+l]=!0,!this.tolerate(h*t+l,s,i)){n&&(this.mpx[h*t+l]=4294967295);break}this.mpx[h*t+l]=4294967295,++l}a.push(new r(c+1,l-1,t))}else n&&(this.mpx[h*t+c]=4294967295)},this.tolerate=(e,t,s)=>{let i,n,a,r,o,h,c;return n=0,a=this.cpx[e],r=a>>24&255,r=t.a-r,i=r<0?-r:r,i>n&&(n=i),t.a>0&&(c=a>>16&255,h=a>>8&255,o=255&a,o=t.r-o,i=o<0?-o:o,i>n&&(n=i),h=t.g-h,i=h<0?-h:h,i>n&&(n=i),c=t.b-c,i=c<0?-c:c,i>n&&(n=i)),n<s},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),(0,i.ZP)("cutout-show-ghost").checked&&(this.selected.render(),this.stage.render()),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),document.removeEventListener("zoom-change",this.zoomChange,!1),document.removeEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("cutout-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("cutout-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("cutout-reset").removeEventListener("click",this.delete,!1),(0,i.ZP)("cutout-invert").removeEventListener("click",this.invert,!1),(0,i.ZP)("cutout-apply").removeEventListener("click",this.bake,!1),d.ZP.user.subscription&&"premium"!==d.ZP.user.subscriptionType&&(0,i.ZP)("cutout-auto").removeEventListener("click",this.auto,!1),(0,i.ZP)("cutout-show-ghost").removeEventListener("change",this.renderMask,!1),(0,i.ZP)("cutout-type-magic").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-brush").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-lasso").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-shape").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-mode-keep").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-mode-remove").removeEventListener("click",this.selectMode,!1),this.size.cleanUp(),this.softness.cleanUp(),this.tolerance.cleanUp(),this.rasterctx=null,this.selected=null,this.brush=null},(0,i.ZP)("cutout-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("cutout-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("cutout-reset").addEventListener("click",this.delete,!1),(0,i.ZP)("cutout-invert").addEventListener("click",this.invert,!1),(0,i.ZP)("cutout-apply").addEventListener("click",this.bake,!1),(0,i.ZP)("cutout-auto").addEventListener("click",this.auto,!1),(0,i.ZP)("cutout-type-magic").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-brush").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-lasso").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-shape").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-mode-keep").addEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-mode-remove").addEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-show-ghost").addEventListener("change",this.renderMask,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.zoomChange,!1),this.size=new h.Z("cutout-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:50,labelFormat:e=>e+"px",onEnd:e=>{this.updateBrush()}}),this.softness=new h.Z("cutout-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:.5,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.updateBrush()}}),this.tolerance=new h.Z("cutout-magic-tolerance",{defaultValue:.32,label:(0,n.Z)("tolerance"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),(0,i.ZP)("cutout-magic-settings").style.display="none",(0,i.ZP)("cutout-brush-settings").style.display="none",(0,i.ZP)("cutout-shape-settings").style.display="none",(0,i.ZP)("cutout-lasso-settings").style.display="none",this.rasterctx=this.stage.raster.getContext("2d"),this.addDownListeners(),this.layerSelect();const t=document.querySelector('input[name="cutout-type"]:checked').value;this.setType(t);const s=document.querySelector('input[name="cutout-mode"]:checked').value;this.setMode(s)}drawToMask(e,t){if("none"!==t){let e=new u.Z;e.addShader("blur","light"===t?.1:.3),this.scratch.replaceCanvas(e.apply(this.scratch.canvas))}const s=a.l(this.scratch.canvas);if(!s)return;let i;e||(i=a.$E(this.selected.mask,s));const n=this.selected.mask.getContext("2d");n.save(),"remove"===this.mode&&(n.globalCompositeOperation="destination-out"),n.drawImage(this.scratch.canvas,0,0),n.restore(),this.scratch.clear(),this.renderMask(),this.stage.history.add({type:"mask",layer:this.selected,rect:s,patch:i})}}},2155:(e,t,s)=>{s.d(t,{Z:()=>v});var i=s(3947),n=s(6548),a=s(3655),r=s(6817),o=s(8776),h=s(8203),c=s(4188),l=s(3673),d=s(2257),u=s(4820),p=s(972),g=s(1951);class m{constructor(e,t,s,i,n,a,r,o,h){this.sx=e,this.sy=t,this.tx=s,this.ty=i,this.background=n,this.color=a,this.radius=r,this.rotation=o,this.factor=h}}class v extends h.Z{constructor(e){var t;super("dispersion",e),this.mode="mask",this.applyClick=()=>{this.blocked?new g.Z(this.stage,"STUDIO"):document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("dispersion-no-layer").style.display="block",(0,i.ZP)("dispersion-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("dispersion-settings").style.display="block",(0,i.ZP)("dispersion-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.setMode("mask")},this.updateBrush=()=>{this.brush.generate(),this.selected&&"mask"===this.mode?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.scratch&&(this.scratch.settings.opacity="mask"===this.mode?.4:1)},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("dispersion-mode-mask")?"mask":"effect")},this.setMode=e=>{"effect"!==e||this.maskRect||(e="mask",this.stage.notify("dispersionCreateMask")),this.mode=e,(0,i.ZP)("dispersion-mode-mask").checked="mask"===this.mode,(0,i.ZP)("dispersion-mode-effect").checked="effect"===this.mode,(0,i.ZP)("dispersion-mask-settings").style.display="mask"===this.mode?"block":"none",(0,i.ZP)("dispersion-effect-settings").style.display="effect"===this.mode?"block":"none",this.updateBrush(),this.disperse()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.disperse=()=>{var e;if(this.scratch.clear(),"effect"!==this.mode||!this.maskRect)return;const t=this.maskRect,s=t.center(),n=this.scratch.ctx,a=this.selected.canvas.getContext("2d"),r=new Array,h=10*this.amount.getValue(),c=Math.round(100*this.scale.getValue()),d=Math.round(.5*c),u=Math.round(t.width/c)*Math.round(t.height/c)*h,p=this.direction.getValue()*Math.PI/180,g=this.spread.getValue(),v=Math.sqrt(t.width*t.width+t.height*t.height),f=Math.round(this.stretch.getValue()*v),y=(0,i.ZP)("dispersion-shrink").checked,w=(0,i.ZP)("dispersion-hollow").checked;let b,x=0,Z=0;for(;x<u&&Z<5e4;){let i=new l.Z(Math.round(this.rand(t.x,t.x+t.width)),Math.round(this.rand(t.y,t.y+t.height)));if(Z++,this.maskData.data[4*(i.y*n.canvas.width+i.x)]>0){x++;let t=v*Math.cos(p),n=v*Math.sin(p),h=this.getBound(i.x,i.y,i.x-t,i.y-n),l=this.getBound(i.x,i.y,i.x+t,i.y+n),u=null!==(e=i.distanceTo(h)/l.distanceTo(h))&&void 0!==e?e:0,w=1-u,b=d+this.rand(.2*-d,.2*d);y&&(b=.5*b+Math.round(.5*b*w));let Z=a.getImageData(l.x,l.y,1,1).data;const k=new o.Z(Z[0],Z[1],Z[2]);let E=a.getImageData(i.x,i.y,1,1).data;const P=new o.Z(E[0],E[1],E[2]);let S=u*u*f,C=Math.cos(p)*S,T=Math.sin(p)*S;if(0!==g){let e=s.rotateAround(i,p),t=(i.y-e.y)*g*u;C+=Math.sin(p)*t,T+=Math.cos(p)*t}if(r.push(new m(i.x,i.y,i.x+C,i.y+T,k,P,b,6.283185308*Math.random(),w)),y&&Math.random()>w){let e=2*c*u,t=this.rand(-e,e),s=this.rand(-e,e);r.push(new m(i.x+t,i.y+s,i.x+C+t,i.y+T+s,k,P,b,6.283185308*Math.random(),w))}}}switch(document.querySelector('input[name="dispersion-type"]:checked').value){case"circle":b=this.circle;break;case"square":b=this.square;break;case"hexagon":b=this.hexagon;break;case"cross":b=this.cross;break;case"triangle":b=this.triangle;break;case"heart":b=this.heart;break;case"star":b=this.star;break;case"glimmer":b=this.glimmer}n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",r.forEach((e=>{n.save(),n.translate(e.sx,e.sy),n.rotate(e.rotation),n.beginPath(),n.shadowBlur=2,n.fillStyle=n.shadowColor=e.background.toRGBA(245),b(n,d),n.closePath(),n.fill(),n.restore()})),r.forEach((e=>{Math.random()<.5&&(n.save(),n.translate(e.tx,e.ty),n.rotate(e.rotation),n.beginPath(),b(n,e.radius),n.closePath(),n.fillStyle=w?e.background.toRGBA():e.color.toRGBA(),n.fill(),w&&(n.lineWidth=.25*e.radius,n.strokeStyle=e.color.toRGBA(),n.stroke()),n.restore())})),window.requestAnimationFrame((()=>this.stage.render()))},this.getBound=(e,t,s,i)=>{let n=e,a=t,r=s-e,o=i-t,h=r>0?1:-1,c=o>0?1:-1;if(r=r<0?-r:r,o=o<0?-o:o,r>o){let e=.5*r;for(let t=1;t<=r&&(n+=h,e+=o,e>=r&&(e-=r,a+=c),0!==this.maskData.data[4*(a*this.scratch.canvas.width+n)]);t++);}else{let e=.5*o;for(let t=1;t<=o&&(a+=c,e+=r,e>=o&&(e-=o,n+=h),0!==this.maskData.data[4*(a*this.scratch.canvas.width+n)]);t++);}return new l.Z(n,a)},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let s=0;s<4;s++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<3;s++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let s=0;s<6;s++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let s=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-s,0,-s,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-s,0,-s,0,0)},this.cross=(e,t)=>{let s=.35*t;e.moveTo(-s,-s);for(let i=0;i<4;i++)e.lineTo(-s,-t),e.lineTo(s,-t),e.lineTo(s,-s),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<5;s++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<4;s++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.down=e=>{this.selected&&"mask"===this.mode&&(this.x=this.y=-1,this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.up=e=>{this.removeMoveListeners(),this.maskRect=a.l(this.scratch.canvas),this.maskData=this.maskRect?this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height):void 0,this.maskData&&this.setMode("effect")},this.cancel=()=>{var e;null===(e=this.scratch)||void 0===e||e.clear()},this.apply=()=>{if(this.stage.fresco.block)return void this.cancel();if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(!this.maskRect)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"dispersion",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{this.stage.fresco.block&&this.stage.fresco.setBlock(),this.stage.fresco.removeScratch(),this.removeDownListeners(),(0,i.ZP)("dispersion-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("dispersion-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("dispersion-cancel").removeEventListener("click",this.cancelClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),(0,i.ZP)("dispersion-mode-mask").removeEventListener("change",this.selectMode,!0),(0,i.ZP)("dispersion-mode-effect").removeEventListener("change",this.selectMode,!0),document.querySelectorAll('input[name="dispersion-type"]').forEach((e=>e.removeEventListener("change",this.disperse))),(0,i.ZP)("dispersion-shrink").removeEventListener("click",this.disperse,!1),(0,i.ZP)("dispersion-hollow").removeEventListener("click",this.disperse,!1),this.brushSize.cleanUp(),this.direction.cleanUp(),this.stretch.cleanUp(),this.amount.cleanUp(),this.spread.cleanUp(),this.scale.cleanUp(),this.selected=null,this.scratch=null},this.blocked=null===(t=!u.ZP.user.subscription)||void 0===t||t,this.blocked&&this.stage.fresco.setBlock(!0),(0,i.ZP)("dispersion-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("dispersion-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("dispersion-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),(0,i.ZP)("dispersion-mode-mask").addEventListener("change",this.selectMode,!0),(0,i.ZP)("dispersion-mode-effect").addEventListener("change",this.selectMode,!0),this.brush=new d.Z(new p.Z("circle",50,0)),this.brushSize=new c.Z("dispersion-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.scale=new c.Z("dispersion-scale",{label:(0,n.Z)("scale"),range:[.02,1],step:.02,defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.amount=new c.Z("dispersion-amount",{label:(0,n.Z)("amount"),range:[.01,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.stretch=new c.Z("dispersion-stretch",{label:(0,n.Z)("stretch"),range:[0,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.direction=new c.Z("dispersion-direction",{label:(0,n.Z)("direction"),range:[-180,180],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onEnd:e=>this.disperse()}),this.spread=new c.Z("dispersion-spread",{label:(0,n.Z)("spread"),range:[-1,1],step:.02,defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),document.querySelectorAll('input[name="dispersion-type"]').forEach((e=>e.addEventListener("change",this.disperse))),(0,i.ZP)("dispersion-shrink").addEventListener("click",this.disperse,!1),(0,i.ZP)("dispersion-hollow").addEventListener("click",this.disperse,!1),this.addDownListeners(),this.layerSelect()}}},9954:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(3947),n=s(3655),a=s(6817),r=s(8203),o=s(2634),h=s(4256),c=s(9679);class l extends r.Z{constructor(e){super("effect",e),this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{const e=this.selected===this.stage.fresco.getSelected();if(e||this.apply(),(0,i.ZP)("effect-settings").style.display="none",(0,i.ZP)("effect-selected").style.display="none",!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,i.ZP)("effect-layer-locked").style.display="block",(0,i.ZP)("effect-presets").style.display="none",void(this.selected=null);if((0,i.ZP)("effect-layer-locked").style.display="none",(0,i.ZP)("effect-presets").style.display="block",e)setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0);else{this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached);let e=a.Z.fillFit(this.selected.canvas.width,this.selected.canvas.height,220,220);this.thumbnail=n.eY(this.selected.canvas,e.width,e.height)}this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.group?this.renderEffects(this.group):(0===(0,i.ZP)("effect-list").childElementCount&&this.renderGroups(),this.renderMarked())},this.renderMarked=()=>{if(!this.marked)return;(0,i.ZP)("effect-selected").style.display="block";const e=-(this.thumbnail.width-220)/2,t=-(this.thumbnail.height-120)/2,s=new h.Z([]);s.addPreset(this.marked.name);const n=(0,i.ZP)("effect-selected-preview").getContext("2d");n.drawImage(this.thumbnail,e,t,this.thumbnail.width,this.thumbnail.height),(0,i.ZP)("effect-selected-name").innerText=this.marked.name;setTimeout((()=>{n.drawImage(s.apply(this.thumbnail),e,t,this.thumbnail.width,this.thumbnail.height)}),10),this.positionSettings((0,i.ZP)("effect-selected"))},this.renderGroups=()=>{(0,i.ZP)("effect-back").style.display="none";let e=(0,i.ZP)("effect-list");e.innerHTML="",o.Z.groups().forEach((t=>{const s=document.createElement("div");s.classList.add("effect-group"),s.id=t,s.addEventListener("click",(()=>{this.renderEffects(t)}),!1);const i=document.createElement("img");i.src="/img/effect/"+t+".jpg",s.appendChild(i);let n=document.createElement("span");n.innerText=t,s.appendChild(n),e.appendChild(s)}))},this.renderEffects=e=>{(0,i.ZP)("effect-back").style.display="block",(0,i.ZP)("effect-selected").style.display="none",(0,i.ZP)("effect-settings").style.display="none",this.group=e;let t=(0,i.ZP)("effect-list");t.innerHTML="";const s=-(this.thumbnail.width-220)/2,n=-(this.thumbnail.height-120)/2,a=new h.Z([]);o.Z.names(e).forEach((e=>{const i=document.createElement("div");i.classList.add("effect-preset"),i.id=e,i.addEventListener("click",this.change,!1);const r=document.createElement("canvas");r.width=220,r.height=120,i.appendChild(r);const o=r.getContext("2d");o.drawImage(this.thumbnail,s,n,this.thumbnail.width,this.thumbnail.height);let h=document.createElement("span");h.innerText=e,i.appendChild(h),t.appendChild(i);setTimeout((()=>{a.reset(),a.addPreset(e),o.drawImage(a.apply(this.thumbnail),s,n,this.thumbnail.width,this.thumbnail.height),this.marked&&this.marked.name==e&&setTimeout((()=>{i.classList.add("selected"),this.positionSettings(i)}),200)}),10)}))},this.amount=n.d4(50,(e=>{this.shaders.reset();const t=parseInt((0,i.ZP)("effect-amount").value,10)/100;this.shaders.addPreset(this.marked.name,t),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))})),this.back=()=>{(0,i.ZP)("effect-selected").style.display="none",(0,i.ZP)("effect-settings").style.display="none",this.group="",this.renderGroups(),this.renderMarked()},this.change=e=>{let t=e.currentTarget,s=(0,i.ZP)("effect-list").getElementsByTagName("div");for(var n=0;n<s.length;n++)s[n].classList.remove("selected");t.classList.add("selected"),this.effect(t.id),(0,i.ZP)("effect-settings").style.display="none",setTimeout((()=>{this.positionSettings(t)}),200)},this.positionSettings=e=>{if(!this.marked)return;(0,i.ZP)("effect-amount").value=(0,i.ZP)("effect_amount_out").innerHTML=(100*this.marked.value).toString();let t=(0,i.ZP)("effect-settings");t.style.display="block",t.style.top=e.offsetTop+"px",t.style.left=e.offsetLeft+"px"},this.effect=e=>{if(!this.selected)return;let t,s;this.marked&&(t=this.marked.name,s=this.marked.value),this.stage.history.add({type:"effect",layer:this.selected,kind:e,tool:this,name:t,value:s}),this.shaders.reset(),this.marked=new c.Z(e,1),this.shaders.addPreset(e,1),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),document.dispatchEvent(new CustomEvent("notification",{detail:e}))},this.reset=()=>{if(!this.selected)return;let e,t;this.marked&&(e=this.marked.name,t=this.marked.value),this.stage.history.add({type:"effect",layer:this.selected,kind:"Reset",tool:this,name:e,value:t});let s=(0,i.ZP)("effect-list").getElementsByTagName("div");for(var n=0;n<s.length;n++)s[n].classList.remove("selected");this.marked=null,this.shaders.chain=[],(0,i.ZP)("effect-settings").style.display="none",(0,i.ZP)("effect-selected").style.display="none",this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached),this.stage.render()},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.shaders||0===this.shaders.chain.length)return;const e=new a.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=n.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"effect - "+this.marked.name,layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()}),this.marked=void 0,this.shaders.chain=[]},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.stage.history.abortTransaction(),document.removeEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("effect-amount").removeEventListener("input",this.amount,!1),(0,i.ZP)("effect-back").removeEventListener("click",this.back,!1),(0,i.ZP)("effect-remove").removeEventListener("click",this.reset,!1),(0,i.ZP)("effect-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("effect-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("effect-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("effect-settings").style.display="none",(0,i.ZP)("effect-list").innerHTML="",this.thumbnail=null,this.cached=null},this.shaders=new h.Z,(0,i.ZP)("effect-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("effect-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("effect-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("effect-back").addEventListener("click",this.back,!1),(0,i.ZP)("effect-remove").addEventListener("click",this.reset,!1),(0,i.ZP)("effect-amount").addEventListener("input",this.amount,!1),document.addEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("effect-selected").style.display="none",(0,i.ZP)("effect-settings").style.display="none",(0,i.ZP)("effect-back").style.display="none",this.layerSelect()}}},3948:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(3947),n=s(6548),a=s(3655),r=s(6817),o=s(8203),h=s(3673),c=s(4188),l=s(4820),d=s(1726),u=s(4256),p=s(1951);class g extends o.Z{constructor(e){var t;super("focus",e),this.mode="symmetric",this.PI2=2*Math.PI,this.selectMode=e=>{this.mode=e.currentTarget.value,this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))},this.applyClick=()=>{this.blocked?new p.Z(this.stage,"STUDIO"):document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(this.selected===this.stage.fresco.getSelected()||this.apply(),!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("focus-layer-locked").style.display="block",(0,i.ZP)("focus-settings").style.display="none",this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,void window.requestAnimationFrame((()=>{this.renderControls()}));(0,i.ZP)("focus-layer-locked").style.display="none",(0,i.ZP)("focus-settings").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.center=new h.Z(Math.round(this.stage.fresco.width/2),Math.round(this.stage.fresco.height/2)),this.distance=Math.round(this.stage.fresco.height/2*.75),this.falloff=Math.round(.5*this.distance),this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderBlur(),this.renderShape()}))},this.down=e=>{if(!this.selected)return;this.downPoint=this.stage.translateRasterToFresco(e);let t=this.downPoint.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),t=this.matrix.transformPoint(t).add(this.center)),this.checkControl(t),this.control){switch(this.control){case"center":this.downPosition=this.center.clone();break;case"falloff":this.downPosition=new h.Z(this.center.y,this.falloff),this.downPoint=t;break;case"distance":this.downPosition=new h.Z(this.center.y,this.distance),this.downPoint=t;break;case"rotation":this.downRotation=Math.atan2(this.downPoint.y-this.center.y,this.downPoint.x-this.center.x)-this.rotation}this.raster.addEventListener("pointerup",this.pointerUp,!1)}else a.aG(0,0,this.stage.fresco.width,this.stage.fresco.height,this.downPoint.x,this.downPoint.y)?this.renderControls():this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.move=e=>{if(!this.selected)return;let t=this.stage.translateRasterToFresco(e),s=t.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),s=this.matrix.transformPoint(s).add(this.center)),this.isDown){if(this.control){switch(this.control){case"center":this.center.x=this.downPosition.x+(t.x-this.downPoint.x),this.center.y=this.downPosition.y+(t.y-this.downPoint.y);break;case"falloff":this.falloff=a.uZ(this.downPosition.y+(s.y-this.downPoint.y),20,this.distance-20);break;case"distance":this.distance=a.uZ(this.downPosition.y+(s.y-this.downPoint.y),this.falloff+20,Math.round(this.cached.height));break;case"rotation":this.rotation=Math.atan2(t.y-this.center.y,t.x-this.center.x)-this.downRotation,this.rotation<0?this.rotation+=this.PI2:this.rotation>=this.PI2&&(this.rotation-=this.PI2)}window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))}}else this.checkControl(s)},this.checkControl=e=>{let t=28/this.stage.zoom,s=t/2,i=50/this.stage.zoom,n=!1,r=!1;a.aG(this.center.x-s,this.center.y+this.falloff-s,t,t,e.x,e.y)&&(r="falloff"===this.control,this.control="falloff",n=!0),a.aG(this.center.x-s,this.center.y+this.distance-s,t,t,e.x,e.y)&&(r="distance"===this.control,this.control="distance",n=!0),a.aG(this.center.x-s,this.center.y-s,t,t,e.x,e.y)&&(r="center"===this.control,this.control="center",n=!0),"radial"!==this.mode&&a.aG(this.center.x+i-s,this.center.y-i-s,t,t,e.x,e.y)&&(r="rotation"===this.control,this.control="rotation",n=!0),n&&!r?(window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="pointer"):!n&&this.control&&(this.control=void 0,window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="unset")},this.up=e=>{this.isDown=!1},this.renderBlurEvent=()=>{window.requestAnimationFrame(this.renderBlur)},this.renderBlur=()=>{if((0,i.ZP)("bokeh-blur").checked){const e=document.querySelector('input[name="bokeh-blur-type"]:checked').value;this.shaders.addShader("bokeh",{size:this.bokehBlurSize.getValue(),amount:this.bokehBlurIntensity.getValue(),type:e})}else this.shaders.addShader("bokeh",void 0);const e=(0,i.ZP)("soft-blur").checked;this.shaders.addShader("blur",e?this.softBlurAmount.getValue():void 0),this.blur=this.shaders.apply(this.cached),this.renderFocus()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.hsla=(e,t,s,i)=>"hsla("+e+","+t+"%,"+s+"%,"+i+")",this.renderShape=()=>{if(!(0,i.ZP)("bokeh-shape").checked)return this.shape=void 0,void this.renderFocus();this.shape||(this.shape=a.vL(this.cached.width,this.cached.height));const e=this.shape.getContext("2d");e.clearRect(0,0,this.shape.width,this.shape.height),e.save(),e.globalCompositeOperation="lighter";const t=document.querySelector('input[name="bokeh-shape-type"]:checked').value,s=this.shape.width,n=this.shape.height,r=s+n,o=this.bokehShapeHue.getValue()+180,h=.1*r*this.bokehShapeSize.getValue(),c=.03*r;let l,d=Math.floor(.1*r*this.bokehShapeQuantity.getValue());switch(t){case"circle":l=this.circle;break;case"square":l=this.square;break;case"hexagon":l=this.hexagon;break;case"cross":l=this.cross;break;case"triangle":l=this.triangle;break;case"heart":l=this.heart;break;case"star":l=this.star;break;case"glimmer":l=this.glimmer}const u=(0,i.ZP)("bokeh-shape-dual").checked;for(;d--;){const t=this.rand(0,s),i=this.rand(0,n),a=this.rand(1,h);let r=this.rand(o-30,o+30);u&&d%2==0&&(r+=120),e.shadowColor=this.hsla(r,this.rand(10,80),this.rand(30,60),this.rand(.2,.8)),e.shadowBlur=this.rand(10,c),e.beginPath(),e.save(),e.translate(t,i),e.rotate(Math.random()*this.PI2),l(e,a),e.restore(),e.closePath(),e.fill()}for(d=Math.floor(.03*r*this.bokehShapeQuantity.getValue()),e.shadowBlur=15,e.shadowColor="#fff";d--;){const t=this.rand(0,s),i=this.rand(0,n),a=this.rand(.5,.75*h);e.fillStyle=this.hsla(0,0,100,this.rand(.03,.1)),e.beginPath(),e.save(),e.translate(t,i),e.rotate(Math.random()*this.PI2),l(e,a),e.restore(),e.closePath(),e.fill()}e.restore(),this.renderFocus()},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let s=0;s<4;s++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<3;s++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let s=0;s<6;s++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let s=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-s,0,-s,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-s,0,-s,0,0)},this.cross=(e,t)=>{let s=.35*t;e.moveTo(-s,-s);for(let i=0;i<4;i++)e.lineTo(-s,-t),e.lineTo(s,-t),e.lineTo(s,-s),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<5;s++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<4;s++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.renderFocus=()=>{if(this.scratch.replaceCanvas(this.blur),this.scratch.drawCanvas(this.shape,"screen",this.bokehShapeIntensity.getValue()),"none"===this.mode)return void window.requestAnimationFrame(this.stage.render);let e;const t=(0,i.ZP)("focus-invert").checked,s=t?"#00000000":"#000000FF",n=t?"#000000FF":"#00000000";let a=this.center.neg(this.selected.rect.topLeft());if("radial"===this.mode){const t=this.falloff/this.distance;e=this.scratch.ctx.createRadialGradient(a.x,a.y,0,a.x,a.y,this.distance),e.addColorStop(0,s),e.addColorStop(t,s),e.addColorStop(1,n)}else if("symmetric"===this.mode){const t=this.falloff/this.distance*.5,i=new h.Z(a.x,a.y-this.distance).rotateAround(a,this.rotation),r=new h.Z(a.x,a.y+this.distance).rotateAround(a,this.rotation);e=this.scratch.ctx.createLinearGradient(i.x,i.y,r.x,r.y),e.addColorStop(0,n),e.addColorStop(.5-t,s),e.addColorStop(.5,s),e.addColorStop(.5+t,s),e.addColorStop(1,n)}else{const t=this.falloff/this.distance,i=new h.Z(a.x,a.y+this.distance).rotateAround(a,this.rotation);e=this.scratch.ctx.createLinearGradient(a.x,a.y,i.x,i.y),e.addColorStop(0,s),e.addColorStop(t,s),e.addColorStop(1,n)}this.scratch.ctx.save(),this.scratch.ctx.fillStyle=e,this.scratch.ctx.globalCompositeOperation="destination-out",this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore(),window.requestAnimationFrame(this.stage.render)},this.renderControls=()=>{if(this.rctx.clearRect(0,0,this.raster.width,this.raster.height),!this.selected||"none"===this.mode)return;const e=this.stage.translateFrescoToRaster(this.center),t=Math.round(this.falloff*this.stage.zoom),s=Math.round(this.distance*this.stage.zoom),i="radial"!==this.mode;this.rctx.save(),this.rctx.lineWidth=2,this.rctx.shadowBlur=6,this.rctx.shadowColor="rgba(0,0,0,0.5)",this.rctx.strokeStyle=a.XE,this.rctx.translate(e.x,e.y),this.rctx.rotate(this.rotation),"symmetric"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-s),this.rctx.lineTo(this.raster.width,-s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-t),this.rctx.lineTo(this.raster.width,-t),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,+t),this.rctx.closePath(),this.rctx.stroke()):"linear"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,t),this.rctx.closePath(),this.rctx.stroke()):(this.rctx.beginPath(),this.rctx.arc(0,0,s,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,5]),this.rctx.beginPath(),this.rctx.arc(0,0,t,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke()),this.rctx.setLineDash([]),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="falloff"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="distance"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),i&&(this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="rotation"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill()),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?12:10,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="center"===this.control?a.xZ:a.XI,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?10:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.restore()},this.cancel=()=>{var e;null===(e=this.scratch)||void 0===e||e.clear(),this.blur=void 0,this.shape=void 0,this.cached=void 0},this.apply=()=>{if(this.stage.fresco.block)return void this.cancel();if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;const e=(0,i.ZP)("soft-blur").checked,t=(0,i.ZP)("bokeh-blur").checked,s=(0,i.ZP)("bokeh-shape").checked;if(!e&&!t&&!s)return;const n=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),o=a.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"focus",layer:this.selected,patchRect:n,patch:o,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.block&&this.stage.fresco.setBlock(),this.removeMoveListeners(),this.removeDownListeners(),this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.shaders=void 0,this.softBlurAmount.cleanUp(),this.bokehBlurSize.cleanUp(),this.bokehBlurIntensity.cleanUp(),this.bokehShapeHue.cleanUp(),this.bokehShapeSize.cleanUp(),this.bokehShapeQuantity.cleanUp(),this.bokehShapeIntensity.cleanUp(),(0,i.ZP)("focus-invert").removeEventListener("click",this.renderFocus),(0,i.ZP)("focus-mode-symmetric").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-linear").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-radial").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-none").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("soft-blur").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-circle").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-square").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-hexagon").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-cross").removeEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-shape").removeEventListener("change",this.renderShape,!1),(0,i.ZP)("bokeh-shape-dual").removeEventListener("change",this.renderShape,!1),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.removeEventListener("change",this.renderShape))),this.removeDownListeners(),this.raster.removeEventListener("pointermove",this.pointerMove,!1),(0,i.ZP)("focus-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("focus-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("focus-cancel").removeEventListener("click",this.cancelClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.renderControls,!1),this.cached=void 0,this.shape=void 0,this.blur=void 0,this.raster=void 0,this.rctx=void 0},this.matrix=new d.Z,this.shaders=new u.Z,this.raster=e.raster,this.rctx=this.raster.getContext("2d"),this.blocked=null===(t=!l.ZP.user.subscription)||void 0===t||t,this.blocked&&this.stage.fresco.setBlock(!0),(0,i.ZP)("focus-mode-symmetric").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-linear").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-radial").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-none").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-invert").addEventListener("click",this.renderFocus),(0,i.ZP)("soft-blur").addEventListener("change",this.renderBlurEvent,!1),this.softBlurAmount=new c.Z("soft-blur-amount",{label:(0,n.Z)("amount"),range:[0,1],step:.01,defaultValue:.3,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),(0,i.ZP)("bokeh-blur").addEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-circle").addEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-square").addEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-hexagon").addEventListener("change",this.renderBlurEvent,!1),(0,i.ZP)("bokeh-blur-type-cross").addEventListener("change",this.renderBlurEvent,!1),this.bokehBlurSize=new c.Z("bokeh-blur-size",{label:(0,n.Z)("size"),range:[0,1],step:.01,defaultValue:.3,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),this.bokehBlurIntensity=new c.Z("bokeh-blur-intensity",{label:(0,n.Z)("intensity"),range:[0,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),(0,i.ZP)("bokeh-shape").addEventListener("change",this.renderShape,!1),(0,i.ZP)("bokeh-shape-dual").addEventListener("change",this.renderShape,!1),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.addEventListener("change",this.renderShape))),this.bokehShapeHue=new c.Z("bokeh-shape-hue",{label:(0,n.Z)("color"),range:[-180,180],step:1,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onEnd:e=>this.renderShape()}),this.bokehShapeSize=new c.Z("bokeh-shape-size",{label:(0,n.Z)("size"),range:[0,1],step:.01,defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderShape()}),this.bokehShapeQuantity=new c.Z("bokeh-shape-quantity",{label:(0,n.Z)("quantity"),range:[0,1],step:.01,defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderShape()}),this.bokehShapeIntensity=new c.Z("bokeh-shape-intensity",{label:(0,n.Z)("intensity"),range:[0,1],step:.01,defaultValue:.6,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderFocus()}),(0,i.ZP)("focus-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("focus-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("focus-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.renderControls,!1),this.mode=document.querySelector('input[name="focus-mode"]:checked').value,this.addDownListeners(),this.addMoveListeners(),this.layerSelect()}}},89:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(3947),n=s(6548),a=s(3655),r=s(6817),o=s(8203),h=s(4188),c=s(4820),l=s(4256),d=s(1951);class u extends o.Z{constructor(e){var t;super("glitch",e),this.splitType="red-blue",this.splitTypes=["red-blue","green-red","blue-green","red","blue","green"],this.checkStateChanges=()=>{(0,i.ZP)("glitch-split").classList.toggle("changed",this.splitDistance.isChanged()),(0,i.ZP)("glitch-scan").classList.toggle("changed",this.scanSize.isChanged()),(0,i.ZP)("glitch-interfer").classList.toggle("changed",this.interferSeed.isChanged()),(0,i.ZP)("glitch-slice").classList.toggle("changed",this.sliceSeed.isChanged()),(0,i.ZP)("glitch-bleed").classList.toggle("changed",this.bleedSeed.isChanged())},this.reset=e=>{this.cacheChain=this.shaders.cloneChain(),this.shaders.reset(),this.splitDistance.reset(),this.scanSize.reset(),this.interferSeed.reset(),this.sliceSeed.reset(),this.bleedSeed.reset(),this.scratch.canvas=this.cached,window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges(),e&&(this.addHistory("reset"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("reset")})))},this.glPreset=e=>{switch(this.cacheChain=this.shaders.cloneChain(),this.reset(),e.currentTarget.id){case"glitch-gl1":this.splitDistance.setValue(.14),this.splitDirection.setValue(180),this.splitAmount.setValue(1),(0,i.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="red-blue",(0,i.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.scanSize.setValue(3),this.scanAmount.setValue(.25),this.scan(),this.sliceSeed.setValue(172),this.sliceAmount.setValue(3),this.sliceDistance.setValue(.1),this.slice();break;case"glitch-gl2":this.splitDistance.setValue(.22),this.splitDirection.setValue(0),this.splitAmount.setValue(1),(0,i.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="blue",(0,i.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.sliceSeed.setValue(95),this.sliceAmount.setValue(4),this.sliceDistance.setValue(.2),(0,i.ZP)("slice-line").checked=!0,this.slice(),this.bleedSeed.setValue(83),this.bleedAmplitude.setValue(.3),this.bleed();break;case"glitch-gl3":this.splitDistance.setValue(.2),this.splitDirection.setValue(215),this.splitAmount.setValue(.6),(0,i.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="red",(0,i.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.scanSize.setValue(3),this.scanAmount.setValue(.14),this.scan(),this.interferSeed.setValue(7),this.interferAmount.setValue(.04),this.interfer(),this.bleedSeed.setValue(178),this.bleedAmplitude.setValue(.67),this.bleed();break;case"glitch-gl4":this.splitDistance.setValue(.51),this.splitDirection.setValue(57),this.splitAmount.setValue(.4),(0,i.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="blue",(0,i.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.sliceSeed.setValue(193),this.sliceAmount.setValue(4),this.sliceDistance.setValue(.2),this.slice()}this.addHistory("preset"),document.dispatchEvent(new CustomEvent("notification",{detail:"GL"}))},this.random=()=>{this.cacheChain=this.shaders.cloneChain(),this.reset(),Math.random()>.5&&(this.splitDistance.setValue(.7*Math.random()),(0,i.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType=this.splitTypes[Math.floor(5.999*Math.random())],(0,i.ZP)("split-"+this.splitType).classList.add("active"),this.splitDirection.setValue(Math.round(360*Math.random())),this.splitAmount.setValue(.5+.5*Math.random()),this.split()),Math.random()>.5&&(this.scanSize.setValue(Math.round(4*Math.random())),this.scanAmount.setValue(Math.round(.8*Math.random()*100)/100),this.scan()),Math.random()>.7&&(this.interferSeed.setValue(Math.round(100*Math.random())),this.interferAmount.setValue(Math.round(100*(.2*Math.random()-.1))/100),this.interfer()),Math.random()>.5&&(this.sliceSeed.setValue(Math.round(200*Math.random())),(0,i.ZP)("slice-line").checked=Math.random()>.5,this.slice()),Math.random()>.5&&(this.bleedSeed.setValue(Math.round(200*Math.random())),this.bleedAmplitude.setValue(Math.round(100*Math.random())/100),this.bleed()),this.addHistory("random"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("random")}))},this.applyClick=()=>{this.blocked?new d.Z(this.stage,"STUDIO"):document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(this.selected===this.stage.fresco.getSelected()||this.apply(),!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,i.ZP)("glitch-layer-locked").style.display="block",(0,i.ZP)("glitch-settings").style.display="none",void(this.selected=void 0);(0,i.ZP)("glitch-layer-locked").style.display="none",(0,i.ZP)("glitch-settings").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.setValues(this.shaders.chain),this.checkStateChanges()},this.setValues=e=>{this.reset(),e&&e.forEach((e=>{switch(e.type){case"rgb-split":{let t=e.value;this.splitDistance.setValue(20*t.distance),this.splitDirection.setValue(t.direction),this.splitAmount.setValue(t.amount),this.splitType=t.type,this.split()}case"scanlines":{let t=e.value;this.scanSize.setValue(4*t.size),this.scanAmount.setValue(4*t.amount),(0,i.ZP)("scan-colorize").checked=t.colorize,(0,i.ZP)("scan-direction").checked=t.direction,this.scan()}case"interfer":{let t=e.value;this.interferSeed.setValue(t.seed),this.interferAmount.setValue(t.amount),(0,i.ZP)("interfer-direction").checked=t.direction,this.interfer()}case"slice":{let t=e.value;this.sliceSeed.setValue(t.seed),this.sliceAmount.setValue(t.amount),this.sliceDistance.setValue(t.distance),(0,i.ZP)("slice-line").checked=t.line,this.slice()}case"bleed":let t=e.value;this.bleedSeed.setValue(t.seed),this.bleedAmplitude.setValue(7*t.amplitude),this.bleedBlock.setValue(t.block),this.bleed()}}))},this.splitSwatch=e=>{this.cacheChain=this.shaders.cloneChain(),(0,i.ZP)("split-"+this.splitType).classList.remove("active");let t=e.currentTarget;this.splitType=t.getAttribute("data"),t.classList.add("active"),this.split(),this.addHistory("split")},this.split=()=>{0===this.splitDistance.getValue()?this.shaders.addShader("rgb-split",void 0):this.shaders.addShader("rgb-split",{distance:this.splitDistance.getValue()/20,amount:this.splitAmount.getValue(),direction:this.splitDirection.getValue(),type:this.splitType}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.scanCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.scan(),this.addHistory("scan")},this.scan=()=>{0===this.scanSize.getValue()?this.shaders.addShader("scanlines",void 0):this.shaders.addShader("scanlines",{size:this.scanSize.getValue()/4,amount:this.scanAmount.getValue()/4,colorize:(0,i.ZP)("scan-colorize").checked,direction:(0,i.ZP)("scan-direction").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.interferCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.interfer(),this.addHistory("interfer")},this.interfer=()=>{0===this.interferSeed.getValue()?this.shaders.addShader("interference",void 0):this.shaders.addShader("interference",{seed:this.interferSeed.getValue(),amount:this.interferAmount.getValue(),direction:(0,i.ZP)("interfer-direction").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.sliceCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.slice(),this.addHistory("slice")},this.slice=()=>{0===this.sliceSeed.getValue()?this.shaders.addShader("slice",void 0):this.shaders.addShader("slice",{seed:this.sliceSeed.getValue(),amount:this.sliceAmount.getValue(),distance:this.sliceDistance.getValue(),line:(0,i.ZP)("slice-line").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.bleed=()=>{this.selected&&(0===this.bleedSeed.getValue()?this.shaders.addShader("bleed",void 0):this.shaders.addShader("bleed",{seed:this.bleedSeed.getValue(),amplitude:this.bleedAmplitude.getValue()/7,block:4*this.bleedBlock.getValue()}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges())},this.addHistory=e=>{this.blocked||this.stage.history.add({type:"glitch",layer:this.selected,kind:e,shaders:this.shaders,chain:this.cacheChain})},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(this.stage.fresco.block)return void this.cancel();if(!this.selected||!this.stage.fresco.hasLayer(this.selected)||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"glitch",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.block&&this.stage.fresco.setBlock(),this.stage.fresco.removeScratch(),this.stage.history.abortTransaction(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.bleedSeed.cleanUp(),this.bleedBlock.cleanUp(),this.bleedAmplitude.cleanUp(),this.splitAmount.cleanUp(),this.splitDistance.cleanUp(),this.splitDirection.cleanUp(),this.scanSize.cleanUp(),this.scanAmount.cleanUp(),this.interferSeed.cleanUp(),this.interferAmount.cleanUp(),this.sliceSeed.cleanUp(),this.sliceAmount.cleanUp(),this.sliceDistance.cleanUp(),document.querySelector("#split-swatches").querySelectorAll("div").forEach((e=>e.removeEventListener("click",this.splitSwatch))),(0,i.ZP)("scan-colorize").removeEventListener("click",this.scanCheck),(0,i.ZP)("scan-direction").removeEventListener("click",this.scanCheck),(0,i.ZP)("interfer-direction").removeEventListener("click",this.interferCheck),(0,i.ZP)("slice-line").removeEventListener("click",this.sliceCheck),(0,i.ZP)("glitch-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("glitch-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("glitch-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("glitch-random").removeEventListener("click",this.random,!0),(0,i.ZP)("glitch-reset").removeEventListener("click",this.reset,!0),(0,i.ZP)("glitch-gl1").removeEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl2").removeEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl3").removeEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl4").removeEventListener("click",this.glPreset,!0),document.removeEventListener("layer-select",this.layerSelect,!1)},this.shaders=new l.Z,this.blocked=null===(t=!c.ZP.user.subscription)||void 0===t||t,this.blocked&&this.stage.fresco.setBlock(!0),(0,i.ZP)("glitch-random").addEventListener("click",this.random,!0),(0,i.ZP)("glitch-reset").addEventListener("click",this.reset,!0),(0,i.ZP)("glitch-gl1").addEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl2").addEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl3").addEventListener("click",this.glPreset,!0),(0,i.ZP)("glitch-gl4").addEventListener("click",this.glPreset,!0),this.splitDistance=new h.Z("split-distance",{label:(0,n.Z)("distance"),step:.01,range:[0,1],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("split")}}),this.splitDirection=new h.Z("split-direction",{label:(0,n.Z)("direction"),step:1,range:[0,360],defaultValue:180,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("split")}}),this.splitAmount=new h.Z("split-amount",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:1,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("split")}}),document.querySelector("#split-swatches").querySelectorAll("div").forEach((e=>e.addEventListener("click",this.splitSwatch))),this.scanSize=new h.Z("scan-size",{label:(0,n.Z)("size"),range:[0,10],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.scan(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("scan")}}),this.scanAmount=new h.Z("scan-amount",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.scan(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("scan")}}),(0,i.ZP)("scan-colorize").addEventListener("click",this.scanCheck),(0,i.ZP)("scan-direction").addEventListener("click",this.scanCheck),this.interferSeed=new h.Z("interfer-seed",{label:(0,n.Z)("seed"),range:[0,100],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.interfer(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("interfer")}}),this.interferAmount=new h.Z("interfer-amount",{label:(0,n.Z)("amount"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.interfer(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("interfer")}}),(0,i.ZP)("interfer-direction").addEventListener("click",this.interferCheck),this.sliceSeed=new h.Z("slice-seed",{label:(0,n.Z)("seed"),range:[0,200],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("slice")}}),this.sliceAmount=new h.Z("slice-amount",{label:(0,n.Z)("amount"),step:1,range:[0,25],defaultValue:4,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("slice")}}),this.sliceDistance=new h.Z("slice-distance",{label:(0,n.Z)("distance"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("slice")}}),(0,i.ZP)("slice-line").addEventListener("click",this.sliceCheck),this.bleedSeed=new h.Z("bleed-seed",{label:(0,n.Z)("seed"),range:[0,200],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("bleed")}}),this.bleedAmplitude=new h.Z("bleed-amplitude",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("bleed")}}),this.bleedBlock=new h.Z("bleed-block",{label:(0,n.Z)("block"),step:.01,range:[0,1],defaultValue:.7,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,s)=>{this.addHistory("bleed")}}),(0,i.ZP)("glitch-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("glitch-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("glitch-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),this.layerSelect()}}},7403:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3947),n=s(8203),a=s(4820),r=s(3868),o=s(9872),h=s(3655),c=s(6548);class l extends r.Z{constructor(e){super((0,c.Z)("dialogPageSizeTitle")),this.anchorChange=e=>{let t=e.currentTarget,s=(0,i.ZP)("anchor-grid").getElementsByClassName("box");for(var n=0;n<s.length;n++)s[n].classList.remove("selected");t.classList.add("selected"),this.anchor=t.getAttribute("data")},this.changepageRelative=()=>{let e=(0,i.ZP)("page-size-relative").checked,t=(0,i.ZP)("page-size-width"),s=(0,i.ZP)("page-size-height");e?(t.value="0",s.value="0"):(t.value=this.stage.fresco.width.toString(),s.value=this.stage.fresco.height.toString())},this.apply=()=>{let e=Number((0,i.ZP)("page-size-width").value),t=Number((0,i.ZP)("page-size-height").value),s=(0,i.ZP)("page-size-relative").checked;const n=new o.Z(this.stage.fresco.width,this.stage.fresco.height);e=h.uZ(Number(e),1,this.maxSize),t=h.uZ(Number(t),1,this.maxSize),this.stage.fresco.size(e,t,s,this.anchor),this.stage.history.add({type:"pageSize",anchor:this.anchor,size:n}),document.dispatchEvent(new CustomEvent("layer-arrange")),this.stage.updateViewport(),this.cleanUp()},this.stage=e,this.maxSize=a.ZP.user.subscription?8192:4096,this.setContent(`\n            <label class="split">${(0,c.Z)("width")} <input type="number" id="page-size-width"/></label>\n            <label class="split">${(0,c.Z)("height")} <input type="number" id="page-size-height"/></label>\n        \n            <input type="checkbox" id="page-size-relative" />\n            <label class="switch pad-10" for="page-size-relative">${(0,c.Z)("dialogSizeRelative")}<span></span></label>\n        \n            <label class="pad-30">${(0,c.Z)("dialogSizeAnchor")}</label>\n            <div id="anchor-grid" class="anchor-grid">\n                <div class="row">\n                    <div data="TL" class="box"><div class="inner"></div></div>\n                    <div data="TC" class="box"><div class="inner"></div></div>\n                    <div data="TR" class="box"><div class="inner"></div></div>\n                </div>\n                <div class="row">\n                    <div data="CL" class="box"><div class="inner"></div></div>\n                    <div data="CC" class="box selected"><div class="inner"></div></div>\n                    <div data="CR" class="box"><div class="inner"></div></div>\n                </div>\n                <div class="row">\n                    <div data="BL" class="box"><div class="inner"></div></div>\n                    <div data="BC" class="box"><div class="inner"></div></div>\n                    <div data="BR" class="box"><div class="inner"></div></div>\n                </div>\n            </div>\n        \n            <small class="pad-30" style="display: block;">${(0,c.Z)("dialogSizeCropWarning")}</small>\n        `),(0,i.ZP)("page-size-width").value=this.stage.fresco.width.toString(),(0,i.ZP)("page-size-height").value=this.stage.fresco.height.toString(),(0,i.ZP)("page-size-relative").addEventListener("input",this.changepageRelative,!1);let t=(0,i.ZP)("anchor-grid").getElementsByClassName("box");for(var s=0;s<t.length;s++)t[s].addEventListener("click",this.anchorChange,!1);this.anchor="CC"}}class d extends r.Z{constructor(e){super((0,c.Z)("dialogResizePageTitle")),this.pageSizeInputChange=e=>{let t,s,n,a=e.currentTarget;(0,i.ZP)("page-resize-constrain").checked&&("page-resize-width"==a.id?(t=h.uZ(Number(a.value),1,this.maxSize),n=t/this.stage.fresco.width,s=Math.round(n*this.stage.fresco.height),(0,i.ZP)("page-resize-height").value=s.toString()):(s=h.uZ(Number(a.value),1,this.maxSize),n=s/this.stage.fresco.height,t=Math.round(n*this.stage.fresco.width),(0,i.ZP)("page-resize-width").value=t.toString()),a!=document.activeElement&&((0,i.ZP)("page-resize-width").value=t.toString(),(0,i.ZP)("page-resize-height").value=s.toString()))},this.apply=()=>{setTimeout((()=>{const e=Number((0,i.ZP)("page-resize-width").value),t=Number((0,i.ZP)("page-resize-height").value),s=new o.Z(this.stage.fresco.width,this.stage.fresco.height),n=(0,i.ZP)("page-resize-smooth").checked,a=this.stage.fresco.layers.map((e=>e.clone(!0)));this.stage.fresco.resize(e,t,n),this.stage.history.add({type:"pageResize",size:s,layers:a}),this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()}),500)},this.stage=e,this.maxSize=a.ZP.user.subscription?8192:4096,this.setContent(`\n            <label class="split">${(0,c.Z)("width")} <input type="number" id="page-resize-width"/></label>\n            <label class="split">${(0,c.Z)("height")} <input type="number" id="page-resize-height"/></label>\n        \n            <input type="checkbox" checked id="page-resize-constrain" />\n            <label class="switch pad-30" for="page-resize-constrain">${(0,c.Z)("dialogResizeContrain")}<span></span></label>\n            \n            <input type="checkbox" checked id="page-resize-smooth" />\n            <label class="switch pad-10" for="page-resize-smooth">${(0,c.Z)("dialogResizeSmoothing")}<span></span></label>\n        \n            <small class="pad-30" style="display: block;">${(0,c.Z)("dialogResizeApplyAll")}</small>\n        `);let t=(0,i.ZP)("page-resize-width");t.addEventListener("input",this.pageSizeInputChange,!1),t.addEventListener("change",this.pageSizeInputChange,!1),t.value=this.stage.fresco.width.toString();let s=(0,i.ZP)("page-resize-height");s.addEventListener("change",this.pageSizeInputChange,!1),s.addEventListener("input",this.pageSizeInputChange,!1),s.value=this.stage.fresco.height.toString()}}var u=s(2397);class p extends n.Z{constructor(e){super("layout",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{this.backgroundColor.setHex(this.stage.fresco.color,!1),(0,i.ZP)("layout-background").checked=!!this.stage.fresco.color},this.pageResize=e=>{new d(this.stage)},this.pageSize=e=>{new l(this.stage)},this.changeBackground=()=>{const e=this.stage.fresco.color,t=(0,i.ZP)("layout-background").checked;this.stage.fresco.color=t?this.backgroundColor.getHex():void 0,this.stage.history.add({type:"background",color:e}),this.stage.render()},this.changeBackroundColor=e=>{const t=this.stage.fresco.color;this.stage.fresco.color=e.toHEX(),this.stage.history.add({type:"background",color:t}),this.stage.render()},this.cleanUp=()=>{document.removeEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("layout-background").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("layout-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("layout-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("layout-page-resize").removeEventListener("click",this.pageResize,!1),(0,i.ZP)("layout-page-size").removeEventListener("click",this.pageSize,!1)},document.addEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("layout-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("layout-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("layout-page-resize").addEventListener("click",this.pageResize,!1),(0,i.ZP)("layout-page-size").addEventListener("click",this.pageSize,!1),this.backgroundColor=new u.Z((0,i.ZP)("layout-background-color-picker"),void 0,this.changeBackroundColor),(0,i.ZP)("layout-background").addEventListener("change",this.changeBackground,!1),this.layerSelect()}}},1158:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),n=s(6548),a=s(3655),r=s(8203),o=s(4188),h=s(8776),c=s(2257),l=s(972);class d extends r.Z{constructor(e){super("liquify",e),this.timedStroke=!1,this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=async()=>{const{Displacement:e}=await Promise.resolve().then(s.bind(s,8132));if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("liquify-no-layer").style.display="block",(0,i.ZP)("liquify-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("liquify-sub-tools").style.display="block",(0,i.ZP)("liquify-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace"),this.scratch.ctx.drawImage(this.selected.canvas,0,0);const t=this.selected.canvas.getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);if(this.displacement)this.displacement.retarget(t.data,t.width,t.height);else{this.displacement=new e(t.data,t.width,t.height,this.sizeSlider.getValue(),this.strengthSlider.getValue(),this.densitySlider.getValue());const s=document.querySelector('input[name="liquify-mode"]:checked').value;this.setMode(s),this.brush.settings.size=this.sizeSlider.getValue()}this.updateBrush()},this.selectMode=e=>{this.setMode(e.currentTarget.value)},this.setMode=e=>{var t;this.timedStroke="MOVE"!==e,null===(t=this.displacement)||void 0===t||t.setMode(e)},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new h.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=e=>{this.selected&&this.displacement&&(this.scratch.rect=this.selected.rect,this.stroke=this.displacement.beginStroke(),this.highQualityStroke=(0,i.ZP)("liquify-hq-preview").checked,this.move(e),this.addMoveListeners())},this.move=e=>{const t=this.stage.translateRasterToFresco(e,this.selected.rect),s=this.stroke.push(t.x,t.y,this.timedStroke);if(s){this.strokeDamage=s.union(this.strokeDamage),window.requestAnimationFrame((()=>this.stage.render()));const e=this.highQualityStroke?this.displacement.applyQuality(s):this.displacement.applyFast(s);this.scratch.ctx.putImageData(new ImageData(e,s.width,s.height),s.x,s.y)}this.timedStroke&&(window.clearTimeout(this.strokeTimeout),this.strokeTimeout=window.setTimeout((()=>this.move(e)),16))},this.up=e=>{var t;if(null===(t=this.stroke)||void 0===t||t.free(),this.stroke=void 0,window.clearTimeout(this.strokeTimeout),this.removeMoveListeners(),!this.displacement||!this.strokeDamage)return;const s=this.strokeDamage;if(this.strokeDamage=void 0,!this.highQualityStroke){let e=this.displacement.applyQuality(s);this.scratch.ctx.putImageData(new ImageData(e,s.width,s.height),s.x,s.y),window.requestAnimationFrame((()=>this.stage.render()))}const i=a.$E(this.selected.canvas,s),n=this.selected.rect.clone(),r=this.selected.canvas.getContext("2d");r.clearRect(s.x,s.y,s.width,s.height),r.drawImage(this.scratch.canvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height),this.scratch.clear(),this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"liquify",layer:this.selected,patchRect:s,patch:i,rect:n})},this.cleanUp=()=>{var e,t;null===(e=this.displacement)||void 0===e||e.free(),null===(t=this.stroke)||void 0===t||t.free(),this.stage.fresco.removeScratch(),this.removeDownListeners(),this.sizeSlider.cleanUp(),this.strengthSlider.cleanUp(),this.densitySlider.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),(0,i.ZP)("liquify-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("liquify-cancel").removeEventListener("click",this.cancelClick,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.removeEventListener("click",this.selectMode,!1)})),this.selected=null},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.addEventListener("click",this.selectMode,!1)})),(0,i.ZP)("liquify-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("liquify-cancel").addEventListener("click",this.cancelClick,!1),this.brush=new c.Z(Object.assign(Object.assign({},new l.Z),{size:50,softness:0})),this.sizeSlider=new o.Z("liquify-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,500],defaultValue:50,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{var t;this.brush.settings.size=e,this.updateBrush(),null===(t=this.displacement)||void 0===t||t.setStampSize(e)}}),this.strengthSlider=new o.Z("liquify-brush-strength",{label:(0,n.Z)("strength"),range:[.01,1],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setStrength(e)}}),this.densitySlider=new o.Z("liquify-brush-density",{label:(0,n.Z)("density"),range:[0,.95],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setDensity(e)}}),this.addDownListeners(),this.layerSelect()}}},5725:(e,t,s)=>{s.d(t,{Z:()=>Z});var i=s(3947),n=s(8203),a=s(6548),r=s(3655),o=s(6817),h=s(4188),c=s(4170);function l(e,t){return Math.floor(Math.random()*(t-e+1))+e}var d=s(9198),u=s(2397);class p extends n.Z{constructor(e){super("pen",e),this.stage=e,this.isShiftDown=!1,this.pathPoints=[],this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("paint-no-layer").style.display="block",(0,i.ZP)("paint-sub-tools").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.ZP)("paint-no-layer").style.display="none",(0,i.ZP)("paint-sub-tools").style.display="block",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{this.selected&&(this.mode=(0,i.ZP)("pen-mode").value,this.scratch.settings.opacity=this.opacity.getValue(),this.scratch.ctx.lineWidth=this.size.getValue()/2,this.scratch.ctx.lineJoin=this.scratch.ctx.lineCap="round",this.scratch.ctx.strokeStyle=this.color.getHex(),this.scratch.ctx.fillStyle=this.color.getHex(),this.pathPoints=[],this.pp=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(this.pp),this.addMoveListeners())},this.move=e=>{e=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(e);(function(e,t,s,i,n){let a,r,o,h,c;const d=n.length;if(d<2)return!1;let u=n[d-2],p=n[d-1];const g=Math.sqrt(Math.pow(u.x-p.x,2)+Math.pow(u.y-p.y,2));switch(t){case"plain":case"neon":e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke();break;case"parallel":if(a=p.x-u.x,r=p.y-u.y,a*a+r*r<500)return!1;s=Math.round(s*i*5),e.beginPath(),e.moveTo(u.x-l(0,s),u.y-l(0,s)),e.lineTo(p.x-l(0,s),p.y-l(0,s)),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.moveTo(u.x+l(0,s),u.y+l(0,s)),e.lineTo(p.x+l(0,s),p.y+l(0,s)),e.stroke();break;case"sketchy":if(g<.8*s)return!1;for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.33,h=0;h<n.length;++h)a=n[h].x-p.x,r=n[h].y-p.y,o=a*a+r*r,o<s/2*4e3&&Math.random()<i&&(e.moveTo(p.x+.3*a,p.y+.3*r),e.lineTo(n[h].x-.3*a,n[h].y-.3*r));e.stroke(),e.globalAlpha=1;break;case"shaded":for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.1,h=0,c=n.length-2;h<c&&!(h>50);++h)a=n[c-h].x-p.x,r=n[c-h].y-p.y,o=a*a+r*r,o<s/2*5e3*i&&(e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(n[c-h].x,n[c-h].y),e.stroke());e.globalAlpha=1;break;case"furry":if(g<.8*s)return!1;for(e.beginPath(),e.moveTo(n[n.length-2].x,n[n.length-2].y),e.lineTo(n[n.length-1].x,n[n.length-1].y),e.stroke(),e.globalAlpha=.3,e.beginPath(),h=0,c=n.length;h<c;h++)a=n[h].x-n[n.length-1].x,r=n[h].y-n[n.length-1].y,o=a*a+r*r,o<s/2*2e3&&Math.random()>o/2e3&&(e.moveTo(p.x+a*i*2,p.y+r*i*2),e.lineTo(p.x-a*i*2,p.y-r*i*2));e.stroke(),e.globalAlpha=1;break;case"trail":if(g<.8*s)return!1;for(e.globalAlpha=.3,e.beginPath(),h=n.length-1,c=n.length-Math.round(25*i);h>c;--h)h>0&&(e.moveTo(p.x,p.y),e.lineTo(n[h].x,n[h].y));e.stroke(),e.globalAlpha=1;break;case"crayon":var m=Math.round(Math.sqrt(Math.pow(p.x-u.x,2)+Math.pow(p.y-u.y,2))/(5/(100*i))),v=(p.x-u.x)/m,f=(p.y-u.y)/m;for(h=0;h<m;h++)e.save(),e.globalAlpha=.4+.2*Math.random(),a=u.x+h*v,r=u.y+h*f,e.fillRect(a+(Math.random()-.5)*(s+5),r+(Math.random()-.5)*(s+5),2*Math.random()+2,Math.random()+1),e.restore();break;case"ink":e.save(),e.lineWidth=l(s,2*s),e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.restore()}return!0})(this.scratch.ctx,this.mode,this.size.getValue(),this.amount.getValue()/100,this.pathPoints)?window.requestAnimationFrame((()=>this.stage.render())):this.pathPoints.length>1&&this.pathPoints.pop()},this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"pen",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.amount.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1)},this.scratch=new d.Z,document.addEventListener("layer-select",this.layerSelect,!1),this.size=new h.Z("pen-size",{label:(0,a.Z)("size"),defaultValue:1,range:[1,10],step:1}),this.amount=new h.Z("pen-amount",{label:(0,a.Z)("amount"),defaultValue:30,range:[1,100],step:1}),this.opacity=new h.Z("pen-opacity",{label:(0,a.Z)("opacity"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.color=new u.Z((0,i.ZP)("pen-color-picker")),this.addDownListeners(),this.layerSelect()}}var g=s(2257);class m{constructor(e,t,s,n){this.container=e,this.updatePreview=()=>{if(!this.options.enablePreview)return;this.options.enableSize&&(this.brush.settings.size=this.sizeSlider.getValue()),this.options.enableSoftness&&(this.brush.settings.softness=this.softnessSlider.getValue()),this.options.enableTransparency&&(this.brush.settings.opacity=this.transparencySlider.getValue()),this.brush.generate(),this.previewImage.width=this.brush.canvas.width,this.previewImage.height=this.brush.canvas.height;this.previewImage.getContext("2d").drawImage(this.brush.canvas,0,0),this.previewImage.style.opacity=this.brush.settings.opacity.toFixed(2)},this.buildDOM=()=>{if(this.options.enablePreview){this.container.append((0,i.T)("label",{className:"pad-0"},(0,a.Z)("brush")));const e=(0,i.T)("canvas",{id:`${this.id}:brush-preview`,className:"ic"});this.container.append((0,i.T)("div",{className:"brush-preview-holder"},(0,i.T)("div",{className:"brush-preview"},e)))}this.options.enablePreview&&(this.options.enableSize||this.options.enableSoftness||this.options.enableTransparency)&&this.container.append((0,i.T)("div",{className:"splitter small"})),this.options.enableSize&&this.container.append((0,i.T)("div",{id:`${this.id}:brush-size`,className:"range-box"})),this.options.enableSoftness&&this.container.append((0,i.T)("div",{id:`${this.id}:brush-softness`,className:"range-box"})),this.options.enableTransparency&&this.container.append((0,i.T)("div",{id:`${this.id}:brush-transparency`,className:"range-box"}))},this.cleanUp=()=>{var e,t,s;null===(e=this.sizeSlider)||void 0===e||e.cleanUp(),null===(t=this.softnessSlider)||void 0===t||t.cleanUp(),null===(s=this.transparencySlider)||void 0===s||s.cleanUp()};const o=!!e.dataset.brushEditorId;this.brush=t,this.onUpdate=s,this.options=Object.assign({enablePreview:!0,enableSize:!0,enableSoftness:!0,enableTransparency:!0},n),o?this.id=e.dataset.brushEditorId:(this.id=e.dataset.brushEditorId=r.M8(),this.buildDOM()),this.options.enableSize&&(this.sizeSlider=new h.Z(`${this.id}:brush-size`,{label:(0,a.Z)("size"),range:[1,100,1e3],step:[1,10],stops:[0,.4,1],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",labelParse:e=>parseInt(e,10),onEnd:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enableSoftness&&(this.softnessSlider=new h.Z(`${this.id}:brush-softness`,{label:(0,a.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enableTransparency&&(this.transparencySlider=new h.Z(`${this.id}:brush-transparency`,{range:[.01,1],label:(0,a.Z)("transparency"),defaultValue:this.brush.settings.opacity,labelParse:e=>parseInt(e,10)/100,labelFormat:e=>(100*e).toFixed(0)+"%",onChange:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enablePreview&&(this.previewImage=(0,i.ZP)(`${this.id}:brush-preview`),this.updatePreview())}}var v=s(972);class f extends n.Z{constructor(e){super("draw",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("paint-no-layer").style.display="block",(0,i.ZP)("paint-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("paint-no-layer").style.display="none",(0,i.ZP)("paint-sub-tools").style.display="block",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.lastColor=void 0,this.lastSettings=void 0},this.down=(e,t)=>{if(!this.selected)return;this.isShiftDown||(this.x=this.y=-1);let s=this.colorSelector.getColor();v.Z.isEqual(this.brush.settings,this.lastSettings)&&s.isEqual(this.lastColor)||(this.brush.generate(s),this.lastSettings=this.brush.settings,this.lastColor=s),this.scratch.settings.opacity=this.brush.settings.opacity,"touch"!==t&&this.move(e),this.addMoveListeners()},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=e=>{this.removeMoveListeners();const t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=r.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.brush.settings.opacity),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"draw",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.brushEditor.cleanUp(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.brush=new g.Z(new v.Z),this.brushEditor=new m((0,i.ZP)("draw-brush"),this.brush,this.updateBrush),this.colorSelector=new u.Z((0,i.ZP)("draw-color-picker")),this.addDownListeners(),this.layerSelect()}}var y=s(7175);class w extends n.Z{constructor(e){super("shape",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.toggleLineShape=()=>{this.mode=document.querySelector('input[name="shape-type"]:checked').value,(0,i.ZP)("shape-line-settings").style.display="line"===this.mode?"block":"none",(0,i.ZP)("shape-fill-settings").style.display="line"===this.mode?"none":"block",(0,i.ZP)("shape-outline-settings").style.display="line"===this.mode?"none":"block"},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("paint-no-layer").style.display="block",(0,i.ZP)("paint-sub-tools").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.ZP)("paint-no-layer").style.display="none",(0,i.ZP)("paint-sub-tools").style.display="block",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{if(!this.selected)return;const t=(0,i.ZP)("shape-outline").checked,s=(0,i.ZP)("shape-fill").checked;(t||s||"line"===this.mode)&&(this.downPoint=this.stage.translateRasterToFresco(e),this.addMoveListeners())},this.move=e=>{this.scratch.clear(),e=this.stage.translateRasterToFresco(e),this.scratch.ctx.save();const t=(0,i.ZP)("shape-fill").checked,s=(0,i.ZP)("shape-outline").checked;(t||"line"===this.mode)&&(this.scratch.ctx.lineWidth=this.shapeLineSize.getValue(),this.scratch.ctx.fillStyle=this.shapeColorSelector.getHex(),this.scratch.ctx.strokeStyle=this.shapeLineColorSelector.getHex(),y.Z.fill(this.scratch.ctx,this.mode,this.downPoint,e)),s&&"line"!==this.mode&&(this.scratch.ctx.lineWidth=this.shapeOutlineSize.getValue(),this.scratch.ctx.strokeStyle=this.shapeOutlineColorSelector.getHex(),y.Z.stroke(this.scratch.ctx,this.mode,this.downPoint,e)),this.scratch.ctx.restore(),window.requestAnimationFrame((()=>this.stage.render()))},this.up=e=>{if(this.removeMoveListeners(),e=this.stage.translateRasterToFresco(e),this.downPoint.x===e.x&&this.downPoint.y===e.y)return;this.scratch.clear(),this.scratch.ctx.save();const t=(0,i.ZP)("shape-fill").checked,s=(0,i.ZP)("shape-outline").checked;(t||"line"===this.mode)&&(this.scratch.ctx.lineWidth=this.shapeLineSize.getValue(),this.scratch.ctx.fillStyle=this.shapeColorSelector.getHex(),this.scratch.ctx.strokeStyle=this.shapeLineColorSelector.getHex(),y.Z.fill(this.scratch.ctx,this.mode,this.downPoint,e)),s&&"line"!==this.mode&&(this.scratch.ctx.lineWidth=this.shapeOutlineSize.getValue(),this.scratch.ctx.strokeStyle=this.shapeOutlineColorSelector.getHex(),y.Z.stroke(this.scratch.ctx,this.mode,this.downPoint,e)),this.scratch.ctx.restore();let n=r.l(this.scratch.canvas);if(n&&n.width>0&&n.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,n.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const t=r.dN(this.selected.mask),s=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(n),this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"shape",layer:this.selected,patchRect:this.selected.rect?n.rebase(this.selected.rect.x,this.selected.rect.y):n,patch:e,rect:s,mask:t})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.removeEventListener("change",this.toggleLineShape))),this.shapeOutlineSize.cleanUp(),this.shapeLineSize.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),this.shapeColorSelector=new u.Z((0,i.ZP)("shape-color-picker")),this.shapeOutlineColorSelector=new u.Z((0,i.ZP)("shape-outline-color-picker")),this.shapeLineColorSelector=new u.Z((0,i.ZP)("shape-line-color-picker")),this.shapeOutlineSize=new h.Z("shape-outline-size",{label:(0,a.Z)("size"),defaultValue:5,range:[1,50],step:1}),this.shapeLineSize=new h.Z("shape-line-size",{label:(0,a.Z)("lineSize"),defaultValue:1,range:[1,50],step:1}),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.addEventListener("change",this.toggleLineShape))),this.addDownListeners(),this.layerSelect(),this.toggleLineShape()}}var b=s(8776);class x extends n.Z{constructor(e){super("eraser",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("paint-no-layer").style.display="block",(0,i.ZP)("paint-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("paint-no-layer").style.display="none",(0,i.ZP)("paint-sub-tools").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=r.dN(this.selected.canvas),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"none"),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new b.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&this.selected.rect&&this.selected.canvas&&(this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.selected.replaceCanvas(this.cached),this.scratch.drawToLayer(this.selected,"destination-out",this.brush.settings.opacity),this.selected.render(),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){const e=this.selected.rect.clone();let s=r.$E(this.cached,t);this.cached=r.dN(this.selected.canvas);const i=this.selected.shrinkWrap();this.scratch.clear(),this.stage.history.add({type:"bitmapChange",kind:"eraser",layer:this.selected,patchRect:t.rebase(this.selected.rect.x-e.x,this.selected.rect.y-e.y),patch:s,rect:e}),i&&this.layerSelect()}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.brushEditor.cleanUp(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.cached=void 0},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.brush=new g.Z(new v.Z),this.brushEditor=new m((0,i.ZP)("eraser-brush"),this.brush,this.updateBrush),this.addDownListeners(),this.layerSelect()}}class Z extends n.Z{constructor(e){super("paint",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectSubTool=e=>{this.setSubTool(e.currentTarget.value)},this.addLayer=()=>{this.stage.addEmpty(),this.stage.notify("layerAdded")},this.setSubTool=e=>{var t,s;if(null===(t=this.stage)||void 0===t||t.coating.removeCursorImage(),!this.subTool||this.subTool.name!==e)switch((0,i.ZP)("paint-draw-settings").style.display="none",(0,i.ZP)("paint-eraser-settings").style.display="none",(0,i.ZP)("paint-pen-settings").style.display="none",(0,i.ZP)("paint-shape-settings").style.display="none",null===(s=this.subTool)||void 0===s||s.cleanUp(),this.subTool=null,(0,i.ZP)("paint-"+e+"-settings").style.display="block",e){case"draw":this.subTool=new f(this.stage);break;case"eraser":this.subTool=new x(this.stage);break;case"pen":this.subTool=new p(this.stage);break;case"shape":this.subTool=new w(this.stage)}},this.cleanUp=()=>{var e;(0,i.ZP)("paint-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("paint-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("paint-add-empty").removeEventListener("click",this.addLayer,!1),(0,i.ZP)("paint-type-draw").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-eraser").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-pen").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-shape").removeEventListener("change",this.selectSubTool,!1),null===(e=this.subTool)||void 0===e||e.cleanUp(),this.subTool=null},(0,i.ZP)("paint-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("paint-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("paint-add-empty").addEventListener("click",this.addLayer,!1),(0,i.ZP)("paint-type-draw").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-eraser").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-pen").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("paint-type-shape").addEventListener("change",this.selectSubTool,!1);const t=document.querySelector('input[name="paint-type"]:checked').value;this.setSubTool(t)}}},4604:(e,t,s)=>{s.d(t,{Z:()=>x});var i=s(3947),n=s(6548),a=s(8776),r=s(3655),o=s(6817),h=s(8203),c=s(4188),l=s(3673),d=s(2257),u=s(4820),p=s(972);class g{constructor(e){this.stage=e,this.resize=()=>{const e=document.querySelector(".raster");this.container.style.top=e.style.top,this.container.style.left=e.style.left,this.container.style.width=e.style.width},this.bar=(0,i.T)("div"),this.container=(0,i.T)("div",{id:"workspace-progress"},this.bar),(0,i.ZP)("workspace").append(this.container),this.resize(),document.addEventListener("viewport-update",this.resize),document.addEventListener("resize",this.resize)}update(e){this.bar.style.width=`${(100*e).toFixed(0)}%`}show(){this.bar.style.width="0",this.container.style.display="block",this.resize()}hide(){this.container.style.display="none",this.resize()}cleanUp(){this.bar.remove()}}var m=s(7282);const v={speed:[2,20],balanced:[20,20],quality:[50,50]};class f extends h.Z{constructor(e){var t;super("heal",e),this.workset=null,this.blocked=!1,this.changeMode=()=>{this.mode=document.querySelector('input[name="heal-mode"]:checked').value,"infill"===this.mode&&this.blocked?(this.stage.fresco.setBlock(!0),this.setAlternativeCanvas()):(this.stage.fresco.setBlock(),this.updateBrush(),this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.cleanUpWorker(),this.worker=new m.$p)),this.stage.render(),(0,i.ZP)("heal-presets").style.display="infill"===this.mode?"block":"none"},this.setAlternativeCanvas=()=>{"infill"===this.mode&&this.blocked&&this.selected&&this.selected.setAltCanvas()},this.layerSelect=()=>{var e,t;if((null===(e=this.selected)||void 0===e?void 0:e.id)!==(null===(t=this.stage.fresco.getSelected())||void 0===t?void 0:t.id)&&(this.cleanUpWorker(),this.worker=new m.$p,this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.stage.render())),!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("retouch-no-layer").style.display="block",(0,i.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("retouch-sub-tools").style.display="block",(0,i.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.scratch.settings.opacity=.4,this.setAlternativeCanvas(),this.updateBrush()},this.updateBrush=()=>{this.brush.generate(new a.Z(0,255,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{if(!this.selected)return;"patch"===document.querySelector('input[name="heal-mode"]:checked').value?(this.stage.coating.animateCursorTap(),this.applyHealPatch(e)):(this.brushPoints=[],this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.brushPoints.push(new l.Z(e,t)),this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=async e=>{try{this.removeMoveListeners();const e=document.querySelector('input[name="heal-preset"]:checked').value,[t,s]=v[e];let i=50,n=o.Z.fromPointRects(this.brushPoints,this.brush.canvas.width,this.brush.canvas.height);if(n.x-=i,n.y-=i,n.width+=2*i,n.height+=2*i,n=n.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!n)return;const a=r.$E(this.selected.canvas,n);if(this.workset=[n,a],await this.fill(n,!0,t,s),this.blocked)return;this.stage.history.add({type:"bitmapChange",kind:"healInfill",layer:this.selected,patchRect:n,patch:a,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.applyHealPatch=async e=>{try{(e=this.stage.translateRasterToFresco(e,this.selected.rect)).x-=~~(this.brush.canvas.width/2),e.y-=~~(this.brush.canvas.height/2),this.scratch.ctx.drawImage(this.brush.canvas,e.x,e.y);let t=this.brush.canvas.width,s=this.brush.canvas.height;const i=50;let n=new o.Z(e.x-i,e.y-i,t+2*i,s+2*i);if(n=n.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!n)return;const a=r.$E(this.selected.canvas,n);this.workset=[n,a];const[h,c]=v.balanced;await this.fill(n,!1,h,c),this.stage.history.add({type:"bitmapChange",kind:"healPatch",layer:this.selected,patchRect:n,patch:a,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.fill=async(e,t,s,i)=>{t&&(this.stage.coating.removeCursorImage(),this.progress.show());const n=this.selected.getCanvas().getContext("2d"),a=n.getImageData(e.x,e.y,e.width,e.height),o=r.vL(e.width,e.height),h=o.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,e.width,e.height),h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const c=h.getImageData(0,0,e.width,e.height);this.worker.send({image:a,neighbour:s,random:i,mask:c,intermediateImage:t},[a.data.buffer,c.data.buffer]),h.globalCompositeOperation="copy",h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const l=r.vL(e.width,e.height),d=l.getContext("2d");for(d.globalCompositeOperation="destination-atop",this.scratch.clear(),this.stage.render();;){const{progress:t,image:s}=await this.worker.receive();if("done"===t){this.progress.update(1),n.putImageData(s,e.x,e.y);break}this.progress.update(t),s&&(d.putImageData(s,0,0),d.drawImage(o,0,0),n.drawImage(l,0,0,e.width,e.height,e.x,e.y,e.width,e.height),window.requestAnimationFrame((()=>{this.stage.render()})))}t&&(setTimeout((()=>this.progress.hide()),300),this.updateBrush()),this.selected.render(),this.scratch.clear(),this.stage.render()},this.cleanUpWorker=()=>{var e;if(null===(e=this.worker)||void 0===e||e.terminate(),this.progress.hide(),this.workset){const[e,t]=this.workset;this.selected.getCanvas().getContext("2d").putImageData(t,e.x,e.y),this.stage.render(),this.workset=null}},this.cleanUp=()=>{var e;this.cleanUpWorker(),this.stage.fresco.block&&this.stage.fresco.setBlock(),this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.stage.render()),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),this.size.cleanUp(),this.progress.cleanUp(),document.getElementsByName("heal-mode").forEach((e=>{e.removeEventListener("click",this.changeMode,!1)})),this.selected=null,this.scratch=null},this.blocked=null===(t=!u.ZP.user.subscription)||void 0===t||t,document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(new p.Z("circle",50,0)),this.progress=new g(this.stage),this.size=new c.Z("heal-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),document.getElementsByName("heal-mode").forEach((e=>{e.addEventListener("click",this.changeMode,!1)})),this.addDownListeners(),this.changeMode(),this.layerSelect()}}class y extends h.Z{constructor(e){super("clone",e),this.mode="source",this.layerSelect=()=>{const e=this.selected===this.stage.fresco.getSelected();if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("retouch-no-layer").style.display="block",(0,i.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("retouch-sub-tools").style.display="block",(0,i.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),e||(this.alignChange(),this.updateBrush())},this.alignChange=()=>{this.source=void 0,this.setMode("source")},this.toggleMode=()=>{this.setMode("paint"===this.mode?"source":"paint")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("clone-mode-paint")?"paint":"source")},this.setMode=e=>{this.mode=e,(0,i.ZP)("clone-mode-paint").checked="paint"===this.mode,(0,i.ZP)("clone-mode-source").checked="source"===this.mode,this.updateBrush()},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage("source"===this.mode?null:this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,i.ZP)("clone-brush-preview").innerHTML="",(0,i.ZP)("clone-brush-preview").appendChild(this.brush.canvas)},this.down=(e,t)=>{if(this.selected)return"source"==this.mode?(this.source=this.stage.translateRasterToFresco(e),this.offset=void 0,void(this.isShiftDown||this.toggleMode())):void(this.source?((0,i.ZP)("workspace").appendChild(this.sourceMarker),(0,i.ZP)("clone-aligned").checked&&this.offset||(this.offset=this.stage.translateRasterToFresco(e),this.offset.x=this.offset.x-this.source.x,this.offset.y=this.offset.y-this.source.y),this.x=this.y=-1,this.scratch.settings.opacity=this.opacity.getValue(),"touch"!==t&&this.move(e),this.addMoveListeners()):document.dispatchEvent(new CustomEvent("notification",{detail:"select source"})))},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(this.sourceMarker.style.top=e.y-Math.round(this.offset.y*this.stage.zoom)+(this.stage.raster.offsetTop-16)+"px",this.sourceMarker.style.left=e.x-Math.round(this.offset.x*this.stage.zoom)+(this.stage.raster.offsetLeft-16)+"px",e=this.stage.translateRasterToFresco(e),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let s=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);s.save(),s.drawImage(this.selected.canvas,-(e-this.offset.x-this.selected.rect.x),-(t-this.offset.y-this.selected.rect.y)),s.globalCompositeOperation="destination-in",s.drawImage(this.brush.canvas,0,0),s.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.sourceMarker.remove(),this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y));const s=this.selected.rect.clone(),i=r.dN(this.selected.mask);this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"clone",layer:this.selected,patchRect:t.rebase(this.selected.rect.x,this.selected.rect.y),patch:e,rect:s,mask:i})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.size.cleanUp(),this.opacity.cleanUp(),this.softness.cleanUp(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("clone-mode-source").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-mode-paint").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-aligned").removeEventListener("change",this.alignChange,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("clone-mode-source").addEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-mode-paint").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new p.Z),{size:50,softness:.5})),this.size=new c.Z("clone-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("clone-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.opacity=new c.Z("clone-brush-transparency",{label:(0,n.Z)("transparency"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),(0,i.ZP)("clone-aligned").addEventListener("change",this.alignChange,!1),this.sourceMarker=document.createElement("img"),this.sourceMarker.src="/img/cursor/source.svg",this.sourceMarker.id="source-marker",this.addDownListeners(),this.setMode("source"),this.layerSelect()}}class w extends h.Z{constructor(e){super("detail",e),this.mode="blur",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("retouch-no-layer").style.display="block",(0,i.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("retouch-sub-tools").style.display="block",(0,i.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.updateBrush()},this.toggleMode=()=>{this.setMode("blur"===this.mode?"sharpen":"blur")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("detail-mode-blur")?"blur":"sharpen")},this.setMode=e=>{this.mode=e,(0,i.ZP)("detail-mode-blur").checked="blur"===this.mode,(0,i.ZP)("detail-mode-sharpen").checked="sharpen"===this.mode},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,i.ZP)("detail-brush-preview").innerHTML="",(0,i.ZP)("detail-brush-preview").appendChild(this.brush.canvas)},this.down=(e,t)=>{this.selected&&(this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);i.save(),i.drawImage(this.selected.canvas,-e,-t),"blur"===this.mode?this.blur(i):this.sharpen(i),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.save(),this.scratch.ctx.globalAlpha=.01*s,this.scratch.ctx.drawImage(this.patch,e,t),this.scratch.ctx.restore()},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"detail",layer:this.selected,patchRect:t,patch:e,rect:this.selected.rect.clone()})}window.requestAnimationFrame((()=>this.stage.render()))},this.sharpen=e=>{const t=.3;for(var s,i,n,a,r,o,h,c,l,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=[0,-1,0,-1,5,-1,0,-1,0],y=Math.round(Math.sqrt(f.length)),w=.5*y|0,b=e.createImageData(m,v),x=b.data,Z=e.getImageData(0,0,m,v).data,k=v;k--;)for(s=m;s--;){for(n=k,i=s,h=4*(k*m+s),a=0,r=0,o=0,0,u=0;u<y;u++)for(d=0;d<y;d++)g=i+d-w,(p=n+u-w)>=0&&p<v&&g>=0&&g<m&&(l=f[u*y+d],a+=Z[c=4*(p*m+g)]*l,r+=Z[c+1]*l,o+=Z[c+2]*l,Z[c+3]*l);x[h]=a*t+.7*Z[h],x[h+1]=r*t+.7*Z[h+1],x[h+2]=o*t+.7*Z[h+2],x[h+3]=Z[h+3]}e.putImageData(b,0,0)},this.blur=e=>{var t,s,i,n,a,r,o,h,c,l,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=e.getImageData(0,0,m,v),y=f.data,w=m-1,b=v-1;var x=[],Z=[],k=[],E=[],P=[],S=[];for(p=u=0,r=0;r<v;r++){for(t=6*y[p],s=6*y[p+1],i=6*y[p+2],n=6*y[p+3],o=1;o<=5;o++)h=p+((o>w?w:o)<<2),t+=y[h++],s+=y[h++],i+=y[h++],n+=y[h];for(a=0;a<m;a++)x[u]=t,Z[u]=s,k[u]=i,E[u]=n,0==r&&(P[a]=((h=a+6)<w?h:w)<<2,S[a]=(h=a-5)>0?h<<2:0),c=p+P[a],l=p+S[a],t+=y[c++]-y[l++],s+=y[c++]-y[l++],i+=y[c++]-y[l++],n+=y[c]-y[l],u++;p+=m<<2}for(a=0;a<m;a++){for(t=6*x[d=a],s=6*Z[d],i=6*k[d],n=6*E[d],o=1;o<=5;o++)t+=x[d+=o>b?0:m],s+=Z[d],i+=k[d],n+=E[d];for(u=a<<2,r=0;r<v;r++)y[u+3]=g=34*n>>>12,g>0?(g=255/g,y[u]=(34*t>>>12)*g,y[u+1]=(34*s>>>12)*g,y[u+2]=(34*i>>>12)*g):y[u]=y[u+1]=y[u+2]=0,0===a&&(P[r]=((h=r+6)<b?h:b)*m,S[r]=(h=r-5)>0?h*m:0),c=a+P[r],l=a+S[r],t+=x[c]-x[l],s+=Z[c]-Z[l],i+=k[c]-k[l],n+=E[c]-E[l],u+=m<<2}e.putImageData(f,0,0)},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.softness.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("detail-mode-blur").addEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-sharpen").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new p.Z),{size:100,softness:.5})),this.size=new c.Z("detail-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("detail-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.strength=new c.Z("detail-brush-strength",{label:(0,n.Z)("strength"),range:[1,100],defaultValue:40,step:1}),this.addDownListeners(),this.setMode("blur"),this.layerSelect()}}class b extends h.Z{constructor(e){super("toning",e),this.mode="lighten",this.range="midtone",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("retouch-no-layer").style.display="block",(0,i.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("retouch-sub-tools").style.display="block",(0,i.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.updateBrush()},this.toggleMode=()=>{this.setMode("lighten"===this.mode?"darken":"lighten")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("toning-mode-lighten")?"lighten":"darken")},this.setMode=e=>{this.mode=e,(0,i.ZP)("toning-mode-lighten").checked="lighten"===this.mode,(0,i.ZP)("toning-mode-darken").checked="darken"===this.mode},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,i.ZP)("toning-brush-preview").innerHTML="",(0,i.ZP)("toning-brush-preview").append(this.brush.canvas)},this.down=(e,t)=>{this.selected&&(this.range=document.querySelector('input[name="toning-range"]:checked').value,this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,n=e.y-this.y,a=i>0?1:-1,r=n>0?1:-1;if(i=i<0?-i:i,n=n<0?-n:n,i>n){let e=.5*i;for(let o=1;o<=i;o++)this.x+=a,e+=n,e>=i&&(e-=i,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=i,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);i.save(),i.drawImage(this.selected.canvas,-e,-t),"lighten"===this.mode?this.lighten(i,this.range,s):this.darken(i,this.range,s),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"toning",layer:this.selected,patchRect:t,patch:e,rect:this.selected.rect.clone()})}window.requestAnimationFrame((()=>this.stage.render()))},this.lighten=(e,t,s)=>{var i=e.canvas.width,n=e.canvas.height;s/=10;for(var a,r,o,h,c,l,d=e.getImageData(0,0,i,n),u=d.data,p=n;p--;)for(a=i;a--;){switch(r=u[c=4*(p*i+a)]/255,o=u[c+1]/255,h=u[c+2]/255,t){case"highlight":r+=s*(Math.exp(r)-1),o+=s*(Math.exp(o)-1),h+=s*(Math.exp(h)-1);break;case"midtone":r+=(l=.25*s)*Math.sin(r*Math.PI),o+=l*Math.sin(o*Math.PI),h+=l*Math.sin(h*Math.PI);break;case"shadow":r=(l=1-.5*s)*r+(1-l),o=l*o+(1-l),h=l*h+(1-l)}(r*=255)>255&&(r=255),(o*=255)>255&&(o=255),(h*=255)>255&&(h=255),u[c]=r,u[c+1]=o,u[c+2]=h}e.putImageData(d,0,0)},this.darken=(e,t,s)=>{var i=e.canvas.width,n=e.canvas.height;s/=10;for(var a,r,o,h,c,l,d=e.getImageData(0,0,i,n),u=d.data,p=n;p--;)for(a=i;a--;){switch(r=u[c=4*(p*i+a)]/255,o=u[c+1]/255,h=u[c+2]/255,t){case"highlight":r*=l=1-.75*s,o*=l,h*=l;break;case"midtone":r-=(l=.25*s)*Math.sin(r*Math.PI),o-=l*Math.sin(o*Math.PI),h-=l*Math.sin(h*Math.PI);break;case"shadow":r+=s*(1-Math.exp(1-r)),o+=s*(1-Math.exp(1-o)),h+=s*(1-Math.exp(1-h))}(r*=255)<0&&(r=0),(o*=255)<0&&(o=0),(h*=255)<0&&(h=0),u[c]=r,u[c+1]=o,u[c+2]=h}e.putImageData(d,0,0)},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.softness.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("toning-brush-preview").innerHTML="",this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("toning-mode-lighten").addEventListener("click",this.selectMode,!1),(0,i.ZP)("toning-mode-darken").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new p.Z),{size:50,softness:.5})),this.size=new c.Z("toning-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("toning-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",onChange:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.strength=new c.Z("toning-brush-strength",{label:(0,n.Z)("strength"),range:[1,10],defaultValue:3,step:1}),this.addDownListeners(),this.setMode("lighten"),this.layerSelect()}}class x extends h.Z{constructor(e){super("retouch",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectSubTool=e=>{this.setSubTool(e.currentTarget.value)},this.setSubTool=e=>{var t;if(!this.subTool||this.subTool.name!==e)switch((0,i.ZP)("retouch-heal-settings").style.display="none",(0,i.ZP)("retouch-clone-settings").style.display="none",(0,i.ZP)("retouch-detail-settings").style.display="none",(0,i.ZP)("retouch-toning-settings").style.display="none",null===(t=this.subTool)||void 0===t||t.cleanUp(),this.subTool=null,(0,i.ZP)("retouch-"+e+"-settings").style.display="block",e){case"heal":this.subTool=new f(this.stage);break;case"clone":this.subTool=new y(this.stage);break;case"detail":this.subTool=new w(this.stage);break;case"toning":this.subTool=new b(this.stage)}},this.cleanUp=()=>{var e;(0,i.ZP)("retouch-close").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("retouch-cancel").removeEventListener("click",this.cancelClick,!1),(0,i.ZP)("retouch-type-heal").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-clone").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-detail").removeEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-toning").removeEventListener("change",this.selectSubTool,!1),null===(e=this.subTool)||void 0===e||e.cleanUp(),this.subTool=null},(0,i.ZP)("retouch-close").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("retouch-cancel").addEventListener("click",this.cancelClick,!1),(0,i.ZP)("retouch-type-heal").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-clone").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-detail").addEventListener("change",this.selectSubTool,!1),(0,i.ZP)("retouch-type-toning").addEventListener("change",this.selectSubTool,!1);const t=document.querySelector('input[name="retouch-type"]:checked').value;this.setSubTool(t)}}},7538:(e,t,s)=>{s.d(t,{Z:()=>v});var i=s(6548),n=s(3947),a=s(3655),r=s(6817),o=s(4188),h=s(3673),c=s(4170),l=s(4820),d=s(4178),u=s(3868),p=s(5934);class g extends u.Z{constructor(e){super((0,i.Z)("dialogAddLayerTitle"),!0),this.rotation=0,this.maxSize=1920,this.checkNeverAskAgain=()=>{(0,n.ZP)("add-layer-never-ask-again").checked&&(0,l.Lt)("askToAddLayer",!1)},this.addLayerChoice=async e=>{e.stopPropagation(),this.checkNeverAskAgain();let t="x"===l.ZP.product;switch(e.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":await(0,p.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,p.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}this.cleanUp()},this.stage=e,this.dialog.style.width="500px",this.dialog.style.maxWidth="500px",this.setContent(`\n            <label class="pad-0">${(0,i.Z)("dialogAddLayerHL")}</label>\n\n            <ul id="add-layer-type" class="push-buttons small pad-20">\n                <li id="add-layer-empty" data="empty"><img src="/img/tool/empty.svg" class="ic"><span>${(0,i.Z)("empty")}</span></li>\n                <li id="add-layer-image" data="image"><img src="/img/tool/image.svg" class="ic"><span>${(0,i.Z)("image")}</span></li>\n                <li id="add-layer-frame" data="frame"><img src="/img/tool/frame.svg" class="ic"><span>${(0,i.Z)("frame")}</span></li>\n                <li id="add-layer-text" data="text"><img src="/img/tool/text.svg" class="ic"><span>${(0,i.Z)("text")}</span></li>\n                <li id="add-layer-shape" data="shape"><img src="/img/tool/shape.svg" class="ic"><span>${(0,i.Z)("shape")}</span></li>\n            </ul>\n            <input type="checkbox" id="add-layer-never-ask-again" />\n            <label class="switch pad-20" for="add-layer-never-ask-again">${(0,i.Z)("neverAskMeAgain")}<span></span></label>\n        `),(0,n.ZP)("add-layer-empty").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-image").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-text").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-frame").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-shape").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("dialog-apply"+this.mid).style.display="none"}}var m=s(2282);class v{constructor(e){this.isDown=!1,this.stamp=(new Date).getTime(),this.addLayer=e=>{l.ZP.askToAddLayer?new g(this.stage):this.stage.addEmpty()},this.changeName=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);const s=(0,n.ZP)("layer-settings-name").value;e.settings.name!==s&&(e.settings.name=s,this.stage.history.add({type:"layerSettings",kind:"name",layer:e,settings:t}),(0,n.ZP)(e.id+"-name")&&((0,n.ZP)(e.id+"-name").innerHTML=e.settings.name+"<span>"+(0,i.Z)(e.type)+"</span>"))},this.changeBlendMode=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);e.settings.blendmode=(0,n.ZP)("layer-settings-blend-mode").value,this.stage.history.add({type:"layerSettings",kind:"blendMode",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=e=>{this.stamp=(new Date).getTime();const t=(0,n.ZP)("layer-settings-locked-true").checked;this.stage.changeLocked(void 0,t)},this.changeVisible=e=>{this.stamp=(new Date).getTime();let t=this.stage.fresco.getLayerById(this.settingsId);const s=(0,n.ZP)("layer-settings-visible-true").checked;this.stage.changeVisible(t,s)},this.markSelected=e=>{if(this.settingsId="",(0,n.ZP)("layer-settings").classList.remove("show"),this.stage&&this.stage.fresco&&(0,n.ZP)("layer-box")){let e=(0,n.ZP)("layer-list").getElementsByTagName("div");for(var t=0;t<e.length;t++)e[t].classList.toggle("selected",this.stage.fresco.isSelectedById(e[t].id))}},this.redraw=e=>{if(!this.stage)return;if(this.stage.supressRender)return;if(this.isDown&&!this.stage.layerDrag)return;const t=(0,n.ZP)("layer-list");if(t){for((new Date).getTime()-this.stamp>1e3&&(this.settingsId="",(0,n.ZP)("layer-settings").classList.remove("show"));t.lastChild;)t.removeChild(t.lastChild);if(this.stage.fresco){const e=r.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,80,120),o=e.width/this.stage.fresco.width,h=this.stage.fresco.width,l=this.stage.fresco.height;(0,n.ZP)("layer-box-add").style.width=e.width+8+"px";for(var s=this.stage.fresco.layers.length-1;s>=0;s--){const d=this.stage.fresco.layers[s],u=this.stage.fresco.isSelectedById(d.id);let p=(0,n.T)("div",{className:"layer"});u&&p.classList.add("selected"),p.style.width=e.width+8+"px",p.style.height=e.height+8+"px",p.id=d.id;let g=a.vL(e.width,e.height);if(d.canvas){let t=g.getContext("2d");if(d.rect.width/h>.5||d.rect.height/l>.5)t.scale(o,o),this.stage.renderLayer(t,d,!0);else{t.translate(e.width/2,e.height/2),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.rotate(d.rect.rotation*Math.PI/180);const s=r.Z.bestFit(d.rect.width,d.rect.height,e.width-8,e.height-8);t.drawImage(d.baked?d.baked:d.canvas,-s.width/2,-s.height/2,Math.max(s.width,1),Math.max(s.height,1))}}p.appendChild(g);const v=(0,n.T)("img",{className:"more",src:"/img/icon/three-dot.svg",title:(0,i.Z)("layerSettings")});v.addEventListener("pointerdown",(e=>{e.stopPropagation(),e.preventDefault(),this.toggleSettings(e,d.id)}),!0),p.appendChild(v),d.settings.visible||p.classList.add("hidden");let f=(0,n.T)("div",{className:"icons"});if(p.appendChild(f),d.settings.locked&&!d.settings.visible||!d.settings.locked){const e=(0,n.T)("img",{className:"visibility",title:d.settings.visible?(0,i.Z)("visible"):(0,i.Z)("hidden"),src:d.settings.visible?"/img/icon/visible.svg":"/img/icon/hidden.svg"});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeVisible(d,!d.settings.visible)}),!1),f.appendChild(e)}else{let e=(0,n.T)("img",{src:"/img/icon/locked.svg",className:"locked",title:(0,i.Z)("locked")});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeLocked(d,!1)}),!1),f.appendChild(e)}if(d.animation){const e=(0,n.T)("img",{src:d.animation.block?"/img/icon/animation/none.svg":"/img/icon/animation/animation.svg",title:(0,i.Z)("animation"),className:"animation"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("panel-animation"))})),f.appendChild(e)}if(d instanceof m.Z&&d.hasMask()){const e=(0,n.T)("img",{src:"/img/icon/mask.svg",title:(0,i.Z)("hasCutout"),className:"cutout"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("select-tool",{detail:"cutout"}))})),e.addEventListener("dblclick",(()=>{this.stage.maskApply()})),f.appendChild(e)}switch(d.type){case c.Z.TYPE_IMAGE:f.appendChild((0,n.T)("img",{src:"/img/tool/image.svg",title:(0,i.Z)("image"),className:"type"}));break;case c.Z.TYPE_FRAME:f.appendChild((0,n.T)("img",{src:"/img/tool/frame.svg",title:(0,i.Z)("frame"),className:"type"}));break;case c.Z.TYPE_ELEMENT:f.appendChild((0,n.T)("img",{src:"/img/tool/element.svg",title:(0,i.Z)("element"),className:"type"}));break;case c.Z.TYPE_TEXT:f.appendChild((0,n.T)("img",{src:"/img/tool/text.svg",title:(0,i.Z)("text"),className:"type"}));break;case c.Z.TYPE_SHAPE:f.appendChild((0,n.T)("img",{src:"/img/tool/shape.svg",title:(0,i.Z)("shape"),className:"type"}))}p.addEventListener("mousedown",this.mouseDown,!1),p.addEventListener("touchstart",this.touchStart,{passive:!1}),t.appendChild(p)}}}},this.settingsId="",this.toggleSettings=(e,t)=>{null==e||e.preventDefault(),null==e||e.stopPropagation();let s=t?this.stage.fresco.getLayerById(t):this.stage.fresco.getSelected();if(!s)return;if(s.id===this.settingsId)return void this.hideSettings();(0,n.ZP)("layer-settings").style.display="block",this.settingsId=s.id,this.opacity.setValue(s.settings.opacity),(0,n.ZP)("layer-settings-name").value=s.settings.name,(0,n.ZP)("layer-settings-blend-mode").value=s.settings.blendmode,(0,n.ZP)("layer-settings-visible-true").checked=s.settings.visible,(0,n.ZP)("layer-settings-visible-false").checked=!s.settings.visible,(0,n.ZP)("layer-settings-locked-true").checked=s.settings.locked,(0,n.ZP)("layer-settings-locked-false").checked=!s.settings.locked;let i=(0,n.ZP)("layer-settings");const r=i.getBoundingClientRect(),o=a.HS(e.target),h=(0,n.ZP)("layer-box-content-ss-content").scrollTop;let c=o.y-h;c+r.height>(0,n.ZP)("workspace").clientHeight&&(c=(0,n.ZP)("workspace").clientHeight-r.height-4),i.style.top=c-20+"px",i.style.right="80px"},this.hideSettings=()=>{this.settingsId="",(0,n.ZP)("layer-settings").style.display="none",document.dispatchEvent(new CustomEvent("layer-arrange"))},this.touchStart=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.down(e.touches[0].clientX,e.touches[0].clientY,e.currentTarget,e.shiftKey||e.ctrlKey),this.stage.fresco.getSelected()&&(document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})))},this.touchMove=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX,e.touches[0].clientY))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.up(e.touches[0].clientX,e.touches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{"INPUT"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName&&(e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget,e.shiftKey||e.ctrlKey),this.stage.fresco.getSelected()&&(document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0),this.isDown=!0,(0,n.ZP)("layer-box").classList.add("down")))},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.mouseUp=e=>{e.stopPropagation(),this.up(e.clientX,e.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(e,t,s,i)=>{this.downY=t,this.heightY=(0,n.ZP)("layer-box-content-ss-content").scrollHeight,(i||this.stage.fresco.isSelectedStack()||!this.stage.fresco.isSelectedById(s.id))&&(i&&this.stage.fresco.isSelectedById(s.id)?this.stage.unselectLayerById(s.id):this.stage.selectLayerById(s.id,i,!0))},this.pointInLayerBox=(e,t)=>{const s=(0,n.ZP)("layer-list").getBoundingClientRect();return e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height},this.move=(e,t)=>{const s=(0,n.ZP)("layer-list");if(!this.pointInLayerBox(e,t)){if(this.ghost){this.ghost.classList.remove("ghost"),this.ghost.style.left="unset",this.ghost.style.top="unset",this.ghostFill.remove();const e=this.stage.fresco.layers.length-this.stage.fresco.selectedLayerNr()-1;s.children[e].before(this.ghost),this.ghost=null,this.ghostFill=null}if(!this.stage.layerDrag){const s=this.stage.fresco.getSelected(),i=(0,n.ZP)(s.id);this.stage.layerDrag={fresco:this.stage.fresco.id,layer:s,node:(0,n.T)("div",{className:"grabbed-layer"},(0,n.T)("div",{className:"thumb"},a.dN(i.querySelector("canvas"))),(0,n.T)("div",s.settings.name)),position:new h.Z(e,t),blocked:this.stage.fresco.block},this.stage.workspace.append(this.stage.layerDrag.node),document.body.style.cursor="move"}const i=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-i.width/2+"px",this.stage.layerDrag.node.style.top=t-i.height/2+"px",this.stage.layerDrag.position=new h.Z(e,t),void document.dispatchEvent(new CustomEvent("layer-drag-move"))}if(this.stage.layerDrag){if(this.stage.coating.clear(),document.body.style.cursor="unset",this.stage.layerDrag.fresco!==this.stage.fresco.id){const s=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-s.width/2+"px",this.stage.layerDrag.node.style.top=t-s.height/2+"px",void(this.stage.layerDrag.position=new h.Z(e,t))}this.stage.layerDrag.node.remove(),this.stage.layerDrag=null}this.ghost||(this.ghost=(0,n.ZP)(this.stage.fresco.getSelected().id),this.startY=this.ghost.offsetTop,this.ghost.style.left=this.ghost.offsetLeft+"px",this.ghostFill=document.createElement("div"),this.ghostFill.id="ghost-fill",this.ghostFill.style.width=this.ghost.clientWidth+4+"px",this.ghostFill.style.height=this.ghost.clientHeight+4+"px",this.ghost.before(this.ghostFill),this.ghost.classList.add("ghost"),s.appendChild(this.ghost)),-1===this.startY&&(this.startY=this.ghost.offsetTop,this.downY=t),this.ghost.style.top=this.startY-(this.downY-t)+"px",this.moveGhostFill(),window.clearTimeout(this.auto);let i=(0,n.ZP)("layer-box-content-ss-content");this.ghost.offsetTop<i.scrollTop-5?this.autoScroll(-20):this.ghost.offsetTop+this.ghost.offsetHeight>i.scrollTop+i.offsetHeight+5&&this.autoScroll(20)},this.moveGhostFill=()=>{this.ghost.offsetTop>this.ghostFill.offsetTop+this.ghostFill.offsetHeight/2+10?this.ghostFill.nextElementSibling.classList.contains("selected")||this.ghostFill.nextElementSibling.after(this.ghostFill):this.ghost.offsetTop<this.ghostFill.offsetTop-this.ghostFill.offsetHeight/2-10&&this.ghostFill.previousElementSibling&&this.ghostFill.previousElementSibling.before(this.ghostFill)},this.autoScroll=e=>{window.clearTimeout(this.auto);const t=(0,n.ZP)("layer-box-content-ss-content"),s=()=>{this.ghost&&(e<0&&t.scrollTop>10||e>0&&t.scrollTop+10<this.heightY-t.clientHeight)&&(this.startY=-1,t.scrollTop+=e,this.ghost.style.top=this.ghost.offsetTop-10+e+"px",this.moveGhostFill(),this.auto=window.setTimeout(s,80))};this.auto=window.setTimeout(s,80)},this.up=(e,t)=>{this.isDown=!1,(0,n.ZP)("layer-box").classList.remove("down"),document.body.style.cursor="unset",this.stage.layerDrag&&(this.pointInLayerBox(e,t)||document.dispatchEvent(new CustomEvent("layer-drag-drop")),this.stage.layerDrag.node.remove(),this.stage.layerDrag=void 0),this.ghost&&(this.ghost.classList.remove("ghost"),this.ghost.style.left="0px",this.ghost.style.top="0px",this.ghostFill.before(this.ghost),this.ghostFill.remove(),this.ghost=void 0,this.ghostFill=void 0);let s=this.stage.fresco.selectedLayerNr(),i=(0,n.ZP)("layer-list").getElementsByClassName("layer");const a=this.stage.fresco.getSelected();for(var r=0;r<i.length;r++)if(i[r].id===a.id){let e=i.length-r-1;e!=s&&this.stage.changeOrder(s,e);break}},this.stage=e,document.addEventListener("layer-list-render",(()=>this.redraw()),!0),document.addEventListener("layer-select",(()=>this.markSelected()),!1),(0,n.ZP)("layer-box-add").addEventListener("click",this.addLayer,!1),(0,n.ZP)("layer-settings-name").addEventListener("blur",this.changeName,!1),(0,n.ZP)("layer-settings-name").addEventListener("keydown",(e=>{"Enter"===e.key&&(e.currentTarget.blur(),this.hideSettings())}),!0),(0,n.ZP)("layer-settings-close").addEventListener("click",this.hideSettings,!1),(0,n.ZP)("layer-settings-delete").addEventListener("click",(()=>this.stage.deleteLayer()),!1),(0,n.ZP)("layer-settings-duplicate").addEventListener("click",(()=>this.stage.duplicateLayer()),!1),(0,n.ZP)("layer-settings-blend-mode").addEventListener("change",this.changeBlendMode,!1),(0,n.ZP)("layer-settings-visible-false").addEventListener("click",this.changeVisible,!1),(0,n.ZP)("layer-settings-visible-true").addEventListener("click",this.changeVisible,!1),(0,n.ZP)("layer-settings-locked-false").addEventListener("click",this.changeLocked,!1),(0,n.ZP)("layer-settings-locked-true").addEventListener("click",this.changeLocked,!1),(0,n.ZP)("layer-settings-merge-down").addEventListener("click",(()=>this.stage.mergeDown()),!1),(0,n.ZP)("layer-settings-merge-visible").addEventListener("click",(()=>this.stage.mergeVisible()),!1),(0,n.ZP)("layer-settings-merge-flatten").addEventListener("click",(()=>this.stage.mergeFlatten()),!1),this.opacity=new o.Z("layer-settings-opacity",{defaultValue:1,label:(0,i.Z)("opacity"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.stage.fresco.getLayerById(this.settingsId).settings.opacity=e,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(e,t)=>{this.stamp=(new Date).getTime();let s=this.stage.fresco.getLayerById(this.settingsId);this.stage.history.add({type:"layerSettings",kind:"opacity",layer:s,settings:Object.assign(Object.assign({},s.settings),{opacity:t})})}}),new d.Z((0,n.ZP)("layer-box-content")),(0,n.ZP)("layer-box-content").oncontextmenu=e=>{e.preventDefault(),this.toggleSettings(e)}}}},5293:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3655),n=s(6817),a=s(3673),r=s(3947);class o{constructor(e){this.stage=e,this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.viewport=n.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,180,180),this.scale=this.viewport.width/this.stage.fresco.width,this.panel.style.width=this.viewport.width+2+"px",this.panel.style.height=this.viewport.height+2+"px",this.back.width=this.viewport.width,this.back.height=this.viewport.height;var e=this.back.getContext("2d");e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let t=this.stage.getOutputCanvas(this.scale);t&&t.width>0&&t.height>0&&e.drawImage(t,0,0),this.position()},this.position=()=>{let e=this.stage.fresco.width*this.stage.zoom,t=this.stage.fresco.height*this.stage.zoom;if(!(this.stage.raster.width<=e||this.stage.raster.height<=t))return void(this.panel.style.display="none");this.panel.style.display="block";let s=this.viewport.width,i=this.viewport.height,n=0,a=0;s=Math.round(this.back.width*(this.stage.canvas.width/(this.stage.fresco.width*this.stage.zoom))),i=Math.round(this.back.height*(this.stage.canvas.height/(this.stage.fresco.height*this.stage.zoom))),n=-Math.round((this.stage.offset.x<0?this.stage.offset.x/this.stage.zoom:0)*this.scale),a=-Math.round((this.stage.offset.y<0?this.stage.offset.y/this.stage.zoom:0)*this.scale),this.marker.style.width=s+"px",this.marker.style.height=i+"px",this.marker.style.left=n+"px",this.marker.style.top=a+"px"},this.backDown=e=>{e.stopPropagation();let t=this.back.getBoundingClientRect(),s=this.stage.fresco.width/this.back.width;this.stage.setAnchor(new a.Z(Math.round((e.clientX-t.x)*s),Math.round((e.clientY-t.y)*s))),this.stage.updateViewport()},this.markerDown=e=>{e.stopPropagation(),this.down(e.clientX,e.clientY),document.addEventListener("pointermove",this.pointerMove,!0),document.addEventListener("pointerup",this.pointerUp,!0)},this.pointerMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.pointerUp=e=>{e.stopPropagation(),document.removeEventListener("pointermove",this.pointerMove,!0),document.removeEventListener("pointerup",this.pointerUp,!0)},this.down=(e,t)=>{this.downPoint=new a.Z(e,t),this.downPosition=new a.Z(this.marker.offsetLeft,this.marker.offsetTop)},this.move=(e,t)=>{let s=this.downPosition.x+(e-this.downPoint.x),i=this.downPosition.y+(t-this.downPoint.y);this.stage.setAnchor(new a.Z(Math.round((s+this.marker.clientWidth/2)/this.scale),Math.round((i+this.marker.clientHeight/2)/this.scale))),this.stage.updateViewport()},this.viewport=new n.Z,this.panel=(0,r.T)("div",{id:"navigator"}),this.marker=(0,r.T)("div",{id:"navigator-marker"}),this.back=i.vL(50,50),this.back.id="navigator-back",this.panel.append(this.back,this.marker),(0,r.ZP)("workspace").append(this.panel),this.marker.addEventListener("pointerdown",this.markerDown,!1),this.back.addEventListener("pointerdown",this.backDown,!1),document.addEventListener("viewport-update",this.position),document.addEventListener("layer-list-render",this.render)}}},1966:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),n=s(3947),a=s(3868),r=s(4820);class o extends a.Z{constructor(){super((0,i.Z)("preferences"),!1),this.dialog.style.width="440px",this.dialog.style.maxWidth="440px",this.setContent(`\n            <label>${(0,i.Z)("viewOBarAccent")}</label>\n            <div id="preference-accent" class="pad-4 color-pod-list" style="display:flex">\n                <div class="color-pod small" data="ash" style="background-color:#383E42"></div>\n                <div class="color-pod small" data="brown" style="background-color:#715649"></div>\n                <div class="color-pod small" data="coral" style="background-color:#F3764C"></div>\n                <div class="color-pod small" data="pink" style="background-color:#F17686"></div>\n                <div class="color-pod small" data="rose" style="background-color:#FE5151"></div>\n                <div class="color-pod small" data="red" style="background-color:#BA2B46"></div>\n                <div class="color-pod small" data="plum" style="background-color:#5A354F"></div>\n                <div class="color-pod small" data="maroon" style="background-color:#A82068"></div>\n                <div class="color-pod small" data="purple" style="background-color:#7D4199"></div>\n                <div class="color-pod small" data="lavender" style="background-color:#6D5DD2"></div>\n                <div class="color-pod small" data="denim" style="background-color:#496171"></div>\n                <div class="color-pod small" data="blue" style="background-color:#0099CC"></div>\n                <div class="color-pod small" data="teal" style="background-color:#00A5A5"></div>\n                <div class="color-pod small" data="green" style="background-color:#48B07B"></div>\n                <div class="color-pod small" data="lime" style="background-color:#95C20F"></div>\n                <div class="color-pod small" data="mustard" style="background-color:#F5BB00"></div>\n            </div>\n\n            <label class="pad-16">${(0,i.Z)("viewOBarWorkspace")}</label>\n            <div id="preference-workspace" class="color-selector-presets extended pad-4" style="width:200px">\n                <div data="dark" class="color-pod square" style="background-color: #232529"></div>\n                <div data="iron" class="color-pod square" style="background-color: #606060"></div>\n                <div data="steel" class="color-pod square" style="background-color: #999999"></div>\n                <div data="light" class="color-pod square" style="background-color: #cccccc"></div>\n            </div>\n\n            <a id="preference-theme-reset" class="link pad-20" style="display:inline-block;">${(0,i.Z)("reset")}</a>\n            \n            <div class="splitter small pad-16"></div>\n            <input type="checkbox" id="setting-ask-preresize" />\n            <label class="pad-10 switch" for="setting-ask-preresize">${(0,i.Z)("viewOBarAskPrerezise")}<span></span></label>\n            <input type="checkbox" id="setting-ask-layertyp" />\n            <label class="pad-10 switch" for="setting-ask-layertyp">${(0,i.Z)("viewOBarAskLayertype")}<span></span></label>\n            <div class="splitter small pad-10"></div>\n            <input type="checkbox" id="setting-guides" />\n            <label class="pad-10 switch" for="setting-guides">${(0,i.Z)("viewOBarShowGu")}<span></span></label>\n            <input type="checkbox" id="settings-snap-to" />\n            <label class="pad-10 switch" for="settings-snap-to">${(0,i.Z)("viewOBarSnap")}<span></span></label>\n            <input type="checkbox" id="settings-smooth" />\n            <label class="pad-10 switch" for="settings-smooth">${(0,i.Z)("viewOBarSmooth")}<span></span></label>\n            <div class="splitter small pad-10"></div>\n            <input type="checkbox" id="settings-all-tooltip" />\n            <label class="pad-10 switch" for="settings-all-tooltip">${(0,i.Z)("viewOBarAllTooltip")}<span></span></label>\n            <label class="split pad-10" for="settings-scroll-mode">${(0,i.Z)("viewOBarScollMode")}\n                <div class="select pad-0" style="width:auto">\n                    <select id="settings-scroll-mode">\n                        <option value="zoom">${(0,i.Z)("zoom")}</option>\n                        <option value="move">${(0,i.Z)("move")}</option>\n                        <option value="none">${(0,i.Z)("none")}</option>\n                    </select> \n                </div>\n            </label>\n        `);let e=r.ZP.accent,t=(0,n.ZP)("preference-accent").getElementsByTagName("div");for(var s=0;s<t.length;s+=1)t[s].addEventListener("click",(t=>{document.documentElement.classList.remove(e),e=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(e),document.dispatchEvent(new CustomEvent("layer-list-render")),(0,r.Lt)("accent",e)}));let a=r.ZP.workspace,o=(0,n.ZP)("preference-workspace").getElementsByTagName("div");for(s=0;s<o.length;s+=1)o[s].addEventListener("click",(e=>{document.documentElement.classList.remove(a),a=e.currentTarget.getAttribute("data"),document.documentElement.classList.add(a),(0,r.Lt)("workspace",a)}));(0,n.ZP)("preference-theme-reset").addEventListener("click",(()=>{(0,r.Lt)("workspace","default"),(0,r.Lt)("accent","default"),document.documentElement.className=""}));const h=(0,n.ZP)("setting-ask-preresize");h.checked=r.ZP.askToPreResize,h.onchange=()=>(0,r.Lt)("askToPreResize",h.checked);const c=(0,n.ZP)("setting-ask-layertyp");c.checked=r.ZP.askToAddLayer,c.onchange=()=>(0,r.Lt)("askToAddLayer",c.checked);const l=(0,n.ZP)("setting-guides");l.checked=r.ZP.showGuides,l.onchange=()=>(0,r.Lt)("showGuides",l.checked);const d=(0,n.ZP)("settings-snap-to");d.checked=r.ZP.snapToGuides,d.onchange=()=>(0,r.Lt)("snapToGuides",d.checked);const u=(0,n.ZP)("settings-smooth");u.checked=r.ZP.smoothScaling,u.onchange=()=>(0,r.Lt)("smoothScaling",u.checked);const p=(0,n.ZP)("settings-scroll-mode");p.value=r.ZP.scrollMode,p.onchange=()=>(0,r.Lt)("scrollMode",p.value);const g=(0,n.ZP)("settings-all-tooltip");g.checked=r.ZP.allTooltip,g.onchange=()=>(0,r.Lt)("allTooltip",g.checked),(0,n.ZP)("dialog-apply"+this.mid).style.display="none",(0,n.ZP)("dialog-cancel"+this.mid).innerText=(0,i.Z)("close")}}},4545:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>I});var n=s(3947),a=s(6548),r=s(5182),o=s(3655),h=s(2817),c=s(5402),l=s(4178),d=s(7549),u=s(4820),p=s(7538),g=s(5293),m=s(3515),v=s(5725),f=s(3948),y=s(89),w=s(7403),b=s(7846),x=s(6557),Z=s(9954),k=s(877),E=s(4028),P=s(4604),S=s(1158),C=s(6246),T=s(1966),L=s(147),M=s(2155),A=e([r]);r=(A.then?(await A)():A)[0];class I extends r.Z{constructor(){super(),this.isKeyDown=!1,this.isPreviewMode=!1,this.resize=(e=!1)=>{if(this.isPreviewMode)this.stage.resize(0,0,this.stage.workspace.offsetWidth-15,this.stage.workspace.offsetHeight-16);else{let e="minimized"===u.ZP.boxBarXState?0:110,t=this.tool?(0,n.ZP)(this.tool.name).clientWidth+47:44;this.stage.resize(t,0,this.stage.workspace.offsetWidth-t-e,this.stage.workspace.offsetHeight-46),(0,n.ZP)("bottom-bar").style.paddingLeft=t+20+"px"}this.scrollbar&&this.scrollbar.resize(),this.tool&&"crop"===this.tool.name&&this.tool.refit()},this.togglePreviewMode=()=>{var e,t;this.isHome()||this.isModal()||(this.isPreviewMode=!this.isPreviewMode,this.isPreviewMode?((0,n.ZP)("box-bar").style.display="none",(0,n.ZP)("menu-bar").style.display="none",(0,n.ZP)("bottom-bar").style.display="none",this.stage.reform&&(this.wasSuppress=this.stage.reform.supressed,this.stage.reform.supress(!0)),this.tool&&(null===(e=(0,n.ZP)(this.tool.name))||void 0===e||e.classList.remove("active"))):((0,n.ZP)("box-bar").style.display="flex",(0,n.ZP)("menu-bar").style.display="flex",(0,n.ZP)("bottom-bar").style.display="flex",this.tool&&(null===(t=(0,n.ZP)(this.tool.name))||void 0===t||t.classList.add("active"),this.stage.reform&&!this.wasSuppress&&this.stage.reform.supress(!1))),this.resize())},this.keyDown=e=>{if(this.isHome())return;const t=document.activeElement;if(o.PP(t))13==e.keyCode&&"TEXTAREA"!=t.nodeName&&document.activeElement.blur();else if(this.isModal())e.preventDefault();else if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"o":return e.preventDefault(),void this.home.openClick();case"s":return e.preventDefault(),void this.saveClick();case"q":return e.preventDefault(),void this.closeClick();case"z":return e.preventDefault(),e.shiftKey?this.stage.history.redo():this.stage.history.undo(),!1;case"y":return e.preventDefault(),this.stage.history.redo(),!1;case"0":return e.preventDefault(),void this.stage.setZoom("fit");case"1":return e.preventDefault(),void this.stage.setZoom("1");case"2":return e.preventDefault(),void this.stage.setZoom("fill");case"3":return e.preventDefault(),void this.stage.setZoom("3");case"-":return e.preventDefault(),void this.stage.setZoomStep(!1);case"+":case"=":return e.preventDefault(),void this.stage.setZoomStep(!0)}else{if(" "===e.key)return this.stage.coating.setPan(),void e.preventDefault();if("Tab"===e.key)return e.preventDefault(),void this.togglePreviewMode();if("Escape"!==e.key)if("Enter"!==e.key){if("Delete"===e.key||"Backspace"===e.key)return e.preventDefault(),void this.stage.deleteLayer();switch(e.key.toLowerCase()){case"p":this.toggleTool("layout");break;case"c":this.toggleTool("crop");break;case"k":this.toggleTool("cutout");break;case"v":this.toggleTool("arrange");break;case"a":this.toggleTool("adjust");break;case"e":this.toggleTool("effect");break;case"q":this.toggleTool("liquify");break;case"r":this.toggleTool("retouch");break;case"b":this.toggleTool("paint");break;case"t":this.toggleTool("add-text");break;case"i":this.toggleTool("add-image");break;case"o":this.toggleTool("add-element")}}else this.applyToolEvent();else this.isPreviewMode?this.togglePreviewMode():this.cancelToolEvent()}},this.keyUp=e=>{if(this.isModal())return e.stopImmediatePropagation(),e.stopPropagation(),void e.preventDefault();32!=e.keyCode||this.stage.coating.removePan()},this.setUpMenuBar=()=>{let e=(0,n.ZP)("tool-menu").getElementsByTagName("li");for(var t=0;t<e.length;t++)e[t].addEventListener("click",(e=>this.toggleTool(e.currentTarget.getAttribute("data"))),!1);document.addEventListener("tool-apply",this.applyToolEvent,!0),document.addEventListener("tool-cancel",this.cancelToolEvent,!0),document.addEventListener("select-tool",this.selectTool,!0),(0,n.ZP)("menu-bar").addEventListener("mouseenter",(()=>{u.ZP.allTooltip&&(0,n.ZP)("menu-bar").classList.add("active")})),(0,n.ZP)("menu-bar").addEventListener("mouseleave",(()=>{(0,n.ZP)("menu-bar").classList.remove("active")})),(0,n.ZP)("toggle-home").addEventListener("click",(()=>{this.toggleTool(),this.navigate()}),!1),(0,n.ZP)("toggle-settings").addEventListener("click",(()=>{new T.Z}),!1),this.loadView("layout","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("layout-content")))),this.loadView("arrange","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("arrange-content")))),this.loadView("animation","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("animation-content")))),this.loadView("add-text","workspace","tool-drawer wide").then((e=>new l.Z((0,n.ZP)("add-text-content")))),this.loadView("add-element","workspace","tool-drawer wide").then((e=>new l.Z((0,n.ZP)("add-element-content")))),this.loadView("crop","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("crop-content")))),this.loadView("cutout","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("cutout-content")))),this.loadView("adjust","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("adjust-content")))),this.loadView("effect","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("effect-content")))),this.loadView("liquify","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("liquify-content")))),this.loadView("retouch","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("retouch-content")))),this.loadView("paint","workspace","tool-drawer").then((e=>new l.Z((0,n.ZP)("paint-content"))))},this.setUpBottomBar=()=>{(0,n.ZP)("close").addEventListener("click",this.closeClick,!1),(0,n.ZP)("save").addEventListener("click",this.saveClick,!1);const e=(0,n.ZP)("undo"),t=(0,n.ZP)("redo");e.addEventListener("click",(()=>this.stage.history.undo())),t.addEventListener("click",(()=>this.stage.history.redo())),document.addEventListener("history-update",(async s=>{e.classList.toggle("disabled",s.detail.atStart),t.classList.toggle("disabled",s.detail.atEnd)})),(0,n.ZP)("animator-play").addEventListener("click",(()=>this.stage.playAnimation())),(0,n.ZP)("animator-stop").addEventListener("click",(()=>this.stage.stopAnimation())),(0,n.ZP)("zoom-out").addEventListener("click",(()=>this.stage.setZoomStep(!1)),!1),(0,n.ZP)("zoom-in").addEventListener("click",(()=>this.stage.setZoomStep(!0)),!1),(0,n.ZP)("zoom-level").addEventListener("click",(()=>{(0,n.ZP)("zoom-selector").classList.toggle("active")}),!1);let s=(0,n.ZP)("zoom-selector").getElementsByTagName("li");for(var i=0;i<s.length;i++)s[i].addEventListener("click",(e=>{(0,n.ZP)("zoom-selector").classList.toggle("active");const t=e.currentTarget.getAttribute("data");this.stage.setZoom(t)}),!1);const a=()=>{var e;const t=null===(e=this.stage.fresco)||void 0===e?void 0:e.hasAnimation();(0,n.ZP)("animator").classList.toggle("enabled",t)};document.addEventListener("history-update",a),document.addEventListener("layer-select",a)},this.setUpBoxBar=()=>{this.layerBox=new p.Z(this.stage),this.scrollbar=new d.Z(this.stage),this.navigator=new g.Z(this.stage),!u.ZP.user.subscription&&document.body.clientWidth<1025&&(this.sneaky=new c.Z);const e=(0,n.ZP)("box-tab");e.setAttribute("tooltip","minimized"===u.ZP.boxBarXState?(0,a.Z)("maximize"):(0,a.Z)("minimize")),e.addEventListener("click",(()=>{let t=(0,n.ZP)("box-bar").classList.value;t="maximized"===t?"minimized":"maximized",(0,n.ZP)("box-bar").classList.value=t,e.setAttribute("tooltip","minimized"===t?(0,a.Z)("maximize"):(0,a.Z)("minimize")),e.classList.toggle("minimized","minimized"===t),(0,u.Lt)("boxBarXState",t),this.resize()}),!1),(0,n.ZP)("box-bar").classList.value=u.ZP.boxBarXState,(0,n.ZP)("box-tab").classList.value=u.ZP.boxBarXState},this.animationPlayEvent=e=>{(0,n.ZP)("animator").classList.add("playing"),(0,n.ZP)("animator").setAttribute("time",e.detail),(0,n.ZP)("animator-progress-line").style.width="0%"},this.animationStepEvent=e=>{const t=Number(e.detail),s=Number((0,n.ZP)("animator").getAttribute("time"));(0,n.ZP)("animator-time").innerText=(Math.min(t,s)/1e3).toFixed(1);const i=Math.min(t/s,1);(0,n.ZP)("animator-progress-line").style.width=100*i+"%"},this.animationStopEvent=e=>{(0,n.ZP)("animator").classList.remove("playing")},this.applyToolEvent=()=>{var e;null===(e=this.tool)||void 0===e||e.apply(),this.toggleTool()},this.cancelToolEvent=()=>{var e;null===(e=this.tool)||void 0===e||e.cancel(),this.toggleTool()},this.selectTool=e=>{var t;e&&e.detail&&this.tool&&this.tool.name===e.detail||(null===(t=this.tool)||void 0===t||t.apply(),this.toggleTool(null==e?void 0:e.detail))},this.layerMarked=()=>{this.tool||this.toggleTool("arrange")},this.toggleTool=async e=>{var t,s,i,a,r;if(null===(t=this.sneaky)||void 0===t||t.timeToSneak(),"more"===e)return;const o=this.tool&&this.tool.name===e;if(this.tool&&(e&&this.tool.apply(),this.stage.history.commitTransaction(),this.stage.coating.removeCursorImage(),null===(s=(0,n.ZP)("tool-"+this.tool.name))||void 0===s||s.classList.remove("active"),null===(i=(0,n.ZP)(this.tool.name))||void 0===i||i.classList.remove("active"),this.tool.cleanUp(),this.tool=null),e&&!o){if(!(0,n.ZP)(e)&&(await this.loadView(e,"workspace","tool-drawer").then((t=>new l.Z((0,n.ZP)(e+"-content")))),this.tool))return;switch((0,n.ZP)("menu-bar").classList.remove("active"),e){case"arrange":this.tool=new E.Z(this.stage);break;case"animation":this.tool=new C.Z(this.stage);break;case"layout":this.tool=new w.Z(this.stage);break;case"crop":this.tool=new m.Z(this.stage);break;case"cutout":this.tool=new b.Z(this.stage);break;case"adjust":this.tool=new x.Z(this.stage);break;case"effect":this.tool=new Z.Z(this.stage);break;case"retouch":this.tool=new P.Z(this.stage);break;case"liquify":this.tool=new S.Z(this.stage);break;case"paint":this.tool=new v.Z(this.stage);break;case"add-element":this.tool=new L.Z(this.stage);break;case"add-text":this.tool=new k.Z(this.stage);break;case"focus":this.tool=new f.Z(this.stage);break;case"glitch":this.tool=new y.Z(this.stage);break;case"dispersion":this.tool=new M.Z(this.stage)}}!this.tool||this.tool instanceof E.Z||this.tool instanceof w.Z||this.tool instanceof k.Z||this.tool instanceof L.Z?this.stage.reform.supress(!1):this.stage.reform.supress(!0),this.tool&&(null===(a=(0,n.ZP)("tool-"+this.tool.name))||void 0===a||a.classList.add("active"),null===(r=(0,n.ZP)(this.tool.name))||void 0===r||r.classList.add("active")),this.resize(!!this.tool)},this.stage.tabLimit=1,this.stage.reform=new h.Z(this.stage,"ARRANGE"),window.onresize=()=>this.resize(),document.body.onkeydown=e=>this.keyDown(e),document.body.onkeyup=e=>this.keyUp(e),this.loadView("menu-bar","workspace").then(this.setUpMenuBar),this.loadView("box-bar","workspace").then(this.setUpBoxBar),this.loadView("bottom-bar","workspace").then(this.setUpBottomBar),document.addEventListener("resize",(()=>this.resize())),document.addEventListener("layer-marked",(()=>this.layerMarked())),document.addEventListener("animation-play",this.animationPlayEvent,!0),document.addEventListener("animation-step",this.animationStepEvent,!0),document.addEventListener("animation-stop",this.animationStopEvent,!0),document.addEventListener("zoom-change",(()=>{(0,n.ZP)("zoom-level").innerText=Math.round(100*this.stage.zoom)+"%"}),!1)}}i()}catch(I){i(I)}}))},2982:(e,t,s)=>{s.a(e,(async(i,n)=>{try{var a,r=i([a=s(2646)]),[a]=r.then?(await r)():r;await s.v(t,e.id,"6e8beab9bcfa48b484e0",{"./pixlr_bg.js":{__wbindgen_string_new:a.h4,__wbg_x_84616b3462f445c9:a.bi,__wbg_y_3b1c131c2eb62473:a.lK,__wbg_width_5491bf1bf3b1e78a:a.gI,__wbg_height_28c0c13811abedde:a.mE,__wbindgen_memory:a.oH,__wbg_buffer_397eaa4d72ee94dd:a.jp,__wbg_newwithbyteoffsetandlength_8252bb2eb6e239b2:a.dZ,__wbindgen_object_drop_ref:a.ug,__wbg_new_de1f835fd3453d3d:a.MS,__wbindgen_throw:a.Or,__wbindgen_rethrow:a.nD}}),n()}catch(o){n(o)}}),1)}},c={};function l(e){var t=c[e];if(void 0!==t)return t.exports;var s=c[e]={id:e,loaded:!1,exports:{}};return h[e](s,s.exports,l),s.loaded=!0,s.exports}l.m=h,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},l.a=(n,a,r)=>{var o;r&&((o=[]).d=1),o&&(o.moduleId=n.id);var h,c,l,d=new Set,u=n.exports,p=new Promise(((e,t)=>{l=t,c=e}));p[t]=u,p[e]=e=>(o&&e(o),d.forEach(e),p.catch((e=>{}))),p.moduleId=n.id,n.exports=p,a((n=>{var a;h=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var a=[];a.d=0,n.then((e=>{r[t]=e,i(a)}),(e=>{r[s]=e,i(a)}));var r={};return r[e]=e=>e(a),r}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var r=()=>h.map((e=>{if(e[s])throw e[s];return e[t]})),c=new Promise((t=>{(a=()=>t(r)).r=0;var s=e=>e!==o&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));h.map((t=>t[e](s)))}));return a.r?c:r()}),(e=>(e?l(p[s]=e):c(u),i(o)))),o&&(o.d=0)},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);l.r(s);var i={};n=n||[null,a({}),a([]),a(a)];for(var r=2&t&&e;"object"==typeof r&&!~n.indexOf(r);r=a(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,l.d(s,i),s},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,s)=>(l.f[s](e,t),t)),[])),l.u=e=>(({155:"ffmpeg",200:"gif",215:"native",346:"infill",500:"pdf-lib",556:"tiff",600:"adyen"}[e]||e)+"."+{30:"c09c5a95167a042a7289",126:"d9c3d8c8052cf6f45542",132:"aa314f020245f43ef712",155:"0504991b2012ff8a26c8",184:"9e639613adaa4a4b34e6",200:"9f856c0e6828dab009a4",215:"9438b49ea7cd56b92a63",250:"91b2833de2b5caa97de1",251:"cedbf54a78c2a5b69ad1",289:"92967676bcc7eb9c965d",304:"932be47fccde4cb565c1",312:"2cc2557536b872355335",316:"387876773281b1dad94d",346:"fbcd17bafcc07e9ffb1c",382:"149eaca6c7cd1a96ea96",391:"fefe7ba625e4f5756dcd",392:"1308fa47b160c4b93ad6",432:"555921f9d9464f9a0297",495:"9cc63b318311e7aaeb74",496:"cd264056835aeae218d8",500:"2b528a9d09058a33661b",501:"5b3fdd03e21ee0ca7678",513:"a31d579d7131151a02bc",556:"092e9694c7af0e9c7051",562:"73b292bc0298a468eacd",600:"2c29bd4b833e192d8350",630:"dca33d53b9f75cac1ad8",633:"c255182816b983add412",638:"f867b0df2d63a6b15a69",886:"04c4e19a2291ef041213",905:"bded37b59f54f7b2243c",977:"a1dc33b897dba8d280e6"}[e]+".js"),l.miniCssF=e=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="pixlr:",l.l=(e,t,s,i)=>{if(r[e])r[e].push(t);else{var n,a;if(void 0!==s)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==o+s){n=d;break}}n||(a=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,l.nc&&n.setAttribute("nonce",l.nc),n.setAttribute("data-webpack",o+s),n.src=e),r[e]=[t];var u=(t,s)=>{n.onerror=n.onload=null,clearTimeout(p);var i=r[e];if(delete r[e],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((e=>e(s))),t)return t(s)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),a&&document.head.appendChild(n)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.v=(e,t,s,i)=>{var n=fetch(l.p+""+s+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,i).then((t=>Object.assign(e,t.instance.exports))):n.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,i))).then((t=>Object.assign(e,t.instance.exports)))},l.p="/dist/",(()=>{l.b=document.baseURI||self.location.href;var e={166:0,215:0,132:0};l.f.j=(t,s)=>{var i=l.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var n=new Promise(((s,n)=>i=e[t]=[s,n]));s.push(i[2]=n);var a=l.p+l.u(t),r=new Error;l.l(a,(s=>{if(l.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;r.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",r.name="ChunkLoadError",r.type=n,r.request=a,i[1](r)}}),"chunk-"+t,t)}};var t=(t,s)=>{var i,n,[a,r,o]=s,h=0;if(a.some((t=>0!==e[t]))){for(i in r)l.o(r,i)&&(l.m[i]=r[i]);if(o)o(l)}for(t&&t(s);h<a.length;h++)n=a[h],l.o(e,n)&&e[n]&&e[n][0](),e[n]=0},s=self.webpackChunkpixlr=self.webpackChunkpixlr||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),l.nc=void 0;l(4424)})();